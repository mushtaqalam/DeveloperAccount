{"version":3,"sources":["app.js","labels_en.js","org.local.js","Utils/CacheManager.js","Utils/DateUtils.js","Utils/NumberUtils.js","Utils/RecordJobManager.js","ajax/ajax.js","assets/assets.5.js","assets/assets.routes.js","common/Util.js","common/common.js","contracts/contracts.routes.js","docgen/docgen.routes.js","favorites/favorites.5.js","favorites/favorites.routes.js","perfMetrics/MetricsService.js","products/products.5.js","products/products.routes.js","quotes/QuoteContext.js","quotes/quotes.5.js","quotes/quotes.routes.js","subscriptions/subscriptions.5.js","subscriptions/subscriptions.routes.js","Utils/DAOs/UsageRateCardDAO.5.js","common/behaviors/DeviceBehavior.js","common/behaviors/LookupBehavior.js","common/behaviors/SFTableRowBehavior.js","common/core/AppContext.js","common/core/Navigator.js","common/core/Page.js","common/formatter/Formatter.js","common/forms/DateParser.js","common/forms/DependentPicklistBuilder.js","common/forms/Locale.js","common/forms/NumberFormatter.js","common/forms/NumberParser.js","common/oauth/OAuth.js","common/oauth/oauth.local.js","common/relationship/RelationshipFieldManager.js","common/rules/QuoteRuleExecutor.js","common/rules/RuleEvaluator.js","common/rules/RuleExecutor.js","common/signal/AbstractFocusSignaler.js","common/signal/RowFocusSignaler.js","docgen/sb-docgen-preview/DocgenPreview.js","favorites/sb-favorite-lookup/FavoriteLookup.js","favorites/sb-favorite-share-dialog/FavoriteShareDialog.js","products/localization/LocalizeFields.js","quotes/models/AssetQuantityValidator.js","quotes/models/Constants.js","quotes/models/CustomActionModel.js","quotes/models/DiscountTierModel.js","quotes/models/DiscountTiersValidator.js","quotes/models/DragDropModel.js","quotes/models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/JSQCNotifier.js","quotes/models/LineModel.js","quotes/models/MDQSegmentHelper.js","quotes/models/QuoteMessenger.js","quotes/models/QuoteModel.js","quotes/models/SortLinesHandler.js","quotes/models/UiNotifier.js","quotes/precaching/IdConverter.js","quotes/precaching/JSQCPrecacheWorker.js","quotes/precaching/JSQCPrecacheWorkerManager.js","quotes/precaching/PrecacheRestClient.js","quotes/sb-le-custom-action-services/LECustomActionServices.js","quotes/sb-line-sort/QuoteLineSort.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/tables/SFAbstractTable.js","quotes/ui-data-manager/UIDataManager.js","common/aggregate/quote-aggregator/QuoteAggregator.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","common/data/cache/Cache.js","common/data/client/ConnectionClient.js","common/data/client/RemoteClient.js","common/data/client/RemoteSession.js","common/data/client/RestClient.js","common/data/client/ServiceClient.js","common/data/format/DataBuilder.js","common/data/format/ErrorFormatter.js","common/data/format/JsonFormatter.js","common/data/minimize/QuoteMinimizer.js","common/data/sb-describe/Describe.js","common/data/sb-service/Service.js","common/filter/searcher/Searcher.js","common/core/sb-i18n/I18n.js","common/core/sb-loading-spinner/LoadingSpinner.js","common/core/sb-page-container/PageContainer.js","common/core/sb-page-header/PageHeader.js","common/core/sb-toast/Toast.js","common/core/sb-router/Router.js","common/core/sf-loading-spinner/LoadingSpinner.js","common/forms/sb-checkbox/Checkbox.js","common/forms/sb-date-range/DateRange.js","common/forms/sb-datepicker/Datepicker.js","common/forms/sb-discount/Discount.js","common/forms/sb-dual-list-box/DualListBox.js","common/forms/sb-field/Field.js","common/forms/sb-input/Input.js","common/forms/sb-lookup/Lookup.js","common/forms/sb-lookup-dialog/LookupDialog.js","common/forms/sb-multi-lookup/MultiLookup.js","common/forms/sb-pagination/Pagination.js","common/forms/sb-search-bar/SearchBar.js","common/forms/sb-rte/RichTextEditor.js","common/forms/sb-search-bar-dialog/SearchBarDialog.js","common/forms/sb-select/Select.js","common/forms/sb-textarea/Textarea.js","common/forms/sb-typeahead/Typeahead.js","common/layout/data/RecordGrouper.js","common/layout/fields/FieldHider.js","common/layout/fields/FieldSetHandler.js","common/layout/sb-actions/Actions.js","common/layout/sb-badge/Badge.js","common/layout/sb-dialog/Dialog.js","common/layout/sb-div/Div.js","common/layout/sb-field-item/FieldItem.js","common/layout/sb-field-table/FieldTable.js","common/layout/sb-filter-item/FilterItem.js","common/layout/sb-filter-layout/FilterLayout.js","common/layout/sb-group/Group.js","common/layout/sb-html/Html.js","common/layout/sb-lookup-layout/LookupLayout.js","common/layout/sb-popup/Popup.js","common/layout/sb-row-drawer/RowDrawer.js","common/layout/sb-side-panel/SidePanel.js","common/layout/sb-swipe-container/SwipeContainer.js","common/layout/sb-table-cell/TableCell.js","common/layout/sb-table-cell-select/TableCellSelect.js","common/layout/sb-table-header/TableHeader.js","common/layout/sb-table-row/TableRow.js","common/layout/sb-tabs/Tabs.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/RowFieldSelector.js","common/layout/tables/TableClassBuilder.js","common/rules/operators/OpContains.js","common/rules/operators/OpEndsWith.js","common/rules/operators/OpEquals.js","common/rules/operators/OpGreaterThan.js","common/rules/operators/OpGreaterThanEquals.js","common/rules/operators/OpLessThan.js","common/rules/operators/OpLessThanEquals.js","common/rules/operators/OpNotEquals.js","common/rules/operators/OpStartsWith.js","common/rules/operators/OperatorsUtils.js","common/services/sb-field-md/FieldMetadata.js","common/services/sb-job-checker/JobChecker.js","common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js","common/services/sb-line-editor-read/LineEditorReader.js","common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js","common/services/sb-search-model-load/SearchModelLoader.js","common/services/sb-search-model-select/SearchModelSelector.js","products/config/message/ProductMessenger.js","products/config/search/ConfiguratorSearch.js","products/config/viewmodel/ProductViewModel.js","products/resources/optionConstraints/OptionConstraintsHandler.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","products/resources/reconfigure/ProductReconfigurer.js","products/resources/rules/RuleProcessor.js","products/resources/sb-product-alert/ProductAlert.js","products/resources/tree/ConfigTree.js","quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js","quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js","quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js","quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js","quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js","quotes/md/sb-le-field-md/LEFieldMD.js","quotes/layout/sb-cse-table-cell/CSETableCell.js","quotes/layout/sb-custom-action/CustomAction.js","quotes/layout/sb-ds-table-cell/DSTableCell.js","quotes/layout/sb-ds-tiers/DSTiers.js","quotes/layout/sb-field-set-table/FieldSetTable.js","quotes/layout/sb-field-set-table-item/FieldSetTableItem.js","quotes/layout/sb-le-drawer/LEDrawer.js","quotes/layout/sb-le-footer/LEFooter.js","quotes/layout/sb-le-group/LEGroup.js","quotes/layout/sb-le-group-layout/LEGroupLayout.js","quotes/layout/sb-le-list/LEList.js","quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js","quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js","quotes/layout/sb-le-list-row/LEListRow.js","quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js","quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js","quotes/layout/sb-le-summary-row/LESummaryRow.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/layout/sb-le-table-cell/LETableCell.js","quotes/layout/sb-le-table-cell/Localizer.js","quotes/layout/sb-le-table-cell/QuoteLineUpgradeHandler.js","quotes/layout/sb-le-table-cell/Swiper.js","quotes/layout/sb-le-table-header/LETableHeader.js","quotes/layout/sb-le-table-row/LETableRow.js","quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js","quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js","quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js","quotes/layout/sf-le-table-row/ControllingField.js","quotes/layout/sf-le-table-row/DesktopDelegate.js","quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js","quotes/layout/sf-le-table-row/MobileDelegate.js","quotes/layout/sf-le-table-row/NonDiscountableControllingField.js","quotes/layout/sf-le-table-row/PriceEditableControllingField.js","quotes/layout/sf-le-table-row/PricingMethodControllingField.js","quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js","quotes/layout/sf-le-table-row/SFLETableRow.js","quotes/layout/sf-line-warning/SFLineWarning.js","quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js","quotes/layout/sf-line-actions/SFLineActions.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/MobileLETemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/pages/sb-line-editor/LineEditor.js","quotes/precaching/PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/MetadataSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/OptionSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/PriceRuleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/ProductSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/RelatedRecordSequenceRunner.js","quotes/tables/sb-segmented-lines/SegmentedLines.js","quotes/tables/sb-standard-lines/StandardLines.js","quotes/tables/sf-segmented-table/SFSegmentedTable.js","quotes/tables/sf-standard-table/SFStandardTable.js","assets/selection/routes/sb-asset-lookup/AssetLookup.js","assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js","common/forms/sb-checkbox/factory/CheckboxFactory.js","common/forms/sb-datepicker/factory/DatePickerFactory.js","common/forms/sb-discount/factory/DiscountFactory.js","common/forms/sb-field/factory/FieldFactory.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-field/factory/NumericFieldFactory.js","common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/TextFieldFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-lookup/factory/LookupFactory.js","common/forms/sb-lookup/map/LookupNameMapper.js","common/forms/sb-lookup/query/LookupQueryBuilder.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/forms/sb-rte/factory/RichTextEditorFactory.js","common/forms/sb-select/factory/SelectFactory.js","common/forms/sb-textarea/factory/TextareaFactory.js","contracts/selection/routes/sb-contract-lookup/ContractLookup.js","products/config/actions/sb-custom-actions/CustomActions.js","products/config/attribute/sb-attribute-item/AttributeItem.js","products/config/attribute/sb-attribute-table/AttributeTable.js","products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js","products/config/feature/sb-product-feature/ProductFeature.js","products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js","products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js","products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js","products/config/feature/sb-product-feature-list/ProductFeatureList.js","products/config/option/sb-option-cell/OptionCell.js","products/config/option/sb-option-drawer/OptionDrawer.js","products/config/option/sb-product-option-table/ProductOptionTable.js","products/config/routes/sb-dynamic-lookup/DynamicLookup.js","products/config/routes/sb-option-lookup/OptionLookup.js","products/config/routes/sb-product-config/ProductConfig.js","products/resources/model/nestedOptions/NestedOptionsModel.js","products/selection/filter/sb-suggester/Suggester.js","products/selection/routes/sb-product-lookup/ProductLookup.js","quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js","quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js","quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js","subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js","products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js","products/config/routes/services/sb-pc-option-save/OptionSaver.js","products/config/routes/services/sb-pc-product-load/ProductLoader.js","products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js"],"names":["docgen","quotes","assets","contracts","subscriptions","products","favorites","AppContext","I18n","Router","RichTextEditorDialog","App","pageContainer","dbName","settingsObj","urls","r","PREFIX","ROUTES","allRoutes","setBaseUrl","tinymce","Promise","all","init","_initIntlLocale","intl","locale","url","res","rej","xhr","XMLHttpRequest","getURL","open","onerror","e","Error","ontimeout","onload","responseText","data","JSON","parse","addLocaleData","Intl","__addLocaleData","statusText","send","LABELS","Apply","Asset Selection","Cancel","Clear Fields","Filter","Select","searchText","FieldSetWarning","numResults","Save","Edit Description","Search Products","Product Search","Select All","Popup","Add Products","Delete","Favorite Lookup","Select & Add More","Share","Share Favorites","Attributes","Options","showAvailableUpgrades","No visible options in feature","Features","Add Options","Add","Configure Products","Configuration Attribute Error","Configuration Error","Maximum Quantity Error","Add to Cart","Categories","Description","Go","My Favorites","Price","Product Code","Product Name","Start Over","Alert","Continue","Active Contract Selection","Select Contract","Skip","Favorites","Guided Selling","Product Filter","Product Selection","Suggest","Available Groups","Clone To Groups","Select Groups","Selected Groups","Custom Segments","Discount Schedule Editor","Update","Add to Favorites","Favorite Name","Choose Price Book","Details","Total","Quote Total","Add To Favorite","Click to edit description","emptyLinesMsg","mobileEmptyLinesMsg","Remove From Favorites","Segmented Products","Standard Products","Subtotal","invalidPricebookEntry","missingOpportunityLineItem","Edit Quote","emptyGroupedQuoteMsg","emptyQuoteMsg","fullScreenMode","Subscription Selection","settings","developerPrefix","isMultiCurrencyOrg","calculateImmediately","language","defaultCurrency","currencySymbol","currencyDecimalScale","fullName","userName","userId","device","isOAuth","additionalLookupSearchTypes","oik","maxLookupSearchFields","isJSProductRulesEnabled","hasQuoteSelectionProductRules","ui3Enabled","CacheManager","logger","trace","this","_caches","Map","require","getLogger","prototype","getCache","name","cacheClass","debug","cache","get","warn","_typeof","set","flushCaches","resetCaches","forEach","value","clear","CACHE_MANAGER_KEY","Symbol","for","globalRef","global","self","window","globalSymbols","Object","getOwnPropertySymbols","indexOf","_cacheManager","freeze","module","exports","cacheManager","toApexDate","date","toISOString","replace","RegExp","toApexDateTime","dateTime","dateIso","slice","length","toUTCDateString","timezone","getTimezoneOffset","Date","setMinutes","getMinutes","parseInt","toLocaleDateString","distinguishDateFromDateTime","dateString","dateRegex","dateTimeRegex","test","monthsBetween","startDate","endDate","result","getUTCFullYear","getUTCMonth","monthsBetweenRoundPartialUp","getTime","addMonths","daysBetween","msDiff","Math","round","numMonths","currentMonth","setUTCMonth","trueMonth","setUTCDate","addDays","numDays","getUTCDate","daysBetweenIgnoringLeapYearDays","year","numLeapDays","i","j","leapDay","setScale","num","scale","exp","pow","toFixed","RecordJobManager","conn","prefix","_conn","serviceRouterPrefix","_serviceRouterUrl","_setJobStatusProvider","_setJobsStatusProvider","updateJobStatus","recordId","jobType","jobStatus","jobDetails","targetId","context","saver","model","stringify","apexRestCallStartTime","now","info","apex","post","then","apexRestCallEndTime","catch","err","reject","message","updateJobsStatus","recordIds","SB","ajax","System","register","_export","_context","setters","execute","/lookup","comp","mod","/upgrade","Util","n","width","z","Array","join","d","pad","getUTCHours","getUTCMinutes","getUTCSeconds","ctxComponent","object","strProp","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","keys","iterator","next","done","prop","notifyPath","return","fieldValue","filterValue","operator","toLowerCase","startsWith","endsWith","includes","text","frame","document","createElement","body","appendChild","contentWindow","parentNode","removeChild","Polymer","holdTimer","Gestures","deps","flow","start","end","emits","mouseup","up","touchend","changedTouches","clearTimeout","mousedown","down","touchstart","preventer","setTimeout","fire","findOriginalTarget","x","clientX","y","clientY","sourceEvent","/preview","_favoritesSbFavoriteLookupFavoriteLookupJs","_favoritesSbFavoriteShareDialogFavoriteShareDialogJs","MetricsService","msg","canGatherMetrics","_isNotStarted","_init","_queueIdleCallback","console","log","actionName","additionalInfo","sb","internal","sptNum","id","_getUniqueId","actions","_buildTransportAction","metrics","_externalLogMetrics","assign","actionDefs","pageStartTime","ts","_getTime","ns","sptTime","arguments","idleRetries","idleStart","idleTime","_populateTransportAction","entityId","perfNow","_getPageStartTime","visibilityStateEnd","visibilityState","bootstrap","visibilityStateStart","performance","timing","p","pt","additionalMetrics","readyStart","fetchStart","navigationStart","lookupDomainTime","domainLookupEnd","domainLookupStart","connectTime","connectEnd","connectStart","requestTime","responseEnd","requestStart","initDomTreeTime","domInteractive","domReadyTime","domComplete","loadEventTime","loadEventEnd","loadEventStart","loadTime","unloadEventTime","unloadEventEnd","unloadEventStart","appCacheTime","redirectTime","redirectEnd","redirectStart","toJSON","getEntries","resource","summaryRequest","_summarizeResourcePerfInfo","push","lastIdleEndTime","currentPage","ept","bpt","spt","page","attributes","app","appName","appType","location","href","entity","_calcAndDisplayMetrics","_logMetrics","initiatorType","duration","startTime","dns","tcp","ttfb","responseStart","transfer","transferSize","encodedBodySize","decodedBodySize","transportAction","requestIdleCallback","_idle","bind","eptTime","bptTime","transports","allResources","getEntriesByType","_step$value","_slicedToArray","filter","marks","transport","_canDisplayMetrics","metricsChangedEvent","CustomEvent","detail","dispatchEvent","apiHost","m","exec","hostname","_normalizeApiHost","host","protocol","withCredentials","onreadystatechange","readyState","DONE","status","getAllResponseHeaders","defaultAttrs","pkgVersion","apiVersion","common","core","org","version","logLines","logName","logLevel","logAttrs","attrsId","resources","bootstrapEPT","allRequests","formData","FormData","append","URL","URLSearchParams","search","_getRandomInt","min","max","floor","random","_productsConfigAttributeSbAttributeItemAttributeItemJs","_productsConfigAttributeSbAttributeTableAttributeTableJs","_productsConfigBundlesSbProductBundlesLayoutProductBundlesLayoutJs","_productsConfigBundlesSbProductBundlesFilterItemProductBundlesFilterItemJs","_productsConfigFeatureSbProductFeatureProductFeatureJs","_productsConfigFeatureSbProductFeatureLayoutProductFeatureLayoutJs","_productsConfigFeatureSbProductFeatureCategoryListProductFeatureCategoryListJs","_productsConfigFeatureSbProductFeatureListProductFeatureListJs","_productsConfigOptionSbProductOptionTableProductOptionTableJs","_productsConfigOptionSbOptionCellOptionCellJs","_productsConfigOptionSbOptionDrawerOptionDrawerJs","_productsConfigRoutesServicesSbPcProductLoadProductLoaderJs","_productsConfigRoutesServicesSbPcOptionSaveOptionSaverJs","_productsConfigRoutesServicesSbProductRulesInvokeProductRulesInvokerJs","_productsConfigRoutesServicesSbPcOptionConfigureOptionConfiguratorJs","_productsConfigActionsSbCustomActionsCustomActionsJs","_productsLocalizationLocalizeFieldsJs","_productsResourcesSbProductAlertProductAlertJs","/dl","/ol","/pc","/search","constants","QuoteContext","field","ADDITIONAL_DISCOUNT_FIELD","MARKUP_FIELD","LIST_PRICE_FIELD","PRODUCT_NAME_FIELD","NET_TOTAL_FIELD","SUBSCRIPTION_SCOPE_FIELD","_quotesPagesSbLineEditorLineEditorJs","_quotesSbLeCustomActionServicesLECustomActionServicesJs","_quotesMdSbLeFieldMdLEFieldMDJs","_quotesLayoutSbLeGroupLEGroupJs","_quotesTablesSbStandardLinesStandardLinesJs","_quotesTablesSfStandardTableSFStandardTableJs","_quotesTablesSfSegmentedTableSFSegmentedTableJs","_quotesLayoutSfSegmentedCellTooltipSFSegmentedCellTooltipJs","_quotesTablesSbSegmentedLinesSegmentedLinesJs","_quotesLayoutSbSegmentedLineDetailsSegmentedLineDetailsJs","_quotesLayoutSbSegmentedDetailRowSegmentedDetailRowJs","_quotesLayoutSfLeTableRowSFLETableRowJs","_quotesLayoutSbLeTableRowLETableRowJs","_quotesLayoutSfLineActionsSFLineActionsJs","_quotesLayoutSfLineWarningSFLineWarningJs","_quotesLayoutSbLeTableCellLETableCellJs","_quotesLayoutSbDsTableCellDSTableCellJs","_quotesLayoutSbDsTiersDSTiersJs","_quotesLayoutSbLeTableHeaderLETableHeaderJs","_quotesLayoutSbLeTableHeaderCellLETableHeaderCellJs","_quotesLayoutSbLeFooterLEFooterJs","_quotesLayoutSbLeGroupLayoutLEGroupLayoutJs","_quotesLayoutSbLeListLEListJs","_quotesLayoutSbLeListRowLEListRowJs","_quotesLayoutSbLeListGroupHeaderRowLEListGroupHeaderRowJs","_quotesLayoutSbLeListGroupFooterRowLEListGroupFooterRowJs","_quotesLayoutSbLeListStandardLineRowLEListStandardLineRowJs","_quotesLayoutSbLeListSegmentedLineRowLEListSegmentedLineRowJs","_quotesLayoutSbFieldSetTableItemFieldSetTableItemJs","_quotesLayoutSbFieldSetTableFieldSetTableJs","_quotesLayoutSbLeDrawerLEDrawerJs","_quotesLayoutSbLineEditorTabsSbQuoteTabsQuoteTabsJs","_quotesLayoutSbLineEditorTabsSbGroupTabsGroupTabsJs","_quotesLayoutSbCustomActionCustomActionJs","_quotesLayoutSbLeSummaryRowLESummaryRowJs","_quotesLayoutSbLeSummaryRowSbLeSummaryCellLESummaryCellJs","_quotesDialogsSbFavoriteDialogFavoriteDialogJs","_quotesDialogsSbCloneToGroupDialogCloneToGroupDialogJs","_quotesDialogsSbCustomSegmentDialogCustomSegmentDialogJs","_quotesLayoutSbCseTableCellCSETableCellJs","_quotesDialogsSbPricebookDialogPricebookDialogJs","_quotesModelsDragDropModelJs","_quotesDialogsSbDiscountScheduleDialogDiscountScheduleDialogJs","/le","deviceClasses","currentTime","totalComponents","totalTime","DeviceBehavior","deviceNodes","dom","root","querySelectorAll","getDeviceClasses","deviceClass","toggleClass","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","deviceNode","hasInitialized","isPhone","isTablet","time","tagName","CommonBehaviors","LookupBehavior","handleProductsLoadServerResponse","handleHideSearchFilterIfNoSearchColumnsDisplayed","bindFilterEnterCallBacks","addEventListener","removeFilter","TemplateGenerator","SFAbstractTable","SFTableRowBehavior","index","container","querySelector","cells","from","children","templateHTML","template","innerHTML","templatize","stamp","templateNode","content","evt","$$","hook_onHovered","handled","tableComp","getTableComponent","cell","findCell","isEditable","classList","contains","classNames","EDITABLE","isBoolean","BOOLEAN","isFocused","HAS_FOCUS","isEditing","EDIT_MODE","applyCellFocus","setEditOnFocus","paths","path","EDIT_ICON","findEditIcon","toggleInlineEdit","hook_onTap","find","pathElem","tagname","toUpperCase","isEdit","rowTemplate","type","observer","labels","user","i18n","ui","buildUserAndOrgFromSettings","navigator","userAgent","match","i18nClass","resolve","import","userLabels","ret","userAndOrgSettingsSet","lang","fullname","username","inCommunity","hasQuoteEditPermission","quantityScale","orgUrl","orgInstanceUrl","siteUrl","isUI3Enabled","ua","deviceContext","isDesktop","isMobile","obj","properties","Navigator","queryParams","pathParams","newWin","component","u","pLen","pKeys","kLen","encodeURIComponent","setPreviousRoute","hash","urlBase","split","previousRoute","previousParams","_getParams","backupQueryParams","backupPathParams","nav","route","params","param","parts","decodeURIComponent","PageContainer","Page","Base","extend","ctx","viewport","getViewport","NumberFormatter","Html","getUnitAndDisplayValue","updateUnitIfAmountInactive","Formatter","rawData","fieldMetadata","record","dataType","formatter","isDiscountField","isMarkupField","extraTypeInfo","format","formatDiscountField","formatReferenceField","sanitizeHtmlText","calculatedFormula","containsMarkup","formatPicklistData","values","_this","picklistValues","pickListValue","findPickListValue","label","_this2","fieldName","_pickListValuesMap","plValue","numFormatter","metadata","_getUnitAndDisplayVal","displayValue","units","unit","isNaN","selectedUnit","unitLabel","relationshipName","Name","DateParser","stripTime","_classCallCheck","dateTimeFormatSimple","getLocaleData","formats","dateFormats","yMd","separator","dateTimeElements","dateIdx","monthIdx","yearIdx","dateStr","isValidYearFunction","_isValidYear","invalid","elements","day","month","monthEnd","DependentPicklistBuilder","controlledPicklist","controllingValue","options","validOptions","option","_testBit","atob","validFor","_getControllingValueIndex","controllingField","controllingOptions","l","controllingValueIndex","byteToCheck","bit","charCodeAt","Locale","COMMA_DECIMAL_LOCALES","editable","appContext","allowUnits","opts","minimumFractionDigits","maximumFractionDigits","_setCurrencyFormatOptions","_setPercentFormatOptions","isCommaDecimal","useGrouping","isNil","formattedValue","style","currency","CurrencyIsoCode","currencyDisplay","NumberParser","isCommaDecimalLocale","numberStr","strict","applyScale","removeUnusualSeparators","removeNonDecimalCommas","removeDecimalSepartors","replaceCommaDecimalWithPeriod","number","parseFloat","NaN","OAUTH_KEY","OAUTH_SECRET","PRIVATE_API_SECRET","OAUTH_PROXY_URL","OAUTH_LOGIN_URL","port","oauth2","clientId","clientSecret","redirectUri","proxyUrl","loginUrl","OAuth","tokens","_getNoOAuthClientKeyMessage","storeTokens","jsforce","browser","Client","_storeTokens","localStorage","setItem","_prefix","refresh_token","removeTokens","_removeTokens","removeItem","getTokens","_getTokens","refreshToken","getItem","isLoggedIn","connection","cookie","OAuth2","_refresAccessToken","login","once","accessToken","callback","_transport","httpRequest","method","headers","SalesforceProxy-Endpoint","tokenServiceUrl","Content-Type","response","statusCode","error","error_description","thenCall","instanceUrl","userInfo","_getParameterByName","instance_url","access_token","issued_at","results","LookupNameMapper","RelationshipFieldManager","getRelationship","relationshipField","getRelationshipField","nameField","relationship","_getLookupName","display","tableName","buildRelationship","Id","getNameField","relationshipTable","idField","substring","RuleExecutor","RuleEvaluator","QuoteRuleExecutor","quote","rules","errorStrings","_possibleConstructorReturn","__proto__","getPrototypeOf","call","requiredProductIds","lineItemsById","lineItems","line","PRODUCT","ruleEvaluator","rule","isRuleSatisfied","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","ACTIONS","records","action","_conditionallyAddToResponseObject","responseType","TYPE","_productAdded","productId","OperatorsUtils","_setConstants","_setAliasedFieldsMap","ERROR_CONDITIONS","TESTED_VARIABLE","CONDITIONS_MET","TESTED_OBJECT","TESTED_FIELD","FILTER_VALUE","FILTER_TYPE","OPERATOR","aliasedFieldsMap","Quote","Group Line Items","_hasActions","_hasErrorConditions","conditionsMet","condition","testedVariable","testedObject","conditionDetails","packageConditionDetails","evaluateCondition","evaluateCollection","lineItemGroups","_throwError","msg_jspr_err_summary_variable_used","msg_jspr_err_no_tested_object","_canReturnImmediately","op","getInstance","errorMsg","msg_jspr_err_invalid_operator","collection","len","collectionResult","target","testedValue","_getValue","evaluate","testedField","aliasedField","msg_jspr_err_no_tested_field","totalSize","actionType","AbstractFocusSignaler","element","focusEvents","blurEvents","signalName","unregister","fireFocusSignal","_fireSignal","fireBlurSignal","focusEvent","removeEventListener","blurEvent","focused","_fireSignals","lastSignaler","_getLastSignaler","_setLastSignaler","_toggleDisabled","_isDisabled","fireSignal","targets","getSignalTargets","signaler","last","disabled","RowFieldSelector","RowFocusSignaler","row","groupId","cellName","rowId","rowIndex","rowIndexAttribute","ironList","groupIds","constructor","fields","group","current","selector","selectNextEditableField","selectPreviousEditableField","first","selectFirstEditableField","selectLastEditableField","signal","table","rowName","selectFirstEditableFieldInFirstRow","rowNum","selectLastEditableFieldInLastRow","templates","title","DocgenPreview","is","DataBuilder","ErrorFormatter","QuoteLineAggregator","FavoriteLookup","lineEditorModel","favoriteModel","selectedFavorites","errors","notify","qId","String","aId","groupKey","Number","Boolean","_isMobileViewport","$","le","md","_setMetaData","fm","_setSelected","addFavorite","partialVO","_recombinePartialQuoteWithFullQuote","_toggleSelected","addMore","jspr","header","selected","shareFavorites","add","groups","users","build","_handleOneFavoriteSelected","_handleAllFavoritesSelected","partialQuote","originalLines","concat","segmentTemplatesByDimensionTypeByGroupKey","emptyGroupKeys","cols","resultFieldNames","colsDisplay","fieldLabels","numFields","primaryMobileCols","favorite","bool","rows","tbody","favoriteIds","deleteFavorite","shareFavorite","dialog","toggle","largeQuoteThreshold","largeQuoteMessage","customLabels","msg_large_quote_sent_without_lines","_minimizeQuoteVO","addQuote","largeQuote","smallQuote","qla","getSegmentTemplatesByDimensionTypeForGroupKey","getKeysOfEmptyGroups","onSelect","validations","truncate","errors-changed","FavoriteShareDialog","favdUsers","favdGroups","favoriteCallback","Function","_favoriteCallbackFunction","iconMap","User","Group","onCancel","searchValue","multilookup","updateTable","service","uid","menuItemLabels","_parseResults","numGroups","numUsers","selectedIdsByItems","items","map","k","numItems","_clearFavdLists","LocalizeFields","searchModel","localizedProducts","localizationByFieldByProductId","localizedFields","Product2Id","localizedValue","getLocalizedValue","Product2","product","localized","localizedFeatureName","untranslatedRecord","localizationByFieldName","localizedOptionField","features","feature","AssetQuantityValidator","quoteModel","quoteType","TYPE_FIELD","_validateAssetQuantityChangeForRenewal","_validateAssetQuantityChangeForAmendment","errMsgs","renewal","RENEWAL_CHECKBOX","existing","EXISTING_FIELD","priorQty","PRIOR_QUANTITY_FIELD","currentQty","QUANTITY_FIELD","newErrMsg","NUMBER_FIELD","negativeQtyLines","linesWithTooManyUpgrades","linesWithTooFewUpgrades","qty","upgradedQty","existingProduct","carryoverLine","UPGRADED_ASSET_FIELD","CARRYOVER_LINE_FIELD","UPGRADED_QUANTITY","ALLOW_ASSET_REFUND_FIELD","lineNumbers","substr","lastIndexOf","prodName","QUOTE","QUOTE_LINE","QUOTE_LINE_GROUP","ACCOUNT_FIELD","ACCOUNT_ID_FIELD","ACTION_FIELD","ADDITIONAL_DISCOUNT_AMOUNT_FIELD","ADDITIONAL_DISCOUNT_RATE_FIELD","ADDITIONAL_QUANTITY_FIELD","BATCH_QUANTITY","BUNDLE_FIELD","BUNDLED_FIELD","BUNDLED_QUANTITY_FIELD","CLASS_FIELD","COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD","COMPONENT_LIST_TOTAL_FIELD","COMPONENT_SUBSCRIPTION_SCOPE_FIELD","COMPONENT_VISIBILITY_FIELD","CONDITIONS_MET_FIELD","COST_EDITABLE_FIELD","CUSTOM_ACTION_CONDITIONS_FIELD","CUSTOMER_AMOUNT_FIELD","CUSTOMER_PRICE_FIELD","DEFAULT_SUBSCRIPTION_TERM_FIELD","DEFAULT_FIELD","DESCRIPTION_FIELD","DIMENSION_ID_FIELD","DIMENSION_FIELD","DISCOUNT_AMOUNT_FIELD","DISCOUNT_SCHEDULE_FIELD","DISCOUNT_SCHEDULE_TYPE_FIELD","DISCOUNT_TIER_FIELD","DISCOUNT_TIERS_FIELD","DISCOUNT_UNIT_FIELD","DISTRIBUTOR_DISCOUNT_FIELD","EFFECTIVE_QUANTITY","END_DATE_FIELD","EVENT_HANDLER_NAME_FIELD","FAVORITE_ID_FIELD","FIELD_FIELD","FILTER_VALUE_FIELD","GROUP_LINE_ITEMS_FIELD","ICON_CLASS_FIELD","LABEL_FIELD","LOCATION_FIELD","LONG_TEXT_AREA_FIELD","LOWER_BOUND_FIELD","MARKUP_AMOUNT_FIELD","MARKUP_RATE_FIELD","NET_AMOUNT_FIELD","NET_PRICE_FIELD","NON_DISCOUNTABLE_FIELD","NON_PARTNER_DISCOUNTABLE_FIELD","OPERATOR_FIELD","OPPORTUNITY_FIELD","OPPORTUNITY_ID_FIELD","OPTION_LEVEL_FIELD","OPTION_TYPE_FIELD","OPTIONAL_FIELD","ORIGINAL_QUOTE_LINE_FIELD","ORIGINAL_SCHEDULE_FIELD","OVERRIDE_BEHAVIOR_FIELD","PAGE_FIELD","PARENT_CUSTOM_ACTION_FIELD","PARTNER_DISCOUNT_FIELD","PARTNER_PRICE_FIELD","PRICE_EDITABLE_FIELD","PRICEBOOK_ID_FIELD","PRICEBOOK_LOOKUP_ID_FIELD","PRICING_METHOD_EDITABLE_FIELD","PRICING_METHOD_FIELD","PRIMARY_FIELD","BRAND_BUTTON_FIELD","PRODUCT_CODE_FIELD","PRORATE_MULTIPLIER_FIELD","QUOTE_PROCESS_FIELD","QUOTE_PROCESS_ID_FIELD","REGULAR_PRICE_FIELD","RENEWED_ASSET_ID_FIELD","RENEWED_ASSET_RELATIONSHIP_FIELD","RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD","REQUIRED_BY_FIELD","RICH_TEXT_AREA_FIELD","SEGMENT_INDEX_FIELD","SEGMENT_KEY_FIELD","SEGMENT_LABEL_FIELD","SOURCE_FIELD","SPECIAL_PRICE_FIELD","START_DATE_FIELD","SUBSCRIBED_ASSET_IDS_FIELD","SUBSCRIPTION_BASE_FIELD","SUBSCRIPTION_PRICING_FIELD","SUBSCRIPTION_TERM_FIELD","TARGET_CUSTOMER_AMOUNT","TARGET_OBJECT_FIELD","TEXT_FIELD","TEXT_AREA_FIELD","UNIT_COST_FIELD","UPGRADE_CONVERSION_RATE","UPGRADED_SUBSCRIPTION_FIELD","UPLIFT_FIELD","UPPER_BOUND_FIELD","URL_TARGET_FIELD","URL_FIELD","RETURN_URL_FIELD","USE_PRICE_FOR_AMOUNT_FIELD","USER_DEFINED_FIELD","UNOPENED_FIELD","CUSTOM_VALUE","PANEL_ADDED_INDEX","PERCENT_OF_TOTAL","TYPE_STANDARD","TYPE_YEARLY_DIMENSION","TYPE_QUARTERLY_DIMENSION","TYPE_MONTHLY_DIMENSION","TYPE_SINGLE_DIMENSION","TYPE_CUSTOM_DIMENSION","STANDARD_LINE","SEGMENTED_LINE","GROUP_HEADER","GROUP_FOOTER","QUANTITY_FIELDS","Set","UNIT_PRICE_FIELDS","LineModel","CustomActionModel","editorModel","customAction","customActionModelsByParentId","renderLocation","icon","class","caClass","eventHandlerName","isSeparator","primary","urlTarget","_customActionsConditionsMet","hasParent","isAmendment","configurable","lineVO","productHasDimensions","segmented","bundle","dsField","isDiscountScheduleIdExcluded","grouped","toggleOptionalShown","allOptional","renewSubscriptionsButtonRendered","isAmendmentOrChangeQuote","upgradeAssetsButtonRendered","multiLineDeleteEnabled","meetAllConditions","conditions","productVO","arithmeticOperatorConversion","quoteVO","isHidden","isDefault","DiscountTierModel","discountTierRecord","discountScheduleRecord","discountSchedule","hidden","tiers","DiscountTiersValidator","schedule","unitPriceScale","priceScale","lastTier","lowerBound","upperBound","lastUpperBound","discountUnit","discount","formatLabel","msg_missing_lower_bound_tier","msg_unequal_lower_upper_bounds_tier","msg_upper_greater_tier","tier","discountFormatted","msg_missing_discount_amount_tier_currency","msg_missing_discount_amount_tier","msg_missing_discount_tier","args","toString","_addTopBorderClass","node","topBorderHighlightClass","_addBottomBorderClass","bottomBorderHighlightClass","removeTopBottomBorderClass","remove","isComponent","el","lineModel","ifLineElementsShareParent","eL1","eL2","parentItemKey","ifLineElementsAreParentChild","key","dragging","DragDropModel","keepBundle","draggable","validTargets","dragFunc","trackFunc","dropFunc","ghostXOffset","ghostYOffset","keepBundleTogether","sourceElement","hoverOver","placeHolderComp","ghostField","targetClass","dropBefore","usePlaceholder","highlightTargetPosition","highlightableElements","enableHighLight","lineEditor","linesByParentKey","linesByParentItemKey","standardLinesByParentKey","standardLinesByParentItemKey","segmentedLinesByParentKey","segmentedLinesByParentItemKey","ghost","handleDrag","handleTrack","handleDrop","_bootstrapMetricsService","metricsService","mouseX","mouseY","stopPropagation","preventDefault","state","abs","dx","dy","startTransaction","localTarget","sourceBox","getBoundingClientRect","sourceWidth","sourceHeight","height","_appendGhostImage","_moveGhost","hoverOverComp","event","hover","_showGhost","_hideGhost","debounce","RenderStatus","afterNextRender","previousHoverOverComp","_removePlaceholder","_removeHighlightHover","_usePlaceholder","_highlightHover","toggleAttribute","removeAttribute","_removeGhost","ghostElement","_clonePolymerElement","loadingSpinner","gX","gY","left","top","visibility","_ifParentIsValidTarget","localName","domHost","_findTableRowValidTarget","drag","dimensionType","groupModel","phLoc","navItems","hoverElement","ref","previousElementSibling","nextElementSibling","lineKey","nodeName","rootNode","_findParentCustomElement","parentElement","classArr","has","boundBox","midHeight","deepCloneNode","setAttribute","create","backgroundColor","targetHost","insertBefore","hasAttribute","getAttribute","clonedElement","cloneNode","rowComp","tds","getElementsByClassName","QuoteModel","Constants","EditorModel","_observers","fieldsetMap","_createFieldsetMap","fieldNameSet","fieldsMap","quoteLineObjectName","required","excludedDiscountScheduleIds","_convertExcludedDiscountScheduleIdsToObject","largeQuoteExperienceEnabled","summarized","summaries","createQuoteModel","standardPrimaryMobileCols","segmentedPrimaryMobileCols","segmentedDetailsPrimaryMobileCols","_isToggleOptionalShown","customActionsByLocation","customActionsByLocationMobile","groupMobileMenuButtonAction","_updateCustomActions","_initCustomActions","customActions","quoteCustomActions","lineCustomActions","Line","styleQuoteAndGroupActionButtons","communityPrefix","_getCommunityPrefix","isMultiGroupViewEnabled","multiGroupViewEnabled","styleActionButtons","lastCustomAction","pathname","idx","controllerFieldName","controllerName","standardLineItemDrawerFieldNames","productHierarchyVisualized","reduce","accumulator","actionsColumnPlacement","fieldsetList","_createFieldsetList","fieldset","containsOptional_Field","lineFieldNames","multiSegmentLineFieldNames","defaultCustomActions","validLocations","customActionsByParentId","addGroupCustomActionModel","addToLocation","customActionModel","default","parentId","childCustomActions","solutionGroupsEnabled","solutionGroups","addGroupChildren","sgL","solutionGroupAction","depth","loopThroughActionsByLocation","FieldSetHandler","setDiscountValue","getSubchange","setThenNotify","GroupModel","groupVO","standardLines","segmentedLines","dimensions","dimensionsMap","segmentedLinesByDimension","segmentedLinesBySegmentKey","segmentedLineKeysBySegmentKey","standardSubscriptionScopeEditable","segmentedSubscriptionScopeEditable","groupObjectName","multiSegmentColumnTotals","netMultiSegmentTotal","hasVisibleStandardLines","hasVisibleSegmentedLines","standardLineFieldNames","_setStandardLineFieldNames","groupFieldNames","_getFieldSetNames","_setDrawerFields","lineType","lineModelsByKey","_addSegmentedLine","_addStandardLine","segments","addToLinesByParentItemKey","visible","indexByGroupKey","parentGroupKey","indexByLineKey","subscriptionScopeEditable","lineRecord","segmentKey","segmentLabel","dimension","multiSegmentKeys","segmentedLineKey","segmentsByLabel","firstSegment","setDimensionProperties","addToSegmentsArray","addToSegmentsByLabel","indexBySegmentKey","dim","splice","stdMap","mdqMap","groupSelected","newLineVO","clone","_hasCards","_cloneCards","nextKey","_updateColWidths","cards","getRateCards","oldCards","newCards","originalRateCard","rateProperty","rates","setCards","cloneLine","cloneSegmentKey","lineSegmentKey","multiSegmentRowTotals","clonedSegment","multiSegmentColumns","localizedMultiSegmentColumns","colWidth","Standard","s","removedLine","canDeleteLines","lines","every","fieldSetHandler","fieldSet","getByViewport","fieldSetName","_getFields","drawerFields","standardLineDrawerFieldNames","optional","_callChildren","subchange","groupMD","_this3","_this4","_lineType","lt","_this5","favIds","rowType","_toConsumableArray","JSQCNotifier","lineEditorComponent","propertyNameSet","pathNameSet","elem","pathsToNotify","originalPathValues","pathsToSet","groupModels","lineGroups","modelVO","previous","groupIndex","lineIndex","pop","notifySpecificPath","parentQuote","segmentIndex","dimensionsLength","columns","columnKeys","columnsLength","hasOwnProperty","lineItemDrawerIconClass","_getLineItemDrawerIconClass","expandedIconClass","_getExpansionClass","isVisibleInLineEditor","hasParentLine","setItemClassMap","discountScheduleId","expanded","hasStandardLineItemDrawer","getFieldMD","fieldEditability","updateable","quantityEditable","listPriceEditable","discountable","discountEditable","nonPartnerDiscountable","partnerDiscountEditable","upliftable","unitCostEditable","pricingMethodCustom","pricingMethodDisabled","bundled","pricingMethodCost","descriptionLocked","PACKAGE_PRODUCT_CODE_FIELD","PRORATED_LIST_PRICE_FIELD","subscription","isMDQ","fieldVisibility","componentVisibility","renewedAssetId","renewedAssetsHiddenWhenEditing","rateCards","itemClassMap","isFieldRendered","dynamic","productPullIns","hasConfiguration","hasConfigurationAttributes","renewalQuotesWithoutAssetsAllowed","legacySupport","productQuantityEditable","costEditable","dynamicSubscription","nonDiscountable","componentDiscountedByPackage","rootPackage","reconfigurationDisabled","configurationType","configurationEvent","pricingMethodList","_hasStandardLineItemDrawer","asset","layout","colWidths","segmentsLength","getField","updateCustomSegments","scheduleId","MDQSegmentHelper","groupModelsByKey","MONTHLY_DIM","YEARLY_DIM","QUARTERLY_DIM","LINES_GROUPED_FIELD","FIRST_SEGMENT_END_DATE_FIELD","_segmentsChanged","_hasMultiSegmentLines","_adjustSegments","lineCount","term","_calculateSubscriptionTerm","_calculateSegmentDeltasAndModifySegments","startDateFieldValue","endDateFieldValue","subscriptionTermValue","firstSegEndDateFieldValue","firstSegEndDate","subscriptionTermUnitIsDay","firstSegPlusOneDay","setDate","getDate","dimType","segmentDeltasBySegmentKey","_calculateSegmentDeltas","size","_modifySegmentsBasedOnDelta","termIsDay","segmentCountsBySegmentKey","lineSegKey","currentSegCount","mapSegmentCountsBySegmentKeys","trueSegmentCount","termStartDate","quoteEndDate","ceil","determineDesiredNumberOfSegments","segKey","deltaMap","delta","lastSegment","_getLastSegmentFromQuote","noDelta","amendmentLine","lastSegStartDateFieldValue","lastSegEndDateFieldValue","lastSegStartDate","lastSegEndDate","newSegmentVO","_createNewSegment","processQuoteLines","_removeSegment","lineItem","maxIndex","sourceSegment","offset","whitespace","card","rate","segmentToRemove","deletedLineIds","QuoteMessenger","targetRecord","quoteTypes","RENEWAL","AMENDMENT","CHANGE_ORDER","groupsByKey","selectedLinesByKey","isPrimary","isRenewal","isChangeQuote","lineVOs","shouldNotify","quoteMD","deepRenumber","renumberStandardIndexes","renumberSegmentedIndexes","invisibleIdx","numOfGroups","numOfDimensions","numOfLines","numOfSegments","toggleOptional","resetDiscounts","notifyUi","quoteObjectName","_ref","apply","flattenedRows","SortLinesHandler","lineSortField","sort","a","b","lineSortValue","difference","aSecondary","bSecondary","observers","modelObservers","delete","unregisterMap","modelAttr","lastInd","convertTo18","part1","convertToDigit","part2","part3","seg","CONVERSION_TABLE","str","string","reverse","00000","00001","00010","00011","00100","00101","00110","00111","01000","01001","01010","01011","01100","01101","01110","01111","10000","10001","10010","10011","10100","10101","10110","10111","11000","11001","11010","11011","11100","11101","11110","11111","importScripts","Connection","sessionId","sequence","client","load","provider","read","mdType","setOptions","apexFactory","precacheSequence","runnerConstructor","PriceRuleSequence","MetadataSequence","OptionSequence","DiscountAndAccountSequence","ProductSequence","RelatedRecordSequence","postMessage","failure","close","argumentList","resultPoster","accountId","referencedFieldMap","lookupFieldMap","referencedFields","getArgumentList","executeSequence","JSQCPrecacheWorkerManager","filePath","vfSessionId","_spoolWorkers","priceRuleWorker","_createWorker","priceRuleContext","_createWorkerContext","metadataWorker","metadataContext","discountWorker","discountContext","relatedRecordWorker","quoteLookups","groupLookups","lineLookups","allLineLookups","nonstandardLineLookups","fieldPrefix","relatedRecordContext","productWorker","productContext","optionWorker","optionContext","extrasMap","baseContext","val","wrkr","Worker","precachingFn","_precache","successful","JSQCPrecacher","precacheValue","restClient","proxy","endpoint","request","patch","restProxy","getEndpoint","ConnectionClient","JsonFormatter","LECustomActionServices","eventDetail","pseudoServiceModel","lineFilterFn","serviceModel","_usesClientCalculator","sortLines","_reorderLineItems","_reorderGroups","essentialLines","allLines","isLargeQuote","QuoteDAO","_saveLargeQuote","getConnection","saveQuote","sobject","upsertBulk","_bulkService","insertBulk","deleteBulk","oppSync","QuoteOpportunitySynchronizer","promiseArray","updateOpportunityProducts","_checkIfRecordJobFailed","afterPromiseArray","_saveRateCardsAttachedToQuote","_SetRecordJobCompleted","_handleLargeQuoteSaveResponse","createError","showSpinner","rateCard","savedRateCards","cardSaverService","saveBatch","save","cardIndex","baseUrl","recordsCopy","executeBatch","saverResponse","_reloadEditor","lineEditorReader","sbLineEditorRead","clearFromCache","sortRequired","updateAfterJSQC","notifier","_executeServiceAction","favName","noLines","noEssentialKeys","keysToKeep","getComponentKeys","linesToKeep","updateQuote","favoriteResponse","updatedQuote","originalQuote","originalLineCount","originalGroups","originalGroupCount","_removeFavoritesFromQuote","unfavoriteResponse","favIdSet","favFieldName","favs","favId","_updateQuote","_executeCustomURLAction","onSave","parsedURL","_parseURL","_handlePopup","_navigateToURL","calculateResponse","jobId","_onJobChecker","guidedMessages","handleProductRuleAlertModal","navigateToReturnUrl","messages","returnUrl","sobjectId","inFullScreenMode","exitFullScreenMode","acknowledgement","origin","_isLightningExperience","sforce","one","navigateToSObject","Sfdc","Url","getUrlParameters","isdtp","parent","destampGroups","quoteEditorModelResponse","toggleGroupResponse","destroyTabs","rightSideButton","_extendSolutionGroupRecord","buildQuoteTabs","quoteHasNoLines","popupResponse","onQuickSave","reload","popup","messenger","targetModel","splitValues","objectName","shift","isRedirect","navigateToURL","updateQuoteRequired","doneCallback","_jsqcCalculate","calculationRequired","sortLineItems","_createEditorModel","updateUIAfterCalculate","alertModal","displayContinueButton","cancelCB","alerts","calculateService","background","saveService","_save","quickSaveService","selectedGroupKey","returnGroupKeyAfterQuickSave","_navigateToLookup","keysToDelete","_retrieveKeysOfSelected","_deleteLines","renumber","onFlagCalculate","keyToDelete","_resetOnActionSignal","_addGroup","_groupQuote","_ungroupQuote","defaultName","lbl_default_group_name","defaultNameDefined","groupRecord","_createGroupRecord","thePrefix","deletedGroupIds","largeQuoteMsg","lineOmissionMsg","targetKey","keptLines","resegmentResponse","firstSegmentKey","segCount","combinedLineList","firstSegmentLine","transformedLine","_transformLineToNonSegmentedLine","finalLineList","lookingForParent","includeSiblingSegments","deletedLineIndexes","deletedRateCardIds","relatedKeysToDelete","_getAllRelatedKeys","parentGroup","newFavIdList","fId","updatedLineList","segmentedLineModel","renumberIndexes","optionType","actualQuantity","getActualQuantity","toggleOptionalBoolean","_cloneGroup","newGroup","linesInOtherGroupKey","allStandardLinesMap","originalLine","_getRootPackage","_cloneLine","canDelete","confirm","_deleteGroup","_removeGroup","_this6","removeGroup","parentItemKeys","_quoteModel$quoteVO$d","newLines","newlineItemGroups","ligroup","newlineGroups","lgroup","ignoreCache","_openDialog","_executeQuotelessServiceAction","selectedGroups","indexes","_clearSelectedCheckbox","emitter","cloneToGroupDialog","_this7","clonedLines","clonedSegmentedLines","Year","Quarter","Month","Custom","_addParentAndAllChildLineItems","cloneSegmentedLine","components","standardLinesLength","bundleKeptTogether","clonedLine","_addClonedLines","segmentedLinesToSplice","segmentedLinesLength","lastSegmentedLineKey","segmentedLineModelToSplice","_addClonedSegmentedLines","usesClientCalculator","JSQC","displayedLookupMap","getDisplayedLookupNames","updateSegments","qc","connectionPromiseArray","connections","setConnection","setCustomerOnlyConnection","onCalc","successQuote","lineFields","groupFields","quoteFields","job","jobchecker","useSpinner","payload","backgroundCalculatePending","saveServiceAfterBackgroundCalc","invalidQtyMessages","validateAssetQuantityChanges","usesBackgroundCalculator","lookupName","customActionId","gmLength","removable","_this8","thisLine","childLines","childKeys","grandChildKeys","segment","standardSubScope","segmentedSubScope","oldGroupModel","defaultQuoteProcessId","dialogName","favDialog","favoritedLine","groupLines","favoritedGroup","sb-favorite-saved","sb-clone-to-group-selected","job-completed","sortLinesAscByKey","sortLinesAscByField","A","lookupNameField","sortByField","B","isABundled","isBBundled","Localizer","updateFieldFormat","sortLinesDescByField","isBundled","arr","byOrder","startingNumbers","lowestVisibleNumber","lowestInvisibleNumber","lineNumber","getStartingNumbers","depthFirstTraversal","tree","makeLineItemsTree","array","reorderLineNumbers","fieldFactory","SFComponentFactory","referenceDetails","selectOptions","refDisplay","refDisplayName","refTable","referenceTable","referenceTo","computeRefTable","refObjects","controllerValue","findAdjacentRow","cur","isUp","isLQE","curTag","adjParent","child","adj","getCellMetadata","findParentRow","_getFieldMetadata","LETemplateGenerator","MobileLETemplateGenerator","IGNORED_ELEMENT_KEYS","INPUT","TEXTAREA","SELECT","segmentedColumns","isSecondary","isSameTable","activeElement","removeCellFocus","focusedCell","keyCode","_onEnterKeyPress","_onSpaceBarPress","_onEscapePress","_moveCellFocus","shiftKey","_routeKeyEvent","_toggleInlineEditIfFocused","_editOnFocus","parentRow","onKeyDown","_isCellFocusedAndEditable","blur","keepEditableFocus","focus","direction","tag","newParentRow","nextCell","parentEl","adjRow","getCellRowIndex","getCellByIndex","focusableChildren","isLeft","clazz","UIDataManager","quoteLineFields","uiData","recordUI","prepareFieldData","computeCellClass","prepareSegmentedLineData","prepareSelectionCheckbox","prepareWarningIcon","_cellClasses","_selectionCB","DISABLED","validPricebookEntryExists","hasLineWarning","opportunityLineItemExists","lineWarningKey","lineWarningMsg","isSubscriptionScopeField","isListPriceField","_updateFieldMetadata","formatFieldData","quantityFields","productQuantityScale","segmentData","cellClass","HIDE_CHECKBOX","isProductHierarchyVisualized","computeProductHierarchyCss","isProductNameField","isNetTotalField","INDENT","isBundle","CHEVRON_DOWN_ICON","TOP_LEVEL","OPTION","QuoteAggregator","clientQuote","serverQuote","requiredKeys","linesRequiringInjection","linesBelongingAtEnd","serverLineCount","existingLineKey","resultLines","_quote","_linesByKey","devPrefix","_constants","_getPriorBundledQuantity","idSet","upgradedAssetIdField","upgradedAssetId","existingField","productIdField","customKey","yearlyKey","monthlyKey","quarterlyKey","customSegs","monthlySegs","yearlySegs","quarterlySegs","dimensionIdField","dimensionField","typeField","segmentKeyField","groupKeySet","prior","parentPrior","_isCarryoverLine","_getCarryoverQuantity","_optionTypeIsComponent","carryoverQuantity","parentItem","sourceLineKey","sourceLine","AssetUpgradeQuantityCalculator","upgradeHandler","source","upgrade","isSourceLine","getLine","_getUpgrade","_getSource","setSourceAndUpgrade","_setAutomaticQuantity","getSourceOrUpgrade","didUserChangeSourceQuantity","upgradeRatio","_getUpgradeRatio","getSourceIdField","getUpgradeConversionRateField","sourceCurrentQty","getSourceCurrentQuantityField","upgradeCurrentQty","getUpgradeCurrentQuantityField","sourceRate","upgradeRate","sourceQtyAfterUpdate","upgradeQtyAfterUpdate","sourcePriorQty","getSourcePriorQuantity","invalidQuantity","validQuantity","didSourceQuantityChange","didUpgradeQuantityChange","isSelected","setUpdatedQuantity","sourceIdField","upgradeConversionRateField","sourceId","upgradeSourcesBySourceProductId","Cache","createEvent","initEvent","RemoteSession","Visualforce","getRemoteConnection","RestClient","RemoteClient","VF_MAX_INPUT","_remoteConnection","_restClient","reader","_remote","loader","_isPayloadTooLarge","_model","sObject","describe","soql","query","input","_getAction","startServiceRequest","remoting","Manager","invokeAction","_callback","escape","timeout","_getPrefix","stopServiceRequest","_parse","_getApex","_getEndpoint","_resolve","_reject","fileType","fileId","fileContentsField","oauth","_getConnection","errorMessage","_adjustErrorMessage","ServiceClient","fullNames","streamFileContents","pretty","omitRelationships","addObject","omitNull","int","topLine","fieldsToKeep","requiredFieldSet","getRequiredFields","_replacer","QuoteMinimizer","groupkey","stripLinesThreshold","stripLinesMessage","hasRelatedLines","existingProductIds","getExistingProductIdsFromLines","_getNecessaryLineKeys","sentLines","relevantKeys","configuration","lineItemKey","_addLineKeyWithRecursiveCallOnChildrenAndSource","rootLine","rootIsParent","rootIsUpgrade","isChildOfRoot","isSourceOfRoot","Describe","objects","ordered","_describe","waiting","objectFields","allFields","controlledFields","mdFields","controlledField","controllingFieldName","controllingPicklist","promises","Service","mdItems","transient","promise","_returnPromiseIfCachedResponse","_response","spinner","cachedResponse","cachedPromise","_services","_createError","escapedValidations","validationsArray","Searcher","searchFilterData","targetObjectName","hasCustomSearchFilters","targetFieldName","searchFilterModel","searchFilters","isLookupType","queryLookupFilterName","stringValue","handleDynamicSearchFilters","responses","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","searchFilter","dynamicSearchFilters","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","isBlank","filters","numFilters","filterValues","_id","searchValues","getFilterContext","dateFormatCache","numberFormatCache","localeData","_replaceWildcards","isDate","f","loc","stringKey","DateTimeFormat","NumberFormat","v","fmt","_getFormat","ymd","_additionalCurrencyFormat","formattedCurrency","containsDash","additionalContent","trim","LoadingSpinner","show","isReady","previousState","toggleSpinner","mqXS","matchMedia","mqSOnly","mqMOnly","mqLOnly","mqXL","activeSpinners","_buildViewport","matches","xs","xl","XS","S","M","L","XL","only","bpS","bpM","bpL","_setupViewportListeners","sender","html","_viewportChanged","updateStyles","originalErr","view","go","nv","router","addListener","domId","getContainer","PageHeader","showMenu","menuClosed","hideFullTitle","searchbar","debugMode","mode","_setupMetricsServiceListeners","textContent","fullTitle","innerText","opacity","_closeMenu","buttons","rootTarget","changeMenu","lookup","invoker","rte","metricsData","sticker","targetElement","openClass","toggler","rect","currentTarget","bs","bottom","right","innerWidth","Toast","hasMessages","messagesModel","repeatHandlers","errorMsgs","msgs","successMsgs","warningMsgs","infoMsgs","numMessages","messagesSplit","removeRepeatedMessages","repeat","isMessageRepeated","toggleRepeatClass","msg1","msg2","ll","removeAnimationListeners","addAnimationListeners","handler","removeRepeatClass","__data__","routes","private_router","PATH_PARAM_REGEX","autoHash","readOnly","modules","modulePaths","_loop","paramNames","paramMap","on","paramsLen","routeHandler","pos","qsParams","queryString","ov","same","dispatch","position","FieldHider","Checkbox","focusOnAttached","applyFocus","hide","checkbox","applyTo","DateRange","Datepicker","selectedDate","range","dateParser","isActive","weeks","weekDays","calendars","gregory","days","short","months","long","getFullYear","getMonth","monthName","className","newDate","oldDate","initialized","dateFormatted","_selectedDateChanged","dateObj","updateVariables","suppressImmediateCalcuation","ensureProperYearInSelectedAndShowCalendar","haveEnsured","_showCalendar","years","isIE","yearsCreated","_createOptionElements","yearSelection","selectedOptions","select","optionEl","updateCalendar","datepicker","datePicker","dateContainer","_clickHandler","some","hideCalendar","updateYearPicklist","increment","firstDay","getDay","week","dayIdx","noblur","dateInput","emptyDate","getLocaleDate","parsedDate","hasSelectedDate","invalidInput","selectDay","validateInput","escaped","updateDate","showCalendar","highlight","setSelectionRange","convertDiscountValue","registerComponent","Discount","property","unitChanged","numberParser","original","checkThenSetDiscountValue","deferBlur","tabBlur","discountUnits","convertDiscountValueThenUpdate","blurred","tabBlurred","blurDiscount","isInput","renderReadOnly","resetToOriginal","directBlur","tabBlurEvent","_blur","oldValue","unitValue","selectUnit","selectedIndex","_getUnitAndDisplayVal2","DualListBox","availableTitle","chosenTitle","chosenOptions","availableOptions","_clearSelected","available","availableOptionsSelected","chosen","chosenOptionsSelected","valueSet","KEY_READ_ONLY","KEY_DOWN_READ_ONLY","BLUR_READ_ONLY","HIDE_FIELD","REF_DISPLAY","Field","computed","editing","_wasEverEditable","link","objAndRefObjects","objKey","refObjectsKey","originalFormattedValue","hideFormattedValue","preventNumericAlignment","tabIndex","factoryData","handleRowFocusSignal","handleFieldEditSignal","isInternalObject","rendered","isReadOnly","updateTemplateData","_render","ff","createBaseElement","onChange","onKeyupReadOnly","onKeyDownReadOnly","keepNewValue","onBlurReadOnly","originalValue","formField","getFormField","getFormattedValue","_onChange","getEventTarget","isNumericType","fireCustomChangeEvents","fireControllingSelectChangeEvent","bubbles","isRenderReadOnly","signalNextPreviousEditableTarget","setPreviouslyFormattedValue","previouslyFormatted","isLookup","enableSignals","defaultValue","addFormattedValueClasses","numeric","setFormattedDetails","attachTo","getSelectOptions","formatted","segmentedAlignment","isDirty","isBool","isEmpty","me","disable","enable","toggleRowFocus","lastVisibleIndex","toggleScrollListener","scrollListenerDetached","edit","ownerDocument","firstChild","valueChanged","clickEdit","_nodes","invertValueIfInlineBoolean","signalRowFocus","ex","returnTrueIfEverEditable","isFormulaHtml","isRichText","htmlFormatted","calculated","booleanValue","sanitizeAndSetInnerHTML","controllerSelectHandler","sameRecord","equals","buildSelectOptions","_selectOptions","clearInvalidValue","getValue","clearValueIfNotAnOption","clearValue","setValue","Input","inputType","showClear","_hideClearIfEmpty","fireChangeOnBlur","newValue","changeOnNextBlur","fireChangeEvent","LookupQueryBuilder","Lookup","limit","labelName","selectedLabel","lookupCallback","lookupResultsCallback","hideInputAndShowPill","hideCancelIcon","inDialog","blurDisabled","focusDisabled","tableLabel","placeholder","showSearchIcon","mobile","fieldFullName","hasFilter","controllingFields","currentRecordFilters","dialogMetadata","setTableLabel","typeahead","handleEnterPressed","setCurrentRecordFilters","labelPlural","customCallback","queryLookupResults","q","apiVersionString","__md__","clearAfterSelection","noFocusAfterSelection","tableParts","searchLabel","handleSearchResults","_setLabel","setSelectedItem","getLabel","selectedItem","setHideInputAndShowPill","_handleSelectedItemChanged","handleSelectedItemChanged","fireLookupValueChanged","applySearchValue","querySearchResults","item","forceSuggest","labelsByValue","_getLabelValueKey","setOriginalSelected","suggest","deletePill","previousBlurDisabled","buildSearchText","_clearAndSave","clearAndSave","_applySearchValue","lookupFieldTable","currentRecordFiltersKeys","TableClassBuilder","LAYOUT_FIELD_SET","SEARCH_FIELD_SET","ALLOWED_SEARCH_TYPES","DEFAULT_SEARCH_TYPES","LookupDialog","fieldLabel","openSpinner","recordSpinner","hideCancel","layoutFields","searchFields","lookupSearchTypes","maxSearchFields","fieldSetPrefix","cancel","setValues","processListFields","updateLookup","setResultsHeightHandler","setResultsHeight","assignParentResizable","stopResizeNotificationsFor","dialogOpened","hasList","labelValue","itemLabel","syncSelection","deferredClose","dialogClosed","reset","clearSelected","destroyGroup","fs","getSelectedLabelValueById","fieldSets","searchFieldsNotInLayout","getCpqLookupSearchFields","names","initMobileMetadata","getCpqLookupLayoutFields","warnUserAboutCPQLayoutFieldSet","omittedNameField","getNameFieldIfOmittedFrom","initSearchFieldsAndReturnOnesNotInLayout","fieldNames","fieldTypeByName","fieldTypeObjByName","fieldTypeByLabel","fieldsOfTypeLookup","headerClassMap","rowClassMap","additionalSearchFields","sanitizeAdditionalSearchFields","sanitizedAdditionalSearchFields","searchField","warnUserAboutSanitizedCPQSearchFieldSet","plus","getResults","overflow","isMobileWithSpotlight","mobileSpotlight","offsetBottom","documentElement","clientHeight","offsetTop","scrollHeight","dataTableHeight","datatable","mask","marginLeft","notifyResize","getCpqLookupFields","forSearch","validCPQFieldSet","df","displayedFields","displayedField","sanitizedSearchFields","setSelected","saveAndDeferredClose","MultiLookup","iconName","selectedItems","customCallBack","_animateDuplicate","_addItem","_appendMobileClasses","unshift","flush","pills","selectedContainer","dataValue","_ret","lookupContainer","resultsTable","dataIndex","Pagination","pageIndex","pageSize","firePageEvent","numPages","pageWindow","nextDisabled","previousDisabled","pageNum","SearchBar","searchedValue","searchService","actionId","searchResultCallback","showResetButton","searcher","handleItemSelected","showAllResults","itemsCallback","typeAheadCallback","localizer","isSearchValid","getSearchResultRow","enabled","serviceCallout","mostRecentResults","parseResults","getFilterContextFromSearcher","getSearchContext","buildContext","localizeSearchModel","productRecord","reg","inner","second","DisplayName","RichTextEditor","SearchBarDialog","attachSearchProperties","attachSearchEvents","updateSearchResults","displayResults","isRequired","noneLabel","multiSelect","_multiple","_options","newVal","oldVal","buildOptions","noneSelected","_getValues","childNodes","getValues","Textarea","textarea","wildCards","Typeahead","debounceDelay","itemsList","delimiter","savedLabelValue","invalidLabel","hasLabel","optionIndex","revertOnEscape","calculateListPosition","showListNoSuggestion","showListOnFocus","hideInput","showLeftSearchIcon","noSearchItem","disjointLabel","_directInputFocus","_directInputBlur","isAttached","updateItemsList","valueAttr","originalSelected","numOfOptions","numOfLabels","updateItem","hideList","forceSuggestOnFocus","clearSelection","focusOrBlurAfterSelection","searchLabels","highlighted","numOfItems","cloneItem","showItem","noBlur","selectAdjacentItem","showList","preventBlur","focusing","_showListOnFocus","force","leftOffset","NOT_GROUPED_NAME","RecordGrouper","groupField","groupedRecordFields","recordPath","itemProperties","itemPropertiesByGroup","groupProperties","groupCountPath","groupFieldType","groupFieldTypePath","orderdGroups","itemsByGroup","_get","notGrouped","groupedItems","groupie","grouper","_setProperties","_sortItemsByGroup","orderedGroups","groupItem","propertiesKey","types","desktop","tablet","phone","desktopFields","tabletFields","phoneFields","_getPhoneFieldSet","_getTabletFieldSet","_getDesktopFieldSet","Actions","rowActions","addedManually","disabledData","onTapFunction","shouldDisable","invisible","iconTitle","configured","configurationRequired","Badge","_updateTarget","_setVisibility","_target","updatePosition","targetRect","thisRect","ownerRoot","Dialog","modal","hideHeader","appendedClass","cancelText","Type","closeDialog","hideCloseIcon","hideCancelButton","mobileDropDown","tapDialog","ignoreMaskTap","observeNodes","mobileButtons","dropDownButton","footer","numChildren","dropDownMenu","onCloseDialog","dateContainerBoundingClientRect","contentBoundingClientRect","datepicker-opened","Div","FieldItem","helpText","inlineHelpText","rfm","hasRelationship","getRelationshipName","FieldTable","numColumns","column1Group","column2Group","column3Group","columnOneWidth","columnTwoWidth","columnThreeWidth","setColumns","firstColumn","secondColumn","thirdColumn","FilterItem","reflectToAttribute","handleKeyPress","handleLabelChange","itemType","process","filterItem","FilterLayout","filterPath","filterKey","filterDelegator","groupItems","serviceLoader","enterCallback","translationCallback","serviceCallback","sendQuoteRecord","resultLimit","searchContext","mdResponse","handleEnterKeyPressed","searchModelInitialized","eval","isArray","getSearchTable","duplicateHidden","getGroupKey","buildFields","setFilterValueMap","groupKeys","fieldsByObject","skipDefaults","setDefaultFilterValues","panel","applyFocusToItem","noSpinner","builderModel","getAdditionalProperties","quiet","groupClass","itemClass","groupDisplay","primaryItems","numPrimary","includePrimaryInSecondary","pathPrefix","focusIndex","itemEditableMap","columnWidths","oldMap","newMap","g","_item$classList","_item$classList2","initInternalGroupAndPrimaryItems","_group","_updateColumnWidths","_itemClassMapChanged","_updateItemClasses","buildItems","addedNodes","bindElementEvents","_setColumnWidths","columnWidth","props","_primaryItems","_normalizeWithTemplateGroup","secondary","doc","classes","_createColumnWidthStyleHtml","div","numElements","updateFocusIndex","propagateValueToParent","childToParentExtension","propagateFromParentToChildOverride","_propagateFromParentToChild","primaryEventsResistered","itemField","dateRowRect","offsetParent","dateContainerRect","offsetWidth","DEFAULT_WIDTH","DEFAULT_HEIGHT","useImage","checkboxBase64","padding","handleDefaultSizeIfImage","imageNoWidth","imageNoHeight","_tabindex","tabindex","sanitizeHtml","allowedTags","defaults","allowedAttributes","img","span","parser","decodeEntities","ImageCellSizer","LookupLayout","selectedRows","totalCount","hasTotalCount","maxSelectAll","selectionIdDataPath","parentAttributesPath","additionalFields","groupByField","groupByFieldType","_primaryMobileColumns","rowsByGrouper","viewResultsIndexById","viewResultsIds","headerSelectionDisabled","headerSelectionTooltip","mobileRowDetails","keyPressed","lastClickedIndex","_setupKeyPressListeners","handleAllRowsSelected","handleOneRowSelected","handleMetaDataResponse","hiddenByGroup","expandMobileRow","selectMobileRow","expandRow","scrollTarget","initRecordKeysFieldLabelsAndTypeMap","deSelectAll","fieldMetadataInitialized","setFieldMetadata","metadataFields","recordKeys","fieldLabelMap","typeMap","labelTypeMap","itemTypeMap","labelWidths","currencyIsoCode","isMobileViewport","imageWidth","getImageWidth","selectAllClicked","toggleRowSelections","processed","_isValidViewResultId","viewResults","viewResult","selectOneRow","getSelection","removeAllRanges","handleRangeSelection","autoSelectGroupRows","rowData","_selectedChangeByParent","UnitPrice","getViewResults","hasGroupedField","_resetMobileDetails","expandAll","setGroupExpandedHandler","viewResultIndex","_indexViewResult","groupRow","grouperExpanded","expandedRows","setGrouperClasses","_viewResults","isGrouped","groupExpandedHandler","expandGroupedViewResults","list","_setMobileExpandDetails","_setMobileSelectedDetails","expandDetails","_setMobileDetails","selectedDetails","virtualIndex","_computeVidx","_physicalCount","details","ids","scrollToIndex","groupStart","_notifySplice","_scrollPosition","firstVisibleIndex","_adjustScrollAfterExpandRow","_updateScrollerSize","_getMaxResultsToSelectAll","_getMobileDetails","includePath","expandDisabled","_enabledExpand","_findRowIndex","numKeys","IronScrollTargetBehavior","channel","responseMessage","closePopup","autoLaunched","backOnCancelOrClose","_initRpc","_sendMessage","_handleAutoLaunch","_close","_getRedirectDetails","redirectDetails","rpc","destroy","redirect","featureOptionIds","dynamicOptions","easyXDM","Rpc","remote","local","_receiveMessage","outgoing","getRequest","incoming","getResponse","received","_logReceivedMessage","back","auto","RowDrawer","richTextFields","highlightOnFocus","columnGroups","rteColumn","signalOnFocus","SidePanel","renderHeader","arrows","sideText","isOpen","SwipeContainer","listeners","expanded-changed","disableSwipe","preventSwipe","isRequiredRowNotSelected","groupExpanded","swipeHeader","swipeMenu","swipeItems","swipeItemWidth","variant","_preventSwipe","minWidth","mutations","_findSwipeHeaderAndMenu","nodeType","Node","TEXT_NODE","COMMENT_NODE","_initSwipeHeader","swipeHeaderStyle","maxWidth","listen","setScrollDirection","swipeContainer","_animate","_closeMenuWhenTapped","swipeItem","allNodesOfSwipeMenu","swipeMenuItems","shadowRoot","currentNode","_isValidSwipeMenuItem","swipeItemsLen","speed","transition","_setSwipeItemStyles","swipeItemStyle","webkitBackfaceVisibility","borderRadius","_initSwipeMenu","track","_trackMove","blah","cho","getComputedStyle","distance","toPrecision","transform","dist","fav","TableCell","setDisabled","setHidden","setRecordId","setSuffix","setFieldMetadataFromModel","suffix","fullWidthItem","TableCellSelect","isRadio","_attached","_setDisabled","_setHidden","TableHeader","selectable","selectionType","selectionDisabled","selectionTooltip","headerActions","hideHiddenSelectable","col","registeredDataChangedHandler","registerSelectionChangedHandler","selection","selectionChangedHandler","selectionData","hideSelection","TableRow","row-swiped","routeSource","requiresModel","constrained","parentIdDataPath","repeatPrimaryMobileCols","ignoreViewportChange","editFirstWhenSelected","rowSwiped","selectionClass","leftClass","highlightRowOnFocus","deferGrouping","selectionOnLoad","forceColumnWidths","mobileExpandedDetails","mobileSelectedDetails","disableSelectionTabFocus","hasTogglePlaceholder","hasToggle","togglePlaceholder","setPrimaryMobileColumnsIfMobileViewport","setFullWidthIfGroupRow","_cloneColumnWidths","changed","editFirst","fireSetSelectionEvent","itemToEdit","bundleId","defaultHidden","hasDeleteAction","selectionContainer","_broadcastGroupSelected","_broadcastMobileSelected","_groupSelected","tableRow","expandPath","internalExpand","mobileSelected","isGrouper","rowDiv","setGrouperToggle","_toggleGroupHandler","toggleGroupHandler","expected","expand","eventTarget","isExpanded","_transient_","optionDrawerExpanded","_isGrouperRow","_configurationRequired","added","firstColumnWidth","Tabs","tabs","pageComponent","pageData","commonData","selectedTabIndex","selectedPageIndex","tabsClass","usePagination","paginationClass","tabLimit","overflowTab","overflowTabClass","overflowTabMenuClass","menuMaskClass","bindingData","hideTabs","contentContainerClass","tabContainerClass","pageElements","overflowTabMenuDisabled","overflowTabMenuLabelDisabled","_enforceValidTabSelected","_buildTabs","paperTabs","pages","_initTemplateData","_buildPages","templateBindData","_bind","tab","CaseMap","camelToDashCase","attr","appendBindData","_addComplexObserverEffect","requiresTemplateBindData","selectedTab","changeTab","_changeTab","tabLength","_ensureOverflowTabMenuDisabled","_ensureOverflowSelection","_displayOverflowTabName","getElementsByTagName","overflowTabMenu","overflowTabMenuLabel","overflowTabIndex","_getTabIndexByLabel","overflowMenuItems","isMenuItemSelected","selectedPage","isInteger","_deselectPreviouslySelectedTab","iconId","iconSpan","closeMenu","firedEventName","tabToDisplay","pagination","tabClassName","hideIcon","overflowIconSpan","fireTabSelected","_handleOverFlow","dashKey","dashBind","hasVisibleContent","_disabled","_changeToNextEnabledTabQueued","_changeToNextEnabledTab","nextEnabledPageIndex","_getNextEnabledPageIndex","ii","TableLayoutBuilder","parentElWidth","actionsOnTheLeft","hasSelection","hasStandardDrawer","availableWidth","_getAvailableWidth","totalWidth","numOfCols","widthPerCol","imageCols","_getMultiplier","totalColsWidth","diff","numberOfColsDivisor","totalAdjustedWidth","adjustedWidth","_getStaticColsWidth","labelMultiplier","_getImageWidth","hasInvalidWidth","_warnInvalidWidthParameter","imageFunctionStartIndex","_getImageFunctionStart","imageFunctionEndIndex","_getImageFunctionEnd","_getWidthFromImageFunctionArgs","headerWidth","formula","numOpenParenthesis","numClosedParenthesis","_selectEditableFields","_selectNextEditableField","_selectPreviousEditableField","currentIndex","targetIndex","_selectFirstEditableNextRow","_selectLastEditablePreviousRow","nextRow","_selectRowByIndex","nextRowSelector","previousRow","previousRowSelector","_selectTableRowByIndex","firstRow","lastRow","firstLastClassSuffix","typeByColumnMap","allColumnClasses","classMap","_appendTypeClass","_appendFirstAndLastColumnClasses","_appendAllColumnClasses","_addWidthStyles","prevNumeric","isNumeric","_isNumericType","_isBooleanType","_appendClass","firstInnerClass","lastInnerClass","secondInnerClass","column","columnClass","typeAndWidth","_setWidthStyle","classToAppend","existingClass","OpContains","opType","testValue","fStr","tStr","OpEndsWith","OpEquals","testValueCache","fieldValueCache","valueOf","lowerCaseTest","lowerCaseField","valueFor","valueType","otherValue","OpGreaterThan","fieldTime","testTime","OpGreaterThanEquals","OpLessThan","gte","OpLessThanEquals","gt","OpNotEquals","OpStartsWith","OP_EQ","OP_NEQ","OP_LT","OP_LTE","OP_GT","OP_GTE","OP_SW","OP_EW","OP_CONT","FieldMetadata","doNotFixObjectName","fieldSplit","buildFieldList","JobChecker","asyncNumList","firstStatusTime","lastStatusTime","_setLoadingSpinner","_checkStatus","_useSpinner","Status","_isFinished","cancelAsync","_getStatusMessages","asyncNum","async","_ping","waitTime","_isFailure","LineEditorCacheSaver","LineEditorReader","quoteId","quoteuid","cachedLineEditor","loadEditorModel","addToCache","_setIsLastReadQuoteUnopened","isLastReadQuoteUnopened","ProductRulesQuoteLineAdder","productIds","linesAddedByRules","builder","targetGroupKey","reduceQuote","revertQuote","SearchModelLoader","lineAggregationMethod","processId","dataModel","aggregator","aggregatedData","SearchModelSelector","stripQuoteLines","selectedProducts","selectedProductList","quoteProcess","useCache","selectionArray","ProductViewModel","ProductMessenger","extender","_initializeProduct","optionFieldSets","defaultOptionPaths","additionalOptionPaths","configuredProductId","lineItemId","configurationAttributes","_createConfigAttributesMap","optionConfigurations","_createFeatureOptionsMap","configurationData","_appendReadOnlyProperties","clones","_cloneProduct","_extendResponseQuote","_extendResponseProduct","_extendResponseProducts","optionNotifications","_getResponseOptionPaths","config","_getMatchingQuoteLine","featuresMap","featureName","changedExternally","optionSelectionMethod","_mixInUnselectedOptionsToAdd","_pushOptionConfigurations","featureOptions","isClick","_createPseudoOptionConfiguration","Quantity","optionConfiguration","pseudoOptionConfig","optionId","ProductCode","ProductName","featureId","addedOptions","addedOption","responseQuote","_sanitizeObject","responseProduct","productKey","_extendResponseConfigurationData","_extendResponseConfigurationAttributes","_extendResponseOptionConfigurations","responseConfigurationData","externalConfigurationData","responseConfigurationAttributes","responseOptionConfigurations","parentProductKey","fieldSetFields","responseOptionConfigurationsByOptionId","featureOptionConfigurations","_createDynamicOption","sourceOptions","sourceOption","_extendResponseOptionConfiguration","sourceData","optionFeature","_setOptionDataForClickFeature","_setOptionDataForNonClickFeature","_extendQuantityAndConfigurationDataToOption","opt","_createOptionConfigurationFromOption","_extendConfigurationDataToOption","additionalOptionPath","responseProducts","_resetFeatureOptionConfiguration","_buildProductKey","_enableSaveToLineEditor","responseOptionPaths","ConfiguratorSearch","fieldTypes","featureInput","showOptions","numOptions","hasFilterValues","hiddenByRule","configAttributes","configAttributesByFeatureId","filtered","isUpgrade","searchKeys","multiFilterValues","multiRecordValues","multiUTLRecordValues","fv","featureLookupId","optionsById","optionIndexById","optionsByFeatureId","featuresWithOptionsOrConfigAttr","featureIdsWithOptionsOrConfigAttr","featureIdsWithSelectionMethodAdd","featureIdsWithSelectionMethodClick","featureIdsWIthSelectionMethodDynamic","configurationAttributeValueMap","configurationAttributeModelMap","configurationAttributeTargetFieldMap","configurationAttributeApplyToOptionMap","attributeValueMap","productRulesActions","originalDataByOptionIds","optionDataByOptionIds","featureIdByOptionId","productOptionConfigurationsMap","initializeProduct","isOptionLookupViewModel","dummy","getFeature","isClickFeature","maxOptions","attribute","optionLayout","featureCategoryLabels","featuresWithoutCategory","tabFeaturesMap","featureCategories","category","featureCategory","appliedImmediately","getOption","localizeProduct","featureLabel","initConfigAttributesById","initConfigurationAttributeMap","initOptionInfo","buildOptionConfigurationMap","getOptionSelectionMethod","initFeatureOptionConfigurations","addFeaturesWithOptionsOrConfigAttr","configuredOption","visibleSelected","isAddFeature","setOptionDisabledData","quantityLabel","minQuantityLabel","recordSelected","recordRequired","unitPrice","productName","setConfigurationAttributesToOptions","removed","mappedFeaturelessOptions","createOtherOptionsFeature","virtualFeatureTitle","recordHasQuantity","attributeSet","attributeItemIdsByOptionId","hasAttributeItems","addAttributeItems","addToOptionByFeatureId","discountAmount","discountRate","quantity","addOptionButtonLabel","addOptionDialogTitle","instructionsText","attributeItems","attributeItemById","drawerIconClass","duplicate","displayRadio","notInitialized","unsortedOptionConfigs","isDynamicFeature","initOptionActions","initReconfiguredOption","sortAndAddOptionConfigs","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","isNotClick","createOptionAction","addOptionConfigurationAction","mobileDisabled","fireEvent","numAttributes","featureless","configData","configurationAttributeValue","myId","autoSelect","shownValues","hiddenValues","applyToProductOptions","configsArray","cloneOptionAndSyncConfiguration","syncOptionToConfigData","setPropertiesWithConfig","requiredOptionAdded","clonedOption","dynamicId","getProductOptionConfigurationData","optionData","dynamicOptionKey","containsUpgrades","unsorted","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_loop2","optionConfig","o","_iterator8","constraintsByConstrained","optionConstraintsByConstrained","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","createConstraintHoverMessage","constraint","Requires","Excludes","constraintMessage","ungroupedConstraints","ungrouped","connector","constrainingOption","groupName","statement","groupedOption","constraining","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","requirement","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_step11","_iterator11","exclusion","OptionConstraintsHandler","setOptionConstraints","constraints","constraintType","constrainedOption","constraintGroup","byConstraining","byConstrained","constrainingByConstrained","constrainedId","constrainingId","optionConstraints","changedOptionId","addedOrSelected","disabledState","optionIsConstrained","hasGroupConstraints","constraintObj","isConstrainedByUngrouped","isConstrainedByGrouped","getUnaffectedDisabledState","requiredConditionMet","excludedConstrained","requiredConstrained","associatedOption","associatedType","constrainedByDependency","constrainedByExclusion","constrainedWithinGroup","len2","priorOptionExists","optId","isDependency","hasUngroupedConstraints","hasGroupedConstraints","c","OptionUpgradeHandler","priorBundledQuantity","sourceOp","upgradeOp","upgradeOption","sourceProductIds","didUserChangeSourceOption","NestedOptionsModel","ProductReconfigurer","nestedOptionModel","buildOptionConfiguration","isDynamicOption","optionConfigs","segmentedMap","isSegmented","buildStrippedOptionData","productConfiguration","newConfiguration","RuleProcessor","validationMessages","optionDataByOptionIdAndIndex","initValidationMessages","initProductRulesActions","initDescendantTree","initOptionDataByOptionIdAndIndex","configuredProducts","onLoad","selectedOptionIds","disabledOptionIds","hiddenOptionIds","deselectOptions","hideOptions","enableOptions","disableOptions","serverOption","assignProductRules","optionNotInPricebook","handleProductActions","listPrice","positiveAction","negativeAction","rulesProcessed","selectedByRule","indices","parentInfo","childInfo","handleDescendantRules","ProductAlert","continueCB","_onCancel","ConfigTree","idProperties","buildSubtree","_buildNode","getChildren","currentLevel","_findOnLevel","nodeId","_buildId","CloneToGroupDialog","availableGroupTitle","chosenGroupTitle","_getSelectedGroups","isContainerHighlighted","CustomSegmentDialog","dataLineModels","lineModels","deletedLineKeys","headerSelected","targetRowElement","dragDrop","segmentRows","onTrack","lineModelByStartDate","currentLineModel","newLineModel","startDates","_buildDialog","_combinePartialQuoteWithFullQuote","resetData","fullQuote","lineSetsBySegmentKey","linesByKey","_sentMDQKeys","linesSharingKey","combinedList","errorResponse","_onAddByIndex","toggleMenu","segmentGroup","newRows","click","_onDeleteLineData","_resetProperties","_validateCustomSegmentLabels","_validateCustomSegmentDates","hasInvalidSegmentDates","msg_invalid_custom_segment_dates","hasInvalidSegmentLabels","msg_invalid_custom_segment_labels","hasNonConsecutiveDates","msg_nonsequential_custom_segment_dates","hasOverlappingSegments","msg_overlapping_custom_segment_dates","updateSegmentMap","_getCustomSegmentUpdates","_createQuoteWithoutUnaffectedLines","updatedLineKeys","endDates","segmentLabels","UpdateCustomSegmentsService","necessaryLineKeys","necessaryLineIds","sentMDQKeys","necessaryLines","_buildFieldsMD","_toggleAllCheckBoxes","_buildRowData","_buildHeaderActions","quoteLineMD","fieldsMD","fieldsLength","fieldMD","rightAction","addAction","lbl_add_segment","deleteAction","lbl_delete_custom_segments","dataMap","lineModelsLength","_updateData","updates","customSegmentLabels","segmentStartDate","segmentEndDate","segStartDate","segEndDate","hasInvalidDateFormat","prevSegment","dayAfterEndDate","allowsNonConsecutiveCustomSegments","sb-cancel-custom-segment","add-tapped","delete-tapped","DiscountScheduleDialog","dialogTapped","discountUnitField","_calculateDiscountAmounts","discountTiers","buildRowData","_handleDialogTap","_handleDialogMouseEvents","currencyCode","loadDiscountScheduleService","overrideBehaviorField","savedTiers","usePriceForAmountField","_setDSFields","showRevertBtn","originalScheduleField","tierModels","buildTiers","buildFieldData","_createActions","_toggleEditableClasses","_buildTabData","newScheduleId","discountScheduleResponse","discountScheduleField","changedRecord","discountTierRecords","_retrieveRecords","previousLowerBound","lowerBoundField","fieldTableData","fieldsArray","discountScheduleModalFieldNames","tierField","priceLabel","lbl_price","prefixedFieldsByFields","discountAmountField","prefixedFieldsArray","_isFieldShown","numberField","_retrieveSchedule","_createBlankTierRecord","tierModel","_createRowActions","_renumberLines","_selectCheckboxes","_processForSaving","userDefinedField","quoteLineField","discountScheduleJSON","tiersJSON","ignoreValidate","discountScheduleUpdaterService","discountScheduleClonerService","dialogOverlapping","hiddenTiers","_sortTiers","visibleTiers","_updateActions","_createTiers","validate","tiersField","discountRateField","quantityField","specialPriceField","upperBoundField","errorsArray","rowNumber","currentQuantity","userDefined","lastPositionIndex","lowestBound","highestBound","_retrieveVisibleRecords","disabledDiscountTier","specialPrice","lowerBoundList","tiersByLowerBound","sortedTiers","msg_identical_lower_bounds","isoCodes","currencyIsoCodes","isoCode","_createMultiCurrencyRecord","_toggleDialogClasses","applyClasses","sbDialog","fieldsEditable","AccountId","tId","FavoriteDialog","favoriteKeys","numGroupLines","PricebookDialog","pricebooks","selectedPricebook","pricebookLoaderService","pricebookSaverService","LEFieldMD","fieldLabelsMap","unitPriceFields","objName","CSETableCell","render","tableCols","quoteLineFieldsMD","CustomAction","actionHidden","button","groupAction","horizontalAlign","horizontalOffset","verticalOffset","hasMenu","_hasMenu","_getLabel","_toggleButton","_setButtonClassAndLabel","DSTableCell","handleOriginalValues","DSTiers","FieldSetTable","quoteFieldNames","FieldSetTableItem","datepickerHeight","offsetHeight","datepickerWidth","windowHeight","innerHeight","windowWidth","distanceFromBottom","distanceFromRight","_updateLookupDisplayValue","addRelationshipName","originalRecord","sb-field-on-change-field","LEDrawer","_isRichTextField","_visibilityChanged","_editabilityChanged","LEFooter","quoteTotal","quoteTotalMd","_setTotalWidth","showQuoteTotal","labelClass","lineEditorTotalsField","_setQuoteTotal","total","totalsField","applyAdditionalDiscountLast","customerTotal","netTotal","LEGroup","subtotal","subtotalMd","descriptionMd","groupLevelTabs","favorited","_updateTableProperties","_updatePageData","_setIsButton","buildGroupTabs","containerClass","isButton","groupHasStandardProducts","_groupHasStandardProducts","groupHasSegmentedProducts","_groupHasSegmentedProducts","groupedAndHasNoLineItems","_groupHasLineItems","groupHasBothProducts","_groupHasBothProducts","_showSubtotal","_setGroupDescription","localizedDimensionNames","iconClass","iconEvent","groupMDQTabs","groupModelKey","_getDescriptionMd","description","groupObjMd","lineEditorGroupSubtotalsField","_getSubtotal","showSubtotal","subtotalField","namesForGroupLayout","_renderTabs","tabName","sourceIndex","upgradeIndex","sourceLineVO","upgradeLineVO","_notifyQuantityChanged","index1","index2","invalidQuantityCheck","validQuantityCheck","internalUpdate","removeDimensionProperties","_onTrack","dragElement","dragLineModel","dragGroupModel","dragKey","dragIndex","dd","_updateMDQTableRowHoverOverObject","dropElement","dropElementBefore","dropKey","dropIndex","dropGroupModel","dropLeGroup","_updateSegmentedSubscriptionScopeEditable","removeSegmentedLine","getOwnerRoot","addSegmentedLineToEmptyTable","dropGroupId","addSegmentedLineToExistingTab","dragTable","dropTable","_prepareUIData","cseDialog-tapped","segmented-changed","upgrade-asset-quantity-changed","LEGroupLayout","noHeader","layoutLink","layoutWidth","layoutLeft","drawerState","lastSelectedGroup","_resize","buildLayout","splicedRecords","indexSplices","addedCount","addedIndex","addedKey","observersAttached","_attachObservers","closePanel","openPanel","drawerPanel","mainPanel","paddingLeft","navTo","isFullScreenToggleEvent","multiDeleteEnabled","hasLines","_getMaxTableWidth","_calculateGroupWidth","getElementById","clientWidth","tableLayoutBuilder","_getQuoteStandardFields","getTotalWidth","multiSegmentFieldNames","_getQuoteSegmentedFields","groupLayout","_getGroupStandardFields","getLeftOffset","_getSegmentedFieldNames","subsScope","_getStandardFields","multiSegmentSummaryFieldNames","multiSegmentLineSummaryFieldNames","colNames","summaryFields","_observeNodes","removedNodes","processNewGroups","processRemovedGroups","toggleSelectedAndScroll","unobserveNodes","groupElement","_scrollIntoView","scrollIntoView","scrollTop","prevGroupKey","currentGroupKey","sbDroppableSidePanelGroups","_findSidePanelGroupValidTarget","side-toggle-clicked","LEList","_ironListResize","_onUpdateSizeForItem","updateSizeForItem","LEListGroupFooterRow","LEListGroupHeaderRow","isStandard","_setSubtotal","_setFieldNames","columnNames","getFields","standardLineColumnWidths","factoryMap","LEListRow","wrapper","targetName","currentEl","targetEl","LEListSegmentedLineRow","LEListStandardLineRow","LESummaryRow","getUnproratedDiscount","price","rawDiscount","modifier","targetCustomerAmount","targetCustomerTotal","getEffectiveQuantity","amountDiscountProrated","priorQuantity","isAdditionalDiscountField","additionalDiscountUnitOptions","defaultAdditionalDiscountUnit","markupUnitOptions","defaultMarkupUnit","previousDisplayValue","nullifyAll","unproratedDiscount","amountMultiplier","changeAdditionalDiscountUnit","cost","markup","changeMarkupUnit","Swiper","QuoteLineUpgradeHandler","ICON","RIGHT","CENTER","OVERRIDDEN","LETableCell","fieldClass","detailsOnHover","renderTooltip","wasModelIsChangedCalledBeforeAttached","_modelIsChanged","quoteLineUpgradeHandler","getSourceLineVO","getUpgradeLineVO","_quantityChanged","assetUpgradeQuantityCalculator","overrideEditable","_setEditable","_setFieldMD","_setFieldClassAndFieldContent","dependentPicklist","_showDetails","userChangedLookupValue","_updateRelationshipName","_isSegmentedDrawer","_togglePreventNumericAlignment","_toggleSegmentedAlignment","overrideValue","setQuantitiesByRatio","getIndexes","lineModelKeys","lineModelKeysLength","_getLineModel","tap","productLocalization","productFieldLocalization","sourceOrUpgradeLineVO","_findLineWithTargetAssetId","groupCount","seekExistingLine","targetAssetId","key2","didUserChangeSourceLine","swiping","primaryCells","leTableRow","classFollows","pcLength","LETableHeader","fieldClasses","fieldsRenderedAsNumber","columnName","displayDrawerIcon","expansionIconClass","LETableRow","field-updated","mobileCols","isDesktopAndHasNoActionsOnTheLeft","isDesktopAndHasActionsOnTheLeft","mdqFields","showCheckbox","totalsByColumns","displayDrawerIconCell","opportunityWarning","invalidEntryWarning","widths","lineTypeClass","_selectedChanged","_handleFieldValueChanged","enableEditableFields","toggleLineExpansion","_handleFieldEditability","editableMap","mobileDrawerOpened","LETableHeaderCell","showSortableHeader","overflowTrue","headerCell","headerNode","bundlesVisualized","newSort","_getKeyByValue","order","SegmentedDetailRow","firstIndex","lastIndex","segmentNumber","_pathRefersToMySegmentRecord","pathList","segmentModel","_initializeFieldVisibility","detailFieldNames","segmentRecord","referencedSegmentVO","referencedKey","referencedIndex","referencedLabel","mySegmentKey","mySegmentIndex","mySegmentLabel","SegmentedLineDetails","signalFirstEditableTargetFirstRow","signalLastEditableTargetLastRow","detailFieldNamesWithLabel","labelColWidth","fieldNamesColWidth","totalColWidth","ControllingField","controllingFieldValue","DeviceDelegate","DesktopDelegate","mouseover","mouseout","spanElem","DOWN_ICON","RIGHT_ICON","CHEVRON_RIGHT_ICON","writeElem","readElem","isRichTextArea","_createWritableElement","commitPendingEdit","_formatNewValue","_toggleDirtyClass","SELECTION","cbContainer","toggleCheckbox","findElementForEvent","_getEditorModel","discountComp","setDiscardPendingEdit","_instance","EditabilityControllingField","_getEditableFieldValues","markedEditable","_getControlledFields","tableCell","_handleEditableCellsHover","_shouldClearFieldValue","_clearFieldValue","MobileDelegate","expansionDisabled","toggleExpanded","swipeCont","secondaryContainer","_loadSecondaryFields","EXPANDED","templateInstance","hydrateTemplateFromNode","secondaryRowTemplate","_createEditField","NonDiscountableControllingField","PriceEditableControllingField","PricingMethodControllingField","PricingMethodEditableControllingField","SFLETableRow","originalFieldValues","change","selected-date-changed","rte-value-changed","lookup-value-changed","_deviceDelegate","initListeners","shadyRoot","scopeSubtree","devices","_populateContent","_resetPencilLoaded","_refreshDirtyIndicators","_loadLineWarning","hasChildNodes","_getRecord","_handleChangeControllingField","editField","getFieldComponent","templateData","hydrateTemplate","_pendingEdit","eventType","_applyFocus","_discardPendingEdit","committed","_preserveOriginalValue","_parseFieldData","_updateDependentPicklist","_calculateImmediately","controllerField","depFields","getDependentFields","_getFieldValue","newOptions","getControllingFields","getFieldName","updateControlledFields","detailValue","isEditOnFocus","_handleSegmentedCellHover","containerEditable","onTap","hasDrawerFields","toggleDrawer","onRowSwiped","grandParentElem","cb","checked","_getLineNumber","expansionChanged","getFieldMetadata","unlisten","_isDragAndDropEnabled","fieldContainer","tooltipCmp","animationDelay","tooltipBody","forceLoad","_pencilLoaded","editableCells","cellsArr","pencilSpan","_getRecordOrSourceId","originalValues","_isAdditionalDiscountUpdated","DIRTY","additionalDiscount","discountAmountChanged","additionalDiscountChanged","discountChanged","_enableDirtyClass","contentChild","discountConstants","Templatizer","SFLineWarning","SFSegmentedCellTooltip","segmentedModel","_getSegmentedLine","_prepareLineData","generateSegmentedTooltipFieldSetTemplate","prepareLineData","SFLineActions","showInfoIcon","src","generateRow","fieldSetTemplate","actionsTemplate","generateActionsTemplate","itemNumTemplate","generateItemNumberTemplate","checkboxTemplate","generateCheckboxTemplate","drawerCellTemplate","generateDrawerCellTemplate","addLineActionsToTemplate","colIndex","startIndex","CLASS_NAMES","SECONDARY","getColWidths","generateInnerFieldSetTemplate","getColumnClass","getPrimaryClass","getFieldLabel","LineEditor","quoteLevelTabs","pageLoaded","mdObjects","getFromService","hasPermission","needsInit","cmd","customActionServices","_updateFieldLabelsMap","_handleGroupCustomActions","_getGroupModels","hasQuoteFieldSet","_executeCmd","isCoTermPrompted","_navigateToContractLookupPage","_executeDefaultCustomAction","_handleMissingPricebook","_loadProductRules","_redirectToLineEditor","executeProductRules","quoteTotalDisplayed","quoteDetailsIconClass","groupKeyInUrl","_isSubtitleCombined","subtitleCombined","groupCustomActions","userType","pricebookDialog","localizedDimensions","localizedSegments","setPageLoaded","quoteActions","_executeCustomAction","namesForQuoteLayout","buildUngroupedSegmentedTabs","ungroupedMDQTabs","quoteMDQTabs","groupedQuoteHasNoGroups","ungroupedQuoteHasNoLines","recombineFn","beginPrecaching","_setError","ruleExecutor","jsprLabels","ruleResponse","handleLinesAddedByProductRules","quoteLineAdder","fieldNamesByObjectNames","_removeDuplicateLineFieldsInDrawer","numOfFields","ln","lineEditorSubtotalsField","removeDuplicates","primarySet","lineFieldNamesPhone","lineFieldNamesTablet","cseDialog","segmentsArray","quoteDetailsHidden","toggleQuoteDetails","_toggleFullscreen","enterFullScreenMode","elm","requestFullScreen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","cancelFullScreen","msExitFullScreen","mozCancelFullScreen","webkitCancelFullScreen","standardPrimaryMobileColsLength","segmentedPrimaryMobileColsLength","isMobileRendered","isDesktopRendered","serviceType","productAlertModal","quoteChanges","copyChanges","originalObj","objChanges","updatedLine","originalGroup","updatedGroup","pathArr","getPreviousRoute","newData","le-action-tapped","cseMobile-tapped","cse-tapped","change-ghost","renumber-lines","validate-quantity-changed","field-change-validated","calculate-immediately","rte-saved","runnerFactory","scheduleMap","volumeDiscountField","termDiscountField","productField","vId","cId","costScheduleId","schedules","overrides","account","objectPrefix","groupType","typeName","determineMetadataFullNames","mdResults","uniquenessMap","requiredIds","requiredFields","ruleRecords","svContext","svIds","recordPrefix","filterVarField","testedVarField","sourceVarField","condRelationship","actionRelationship","condIdCollector","condRecord","actionIdCollector","svRecords","targetObjectField","filterField","constraintField","aggregateField","assetFields","subscriptionFields","svId","svRec","loadAssetsAndSubscriptions","assetAndSubRecs","pricebookFilter","currencyFilter","productFields","sweepModelsForLookupIds","lookupFields","models","targetType","aliasTargetType","getAliasTargetType","convertedId","queryInfo","referencedIds","depthFirstLineItemsTreeSort","SegmentedLines","currencyMd","_onSortLinesByHeader","isCurrentDimension","spliceChanges","linkPaths","headerColumnNames","netMultiSegmentTotalField","_setSubtotalColumnWidth","subtotalColWidth","_getPriceScale","_getNetTotalFieldMd","removeTableRowBorderClass","StandardLines","visibleLines","lastColWidth","drawerFieldNames","dragKeys","dragStandardIndexes","dragMdqIndexesByDim","dragLineModels","_getBundleWithChildren","lm","_getLineIndexFromKey","dragTargetElementIndex","_updateTableRowHoverOverObject","dragLeGroup","indH","_updateStandardSubscriptionScopeEditable","_removeLinesByIndex","groupContainer","segmentType","mdqLm","indexesToRemove","keyArray","_getStandardLineIndexFromKey","changeRecord","SFSegmentedTable","getTemplateGenerator","generateRowNode","_getFieldsForTemplate","SFStandardTable","_getAllFields","_hasNumberField","_preserveNumberValues","AssetLookup","preLoadObjects","qo","smLoadService","primaryMobileColumn","drawer","togglePanel","refocus","closeDrawer","pf","focusFirstField","lookupLayout","navigateToAssetUpgradeRoute","pIds","af","runService","runSearcher","filterData","clearFields","assetLookupObjects","AssetUpgrade","upgrades","upgradeSourceMap","upgradeTargetMap","assetHeaderSelectable","initializeServiceSpinners","initializeProperties","handleUpgradeSelected","handleAddProductResponse","handleLineEditorModelResponse","handleSelectionResponse","addProducts","smSelectService","getSelectedUpgrades","upgradeSelected","availableUpgrades","upgradeTarget","setUpgradeTargetMap","upgradeResults","upgradeProduct2Id","navigateToLineEditor","selectedUpgrades","getUpgrades","addProductsArray","upgradeTargetId","upgradeSourceId","targetProduct","sourceProduct","ifRadioSelectedClearOtherRadioSelections","sourceProductId","handleConfigurableProducts","configProductIds","getConfigProductIds","pId","getSelectedProducts","assetUpgradeObjects","availableUpgrade","sourceProductIndex","FormField","addAttribute","setFormattedValue","formattedDate","simpleFieldFactory","inputFactory","environment","hasStart","hasEnd","readOnlyKeyEvent","readOnlyBlurEvent","changeEvent","newDateRangePicker","getDiscountUnit","pattern","numberFormatter","readOnlyKeyDownEvent","checkboxFactory","datePickerFactory","numericFieldFactory","lookupFactory","selectFactory","textFieldFactory","FRONT_BINDING","0","1","2","BACK_BINDING","events","binding","variable","readOnlyKeyHandler","readOnlyKeyDownHandler","readOnlyBlurHandler","changeHandler","hiddenField","_html","_formattedValue","_defaultValue","_readOnlyKeyEvent","_readOnlyKeyDownEvent","_readOnlyBlurEvent","_changeEvent","_numeric","discountFactory","inputClass","formattedValueWithUnits","textareaFactory","richTextEditorFactory","maxLength","toHTML","extractReferenceDisplay","refObj","refType","nameProp","extractRefDisplay","relationshipRec","filteredLookupInfo","setInnerText","addEvent","NAME_MAP","Contract","Case","lookupFieldFullName","resultsLimit","currentRecordFields","currentRecord","applyMruOptimization","selectAllFields","searchAdditionalFields","searchCriteria","noWildcardSearchValue","scope","getScope","scopeClause","selectClause","getSelectClause","whereClause","getWhereClause","orderByClause","currentRecordField","omitField","getBindValue","searchValueLength","_buildFields","whereConditions","dateSearchValue","numberSearchValue","isDateType","fieldKey","relationships","lookupField","inline","font_formats","forced_root_block","menubar","toolbar1","toolbar2","plugins","FONTS","baseURL","sheets","head","tinymceInitCalled","editors","editor","setContent","getContent","_initialize","newRichTextEditor","useNoneLabel","restrictedPicklist","precision","newTextarea","ContractLookup","selectedContract","selectedAssetIds","prefetchObjects","setPropertyFromUrl","setSkipActionClass","handleContractModelLoadResponse","handleContractSelected","handleContractModelSaveResponse","handleContractModelLoadRequest","contractLookupObjects","accId","skipAction","skip","skipActionClass","contractModelLoadService","setFieldSet","activeContractFieldSets","contractModelSaveService","selectedContractId","navigateToDetailPage","objectId","isLightningExperience","API_FIELD_NAME_MAP","CustomActions","isClassic","productIndex","firstItem","remainingItems","customActionsExist","moreThanOneCustomActionsExist","buttonsCollapsed","launchExternalName","showExternalAction","urlKey","labelKey","brandButtonKey","labelUrlMap","checkCustomActionsConditionsMet","brandButtonClass","targetItem","handlePopup","handleNav","conditionsKey","operatorKey","filterValueKey","targetObjectKey","targetObject","AttributeItem","attributeMD","isValidValue","attributeField","targetField","getPicklistValues","defaultValues","attributeFieldMD","attributeItem","AttributeTable","addedClass","showTable","optionFieldMetadata","setMD","_setReferencedData","attributeFields","attributeModelData","featureAttributes","featureAttributesByFieldName","targetAttribute","featureAttributeIds","columnOrder","normalizeData","bundleAttributes","bundleAttribute","featureAttribute","overridePropagateFromParentToChild","captureCallBack","setFromChildToParentExtension","attributeId","_getTargetFieldNameFromModel","referencedField","attributeData","attributeID","ProductBundlesFilterItem","ProductFeature","selection-changed","fieldSetKey","tabNames","configSearch","hasConfigAttributes","hasTopConfigAttributes","hasBottomConfigAttributes","mobileHasConfigAttributes","hasOptions","mobileHasOptions","hasOptionsAndConfigAttributes","mobileHasOptionsAndConfigAttributes","hasInstructions","mobileHasInstructions","hasSelectedOptions","featureIndex","hasUpgradeOptions","mobileRendering","mobileExpanded","getHasUpgradeOptions","setFeatureAndOptionSelectionMethod","setOptionsDetails","setFieldSetHandler","renderFeatureInDesktopOrMobileView","initSelectedOptions","handleDeleteOptions","handleOptionChangedByRule","optionsTab","attributesTab","isClickSelection","configurationFieldSet","setFieldSetFromViewport","_hasTopOrBottomConfigAttributes","additionalInstructions","getOptionsByFeatureId","containsFeature","ProductFeatureCategoryList","categoryNamesOrFeatures","hasCategories","checkAtLeastOneFeatureHasCategory","getTabFeaturesMap","categoryName","ProductBundlesLayout","setToSections","hasSelected","hasMultipleBundles","searchValuesByFilter","searchFieldMD","searchFilterTypeMap","resize","handleResize","handlePanelSlide","handlePanelEvents","handleMD","applyFilters","numBundles","getProductId","toggleTransition","configuredProductIndex","sfSidebar","_setBundleContainerWidth","navWidth","buildPanelIfMultipleBundesAndNotMobile","panelWidth","isDrawerOpen","bundleContainer","_transition","underscorePrefix","removeAllSelected","navItem","numConfiguredProducts","ProductFeatureLayout","vp","hasFeaturelessConfigAttributes","isMobileAndHasConfigAttributes","isSectionLayout","isPaginationRequired","tabsForFeatureLayout","tabsForTabsAndWizardLayout","optionConstraintsHandler","disabledStateMap","listenersAttached","featurelessConfigAttributes","getOptionLayout","buildFeatureLayoutTabs","handleOptionSelectionChanged","buildTabsAndWizardLayoutTabs","featuresTab","featureKeys","handleOptionConstraints","getUnrenderedConstraining","hasSameOptionAdded","disabledStateChanges","optionSystemOrRequired","optionShouldBeDisabled","handleShownAndHiddenOptions","_handleOptionSelectionsInUnrenderedTabs","pvm","_setOptionSelections","hideOption","featureContainsOneVisibleOptions","featureContainsNoVisibleOptions","findIndex","visibleOptions","noVisibleOptions","_bindResponseChangesToUI","_setConfigAttributes","dynamicOption","_getDynamicOption","_extendDataToOption","syncConfigurationAttributesToProduct","autoSelectAttributes","createConstraintsHoverMessages","ProductFeatureList","handleTabSelected","filterFeatures","_filterFeatures","_filterQueuedForNextRender","allFeaturesHidden","numFeatures","_filterFeatureByIndex","_parentHandleContentFiltered","visibleContent","contentFilteredHandler","_updateHiddenByRuleOptionPropertyForUnRenderedFeatures","setOptionVisibility","_hideFeature","hasRequiredConfigAttributes","hasVisibleOptions","allOptionsHiddenByRule","hasAnyConfigAttr","selectionMethod","maxOptionsMet","renderComponent","renderingComponent","OptionCell","optionDrawer","isDisabled","initQuantityCell","initUnitPriceCell","initCell","getFieldRecordValue","fieldDetails","hasDimension","mdqWarningIcon","getQuantityEditable","attachQuantityChangeCallback","getPriceEditable","quoteLineHasField","setDisplayIfRelationshipItem","attachValueChangedCallback","getBundleId","syncValueChangeWithOptionConfiguration","optionCell","OptionDrawer","ProductOptionTable","showAddOptionsButton","primaryMobileCol","showUpgradeOptions","upgradeOptionButtonText","attributeItemFields","productHasAttributeSet","displayStyle","handleSelectionChanged","handleMetadataChanged","handleDeleteOption","handleConfigureOption","_selectionChanged","_handleOptionUpgrades","setOptionSelected","getOptionIndex","_displayAvailableRowActions","changedOption","priceRule","actionsHidden","fieldMetaData","initFieldMetadata","fieldSetMd","attributeItemMd","optionUpgradeHandler","getSourceOption","getUpgradeOption","sourceOptionIndex","upgradeOptionIndex","_notifyQuantityChange","mdFieldSet","setAttributeItemMetaData","mdItem","addMetaDataProperties","addAdditionalMetaDataProperties","_isMobile","_optionsExternallyChanged","_renderChangedRows","isFeatureOptionless","_setHeaderActions","_addSelectedOption","deleteOption","optionShouldChange","changeOptionDisabled","_collections","deleteMultiple","copy","sameOptionAdded","showOrHideAddOptionsButton","sameOption","entries","_step7$value","getTabIndex","optionalSKU","_step8$value","_step9$value","optionCount","configuredOptions","setUnaddedOptionsRulesActions","setDisplayedOptionsRulesActions","h","fireOptionChangedByRule","priceActions","_getPriceActions","priceAction","_calculateUnitPrice","getPrefix","upgradeOptions","DynamicLookup","redirectUrl","defaultFilters","handleDrawerClosed","handleOptionConfiguratorResponse","_createQueryParams","exceededNumber","validateMaximumOptionsNotExceeded","productLoader","oId","productIdx","optionConfigure","headerSubtitle","convertProductsToOptions","setCurrentProductModel","layoutFieldSet","productFieldSets","buildDelegator","filtersLoaded","valueObject","getStringValue","dynamicFieldSet","panelHeader","clearfilter","lastSubmit","orderedSelectedProductIds","id1","id2","orderedSelectedProducts","selectedProductId","valueField","optionsSelected","OptionLookup","topLevelBundle","currentProductModel","_handleLineEditorModelResponse","_handleProductLoadResponse","_handleOptionSelection","_validateMaximumOptionsNotExceeded","_addSelected","_routeToConfig","lineEditorRead","productLoad","optionTable","displayDelete","_createConstraintsHoverMessages","_fireSelectionStatesForOtherFeatures","_toggleOptionSelection","_handleOptionConstraints","previouslySelected","optionLookupObjects","ProductConfig","productSelectionModel","headerTitle","isMobileAndHasMultipleBundles","preventPreLoadObjects","handleProductLoadResponse","handleOptionSaveResponse","handleProductRulesInvokerResponse","handleCustomActionsCollapsed","handleOnAddOptionClick","handleBundlePanelClick","handleChangeEvents","handleBundleNameChange","handleExternalConfiguration","handleConfigureOptionEvent","optionSave","productRulesInvoke","_handleExternalDynamicOptionsResponse","handleProductConfigurationInitializer","returnToQuote","productAlerts","setOptionConfigurationDetails","loadedModelIsReconfigure","reconfigure","addAttributeSetFromServerProductVO","prod","getConfiguredOptionsFromPath","multipleBundlesView","getProductIndex","SearchFilters","filterMap","bundles","checkForExternalConfiguration","ruleProcessor","getValidationMessages","afterSaveNavigate","getLastFromPath","popFromPathAndGetNextSKU","createPathParams","createQueryParams","configuredProductKey","currentProduct","getProductRulesActions","getOptionDataByOptionIdAndIndex","changeAllActions","navToBundle","handleChangeEvent","_handleExternalDynamicOptions","isReconfigure","c_product","o_config","configurationAttributesValid","configuredProduct","prepareProductForServer","addedProducts","getConfiguredProductsToSave","getSelectedProductsToSave","getConfigurationAttributeMissingFeaturesMessage","navToPreviousRoute","productsToSave","configuredProductsById","productToSave","selectedProduct","externalKey","externalURL","externalConfiguratorUrl","backOrCancelOrClose","thirdPartyConfigurator","visitedExternal","redirectAfterOptionsAdded","handleDynamicOptionsAdded","eventContext","getProductById","handleApplyImmediatelyProductRules","isAppliedImmediately","_updateProductConfigurationHiddenOptions","upgradeAssetId","optionIsHidden","optionWasHiddenIndex","optionWasHidden","applyImmediatelyContext","prepareProductForNestedConfigure","nested","addToPath","stagedOption","nestedProduct","hasDynamicFeature","descendLevel","configure","getCurrentLevel","applyImmediately","minimalProduct","getSelectedOptions","skipValidations","selectedOptionList","_step11$value","setUpgradedAssetId","buildOptionForLineEditor","getAllProductIds","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_step12","_iterator12","requiredConfigAttributes","productConfigAttributes","requiredProductConfigAttributes","productConfigAttribute","requiredConfigurations","getRequiredConfigurationAttributes","missingAttributes","productConfigData","productRequiredConfigAttributes","requiredConfigurationAttributeValid","requiredAttributeMissingValue","featuresWithRequiredMissingAttributes","attrs","getFeatureNameFromId","featureNames","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_step13","_iterator13","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_step14","_iterator14","feat","toggleSearch","featureOptionalSKUs","buildDynamicConfigurations","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_step15","_iterator15","configuratorObjects","configTree","_setConfiguredOptionsObject","_getPreviousLevel","_updateThenGetSubtree","staged","optionsToAdd","_setConfigured","_removeSubtree","_removeConfiguration","configPath","configsToAdd","level","getFromPath","existingConfigs","configToAdd","_propagateRuleData","sku","optionInfo","_buildPathString","_addConfigsToConfigurationObject","nestedConfig","configurationEntered","existingObj","_updateSubtree","_appendSubtree","_propagateAttributes","_mergeNestedConfigurations","productConfigurationData","_addIndexProperty","childIndex","_getChildIndexAndAdjustIndices","childId","_alterIndexPropertyAndNodeId","prevId","includeLast","Suggester","filterContext","gsfields","inputs","processInputValues","evaluateProcessInputConditions","numPass","masterProcessInputValue","Ids","PANELS","ProductLookup","modalActive","hasQuoteProcess","selectionSaver","setPanelDisplay","openSearchFilterByDefault","toggleFilter","panelSuggester","suggester","panelGroupItems","handleClearSelected","handleSelectButtonClickedServerResponseAndNavigation","handleLabelChanged","clearFilterFields","resetSearchBar","attachSearchBarEventListeners","selectionReader","runOnLoad","runSuggester","inputField","quoteProcessId","getQuoteProcessId","setFilterButtonState","onLoadSearchModel","productResultsGroupFieldName","handleTransientCache","groupProcessId","searchBarResultsChanged","searchBarItemSelected","searchBarResetClicked","searchBarNilSearchInvoked","handleNonConfigurableProducts","navigateToSelf","updateSearchFilterData","visiblePanel","isVisible","modalGroup","gs","cleargs","saveCache","_addAggregateDataIfThresholdExceeded","getOrderedSelectedProducts","mdqTemplatesByDimensionType","orderedSelectedProductId","actionIdQueryString","plSelectMore","toggleResetButton","hasSearchFilterValues","lookupObjects","LESummaryCell","_getMD","GroupTabs","isGroupFieldPage","isSegmentedLinesPage","isStandardLinesPage","pageType","QuoteTabs","isQuoteFieldPage","isGroupsPage","isStandardLinesPageUI2","isStandardLinesPageUI3","segmentedCompName","segmentedTabs","tabHeight","layoutHeight","SubscriptionLookup","usesClientAmendRenew","existingLines","sf","JSARSettings","JSARServices","JSARLineGenManager","orgPrefix","amendRenewSettings","services","lineGenManager","subIds","renewSubscriptionsToQuote","amendSubscriptionsToQuote","subscriptionLookupObjects","OptionConfigurator","optionConfiguratorResponse","serverProduct","inheritedConfigurationAttributes","inheritedConfigurationData","OptionSaver","psmResponse","qa","reconcileServerQuoteWithUIQuote","warningCallback","minimizer","getRequiredKeys","priorBundledQuantityByLineKey","mapPriorBundledQuantityByLineKey","ProductLoader","productLoadModel","relevantLines","_getLinesRelevantToParentKey","relevantLineKeys","addKeysRelevantTo","ProductRulesInvoker","configResponse"],"mappings":"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","file":"sb_app_js.js","sourcesContent":["import * as docgen from 'docgen/docgen.routes.js';\nimport * as quotes from 'quotes/quotes.routes.js';\nimport * as assets from 'assets/assets.routes.js';\nimport * as contracts from 'contracts/contracts.routes.js';\nimport * as subscriptions from 'subscriptions/subscriptions.routes.js';\nimport * as products from 'products/products.routes.js';\nimport * as favorites from 'favorites/favorites.routes.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\nimport {Router} from 'common/core/sb-router/Router.js';\nimport {RichTextEditorDialog} from 'common/forms/sb-rte/dialog/RichTextEditorDialog.js';\n\n// import the \"bootstrap\" modules from all feature folders\n// they are here just so we don't have to explicitly call System.import() on individual modules.\nimport 'common/common.js';\nimport 'quotes/quotes.js';\nimport 'products/products.js';\nimport 'favorites/favorites.js';\nimport 'assets/assets.js';\nimport 'subscriptions/subscriptions.js';\n\nexport class App {\n\tstatic init( pageContainer, dbName, /*Obj*/ settingsObj, urls ) {\n\n\t\tlet r = {};\n\t\tr[docgen.PREFIX] = docgen.ROUTES;\n\t\tr[quotes.PREFIX] = quotes.ROUTES;\n\t\tr[products.PREFIX] = products.ROUTES;\n\t\tr[favorites.PREFIX] = favorites.ROUTES;\n\t\tr[assets.PREFIX] = assets.ROUTES;\n\t\tr[contracts.PREFIX] = contracts.ROUTES;\n\t\tr[subscriptions.PREFIX] = subscriptions.ROUTES;\n\n\t\t// initialize app with all URL routes\n\t\tpageContainer.allRoutes = r;\n\n\t\tRichTextEditorDialog.setBaseUrl( urls.tinymce );\n\n\t\treturn Promise.all([\n\t\t\tAppContext.init( settingsObj ),\n\t\t\t// Db.adapter.open( dbName || 'sbcpq' ),\n\t\t\tApp._initIntlLocale( urls.intl, settingsObj.locale )\n\t\t]);\n\t}\n\n\t/**\n\t * Load the CLDR data for the user's locale.  We can't pre-load all locales - too many/too much data in memory.\n\t * We need this data for the Intl polyfill as well as other internal needs.\n\t *\n\t * @param url {String} the base url to the cldr data file (staticresource or bower)\n\t * @param locale {String} the user's locale (e.g. en-US)\n\t * @return {Promise} resolves with the json object when loaded\n\t */\n\tstatic _initIntlLocale( url, locale ) {\n\n\t\treturn new Promise( function( res, rej ) {\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\tlet id = null;\n\t\t\tlet getURL = url + '/locale-data/json/' + locale + '.json';\n\t\t\txhr.open( 'GET', getURL );\n\n\t\t\txhr.onerror = function(e) {\n\t\t\t\trej( new Error( 'Cannot get locale data: ' + e ) );\n\t\t\t}\n\n\t\t\txhr.ontimeout = function(e) {\n\t\t\t\trej( new Error( 'Timeout for locale data' ) );\n\t\t\t}\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif( xhr.responseText ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet data = JSON.parse( xhr.responseText );\n\t\t\t\t\t\tI18n.addLocaleData( data );  // save for other components to use, e.g. DatePicker\n\t\t\t\t\t\tif( Intl && Intl.__addLocaleData ) {\n\t\t\t\t\t\t\tIntl.__addLocaleData( JSON.parse( xhr.responseText ) );  // have to parse again as Intl polyfill changes source locale object when added\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres( data );\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\trej( new Error( 'Cannot parse locale data' ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\trej( new Error( 'Cannot understand locale data: ' + xhr.statusText ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\txhr.send();\n\t\t});\n\t}\n}\n","// THIS FILE IS GENERATED.  DO NOT EDIT!!!!\nexport const LABELS = {\"Apply\":\"Apply\",\"Asset Selection\":\"Asset Selection\",\"Cancel\":\"Cancel\",\"Clear Fields\":\"Clear Fields\",\"Filter\":\"Filter\",\"Select\":\"Select\",\"searchText\":\"Search {0}\",\"FieldSetWarning\":\"Create a Field Set with the label of CPQ_Lookup in {0} object setup to determine which fields are displayed in this CPQ list view popup.\",\"numResults\":\"{0} Results\",\"Save\":\"Save\",\"Edit Description\":\"Edit Description\",\"Search Products\":\"Search Products\",\"Product Search\":\"Product Search\",\"Select All\":\"Reduce search results to fewer than {0} to enable select all\",\"Popup\":\"Popup\",\"Add Products\":\"Add Products\",\"Delete\":\"Delete\",\"Favorite Lookup\":\"Favorite Lookup\",\"Select & Add More\":\"Select & Add More\",\"Share\":\"Share\",\"Share Favorites\":\"Share Favorites\",\"Attributes\":\"Attributes\",\"Options\":\"Options\",\"showAvailableUpgrades\":\"This feature has products available for upgrade, click the Show Available Upgrades button at the bottom of the feature to select upgrade options.\",\"No visible options in feature\":\"No visible options in feature '{0}'\",\"Features\":\"Features\",\"Add Options\":\"Add Options\",\"Add\":\"Add\",\"Configure Products\":\"Configure Products\",\"Configuration Attribute Error\":\"Please review required configuration attributes\",\"Configuration Error\":\"Some or all options require further configuration. Look for configuration icon next to options that must be configured.\",\"Maximum Quantity Error\":\"Exceeded maximum quantity available. Value has been reduced to {0}\",\"Add to Cart\":\"Add to Cart\",\"Categories\":\"Categories\",\"Description\":\"Description\",\"Go\":\"Go\",\"My Favorites\":\"My Favorites\",\"Price\":\"Price\",\"Product Code\":\"Product Code\",\"Product Name\":\"Product Name\",\"Start Over\":\"Start Over\",\"Alert\":\"Alert\",\"Continue\":\"Continue\",\"Active Contract Selection\":\"Active Contract Selection\",\"Select Contract\":\"Select Contract\",\"Skip\":\"Skip\",\"Favorites\":\"Favorites\",\"Guided Selling\":\"Guided Selling\",\"Product Filter\":\"Product Filter\",\"Product Selection\":\"Product Selection\",\"Suggest\":\"Suggest\",\"Available Groups\":\"Available Groups\",\"Clone To Groups\":\"Clone To Group(s)\",\"Select Groups\":\"Select one or more group(s)\",\"Selected Groups\":\"Selected Groups\",\"Custom Segments\":\"Custom Segments\",\"Discount Schedule Editor\":\"Discount Schedule Editor\",\"Update\":\"Update\",\"Add to Favorites\":\"Add to Favorites\",\"Favorite Name\":\"Favorite Name\",\"Choose Price Book\":\"Choose Price Book\",\"Details\":\"Details\",\"Total\":\"Total\",\"Quote Total\":\"Quote Total\",\"Add To Favorite\":\"Add To Favorite\",\"Click to edit description\":\"Click to edit description.\",\"emptyLinesMsg\":\"This group has no line items. Click on Add Products button or drag lines from other groups.\",\"mobileEmptyLinesMsg\":\"This group has no line items. Click on Add Products button to add a product.\",\"Remove From Favorites\":\"Remove From Favorites\",\"Segmented Products\":\"Segmented Products\",\"Standard Products\":\"Standard Products\",\"Subtotal\":\"Subtotal\",\"invalidPricebookEntry\":\"There is not a valid price book entry for this line item.\",\"missingOpportunityLineItem\":\"This product will not sync to the opportunity because a valid pricebook entry does not exist.\",\"Edit Quote\":\"Edit Quote\",\"emptyGroupedQuoteMsg\":\"This quote has no line items. Click on Add Group button to select products.\",\"emptyQuoteMsg\":\"This quote has no line items. Click on Add Products button to select products.\",\"fullScreenMode\":\"Toggle Full Screen Mode\",\"Subscription Selection\":\"Subscription Selection\"};","export const settings = {developerPrefix:'SBQQ',isMultiCurrencyOrg:false,calculateImmediately:false,locale:'en-US',language:'en',defaultCurrency:'USD',currencySymbol:'',currencyDecimalScale:2,fullName:'Admin User',userName:'admin-user@steelbrick.com',userId:'0XXX1',device:'',isOAuth:true,additionalLookupSearchTypes:[],oik:'',maxLookupSearchFields:1,isJSProductRulesEnabled:true,hasQuoteSelectionProductRules:true,ui3Enabled:false}","'use strict';\n\nvar logger = require('js-logger').logger.getLogger();\n\n/**\n * Cache manager. Manage caches in a centralized way.\n *\n * This suppose to be a singleton, so get instance of cache manager like:\n * var cacheManager = require('CacheManager').instance;\n *\n * Get your cache by name. If cache not exist, it will create one\n * var cache = cacheManager('myCache');\n *\n * Flush all caches (Only available in nodejs environment)\n * cacheManager.flushCaches();\n */\nfunction CacheManager() {\n\tlogger.trace('Creating new instance of cache manager');\n\tthis._caches = new Map();\n}\n\n/**\n * Get cache by name.\n *\n * If cache not exist with the name yet, it will be created one. Otherwise, existing\n * cache will be returned.\n *\n * Cache will be created as instance of <tt>Map</tt> unless customize cache class provided.\n *\n * @param name cache name\n * @param cacheClass optional, cache class. Must have default constructor\n * @returns {V}\n */\nCacheManager.prototype.getCache = function (name, cacheClass) {\n\tlogger.debug('Getting cache by name:', name);\n\tvar cache = this._caches.get(name);\n\tif (!cache) {\n\t\tlogger.trace('Cache with name:', name, 'not exist yet.');\n\t\tif (cacheClass) {\n\t\t\tlogger.trace('Cache class defined');\n\t\t\tif (typeof cacheClass === 'function') {\n\t\t\t\tlogger.trace('Creating new cache by customized class for name:', name);\n\t\t\t\tcache = new cacheClass();\n\t\t\t} else {\n\t\t\t\tlogger.warn('Cache class defined, but is not a function.', typeof cacheClass);\n\t\t\t\tthrow new Error('Customize cache class type wrong.');\n\t\t\t}\n\t\t} else {\n\t\t\tlogger.trace('Creating new cache as Map for name:', name);\n\t\t\tcache = new Map();\n\t\t}\n\t\tif (typeof cache !== 'undefined') {\n\t\t\tthis._caches.set(name, cache);\n\t\t} else {\n\t\t\tlogger.warn('Cache undefined, something wrong.');\n\t\t\tthrow new Error('Create cache get undefined.');\n\t\t}\n\t} else {\n\t\tlogger.trace('Find cache for name:', name);\n\t}\n\treturn cache;\n};\n\n/**\n * Flush caches. This operation only available in nodejs environment, will do nothing\n * in browser.\n * This operation will call clear on all caches to make sure other objects that holding same\n * cache still refer to same cache.\n * Also because cache could hold by other objects, this operation will not remove cache for\n * names\n *\n * @param resetCaches pass <tt>true</tt> if want to reset cache manager. Use with caution, objects\n * that already get cache may still holding old cache.\n */\nCacheManager.prototype.flushCaches = function (resetCaches) {\n\tlogger.debug('Flushing all caches');\n\t// Since cache could be hold outside, we cannot just create new cache map.\n\t// That will leave other objects holding old cache.\n\tthis._caches.forEach(function(value) {\n\t\tif (value && typeof value.clear === 'function') {\n\t\t\tvalue.clear();\n\t\t}\n\t});\n\tif (resetCaches) {\n\t\tlogger.trace('Rest cache');\n\t\tthis._caches.clear();\n\t}\n};\n\n/**\n * We want make sure CacheManager is singleton within whole process.\n * No matter how many times it been imported, where it get imported.\n * So we use Symbol to calculate unique key and use global to hold\n * single instance of CacheManager.\n *\n * We also export this single instance only.\n */\nconst CACHE_MANAGER_KEY = Symbol.for('client.Utils.CacheManager');\n\nconst globalRef = typeof global !== 'undefined' ?\n\tglobal :\n\ttypeof self !== 'undefined' ?\n\t\tself :\n\t\ttypeof window != 'undefined' ?\n\t\t\twindow :\n\t\t\t{};\n\nvar globalSymbols = Object.getOwnPropertySymbols(globalRef);\nvar hasCacheManager = (globalSymbols.indexOf(CACHE_MANAGER_KEY) > -1);\n\nif (!hasCacheManager) {\n\tlet _cacheManager = new CacheManager();\n\tObject.freeze(_cacheManager);\n\tglobalRef[CACHE_MANAGER_KEY] = _cacheManager;\n}\n\nmodule.exports = {cacheManager: globalRef[CACHE_MANAGER_KEY]};\n","/**\n * Created by jfeingold on 5/4/15.\n */\n\nmodule.exports.toApexDate = toApexDate;\nmodule.exports.toApexDateTime = toApexDateTime;\nmodule.exports.toUTCDateString = toUTCDateString;\nmodule.exports.monthsBetween = monthsBetween;\nmodule.exports.monthsBetweenRoundPartialUp = monthsBetweenRoundPartialUp;\nmodule.exports.daysBetween = daysBetween;\nmodule.exports.daysBetweenIgnoringLeapYearDays = daysBetweenIgnoringLeapYearDays;\nmodule.exports.distinguishDateFromDateTime = distinguishDateFromDateTime;\nmodule.exports.addMonths = addMonths;\nmodule.exports.addDays = addDays;\n/**\n * Takes a JS Date object and turns it into a string of the type 'YYYY-MM-DD', which is what Apex is expecting.\n * @param {Date} date The date to be stringified\n * @returns {string}\n */\nfunction toApexDate(/*Date*/ date) {\n\t// Get the ISO formatted date string.\n\t// This will be formatted: YYYY-MM-DDTHH:mm:ss.sssZ\n\tvar dateIso = date.toISOString();\n\n\t// Replace everything after the T with an empty string\n\treturn dateIso.replace(new RegExp('[Tt].*'), \"\");\n}\n\n/**\n * Takes a JS Date object and turns it into a string of the format 'YYYY-MM-DDTHH:mm:ss.sss+0000', which is what Apex\n * expects a date-time to look like\n * @param {Date} dateTime The datetime to be stringified\n * @returns {string}\n */\nfunction toApexDateTime(dateTime) {\n\t// Get the ISO formatted date string.\n\t// This will be formatted YYYY-MM;DDTHH:mm:ss.sssZ\n\tvar dateIso = dateTime.toISOString();\n\n\t// Replace the 'Z' at the end with '+0000'\n\treturn dateIso.slice(0, dateIso.length - 1) + \"+0000\";\n}\n\n/**\n * Takes a JS Date object and turns it into a string based on the locale (but based on UTC Time), used primarily when Dates are converted to Text by formulas.\n * @param {Date} date The date to be stringified\n * @returns {string} formatted date that has been converted to a string\n */\nfunction toUTCDateString(date) {\n\t// Gets the timezone offset so that the date is converted to UTC time\n\tvar timezone = date.getTimezoneOffset();\n\treturn new Date(date.setMinutes(date.getMinutes() + parseInt(timezone))).toLocaleDateString();\n}\n\n/**\n * Tests if the provided string represents a Date, DateTime, or neither\n * @param {String} dateString A string that may or may not represent a date or datetime\n * @returns {String} 'date',' datetime', or 'none', if the string format resembles an Apex Date,DateTime, or neither respectively\n */\nfunction distinguishDateFromDateTime(dateString) {\n\tvar dateRegex = new RegExp('\\\\d{4}-\\\\d{2}-\\\\d{2}');\n\tvar dateTimeRegex = new RegExp('\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}:\\\\d{2}:\\\\d{2}.\\\\d{3}(Z|(\\\\+\\\\d{4}))');\n\tif (dateRegex.test(dateString) && dateString.length == 10) {\n\t\treturn 'date';\n\t} else if (dateTimeRegex.test(dateString) && (dateString.length == 24 || dateString.length == 28)) {\n\t\treturn 'datetime';\n\t}\n\treturn 'none';\n}\n\n/**\n * Returns the difference in months between the two dates, ignoring day. i.e. all days in a given month are\n * equally far from all days in any other given month.\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {number} Positive when startDate is before endDate, 0 if same month, else negative.\n */\nfunction monthsBetween(/*Date*/ startDate, /*Date*/ endDate) {\n\t// If the start date is actually after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate  > endDate) {\n\t\treturn -1 * monthsBetween(endDate, startDate);\n\t}\n\tvar result = 0;\n\t// Add the difference in years * 12\n\tresult += ((endDate.getUTCFullYear() - startDate.getUTCFullYear()) * 12);\n\t// Add the difference in months. Note: If startDate was later in the year than endDate, this value will be\n\t// subtracted.\n\tresult += (endDate.getUTCMonth() - startDate.getUTCMonth());\n\treturn result;\n}\n\n/**\n * Returns the number of months between two dates, with partial months being rounded up.\n * E.g. 2016-09-15, 2017-09-20 => 13\n * but  2016-09-15, 2017-09-10 => 12\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {number}\n */\nfunction monthsBetweenRoundPartialUp(startDate, endDate) {\n\t// If the start date is actually after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate > endDate) {\n\t\treturn -1 * monthsBetweenRoundPartialUp(endDate, startDate);\n\t}\n\t// Get the number of calendar months between the two dates\n\tvar result = monthsBetween(startDate, endDate);\n\t// Create new reference so startDate is preserved\n\tvar date = new Date(startDate.getTime());\n\t// Add that many months to the start date\n\taddMonths(date, result);\n\t// If the adjusted start date is before the end date, then it means that there's a partial month left over that needs\n\t// to be rounded up.\n\tif (date < endDate) {\n\t\tresult += 1;\n\t}\n\treturn result;\n}\n\n/**\n * Returns the number of days between two dates.\n * @param {Date} startDate\n * @param {Date} endDate\n * @returns {number} Positive when startDate is before endDate, else negative\n */\nfunction daysBetween(/*Date*/ startDate, /*Date*/ endDate) {\n\t// If the start date is after the end date, reverse the arguments and multiply the result by -1\n\tif (startDate > endDate) {\n\t\treturn -1 * daysBetween(endDate, startDate);\n\t}\n\t// Get the difference in Unix time\n\tvar msDiff = endDate.getTime() - startDate.getTime();\n\tvar dayInUnix = 86400000;\n\t// return the difference divided by the number of ms in a day.\n\treturn Math.round(msDiff / dayInUnix);\n}\n\n/**\n * Adds the specified number of months to a Date. Handles the situation where May 31 + 1 month = June 30 NOT July 1.\n * @param {Date} startDate\n * @param {number} numMonths\n * @returns {Date} Date after months have been added\n */\nfunction addMonths(/*Date*/ startDate, /*number*/ numMonths) {\n\tvar currentMonth = startDate.getUTCMonth();\n\tstartDate.setUTCMonth(startDate.getUTCMonth() + numMonths);\n\tvar trueMonth = currentMonth + numMonths;\n\t// Handles situation where currentMonth is Jan ( index = 0 ) and need to go back one month to Dec\n\t// Dec is index 11, not -1, so we add 12 to get the correct index in this case\n\ttrueMonth = trueMonth < 0 ? trueMonth + 12 : trueMonth;\n\t// Check if we've overflowed into the next month. If so, set date to the last day of the previous month.\n\tif (startDate.getUTCMonth() != ( trueMonth % 12 )){\n\t\tstartDate.setUTCDate(0);\n\t}\n\treturn startDate;\n}\n\nfunction addDays(/*Date*/ startDate, /*number*/ numDays) {\n\tstartDate.setUTCDate(startDate.getUTCDate() + numDays);\n\treturn startDate;\n}\n\n/**\n * Returns the number of days between two dates minus the extra days added from leap years\n * @param startDate\n * @param endDate\n * @returns {number}\n */\nfunction daysBetweenIgnoringLeapYearDays(/*Date*/ startDate, /*Date*/ endDate) {\n\tvar numLeapDays = 0;\n\tvar startYear = startDate.getUTCFullYear();\n\tvar endYear = endDate.getUTCFullYear();\n\tfor ( var i = startYear, j = endYear; i <= j; i++ ) {\n\t\tif (!isLeapYear(i))\n\t\t\tcontinue;\n\n\t\tvar leapDay = new Date(i, 1, 29);\n\t\tif ( startDate < leapDay && endDate > leapDay ) {\n\t\t\tnumLeapDays++;\n\t\t}\n\t}\n\n\treturn daysBetween(startDate, endDate) - numLeapDays;\n}\n\n/**\n * Evaluates whether or not the given date falls within a leap year using the three following Gregorian calendar rules\n * @param year\n * @returns {boolean|number}\n */\nfunction isLeapYear(/*number*/ year) {\n\treturn !(year % 4) && (year % 100) || !(year % 400);\n}\n","/**\n * Created by Josh Feingold on 5/12/15.\n */\nmodule.exports.setScale = setScale;\n\n/**\n * Rounds a number to the given scale, rounding up at 5.\n * i.e. setScale(55.55, 1) = 55.6\n * @param {number} num The number to be rounded\n * @param {number} scale The number of digits that should be kept after the decimal point\n * @returns {number} Num, rounded to 'scale'-many decimals.\n */\nfunction setScale(num, scale) {\n\tvar exp = Math.pow(10, scale);\n\tnum *= exp;\n\tvar res = Math.round(+(num).toFixed(scale));\n\tres /= exp;\n\treturn res;\n}","/**\n * Created by jfeingold on 7/25/17.\n *\n * A manager class for interfacing the the RecordJob__c system in Apex.\n */\n\nlet logger = require('js-logger').logger.getLogger();\n\nfunction RecordJobManager(conn, prefix) {\n\tthis._conn = conn;\n\tlet serviceRouterPrefix = (prefix === '') ? '' : '/SBQQ';\n\tthis._serviceRouterUrl = serviceRouterPrefix + '/ServiceRouter';\n\tif(conn.oik) // add the internal token to the URL if provided in the connection\n\t\tthis._serviceRouterUrl += '?oik=' + conn.oik;\n\tthis._setJobStatusProvider = 'JobCheckerServiceProvider.SetJobStatus';\n\tthis._setJobsStatusProvider = 'JobCheckerServiceProvider.SetJobsStatus';\n}\n\n/**\n * Uses the Apex REST ServiceRouter system to update the status of the RecordJob__c identified by the Record ID and Job Type.\n * @param {String} recordId - The ID of an SObject associated with a RecordJob__c. NOTE: This is NOT the ID of a RecordJob__c record.\n * @param {String} jobType - The type of the Job in question.\n * @param {String} jobStatus - The status of the job in question.\n * @param {String} jobDetails - Extra details about the job status.\n * @param {*} attachmentDetails - An attachment for the record job.\n * @returns {Promise.<String>}\n */\nRecordJobManager.prototype.updateJobStatus = function(recordId, jobType, jobStatus, jobDetails, targetId) {\n\tlet context = {\n\t\tsaver: this._setJobStatusProvider,\n\t\tmodel: JSON.stringify({\n\t\t\trecordId: recordId,\n\t\t\tjobType: jobType,\n\t\t\tjobStatus: jobStatus,\n\t\t\tjobDetails: jobDetails || '',\n\t\t\ttargetId: targetId || null\n\t\t})\n\t};\n\n\tlet apexRestCallStartTime = Date.now();\n\tlogger.info(jobType + ' RecordJobManager.js: Start apex rest call to update job status.');\n\treturn this._conn.apex.post(this._serviceRouterUrl, context)\n\t\t.then(function() {\n\t\t\tlet apexRestCallEndTime = Date.now();\n\t\t\tlogger.info(jobType + ' RecordJobManager.js: Apex rest call to update job status took ' + (apexRestCallEndTime - apexRestCallStartTime) + ' ms.');\n\t\t\treturn;\n\t\t})\n\t\t.catch(function(err) {\n\t\t\treturn Promise.reject('Error occurred while updating RecordJob__c Status: ' + (err.message || err));\n\t\t});\n};\n\n/**\n * Uses the Apex REST ServiceRouter system to update the statuses of all RecordJob__c records identified by the\n * Record IDs and Job Type.\n * @param {Array.<String>} recordIds - An array of SObject IDs associated with RecordJob__c instances. NOTE: These are\n * NOT the IDs of RecordJob__c instances themselves.\n * @param {String} jobType - The type of the Jobs in question.\n * @param {String} jobStatus - The status to which the jobs should be updated.\n * @param {String} jobDetails - Any further details about the jobs in question.\n * @returns {Promise.<String>}\n */\nRecordJobManager.prototype.updateJobsStatus = function(recordIds, jobType, jobStatus, jobDetails) {\n\tlet context = {\n\t\tsaver: this._setJobsStatusProvider,\n\t\tmodel: JSON.stringify({\n\t\t\trecordIds: recordIds,\n\t\t\tjobType: jobType,\n\t\t\tjobStatus: jobStatus,\n\t\t\tjobDetails: jobDetails\n\t\t})\n\t};\n\treturn this._conn.apex.post(this._serviceRouterUrl, context)\n\t\t.catch(function(err) {\n\t\t\treturn Promise.reject('Error occurred while updating RecordJob__c Status: ' + (err.message || err));\n\t\t});\n};\n\nmodule.exports = RecordJobManager;","if (typeof window !== 'undefined' && window) {\n\twindow.SB = window.SB || {};\n\twindow.SB.ajax = require(\"./../calc/Utils/ApexUtils.js\");\n}","\"use strict\";\n\nSystem.register(\"assets/assets.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhc3NldHMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/asset';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-asset-lookup', mod: 'assets/selection/routes/sb-asset-lookup/AssetLookup.js'},\n\t'/upgrade': {comp: 'sb-asset-upgrade', mod: 'assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js'}\n};\n","/**\n * A collection of javascript utility functions\n */\nexport class Util {\n\t/**\n\t * Pad a number with left zeros\n\t * @param  {Integer} n     the numeric value\n\t * @param  {Integer} width the number of zeros to pad\n\t * @param  {String} z     the pad character, defaults to '0'\n\t * @return {String}       the padded number\n\t */\n\tstatic pad( n, width, z ) {\n\t\tz = z || '0';\n\t\tn = n + '';\n\t\treturn n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n\t}\n\n\t/**\n\t * Returns an \"ISO date string\" in RFC 3339 format\n\t * @param  {Number|Date} d the number of milliseconds from epoch or Date object\n\t * @return {String}   the RFC 3339 date string\n\t */\n\tstatic toIsoDate(d) {\n\t\td = typeof d === 'number' ? new Date(d) : d;\n\t\treturn d.getUTCFullYear() + '-'\n\t\t\t\t+ Util.pad( d.getUTCMonth()+1, 2 ) + '-'\n\t\t\t\t+ Util.pad( d.getUTCDate(), 2 ) + 'T'\n\t\t\t\t+ Util.pad( d.getUTCHours(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCMinutes(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCSeconds(), 2 ) + 'Z'\n\t}\n\n\tstatic notifyTopObjects(ctxComponent, object, strProp) {\n\t\tfor (let prop of Object.keys(object)) {\n\t\t\tctxComponent.notifyPath(strProp + '.' + prop, object[prop]);\n\t\t}\n\t}\n\n\tstatic arithmeticOperatorConversion(fieldValue, filterValue, operator) {\n\t\tif(typeof fieldValue === 'boolean') {\n\t\t\tif (filterValue.toLowerCase() === 'true') {\n\t\t\t\tfilterValue = true;\n\t\t\t} else if (filterValue.toLowerCase() === 'false') {\n\t\t\t\tfilterValue = false;\n\t\t\t}\n\t\t}\n\n\t\tswitch (operator) {\n\t\t\tcase 'equals':\n\t\t\t\tlet val = (fieldValue === filterValue);\n\t\t\t\treturn val;\n\t\t\tcase 'not equals':\n\t\t\t\treturn fieldValue != filterValue;\n\t\t\tcase 'less than':\n\t\t\t\treturn fieldValue < filterValue;\n\t\t\tcase 'less or equals':\n\t\t\t\treturn fieldValue <= filterValue;\n\t\t\tcase 'greater than':\n\t\t\t\treturn fieldValue > filterValue;\n\t\t\tcase 'greater or equals':\n\t\t\t\treturn fieldValue >= filterValue;\n\t\t\tcase 'starts with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().startsWith(filterValue.toLowerCase());\n\t\t\tcase 'ends with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().endsWith(filterValue.toLowerCase());\n\t\t\tcase 'contains':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().includes(filterValue.toLowerCase());\n\t\t}\n\t}\n\n\t/**\n\t * Modify text to convert newline/carriage return to line breaks in HTML\n\t * @param  {String}       text Ex: product description or twin fields of data type text area\n\t * @return {String}       text with line breaks\n\t * Linux uses \\n for a new-line, Windows \\r\\n and old Macs \\r.\n\t */\n\tstatic toHTML(text) {\n\t\tif (text != null) {\n\t\t\ttext = text.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n\t\t}\n\t\treturn text;\n\t}\n}\n\n/**\n * SF Aloha UI creates its own Map object in the global namespace and it is anywhere near standards compliant\n * This is a stupid hack that checks for their dumb implemenation and gets the real Map class if needed.\n */\nUtil.Map = Map;\nif( !Map || !Map.prototype.get || !Map.prototype.set ) {\n\tlet frame = document.createElement( 'iframe' );\n\tdocument.body.appendChild( frame );\n\tUtil.Map = frame.contentWindow.Map;\n\tframe.parentNode.removeChild( frame );\n}","// import common behaviors first\nimport 'common/behaviors/DeviceBehavior.js';\nimport 'common/behaviors/LookupBehavior.js';\n\n// these imports are rather dumb.  they are here just so we don't have to explicitly call System.import() on them.\nimport 'common/core/sb-i18n/I18n.js';\nimport 'common/core/sb-loading-spinner/LoadingSpinner.js'\nimport 'common/core/sf-loading-spinner/LoadingSpinner.js'\nimport 'common/core/sb-page-container/PageContainer.js';\nimport 'common/core/sb-toast/Toast.js';\nimport 'common/core/sb-page-header/PageHeader.js';\nimport 'common/data/sb-service/Service.js';\nimport 'common/filter/searcher/Searcher.js';\nimport 'common/forms/sb-field/Field.js';\nimport 'common/forms/sb-typeahead/Typeahead.js';\nimport 'common/forms/sb-lookup/Lookup.js';\nimport 'common/forms/sb-lookup-dialog/LookupDialog.js';\nimport 'common/forms/sb-datepicker/Datepicker.js';\nimport 'common/forms/sb-date-range/DateRange.js';\nimport 'common/forms/sb-discount/Discount.js';\nimport 'common/forms/sb-pagination/Pagination.js';\nimport 'common/forms/sb-rte/dialog/RichTextEditorDialog.js';\nimport 'common/forms/sb-rte/RichTextEditor.js';\nimport 'common/forms/sb-search-bar/SearchBar.js';\nimport 'common/forms/sb-search-bar-dialog/SearchBarDialog.js';\nimport 'common/layout/sb-actions/Actions.js';\nimport 'common/forms/sb-input/Input.js';\nimport 'common/forms/sb-select/Select.js';\nimport 'common/forms/sb-textarea/Textarea.js';\nimport 'common/forms/sb-checkbox/Checkbox.js';\nimport 'common/forms/sb-multi-lookup/MultiLookup.js';\nimport 'common/forms/sb-dual-list-box/DualListBox.js';\nimport 'common/layout/sb-div/Div.js';\nimport 'common/layout/sb-field-item/FieldItem.js';\nimport 'common/layout/sb-field-table/FieldTable.js';\nimport 'common/layout/sb-group/Group.js';\nimport 'common/layout/sb-side-panel/SidePanel.js';\nimport 'common/layout/sb-swipe-container/SwipeContainer.js';\nimport 'common/layout/sb-table-cell/TableCell.js';\nimport 'common/layout/sb-table-cell-select/TableCellSelect.js';\nimport 'common/layout/sb-table-header/TableHeader.js';\nimport 'common/layout/sb-table-row/TableRow.js';\nimport 'common/layout/sb-tabs/Tabs.js';\nimport 'common/layout/sb-badge/Badge.js';\nimport 'common/layout/sb-dialog/Dialog.js';\nimport 'common/layout/sb-popup/Popup.js';\nimport 'common/layout/sb-lookup-layout/LookupLayout.js';\nimport 'common/layout/sb-filter-layout/FilterLayout.js';\nimport 'common/layout/sb-filter-item/FilterItem.js';\nimport 'common/layout/sb-row-drawer/RowDrawer.js';\nimport 'common/services/sb-line-editor-read/LineEditorReader.js';\nimport 'common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js';\nimport 'common/services/sb-job-checker/JobChecker.js';\nimport 'common/services/sb-field-md/FieldMetadata.js'\nimport 'common/services/sb-search-model-load/SearchModelLoader.js'\nimport 'common/services/sb-search-model-select/SearchModelSelector.js'\nimport 'common/data/sb-describe/Describe.js';\nimport 'common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js'\n\n// amount of time needed to trigger a \"on-hold\" event\nlet HOLD_THRESHOLD = 1000;\n\n// Register a custom \"hold\" event.  Polymer doesn't natively support this.\nif( Polymer ) {\n\tlet holdTimer = null;\n\n\tPolymer.Gestures.register({\n\t\tname: 'hold',\n\t\tdeps: ['mousedown', 'mouseup', 'touchstart', 'touchend'],\n\t\tflow: {\n\t\t\tstart: ['mousedown', 'touchstart'],\n\t\t\tend: ['mouseup', 'touchend']\n\t\t},\n\t\temits: ['hold'],\n\t\tmouseup: function(e) {\n\t\t\treturn this.up(e);\n\t\t},\n\t\ttouchend: function(e) {\n\t\t\treturn this.up(e.changedTouches[0], e);\n\t\t},\n\t\tup: function(e) {\n\t\t\tclearTimeout( holdTimer );\n\t\t\treturn false;\n\t\t},\n\t\tmousedown: function(e) {\n\t\t\treturn this.down(e);\n\t\t},\n\t\ttouchstart: function(e) {\n\t\t\treturn this.down(e.changedTouches[0], e);\n\t\t},\n\t\tdown: function(e, preventer) {\n\t\t\tholdTimer = setTimeout( function() {\n\t\t\t\tPolymer.Gestures.fire( Polymer.Gestures.findOriginalTarget(e), 'hold', {\n\t\t\t\t\tx: e.clientX,\n\t\t\t\t\ty: e.clientY,\n\t\t\t\t\tsourceEvent: e,\n\t\t\t\t\tpreventer: preventer\n\t\t\t\t});\n\t\t\t}, HOLD_THRESHOLD );\n\t\t\treturn false;\n\t\t}\n\t});\n}\n","export const PREFIX = '/contract';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-contract-lookup', mod: 'contracts/selection/routes/sb-contract-lookup/ContractLookup.js'}\n};\n","export const PREFIX = '/docgen';\nexport const ROUTES = {\n\t'/preview': { comp: 'sb-docgen-preview', mod: 'docgen/sb-docgen-preview/DocgenPreview.js' }\n}\n","'use strict';\n\nSystem.register('favorites/favorites.js', ['favorites/sb-favorite-lookup/FavoriteLookup.js', 'favorites/sb-favorite-share-dialog/FavoriteShareDialog.js'], function (_export, _context) {\n  return {\n    setters: [function (_favoritesSbFavoriteLookupFavoriteLookupJs) {}, function (_favoritesSbFavoriteShareDialogFavoriteShareDialogJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJmYXZvcml0ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/favorite';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-favorite-lookup', mod: 'favorites/sb-favorite-lookup/FavoriteLookup.js'},\n};\n","const CORE_LOG_NAME = \"cpqEPT\";\nconst CORE_LOG_ENDPOINT = \"/_ui/common/request/servlet/CPQLoggingServlet\";\nconst METRICSSERVICE_VERSION = \"1.0\";\nexport const IDLE_RETRIES = 2; // Wait extra cycles before declaring the transaction end\n\nexport class MetricsService {\n\n\t/**\n\t * Call this to start the EPT MetricsService (e.g. page loads, page actions, etc)\n\t */\n\tstartTransaction(msg) {\n\t\tif (this.canGatherMetrics() && this._isNotStarted()) {\n\t\t\tthis._init();\n\t\t\t// ensure this MetricsService is called when the window becomes idle\n\t\t\tthis._queueIdleCallback();\n\t\t\tconsole.log(msg || 'CPQ Performance Metrics Service: started ept');\n\t\t}\n\t}\n\n\t/**\n\t * Indicates a service request has been queued\n\t */\n\tstartServiceRequest(actionName, additionalInfo) {\n\t\tif (this._isNotStarted())\n\t\t\treturn null;\n\n\t\t// tracks number of service requests pending\n\t\twindow.sb.MetricsService.internal.sptNum += 1;\n\n\t\tlet id = this._getUniqueId();\n\t\tif (actionName === undefined) {\n\t\t\tactionName = '';\n\t\t}\n\n\t\tif (additionalInfo !== undefined) {\n\t\t\tactionName = actionName + '/' + additionalInfo;\n\t\t}\n\t\twindow.sb.MetricsService.internal.actions.set(id, this._buildTransportAction(actionName));\n\n\t\tconsole.log('CPQ Performance Metrics Service: started service call');\n\t\treturn id;\n\t}\n\n\t/**\n\t * Adds external metrics to be included in the log\n\t * @param metrics {Object} external metrics to be included in the log\n\t */\n\taddExternalLogMetrics(metrics) {\n\t\tif(!metrics) metrics = {};\n\t\tif(!this._externalLogMetrics) this._externalLogMetrics = {};\n\t\tObject.assign(this._externalLogMetrics, metrics);\n\t}\n\n\t//TODO move this to it's own plugin classes like one for transport,custom actions,server actions etc.\n\n\t_buildTransportAction(actionName) {\n\t\treturn {\n\t\t\t\"context\": {\n\t\t\t\t\"actionDefs\": [\n\t\t\t\t\tactionName\n\t\t\t\t],\n\t\t\t},\n\t\t\t\"pageStartTime\": Date.now(),\n\t\t\t\"ts\": this._getTime(),\n\t\t\t\"name\": \"request\",\n\t\t\t\"ns\": \"transport\"\n\t\t};\n\t}\n\n\t/**\n\t * Indicate a service response has been resolved\n\t * @param sptTime the total time the service took on the server\n\t */\n\tstopServiceRequest(id, sptTime = 0) {\n\t\tif (this._isNotStarted())\n\t\t\treturn;\n\n\t\twindow.sb.MetricsService.internal.sptNum -= 1;\n\t\t// Allow for more time in idle between server requests\n\t\twindow.sb.MetricsService.internal.idleRetries = IDLE_RETRIES;\n\n\t\tif (window.sb.MetricsService.internal.idleStart > 0) {\n\t\t\twindow.sb.MetricsService.internal.idleTime += (this._getTime() - window.sb.MetricsService.internal.idleStart);\n\t\t\twindow.sb.MetricsService.internal.idleStart = 0;\n\t\t}\n\t\tthis._populateTransportAction(id);\n\t\twindow.sb.MetricsService.internal.sptTime += sptTime;\n\t\tconsole.log('CPQ Performance Metrics Service: ended service call', sptTime);\n\t}\n\n\t_init(entityId = null) {\n\t\tlet now = Date.now();\n\t\tlet perfNow = this._getTime();\n\t\tvar pageStartTime = this._getPageStartTime();\n\t\twindow.sb.visibilityStateEnd = document.visibilityState;\n\t\t// Save a MetricsService object to be used as an array to save state for later calls.\n\t\twindow.sb = window.sb || {};\n\t\tif (window.sb != null && window.sb.MetricsService == null) {\n\t\t\twindow.sb.MetricsService = {};\n            // The first time init is called it will save the bootstrap info which denotes the app load time\n            window.sb.MetricsService.bootstrap = {\n                \"id\" : \"qtc:bootstrap\",\n            };\n            window.sb.MetricsService.bootstrap[\"bootstrapEPT\"] = perfNow;\n            window.sb.MetricsService.bootstrap[\"pageStartTime\"] = pageStartTime;\n            window.sb.MetricsService.bootstrap[\"visibilityStateStart\"] = window.sb.visibilityStateStart;\n            window.sb.MetricsService.bootstrap[\"visibilityStateEnd\"] = window.sb.visibilityStateEnd;\n            var allReq = [];\n            if (window.performance && performance.timing) {\n                var p  = window.performance;\n                var pt = p.timing;\n                var additionalMetrics = {\n\n                        // Time consumed preparing the new page\n                        \"readyStart\"      : pt.fetchStart - pt.navigationStart,\n\n                        // DNS query time\n                        \"lookupDomainTime\": pt.domainLookupEnd - pt.domainLookupStart,\n\n                        // TCP connection time\n                        \"connectTime\"     : pt.connectEnd - pt.connectStart,\n\n                        // Time spent during the request\n                        \"requestTime\"     : pt.responseEnd - pt.requestStart,\n\n                        // Request to completion of the DOM loading\n                        \"initDomTreeTime\" : pt.domInteractive - pt.responseEnd,\n\n                         // Time spent constructing the DOM tree\n                        \"domReadyTime\"    : pt.domComplete - pt.domInteractive,\n\n                        // Load event time\n                        \"loadEventTime\"   : pt.loadEventEnd - pt.loadEventStart,\n\n                        // Total time from start to load\n                        \"loadTime\"        : pt.loadEventEnd - pt.fetchStart,\n\n                        // Time spent unloading documents\n                        \"unloadEventTime\" : pt.unloadEventEnd - pt.unloadEventStart,\n\n                        // AppCache\n                        \"appCacheTime\"    : pt.domainLookupStart - pt.fetchStart,\n\n                        // Time spent during redirection\n                        \"redirectTime\"    : pt.redirectEnd - pt.redirectStart\n                    };\n\n                window.sb.MetricsService.bootstrap[\"timing\"] = Object.assign(pt.toJSON(), additionalMetrics);\n\n            \twindow.sb.MetricsService.bootstrap[\"allRequests\"] = [];\n              \tp.getEntries().forEach(function (resource) {\n                    \tvar summaryRequest = this._summarizeResourcePerfInfo(resource);\n                    \twindow.sb.MetricsService.bootstrap[\"allRequests\"].push(summaryRequest);\n            \t}, this);           \t\n            }\n\t\t} else {\n\t\t\t//After first time,bootstrap object needs to be empty.\n\t\t\twindow.sb.MetricsService.bootstrap = {};\n\t\t}\n\n\t\t// initialize the window.sb MetricsService object\n\n\t\twindow.sb.MetricsService.internal = {\n\t\t\tlastIdleEndTime : perfNow,\n\t\t\tsptNum : 0,\n\t\t\tidleStart : 0,\n\t\t\tidleTime : 0,\n\t\t\tsptTime: 0,\n\t\t\tidleRetries : IDLE_RETRIES,\n\t\t\tactions : new Map()\n\t\t};\n\n\t\twindow.sb.MetricsService.currentPage = {\n\t\t\t\"ept\": undefined,\n\t\t\t\"bpt\": undefined,\n\t\t\t\"spt\": undefined,\n\t\t\t\"pageStartTime\": now, // Time after app.init, which is where startTransaction gets called\n\t\t\t\"ts\": perfNow, // ts since the beginning of the page load\n\t\t\t\"page\": {\n\t\t\t\t\"attributes\": {\n\t\t\t\t\t\"app\": {\n\t\t\t\t\t\t\"appName\": \"SteelBrick\",\n\t\t\t\t\t\t\"appType\": \"Standard\"\n\t\t\t\t\t},\n\t\t\t\t\t\"url\": window.location.href\n\t\t\t\t},\n\t\t\t\t\"entity\": entityId\n\t\t\t},\n\t\t}\n\t}\n\n\t_idle() {\n\t\t// TODO we should unregister the idle when the page or button is finished loading\n\t\tif (this._isNotStarted())\n\t\t\treturn;\n\n\t\tif (window.sb.MetricsService.internal.sptNum === 0) {\n\t\t\tif (window.sb.MetricsService.internal.idleRetries !== 0) {\n\t\t\t\t// wait some idle cycles before declaring the request is finished to allow\n\t\t\t\t// time between server requests.\n\t\t\t\tif (window.sb.MetricsService.internal.idleRetries == IDLE_RETRIES) {\n\t\t\t\t\twindow.sb.MetricsService.internal.lastIdleEndTime = this._getTime();\n\t\t\t\t}\n\t\t\t\twindow.sb.MetricsService.internal.idleRetries--;\n\t\t\t} else {\n\t\t\t\tthis._calcAndDisplayMetrics();\n\t\t\t\tthis._logMetrics();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// if new idle is starting, capture the start time\n\t\tif (window.sb.MetricsService.internal.idleStart === 0)\n\t\t\twindow.sb.MetricsService.internal.idleStart = this._getTime();\n\n\t\t// we are idle, but have pending service request, so queue another idle callback\n\t\tthis._queueIdleCallback();\n\t}\n\n\t_summarizeResourcePerfInfo(r) {\n\t\treturn {\n\t\t\t\"name\"            : r.name,\n\t\t\t\"initiatorType\"   : r.initiatorType,\n\t\t    \"duration\"        : parseInt(r.responseEnd - r.startTime, 10),\n\t\t    \"startTime\"       : parseInt(r.startTime, 10),\n\t\t    \"fetchStart\"      : parseInt(r.fetchStart, 10),\n\t\t    \"requestStart\"    : parseInt(r.requestStart, 10),\n\t\t    \"dns\"             : parseInt(r.domainLookupEnd - r.domainLookupStart, 10),\n\t\t    \"tcp\"             : parseInt(r.connectEnd - r.connectStart, 10),\n\t\t    \"ttfb\"            : parseInt(r.responseStart - r.startTime, 10),\n\t\t    \"transfer\"        : parseInt(r.responseEnd - r.responseStart, 10),\n\t\t\t\"transferSize\"    : parseInt(r.transferSize, 10),\n\t\t    \"encodedBodySize\" : parseInt(r.encodedBodySize, 10),\n\t\t    \"decodedBodySize\" : parseInt(r.decodedBodySize, 10)       \n\t    };\n\t}\n\n\t_populateTransportAction(id) {\n\t\tif (!id) return;\n\t\tlet transportAction = window.sb.MetricsService.internal.actions.get(id);\n\t\tif (transportAction) {\n\t\t\ttransportAction.duration = parseInt(this._getTime() - transportAction.ts);\n\t\t}\n\t}\n\n\t_queueIdleCallback() {\n\t\tif (this.canGatherMetrics()) {\n\t\t\twindow.requestIdleCallback(this._idle.bind(this));\n\t\t}\n\t}\n\n\t_calcAndDisplayMetrics() {\n\t\tlet eptTime = window.sb.MetricsService.internal.lastIdleEndTime - window.sb.MetricsService.currentPage.ts;\n\t\tlet bptTime = eptTime - window.sb.MetricsService.internal.idleTime;\n\t\tlet sptTime = window.sb.MetricsService.internal.sptTime;\n\t\tvar transports = [];\n\t\tvar allResources = null;\n\t\tif (window.performance && window.performance.getEntriesByType) {\n\t\t\tallResources = window.performance.getEntriesByType(\"resource\");\n\t\t}\n\n\t\tfor (var [key, value] of window.sb.MetricsService.internal.actions) {\n\t\t\tif (allResources != null) {\n\t\t\t\tvar resource = allResources.filter(function (res) {\n\t\t\t\t\treturn (res.startTime >= value.ts) && (res.startTime <= (value.ts + value.duration));\n\t\t\t\t})[0];\n\t\t\t\tif (resource != null) {\n\t\t\t\t\tvalue.resource = resource;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttransports.push(value);\n\t\t}\n\t\twindow.sb.MetricsService.internal = null;\n\t\twindow.sb.MetricsService.currentPage.ept = eptTime;\n\t\twindow.sb.MetricsService.currentPage.bpt = bptTime;\n\t\twindow.sb.MetricsService.currentPage.spt = sptTime;\n\t\twindow.sb.MetricsService.currentPage.marks = {\n\t\t\t\"transport\": transports\n\t\t}\n\t\tconsole.log('CPQ Performance Metrics Service: ', window.sb.MetricsService.bootstrap, window.sb.MetricsService.currentPage);\n\n\t\t// Display the stickers only if debug mode is on\n\t\tif (this._canDisplayMetrics()) {\n\t\t\tlet metricsChangedEvent = new CustomEvent('metrics-changed', {\n\t\t\t\t'detail': window.sb.MetricsService.currentPage,\n\t\t\t\t'bootstrap': window.sb.MetricsService.bootstrap\n\t\t\t});\n\t\t\tdocument.dispatchEvent(metricsChangedEvent);\n\t\t}\n\t}\n\n\t_normalizeApiHost(apiHost) {\n\t\tvar m = /([a-zA-Z0-9_-]+)\\.(vpod\\.visual\\.t\\.force|visual\\.force|salesforce)\\.com$/.exec(apiHost);\n\t\tif (m) {\n\t\t\tif (m[2] == \"vpod.visual.t.force\") {\n\t\t\t\tapiHost = m[1] + \".vpod.t.force.com\";\n\t\t\t} else {\n\t\t\t\tapiHost = m[1] + \".salesforce.com\";\n\t\t\t}\n\t\t}\n\t\treturn apiHost;\n\t}\n\n\t_logMetrics() {\n\n\t\t// We are only interested in logging transactions with at least 150ms\n\t\t// This will eliminate the noise cased by random clicks on the page\n\t\tif (window.sb.MetricsService.currentPage.ept < 150) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Figures out the hostname for the API request. QLE is build on visual force\n\t\t// so the hostname will be different than the servlet endpoint\n\t\tvar hostname = this._normalizeApiHost(location.host);\n\t\tvar url = location.protocol + \"//\" + hostname + CORE_LOG_ENDPOINT;\n\n\t\t// Core logging require a valid session id (hence passing the cookie)\n\t\t// Also adding the Origin header in the query to handle CORS\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.withCredentials = true;\n\t\txhr.open(\"POST\", url, true);\n\n\t\t// Log the results of the call when done\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState == XMLHttpRequest.DONE) {\n\t\t\t\tif (xhr.status == 200) {\n\t\t\t\t\tconsole.log(\"CPQ Performance Metrics service Successfully logged\");\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Error while logging CPQ Performance Metrics Service:\");\n\t\t\t\t\tconsole.log(xhr.getAllResponseHeaders());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar defaultAttrs = {\n\t\t\t\"pkgVersion\": window.sb.pkgVersion,\n\t\t\t\"apiVersion\": window.sb.common.core.AppContext.org.apiVersion,\n\t\t\t\"url\": window.sb.MetricsService.currentPage.page.attributes.url,\n\t\t\t\"pageStartTime\": window.sb.MetricsService.currentPage.pageStartTime,\n\t\t\t\"version\": METRICSSERVICE_VERSION\n\t\t};\n\n\t\t// add external log metrics if provided\n\t\tif(this._externalLogMetrics)\n\t\t\tObject.assign(defaultAttrs, this._externalLogMetrics);\n\n\t\t// Build the JSON expected by the servlet\n\t\tvar logLines = [\n\t\t\t{\n\t\t\t\t\"logName\": CORE_LOG_NAME,\n\t\t\t\t\"logLevel\": \"INFO\",\n\t\t\t\t\"logAttrs\": {\n\t\t\t\t\t\"attrsId\": \"cpq:page\",\n\t\t\t\t\t\"ept\": window.sb.MetricsService.currentPage.ept,\n\t\t\t\t\t\"bpt\": window.sb.MetricsService.currentPage.bpt,\n\t\t\t\t\t\"spt\": window.sb.MetricsService.currentPage.spt,\n\t\t\t\t\t\"resources\": window.sb.MetricsService.currentPage.marks\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tObject.assign(logLines[0].logAttrs, defaultAttrs);\n\n\t\tif (Object.keys(window.sb.MetricsService.bootstrap).length !== 0) {\n\t\t\tlogLines.push({\n\t\t\t\t\"logName\": CORE_LOG_NAME,\n\t\t\t\t\"logLevel\": \"INFO\",\n\t\t\t\t\"logAttrs\": {\n\t\t\t\t\t\"attrsId\": window.sb.MetricsService.bootstrap.id,\n\t\t\t\t\t\"bootstrapEPT\": window.sb.MetricsService.bootstrap.bootstrapEPT,\n\t\t\t\t\t\"visibilityStateStart\": window.sb.MetricsService.bootstrap.visibilityStateStart,\n\t\t\t\t\t\"visibilityStateEnd\": window.sb.MetricsService.bootstrap.visibilityStateEnd,\n\t\t\t\t\t\"resources\": window.sb.MetricsService.bootstrap.allRequests,\n\t\t\t\t\t\"timing\": window.sb.MetricsService.bootstrap.timing\n\t\t\t\t}\n\t\t\t});\n\t\t\tObject.assign(logLines[1].logAttrs, defaultAttrs);\n\t\t}\n\n\t\t// Send the data\n\t\tvar formData = new FormData();\n\t\tformData.append(\"logLines\", JSON.stringify(logLines));\n\t\txhr.send(formData);\n\t}\n\n\t_canDisplayMetrics() {\n\t\t// If I can't gather the metrics and can't display them\n\t\tif (!this.canGatherMetrics()) {\n\t\t\treturn false;\n\t\t}\n\t\t// Display the stickers only if eptVisible flag is set in the UI\n\t\tvar url = new URL(window.location.href);\n\t\tvar searchParams = new URLSearchParams(url.search);\n\t\tvar eptVisible = searchParams.get('eptVisible');\n\t\treturn (eptVisible == true);\n\t}\n\n\tcanGatherMetrics() {\n\t\t// uses an experimental API to track when the window is Idle, only supported in Chrome and FF\n\t\treturn (typeof window.requestIdleCallback === 'function');\n\t}\n\n\t_isNotStarted() {\n\t\treturn window.sb == null || window.sb.MetricsService == null || window.sb.MetricsService.internal == null ||\n\t\t\twindow.sb.MetricsService.internal.sptNum == null;\n\t}\n\n\t_getTime() {\n\t\tif (window.performance) {\n\t\t\treturn window.performance.now();\n\t\t} else {\n\t\t\treturn Date.now();\n\t\t}\n\t}\n\n\t _getPageStartTime() {\n        //Get the page firstByte timestamp from either performance API or a mark in the page\n        var p = window.performance;\n        var pst;\n        if (p && p.timing && p.timing.navigationStart) {\n            pst = p.timing.navigationStart;\n        } else {\n            pst = window[\"pageStartTime\"];\n        }\n        return pst;\n    }\n\n\t_getUniqueId() {\n\t\treturn this._getRandomInt(1, 10000);\n\t}\n\n\t_getRandomInt(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n}\n","'use strict';\n\nSystem.register('products/products.js', ['products/config/attribute/sb-attribute-item/AttributeItem.js', 'products/config/attribute/sb-attribute-table/AttributeTable.js', 'products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js', 'products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js', 'products/config/feature/sb-product-feature/ProductFeature.js', 'products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js', 'products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js', 'products/config/feature/sb-product-feature-list/ProductFeatureList.js', 'products/config/option/sb-product-option-table/ProductOptionTable.js', 'products/config/option/sb-option-cell/OptionCell.js', 'products/config/option/sb-option-drawer/OptionDrawer.js', 'products/config/routes/services/sb-pc-product-load/ProductLoader.js', 'products/config/routes/services/sb-pc-option-save/OptionSaver.js', 'products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js', 'products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js', 'products/config/actions/sb-custom-actions/CustomActions.js', 'products/localization/LocalizeFields.js', 'products/resources/sb-product-alert/ProductAlert.js'], function (_export, _context) {\n  return {\n    setters: [function (_productsConfigAttributeSbAttributeItemAttributeItemJs) {}, function (_productsConfigAttributeSbAttributeTableAttributeTableJs) {}, function (_productsConfigBundlesSbProductBundlesLayoutProductBundlesLayoutJs) {}, function (_productsConfigBundlesSbProductBundlesFilterItemProductBundlesFilterItemJs) {}, function (_productsConfigFeatureSbProductFeatureProductFeatureJs) {}, function (_productsConfigFeatureSbProductFeatureLayoutProductFeatureLayoutJs) {}, function (_productsConfigFeatureSbProductFeatureCategoryListProductFeatureCategoryListJs) {}, function (_productsConfigFeatureSbProductFeatureListProductFeatureListJs) {}, function (_productsConfigOptionSbProductOptionTableProductOptionTableJs) {}, function (_productsConfigOptionSbOptionCellOptionCellJs) {}, function (_productsConfigOptionSbOptionDrawerOptionDrawerJs) {}, function (_productsConfigRoutesServicesSbPcProductLoadProductLoaderJs) {}, function (_productsConfigRoutesServicesSbPcOptionSaveOptionSaverJs) {}, function (_productsConfigRoutesServicesSbProductRulesInvokeProductRulesInvokerJs) {}, function (_productsConfigRoutesServicesSbPcOptionConfigureOptionConfiguratorJs) {}, function (_productsConfigActionsSbCustomActionsCustomActionsJs) {}, function (_productsLocalizationLocalizeFieldsJs) {}, function (_productsResourcesSbProductAlertProductAlertJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcm9kdWN0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbXX0=","export const PREFIX = '/product';\nexport const ROUTES = {\n\t'/dl': {comp: 'sb-dynamic-lookup', mod: 'products/config/routes/sb-dynamic-lookup/DynamicLookup.js'},\n\t'/lookup': {comp: 'sb-product-lookup', mod: 'products/selection/routes/sb-product-lookup/ProductLookup.js'},\n\t'/ol': {comp: 'sb-option-lookup', mod: 'products/config/routes/sb-option-lookup/OptionLookup.js'},\n\t'/pc': {comp: 'sb-product-config', mod: 'products/config/routes/sb-product-config/ProductConfig.js'},\n\t'/search': {comp: 'sb-product-search', mod: 'products/prototype/sb-product-search/ProductSearch.js'}\n};\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n *\n * Quote level context\n *\n * @author kzheng\n * @since 212\n *\n */\n\nlet constants = null;\n\nexport class QuoteContext {\n\n\t/**\n\t * @returns Quote relevant constants, see quotes/models/Constants.js\n\t */\n\tstatic get constants() {\n\t\treturn constants;\n\t}\n\n\tstatic set constants(value) {\n\t\tconstants = value;\n\t}\n\n\t/**\n\t * Check if a field is a discount field by matching it against the ADDITIONAL DISCOUNT FIELD name\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isDiscountField(field) {\n\t\treturn field === constants.ADDITIONAL_DISCOUNT_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is a markup field\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isMarkupField(field) {\n\t\treturn field === constants.MARKUP_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is list price\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isListPriceField(field) {\n\t\treturn field === constants.LIST_PRICE_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is product name\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isProductNameField(field) {\n\t\treturn field === constants.PRODUCT_NAME_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is net total field\n\t * @param field\n\t * @return {boolean}\n\t */\n\tstatic isNetTotalField(field) {\n\t\treturn field === constants.NET_TOTAL_FIELD;\n\t}\n\n\t/**\n\t * Check if a field is subscription scope field\n\t * @param field\n\t * @returns {boolean}\n\t */\n\tstatic isSubscriptionScopeField(field) {\n\t\treturn field === constants.SUBSCRIPTION_SCOPE_FIELD;\n\t}\n}","'use strict';\n\nSystem.register('quotes/quotes.js', ['quotes/pages/sb-line-editor/LineEditor.js', 'quotes/sb-le-custom-action-services/LECustomActionServices.js', 'quotes/md/sb-le-field-md/LEFieldMD.js', 'quotes/layout/sb-le-group/LEGroup.js', 'quotes/tables/sb-standard-lines/StandardLines.js', 'quotes/tables/sf-standard-table/SFStandardTable.js', 'quotes/tables/sf-segmented-table/SFSegmentedTable.js', 'quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js', 'quotes/tables/sb-segmented-lines/SegmentedLines.js', 'quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js', 'quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js', 'quotes/layout/sf-le-table-row/SFLETableRow.js', 'quotes/layout/sb-le-table-row/LETableRow.js', 'quotes/layout/sf-line-actions/SFLineActions.js', 'quotes/layout/sf-line-warning/SFLineWarning.js', 'quotes/layout/sb-le-table-cell/LETableCell.js', 'quotes/layout/sb-ds-table-cell/DSTableCell.js', 'quotes/layout/sb-ds-tiers/DSTiers.js', 'quotes/layout/sb-le-table-header/LETableHeader.js', 'quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js', 'quotes/layout/sb-le-footer/LEFooter.js', 'quotes/layout/sb-le-group-layout/LEGroupLayout.js', 'quotes/layout/sb-le-list/LEList.js', 'quotes/layout/sb-le-list-row/LEListRow.js', 'quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js', 'quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js', 'quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js', 'quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js', 'quotes/layout/sb-field-set-table-item/FieldSetTableItem.js', 'quotes/layout/sb-field-set-table/FieldSetTable.js', 'quotes/layout/sb-le-drawer/LEDrawer.js', 'quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js', 'quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js', 'quotes/layout/sb-custom-action/CustomAction.js', 'quotes/layout/sb-le-summary-row/LESummaryRow.js', 'quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js', 'quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js', 'quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js', 'quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js', 'quotes/layout/sb-cse-table-cell/CSETableCell.js', 'quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js', 'quotes/models/DragDropModel.js', 'quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js'], function (_export, _context) {\n  return {\n    setters: [function (_quotesPagesSbLineEditorLineEditorJs) {}, function (_quotesSbLeCustomActionServicesLECustomActionServicesJs) {}, function (_quotesMdSbLeFieldMdLEFieldMDJs) {}, function (_quotesLayoutSbLeGroupLEGroupJs) {}, function (_quotesTablesSbStandardLinesStandardLinesJs) {}, function (_quotesTablesSfStandardTableSFStandardTableJs) {}, function (_quotesTablesSfSegmentedTableSFSegmentedTableJs) {}, function (_quotesLayoutSfSegmentedCellTooltipSFSegmentedCellTooltipJs) {}, function (_quotesTablesSbSegmentedLinesSegmentedLinesJs) {}, function (_quotesLayoutSbSegmentedLineDetailsSegmentedLineDetailsJs) {}, function (_quotesLayoutSbSegmentedDetailRowSegmentedDetailRowJs) {}, function (_quotesLayoutSfLeTableRowSFLETableRowJs) {}, function (_quotesLayoutSbLeTableRowLETableRowJs) {}, function (_quotesLayoutSfLineActionsSFLineActionsJs) {}, function (_quotesLayoutSfLineWarningSFLineWarningJs) {}, function (_quotesLayoutSbLeTableCellLETableCellJs) {}, function (_quotesLayoutSbDsTableCellDSTableCellJs) {}, function (_quotesLayoutSbDsTiersDSTiersJs) {}, function (_quotesLayoutSbLeTableHeaderLETableHeaderJs) {}, function (_quotesLayoutSbLeTableHeaderCellLETableHeaderCellJs) {}, function (_quotesLayoutSbLeFooterLEFooterJs) {}, function (_quotesLayoutSbLeGroupLayoutLEGroupLayoutJs) {}, function (_quotesLayoutSbLeListLEListJs) {}, function (_quotesLayoutSbLeListRowLEListRowJs) {}, function (_quotesLayoutSbLeListGroupHeaderRowLEListGroupHeaderRowJs) {}, function (_quotesLayoutSbLeListGroupFooterRowLEListGroupFooterRowJs) {}, function (_quotesLayoutSbLeListStandardLineRowLEListStandardLineRowJs) {}, function (_quotesLayoutSbLeListSegmentedLineRowLEListSegmentedLineRowJs) {}, function (_quotesLayoutSbFieldSetTableItemFieldSetTableItemJs) {}, function (_quotesLayoutSbFieldSetTableFieldSetTableJs) {}, function (_quotesLayoutSbLeDrawerLEDrawerJs) {}, function (_quotesLayoutSbLineEditorTabsSbQuoteTabsQuoteTabsJs) {}, function (_quotesLayoutSbLineEditorTabsSbGroupTabsGroupTabsJs) {}, function (_quotesLayoutSbCustomActionCustomActionJs) {}, function (_quotesLayoutSbLeSummaryRowLESummaryRowJs) {}, function (_quotesLayoutSbLeSummaryRowSbLeSummaryCellLESummaryCellJs) {}, function (_quotesDialogsSbFavoriteDialogFavoriteDialogJs) {}, function (_quotesDialogsSbCloneToGroupDialogCloneToGroupDialogJs) {}, function (_quotesDialogsSbCustomSegmentDialogCustomSegmentDialogJs) {}, function (_quotesLayoutSbCseTableCellCSETableCellJs) {}, function (_quotesDialogsSbPricebookDialogPricebookDialogJs) {}, function (_quotesModelsDragDropModelJs) {}, function (_quotesDialogsSbDiscountScheduleDialogDiscountScheduleDialogJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJxdW90ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/quote';\nexport const ROUTES = {\n\t'/le': { comp: 'sb-line-editor', mod: 'quotes/pages/sb-line-editor/LineEditor.js' }\n}\n","\"use strict\";\n\nSystem.register(\"subscriptions/subscriptions.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzdWJzY3JpcHRpb25zLmpzIiwic291cmNlc0NvbnRlbnQiOltdfQ==","export const PREFIX = '/subscription';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-subscription-lookup', mod: 'subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js'}\n};","\"use strict\";\n\nSystem.register(\"Utils/DAOs/UsageRateCardDAO.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJVc2FnZVJhdGVDYXJkREFPLmpzIiwic291cmNlc0NvbnRlbnQiOltdfQ==","import {AppContext} from 'common/core/AppContext.js';\n\nlet totalTime = 0;\nlet totalComponents = 0;\nlet currentTime;\nlet deviceClasses;\nlet checkPerformance = false;\nlet quiet = true;\n\nexport class DeviceBehavior {\n\n\tready() {\n\t\tif (checkPerformance)\n\t\t\tthis.startPerformanceCheck();\n\n\t\t// toggle the device classes to the component itself and to all of its \"device\" annotated elements\n\t\tlet deviceNodes = Polymer.dom(this.root).querySelectorAll('*[device]') || [];\n\t\tlet deviceClasses = this.getDeviceClasses();\n\t\tfor (let deviceClass of deviceClasses) {\n\t\t\tthis.toggleClass(deviceClass, true, this);\n\t\t\tfor(let deviceNode of deviceNodes)\n\t\t\t\tthis.toggleClass(deviceClass, true, deviceNode);\n\t\t}\n\n\t\t// add joined device classes as property on the component in case it needs to applied via class attribute interpolation\n\t\t// class$=\"[[deviceClasses]]\"\n\t\tthis['deviceClasses'] = deviceClasses.join(' ');\n\n\t\tif(checkPerformance)\n\t\t\tthis.stopPerformanceCheck(this);\n\n\t\tif(!quiet && deviceNodes.length === 0)\n\t\t\tconsole.warn(`${this.tagName.toLowerCase()}.html is missing an element with the device attribute`);\n\t}\n\n\tgetDeviceClasses() {\n\t\tif(deviceClasses)\n\t\t\treturn deviceClasses;\n\n\t\tif(!AppContext.hasInitialized())\n\t\t\tAppContext.init({});\n\n\t\tif(AppContext.isPhone) deviceClasses = ['--phone', '--mobile'];\n\t\telse if(AppContext.isTablet) deviceClasses = ['--tablet','--mobile'];\n\t\telse deviceClasses = ['--desktop'];\n\n\t\treturn deviceClasses;\n\t}\n\n\tstartPerformanceCheck() {\n\t\tcurrentTime = performance.now();\n\t}\n\n\tstopPerformanceCheck() {\n\t\tvar time =  performance.now() - currentTime;\n\t\ttotalTime += time;\n\t\ttotalComponents++;\n\t\tif(time > 1) console.warn(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t\telse console.log(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.DeviceBehavior = DeviceBehavior.prototype;","import {AppContext} from 'common/core/AppContext.js';\n\nexport class LookupBehavior {\n\tready() {\n\t\tthis.handleProductsLoadServerResponse();\n\t\tthis.handleHideSearchFilterIfNoSearchColumnsDisplayed();\n\t\tthis.bindFilterEnterCallBacks();\n\t}\n\n\thandleHideSearchFilterIfNoSearchColumnsDisplayed() {\n\t\tthis.addEventListener('no-displayed-filters', function () {\n\t\t\tthis.removeFilter();\n\t\t}.bind(this));\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.LookupBehavior = LookupBehavior.prototype;","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n *\n * Common behavior for table row\n * In order to use this behavior, a component is also required to include Polymer.Templatizer behavior\n *\n * @author kzheng\n * @since 212\n *\n */\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class SFTableRowBehavior {\n\n\tstatic get properties() {\n\n\t\treturn {\n\t\t\t// row template is the HTML element used to templatize a row\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_rowTemplateChanged'\n\t\t\t},\n\t\t};\n\t}\n\n\t\t/** Returns the cell element given the index of all cells in this row, null if not found */\n\t\tgetCellByIndex( index ) {\n\t\t\tlet container = this.querySelector( \"#content > div\" );\n\t\t\tif( container ) {\n\t\t\t\tlet cells = Array.from( container.children );\n\t\t\t\tif( cells ) {\n\t\t\t\t\tindex = Math.min(Math.max(0, index), cells.length - 1);\n\t\t\t\t\treturn cells[index];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t/**\n\t * Templatize a template HTML string, then stamp it with data\n\t * @param templateHTML The HTML template string\n\t * @param data Data to stamp the template with\n\t * @return A template instance\n\t */\n\thydrateTemplate(templateHTML, data) {\n\t\tlet template = document.createElement('template');\n\t\ttemplate.innerHTML = `<div>${templateHTML}</div>`;\n\t\tthis.templatize(template);\n\t\treturn this.stamp(data || {});\n\t}\n\n\t/**\n\t * Build a template with the given DOM node, then templatize and stamp it\n\t * @param templateNode\n\t * @param data\n\t * @returns {*}\n\t */\n\thydrateTemplateFromNode(templateNode, data) {\n\t\tlet template = document.createElement('template');\n\t\ttemplate.content.appendChild(templateNode);\n\t\tthis.templatize(template);\n\t\treturn this.stamp(data || {});\n\t}\n\n\tonHovered(evt) {\n\t\tthis.toggleClass('show', true, this.$$('#content'));\n\t\tthis.hook_onHovered(evt);\n\t}\n\n\tonUnhovered() {\n\t\tthis.toggleClass('show', false, this.$$('#content'));\n\t}\n\n\tonTap( evt ) {\n\t\tlet handled = false;\n\t\tlet tableComp = this.getTableComponent( evt );\n\t\tlet cell = SFAbstractTable.findCell( evt );\n\t\tlet isEditable = cell && cell.classList.contains( TemplateGenerator.classNames.EDITABLE ),\n\t\t\t\tisBoolean = cell && cell.classList.contains( TemplateGenerator.classNames.BOOLEAN ),\n\t\t\t\tisFocused = cell && cell.classList.contains( TemplateGenerator.classNames.HAS_FOCUS ),\n\t\t\t\tisEditing = cell && cell.classList.contains( TemplateGenerator.classNames.EDIT_MODE);\n\n\t\tif (tableComp && !isFocused) {\n\t\t\ttableComp.applyCellFocus(cell);\n\t\t\t// tapping a cell turns off editOnFocus, unless it also turns on editing (see below)\n\t\t\ttableComp.setEditOnFocus(false);\n\t\t}\n\n\t\t// if editable and already in focus or pencil clicked then go into edit mode\n\t\tif (isEditable && !isEditing && ( (isFocused && !isBoolean) || findEditIcon(evt) )) {\n\t\t\tthis.toggleInlineEdit(cell, true);\n\t\t\tif (tableComp) {\n\t\t\t\ttableComp.setEditOnFocus(true);\n\t\t\t}\n\t\t\thandled = true;\n\t\t}\n\n\t\t// allow custom handling of onTap\n\t\tthis.hook_onTap( evt, handled, isEditable );\n\t}\n\t\n\t/** Returns the table component for the given event, if it exists */\n\tgetTableComponent( e ) {\n\t\treturn Polymer.dom(e).path.find((pathElem) => {\n\t\t\tlet tagname = pathElem && pathElem.tagName ? pathElem.tagName.toUpperCase() : '';\n\t\t\treturn tagname === 'SF-STANDARD-TABLE' || tagname === 'SF-SEGMENTED-TABLE';\n\t\t});\n\t}\n\t\n\t/**\n\t * Extra on hover handling, to be implemented by including component\n\t * @param evt\n\t */\n\thook_onHovered(evt) { }\n\n\t/**\n\t * Extra onTap handling, to be implemented by including component\n\t * @param evt\n\t * @param handled whether the event has already been handled by SFTableRowBehavior's onTap\n\t */\n\thook_onTap(evt, handled) { }\n\n\t/**\n\t * Toggle inline edit behavior for the container\n\t * To be implemented by including component\n\t * @param container the container div where inline edit is being toggled\n\t * @param isEdit whether inline edit should be turn on or off\n\t */\n\ttoggleInlineEdit(container, isEdit) { }\n\n}\n\n/** Find the edit icon (pencil) in the event path, i.e. did the user click on the pencil? */\nfunction findEditIcon( e ) {\n\tlet paths = Polymer.dom(e).path;\n\tif( paths && paths.length > 0 && paths[0].classList.contains( TemplateGenerator.classNames.EDIT_ICON ) ) {\n\t\treturn paths[0];\n\t}\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFTableRowBehavior = SFTableRowBehavior.prototype;\n","// Singleton/instance data exposed by this class\nlet labels = {},\n\t\torg = {},\n\t\tmd = {},\n\t\tuser = {},\n\t\tdevice = {},\n\t\ti18n = {};  // instance of I18n.js, which we can't import normally due to circular dependency\n\nlet sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\n/**\n * A \"context\" class for the entire Application.  It knows how to initialize/get all the common stuff\n * that any page of the application might need.  This includes:\n *\n * User settings (language, locale, timezone, fullname, email, etc)\n * Localized labels\n * Org settings\n * Org Metadata\n * UI Themes\n *\n * It exposes these as both static and instance properties so that regular javascript can reference\n * in either way, and we can also use class inheritence so Polymer properties can be data bound.\n */\n\nexport class AppContext {\n\t/**\n\t * Initialize the application context data.  This needs to be called (at least once) before\n\t * other methods are used to access instance data.\n\t * @param  {Object} settingsObj details about the org and the user\n\t * @return {Promise}\n\t */\n\tstatic init(settingsObj) {\n\t\tAppContext.buildUserAndOrgFromSettings(settingsObj);\n\t\tAppContext.device = 'desktop';\n\t\t// For ipad, other tablets and Android tablet device, but not a windows hybrid\n\t\tif ( (navigator.userAgent.match(/Tablet|iPad|iPod/i) && !navigator.userAgent.match(/Tablet PC/i)) || (navigator.userAgent.match(/Android/i) && !navigator.userAgent.match(/Mobi/i)) ) {\n\t\t\tAppContext.device = 'tablet';\n\t\t} else if (navigator.userAgent.match(/Mobi/i)) {\n\t\t\tAppContext.device = 'phone';\n\t\t}\n\n\t\tlet i18nClass = null;\n\t\treturn new Promise( function(resolve, reject) {\n\t\t\tSystem.import( 'common/core/sb-i18n/I18n.js' ).then( function(n) {\n\t\t\t\ti18nClass = n.I18n;\n\t\t\t\tSystem.import( 'labels_en.js' ).then( function(m) {\n\t\t\t\t\tlet userLabels = m.LABELS; // default to our built English file\n\t\t\t\t\tif( sb.labels ) {\n\t\t\t\t\t\tuserLabels = window.sb.labels;  // labels from production org or other language\n\t\t\t\t\t}\n\n\t\t\t\t\tlabels = userLabels;\n\t\t\t\t\tlet ret = { labels: userLabels, user: user };\n\n\t\t\t\t\tif( i18nClass )\n\t\t\t\t\t\ti18n = new i18nClass( ret );  // create singleton instance\n\n\t\t\t\t\tresolve( ret );\n\t\t\t\t}).catch( function(e) {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * It has been possible to call the static methods on this before init has been run W-3635053\n\t * Providing an API to let users of this know if it is ready for use\n\t * Which at this time means buildUserAndOrgFromSettings has been run\n\t * @returns {boolean} are the properties ready?\n\t */\n\tstatic hasInitialized() {\n\t\treturn AppContext.userAndOrgSettingsSet === true;\n\t}\n\n\tstatic buildUserAndOrgFromSettings(settingsObj) {\n\t\tif (!settingsObj)\n\t\t\treturn;\n\n\t\tAppContext.userAndOrgSettingsSet = true;\n\n\t\tAppContext.user = {\n\t\t\tlang: settingsObj.language,\n\t\t\tlocale: settingsObj.locale,\n\t\t\tid: settingsObj.userId,\n\t\t\tfullname: settingsObj.fullName,\n\t\t\tusername: settingsObj.userName,\n\t\t\tdevice: settingsObj.device,\n\t\t\tinCommunity: settingsObj.inCommunity,\n\t\t\thasQuoteEditPermission: settingsObj.hasQuoteEditPermission,\n\t\t\toik: settingsObj.oik\n\t\t};\n\n\t\tAppContext.org = {\n\t\t\tprefix: settingsObj.developerPrefix !== undefined ? settingsObj.developerPrefix : 'SBQQ',\n\t\t\tisMultiCurrencyOrg: settingsObj.isMultiCurrencyOrg,\n\t\t\tcalculateImmediately: settingsObj.calculateImmediately,\n\t\t\tdefaultCurrency: settingsObj.defaultCurrency,\n\t\t\tcurrencySymbol: settingsObj.currencySymbol,\n\t\t\tcurrencyDecimalScale: settingsObj.currencyDecimalScale, // TODO ALERT THIS IS WEIRD\n\t\t\tquantityScale: settingsObj.quantityScale,\n\t\t\tisOAuth: settingsObj.isOAuth,\n\t\t\torgUrl: settingsObj.orgUrl,\n\t\t\torgInstanceUrl: settingsObj.orgInstanceUrl,\n\t\t\tsiteUrl: settingsObj.siteUrl,\n\t\t\tadditionalLookupSearchTypes: settingsObj.additionalLookupSearchTypes,\n\t\t\tmaxLookupSearchFields: settingsObj.maxLookupSearchFields,\n\t\t\tisJSProductRulesEnabled: settingsObj.isJSProductRulesEnabled,\n\t\t\thasQuoteSelectionProductRules: settingsObj.hasQuoteSelectionProductRules,\n\t\t\tisUI3Enabled: settingsObj.ui3Enabled,\n\t\t\tapiVersion : 39\n\t\t};\n\t}\n\n\t/**\n\t * The properties object, in Polymer format, that can be inherited by other components/classes.\n\t * @return {Object} a common set of properties for all components/classes in our app.\n\t */\n\tstatic get properties() {\n\t\treturn {\n\t\t\tapp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {\n\t\t\t\t\tuser: user,\n\t\t\t\t\tlabels: labels,\n\t\t\t\t\torg: org,\n\t\t\t\t\tdeviceContext: {\n\t\t\t\t\t\tisDesktop: AppContext.isDesktop,\n\t\t\t\t\t\tisTablet: AppContext.isTablet,\n\t\t\t\t\t\tisPhone: AppContext.isPhone,\n\t\t\t\t\t\tisMobile: AppContext.isPhone || AppContext.isTablet\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t},\n\t\t\t/** A instance of sb-i18n in pure ES6 class form, for direct programmatic access in any inherited component */\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return i18n; }\n\t\t\t}\n\t\t};\n\t}\n\n\tget user() {\n\t\treturn user;\n\t}\n\n\tget labels() {\n\t\treturn labels;\n\t}\n\n\tget org() {\n\t\treturn org;\n\t}\n\n\tstatic get user() {\n\t\treturn user;\n\t}\n\n\tstatic get labels() {\n\t\treturn labels;\n\t}\n\n\tstatic get org() {\n\t\treturn org;\n\t}\n\n\tstatic get device() {\n\t\treturn device;\n\t}\n\n\tstatic set user(obj) {\n\t\tuser = obj;\n\t}\n\n\tstatic set org(obj) {\n\t\torg = obj;\n\t}\n\n\tstatic set device(obj) {\n\t\tdevice = obj;\n\t}\n\n\tstatic get isDesktop() {\n\t\treturn user.device ? user.device === 'desktop' : device === 'desktop';\n\t}\n\n\tstatic get isTablet() {\n\t\treturn user.device ? user.device === 'tablet' : device === 'tablet';\n\t}\n\n\tstatic get isPhone() {\n\t\treturn user.device  ? user.device === 'phone' : device === 'phone';\n\t}\n\n\tstatic isIE() {\n\t\tlet ua = window.navigator.userAgent;\n\t\t// Checks are for IE10 and below, IE11, and Edge respectively\n\t\treturn (ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0);\n\t}\n\n\tstatic isChrome() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Chrome') >= 0;\n\t}\n\n\tstatic isFirefox() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Firefox') >= 0;\n\t}\n\n\tstatic isSafari() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Safari') >= 0 && ua.indexOf('Chrome') < 0;\n\t}\n\n\tstatic get apiVersion() {\n\t\treturn AppContext.org.apiVersion;\n\t}\n\n\tstatic get apiVersionString() {\n\t\treturn AppContext.org.apiVersion + '.0';\n\t}\n\n\tstatic set apiVersion(version) {\n\t\tAppContext.org.apiVersion = version;\n\t}\n\n\tstatic get i18n() {\n\t\treturn i18n;\n\t}\n\n\tstatic get isMobile() {\n\t\treturn AppContext.properties.app.value().deviceContext.isMobile;\n\t}\n}\n\n\n// expose an instance of AppContext as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.AppContext = AppContext.prototype;\n","\nexport class Navigator {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         \tthe relative URL to navigate to\n\t * @param  {Object} queryParams \ta map of query parameters to append to the URL\n\t * @param  {String[]} pathParams  \tarray of path strings to append to the URL\n\t * @param  {boolean} newWin     \ttrue to open in a new browser window\n\t * @return {null}\n\t */\n\tstatic nav( url, queryParams, pathParams, newWin, component ) {\n\t\tlet u = url,\n\t\t\tpLen = pathParams ? pathParams.length : 0,\n\t\t\tpKeys = queryParams ? Object.keys( queryParams ) : [],\n\t\t\tkLen = pKeys.length;\n\n\t\tif( pathParams ) {\n\t\t\tfor ( let i = 0; i < pLen; i++ ) {\n\t\t\t\tif ( pathParams[ i ] != null && pathParams[ i ] != undefined && pathParams[ i ] != '' )\n\t\t\t\t\tu += '/' + encodeURIComponent( pathParams[ i ] );\n\t\t\t}\n\t\t}\n\n\t\tfor( let i = 0; i < kLen; i++ ) {\n\t\t\tu += i == 0 ? '?' : '&';\n\t\t\tu += encodeURIComponent( pKeys[ i ] ) + '=' + encodeURIComponent( queryParams[ pKeys[ i ] ] );\n\t\t}\n\n\t\tcomponent.fire('iron-signal', { name: 'sb-navigation-changed', data: { url: url, location: u } });\n\t\tthis.setPreviousRoute(pathParams.join('/'));\n\t\twindow.location.hash = u;\n\t}\n\n\tstatic setPreviousRoute(pathParams) {\n\t\tif (!window.location.hash || window.location.hash.indexOf('#') < 0 || window.location.hash.indexOf('?') < 0)\n\t\t\treturn;\n\t\tconst urlBase = window.location.hash.indexOf('#/') === 0 ? '#/' : '#';\n\t\tconst hash = window.location.hash.split(urlBase)[1].split('?');\n\t\tif (hash[0] === pathParams)\n\t\t\treturn;\n\t\tthis.previousRoute = hash[0];\n\t\tthis.previousParams = hash[1].indexOf('=') < 0 ? {} : this._getParams(hash[1]);\n\t}\n\n\tstatic getPreviousRoute() {\n\t\treturn this.previousRoute;\n\t}\n\n\tstatic navToPreviousRoute(component, backupQueryParams, backupPathParams) {\n\t\tif (this.previousParams && Object.keys(this.previousParams).length > 0 && this.previousRoute && this.previousRoute.length > 0)\n\t\t\tthis.nav('#', this.previousParams, this.previousRoute.split('/'), false, component);\n\t\telse\n\t\t\tthis.nav('#', backupQueryParams, backupPathParams, false, component);\n\t}\n\n\tstatic _setRoute(route) {\n\t\tthis.previousRoute = route;\n\t}\n\n\tstatic _getParams(params) {\n\t\tlet previousParams = {};\n\t\tfor (let param of params.split('&')) {\n\t\t\tif (param !== null && param !== undefined && param !== '') {\n\t\t\t\tconst parts = param.split('=');\n\t\t\t\tpreviousParams[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);\n\t\t\t}\n\t\t}\n\t\treturn previousParams;\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Navigator} from 'common/core/Navigator.js';\n\nvar sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\n// Screen-ish / viewport sizes\nexport const SIZE_S = 'S';\nexport const SIZE_M = 'M';\nexport const SIZE_L = 'L';\nexport const SIZE_XL = 'XL';\n\n/**\n * The common base class for all Page objects.  A Page is a physical landing point of content when a user navigates in the app.\n */\nexport class Page extends AppContext {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         the relative URL to navigate to\n\t * @param  {Object} queryParams a map of query parameters to append to the URL\n\t * @param  {Object} pathParams  array of path strings to append to the URL\n\t * @param  {boolean} newWin     true to open in a new browser window\n\t * @return {null}\n\t */\n\tnav( url, queryParams, pathParams, newWin ) {\n\t\tNavigator.nav(url, queryParams, pathParams, newWin, this);\n\t}\n\n\t/**\n\t * The base properties object, in Polymer format, that all Pages have in common\n\t * @return {Object} a common set of properties for all pages\n\t */\n\tstatic get properties() {\n\t\treturn Polymer.Base.extend({\n\t\t\tctx: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {} }\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n}\n\n// expose an instance of Page as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.Page = Page.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {Html} from 'common/layout/sb-html/Html.js';\nimport {getUnitAndDisplayValue, updateUnitIfAmountInactive} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\n\n/**\n *\n * Utility for formatting raw data into presentation data\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class Formatter {\n\n\tstatic formatFieldData(model, rawData, fieldMetadata, record) {\n\t\tif(!fieldMetadata)\n\t\t\treturn rawData;\n\n\t\tlet dataType = fieldMetadata.type;\n\t\tlet formatter = new NumberFormatter(false, fieldMetadata, AppContext.i18n, dataType);\n\t\tif (QuoteContext.isDiscountField(fieldMetadata.name)) {\n\t\t\tdataType = 'discount';\n\t\t}\n\t\tif (QuoteContext.isMarkupField(fieldMetadata.name)) {\n\t\t\tdataType = 'markup';\n\t\t}\n\t\tif(fieldMetadata && fieldMetadata.extraTypeInfo === 'richtextarea') {\n\t\t\tdataType = 'richtextarea';\n\t\t}\n\n\t\tswitch (dataType) {\n\t\t\tcase 'double':\n\t\t\t\treturn formatter.format(rawData, false);\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn formatter.format(rawData, true);\n\t\t\tcase 'discount':\n\t\t\tcase 'markup':\n\t\t\t\treturn this.formatDiscountField(model, formatter);\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\treturn AppContext.i18n.format(rawData, { date: true });\n\t\t\tcase 'reference':\n\t\t\t\treturn Formatter.formatReferenceField( fieldMetadata, record );\n\t\t\tcase 'richtextarea':\n\t\t\tcase 'url':\n\t\t\t\tlet data = Html.sanitizeHtmlText(rawData);\n\t\t\t\treturn data === null ? '' : data;\n\t\t\tcase 'string':\n\t\t\t\tif(fieldMetadata.calculatedFormula && Html.containsMarkup(rawData)) {\n\t\t\t\t\treturn Html.sanitizeHtmlText(rawData);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'picklist':\n\t\t\tcase 'multipicklist':\n\t\t\t\treturn this.formatPicklistData(fieldMetadata, rawData);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn rawData;\n\t}\n\t\n\t/**\n\t * Find and render the picklist's label for the given value\n\t * @param fieldMetadata\n\t * @param values\n\t * @returns {*} Corresponding label for the given rawData (value)\n\t */\n\tstatic formatPicklistData(fieldMetadata, values) {\n\t\tif (fieldMetadata.picklistValues && values) {\n\t\t\tlet result = [];\n\t\t\tvalues.split(';').forEach((value) => {\n\t\t\t\tlet pickListValue = this.findPickListValue(fieldMetadata, value);\n\t\t\t\tif (pickListValue) {\n\t\t\t\t\tresult.push(pickListValue.label);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result.join(';');\n\t\t}\n\t\treturn values;\n\t}\n\t\n\t/**\n\t * Locate pick list value from the given metadata for the given value\n\t * Caches visited pick list values in a map to help faster lookup\n\t * @param fieldMetadata\n\t * @param value\n\t * @returns {*}\n\t */\n\tstatic findPickListValue(fieldMetadata, value) {\n\t\tconst fieldName = fieldMetadata.name;\n\t\tif (!this._pickListValuesMap) {\n\t\t\tthis._pickListValuesMap = {};\n\t\t}\n\t\tif (!this._pickListValuesMap[fieldName]) {\n\t\t\tthis._pickListValuesMap[fieldName] = {};\n\t\t\tfieldMetadata.picklistValues.forEach((plValue) => {\n\t\t\t\tthis._pickListValuesMap[fieldName][plValue.value] = plValue;\n\t\t\t});\n\t\t}\n\t\treturn this._pickListValuesMap[fieldName][value];\n\t}\n\n\t/**\n\t * Format discount field from DiscountConverter (getUnitAndDisplayValue)\n\t * @param numFormatter\n\t * @returns {*}\n\t */\n\tstatic formatDiscountField(model, numFormatter) {\n\t\t// concatenates numeric value with unit label, e.g., 4.5 %\n\t\tupdateUnitIfAmountInactive(model, numFormatter.metadata.name);\n\t\tconst { displayValue, units, unit } = getUnitAndDisplayValue(model, numFormatter.metadata.name);\n\t\t// content is empty when value is null\n\t\tif (displayValue !== null && !isNaN(displayValue)) {\n\t\t\tlet selectedUnit = units.find((u) => {\n\t\t\t\treturn u.value === unit\n\t\t\t});\n\t\t\tlet unitLabel = selectedUnit ? selectedUnit.label : '';\n\t\t\tlet formattedVal = numFormatter.format(displayValue);\n\t\t\treturn `${formattedVal} ${unitLabel}`;\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t* Format a reference field (lookup or M/D)\n\t* @param  {Object} fieldMetadata the metadata of the field\n\t* @param  {Object} record        the data recordUI\n\t* @return {String}               the formatted value to display\n\t*/\n\tstatic formatReferenceField( fieldMetadata, record ) {\n\t\tlet name = '';\n\t\tif( record && fieldMetadata.relationshipName && record[fieldMetadata.relationshipName] ) {\n\t\t\tname = record[fieldMetadata.relationshipName].Name;\n\t\t}\n\t\treturn name;\n\t}\n\t\n\t/**\n\t * Format a given date object to ISO8601 format expected by Apex\n\t * @param {Date} date The date object to be formatted\n\t * @returns {String} The formatted string, or blank string if date is null or invalid\n\t */\n\tstatic toApexDate(date) {\n\t\tif (date && date instanceof Date) {\n\t\t\t// Get the ISO formatted date string.\n\t\t\t// This will be formatted: YYYY-MM-DDTHH:mm:ss.sssZ\n\t\t\tvar dateIso = date.toISOString();\n\t\t\t// Replace everything after the T with an empty string\n\t\t\treturn dateIso.replace(new RegExp('[Tt].*'), \"\");\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\t\n\t/**\n\t * Takes a JS Date object and turns it into a string of ISO8601 format (YYYY-MM-DDTHH:mm:ss.sss+0000), which is what Apex\n\t * expects a date-time to look like\n\t * @param {Date} dateTime The date object to be formatted\n\t * @returns {string} The formatted string, or blank string if dateTime is null or invalid\n\t */\n\tstatic toApexDateTime(dateTime) {\n\t\tif (dateTime && dateTime instanceof Date) {\n\t\t\t// Get the ISO formatted date string.\n\t\t\t// This will be formatted YYYY-MM;DDTHH:mm:ss.sssZ\n\t\t\tvar dateIso = dateTime.toISOString();\n\t\t\t\n\t\t\t// Replace the 'Z' at the end with '+0000'\n\t\t\treturn dateIso.slice(0, dateIso.length - 1) + \"+0000\";\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n}\n","import {I18n} from 'common/core/sb-i18n/I18n.js';\n\nexport class DateParser {\n\n\tconstructor(stripTime = false) {\n\t\tthis.stripTime = stripTime;\n\t\tlet dateTimeFormat = I18n.getLocaleData() ? I18n.getLocaleData().date.formats.dateFormats.yMd : 'M/D/YY';\n\t\t// simplify dateTimeFormat string for repeating characters\n\t\tlet dateTimeFormatSimple = dateTimeFormat.replace(new RegExp('[dD]+'), 'D').replace(new RegExp('[mM]+'), 'M').replace(new RegExp('[yY]+'), 'Y');\n\t\t// get the separator\n\t\tthis.separator = dateTimeFormatSimple.match(new RegExp('[\\/.-]'))[0];\n\t\t// split by separator to get day, month, and year indexes\n\t\tlet dateTimeElements = dateTimeFormatSimple.split(this.separator);\n\t\tthis.dateIdx = dateTimeElements.indexOf('D');\n\t\tthis.monthIdx = dateTimeElements.indexOf('M');\n\t\tthis.yearIdx = dateTimeElements.indexOf('Y');\n\t}\n\n\tparse(dateStr, isValidYearFunction = this._isValidYear) {\n\t\tif(typeof dateStr !== 'string')\n\t\t\treturn dateStr; // if dateStr is not a string, then nothing to parse\n\n\t\tif(this.stripTime)\n\t\t\tdateStr = dateStr.split(' ')[0];\n\n\t\tlet invalid = true;\n\t\tlet elements = dateStr.split(this.separator),\n\t\t\tday = elements[this.dateIdx],\n\t\t\tmonth = elements[this.monthIdx],\n\t\t\tyear = elements[this.yearIdx];\n\n\t\t// check day, month, and year strings for validity\n\t\tif ((year && year.length == 4) && (month && month.length > 0 && month.length <= 2) && (day && day.length > 0 && day.length <= 2)) {\n\t\t\tday = parseInt(day);\n\t\t\tmonth = parseInt(month);\n\t\t\tyear = parseInt(year);\n\n\t\t\t// check whether input is split into separate elements and that input elements are numbers\n\t\t\tif (elements.length && !isNaN(year) && !isNaN(month) && !isNaN(day)) {\n\t\t\t\t// check year\n\t\t\t\tif(typeof isValidYearFunction === 'function' && !isValidYearFunction(year))\n\t\t\t\t\treturn null;\n\n\t\t\t\t// check months\n\t\t\t\tif (month >= 1 && month <= 12) {\n\t\t\t\t\t// check days including leap years\n\t\t\t\t\tvar monthEnd = 31;\n\t\t\t\t\tif (month == 2) {\n\t\t\t\t\t\tmonthEnd = 28;\n\t\t\t\t\t\tif (year % 4 == 0) {\n\t\t\t\t\t\t\tif (year % 100 != 0) {\n\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (year % 400 == 0) {\n\t\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ((month == 4) || (month == 6) || (month == 9) || (month == 11)) {\n\t\t\t\t\t\t\tmonthEnd = 30;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (day >= 1 && day <= monthEnd) {\n\t\t\t\t\t\tinvalid = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !invalid ? new Date(year, month - 1, day) : null;\n\t\t}\n\t\treturn null;\n\t}\n\n\t// valid years are between 1700 and 4000 according to https://success.salesforce.com/answers?id=90630000000giqGAAQ\n\t_isValidYear(year) {\n\t\treturn year >= 1700 && year <= 4000;\n\t}\n}","export class DependentPicklistBuilder {\n\n\tconstructor(controlledPicklist, controllingValue) {\n\t\tthis.controlledPicklist = controlledPicklist;\n\t\tthis.controllingValue = controllingValue;\n\t}\n\n\tbuild() {\n\t\tlet options = this.controlledPicklist.picklistValues;\n\t\tlet validOptions = [];\n\t\toptions.forEach( function(option) {\n\t\t\tif (this._testBit(atob(option.validFor), this._getControllingValueIndex(this.controllingValue))) {\n\t\t\t\tvalidOptions.push(option);\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn validOptions;\n\t}\n\n\t_getControllingValueIndex(value) {\n\t\tif (this.controlledPicklist.controllingField.type === 'boolean')\n\t\t\treturn value === true ? 1 : 0;\n\n\t\tlet controllingOptions = this.controlledPicklist.controllingField.picklistValues;\n\t\tfor (let i = 0, l = controllingOptions.length; i < l; i++) {\n\t\t\tif (controllingOptions[i].value == value) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_testBit(validFor, controllingValueIndex) {\n\t\tvar byteToCheck = Math.floor(controllingValueIndex / 8);\n\t\tvar bit = 7 - (controllingValueIndex % 8);\n\t\treturn ((Math.pow(2, bit) & validFor.charCodeAt(byteToCheck)) >> bit) == 1;\n\t}\n\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Locale {\n\n\tstatic get() {\n\t\treturn AppContext.user ? (AppContext.user.locale || 'en-US' ) : 'en-US';\n\t}\n\n\tstatic isCommaDecimal(locale) {\n\t\treturn COMMA_DECIMAL_LOCALES.indexOf(locale || Locale.get()) !== -1;\n\t}\n}\n\n\n// The below list was compiled from\n// https://help.salesforce.com/apex/HTViewHelpDoc?id=admin_supported_locales.htm&language=en_US\n\n// commented out entries are locales that conflict with our client-side formatter (Intl.NumberFormatter):\n// (*)  formats with period decimal which contradicts SalesForce documentation above\n// (**) unsupported locale in our client formatter\n\nexport const COMMA_DECIMAL_LOCALES = [\n\t//'sq-AL', // Albania (*)\n\t//'hy-AM', // Armenia (*)\n\t//'az-AZ', // Azerbaijani (*)\n\t//'eu-ES', // Basque (Spain) (*)\n\t//'be-BY', // Belarusian (Belarus) (*)\n\t//'bs-BA', // Bosnian (Bosnia and Herzegovina) (*)\n\t'bg-BG', // Bulgarian (Bulgaria)\n\t//'ca-ES-EURO', // Catalan (Spain, Euro) (**)\n\t'ca-ES', // Catalan (Spain)\n\t'hr-HR', // Croatian (Croatia)\n\t'cs-CZ', // Czech (Czech Republic)\n\t'da-DK', // Danish (Denmark)\n\t'nl-AW', // Dutch (Aruba)\n\t'nl-BE', // Dutch (Belgium)\n\t'nl-NL', // Dutch (Netherlands)\n\t'nl-SR', // Dutch (Suriname)\n\t'en-ZA', // English (South Africa) (*)\n\t'et-EE', // Estonian (Estonia)\n\t//'fi-FI-EURO', // Finnish (Finland, Euro) (**)\n\t'fi-FI', // Finnish (Finland)\n\t'fr-BE', // French (Belgium)\n\t'fr-CA', // French (Canada)\n\t'fr-KM', // French (Comoros)\n\t//'fr-FR-EURO', // French (France, Euro) (**)\n\t'fr-FR', // French (France)\n\t'fr-GN', // French (Guinea)\n\t'fr-HT', // French (Haiti)\n\t'fr-LU', // French (Luxembourg)\n\t'fr-MR', // French (Mauritania)\n\t'fr-MC', // French (Monaco)\n\t//'fr-CH', // French (Switzerland) (*)\n\t'fr-WF', // French (Wallis and Futuna)\n\t//'ka-GE', // Georgian (Georgia) (*)\n\t//'de-AT-EURO', // German (Austria, Euro) (**)\n\t'de-AT', // German (Austria)\n\t//'de-DE-EURO', // German (Germany, Euro) (**)\n\t'de-DE', // German (Germany)\n\t//'de-LU-EURO', // German (Luxembourg, Euro) (**)\n\t'de-LU', // German (Luxembourg)\n\t'el-GR', // Greek (Greece)\n\t'hu-HU', // Hungarian (Hungary)\n\t//'is-IS', // Icelandic (Iceland) (*)\n\t'in-ID', // Indonesian (Indonesia)\n\t'it-IT', // Italian (Italy)\n\t//'kk-KZ', // Kazakh (Kazakhstan) (*)\n\t//'km-KH', // Khmer (Cambodia) (*)\n\t'lv-LV', // Latvian (Latvia)\n\t'lt-LT', // Lithuanian (Lithuania)\n\t//'mk-MK', // Macedonian (Macedonia) (*)\n\t//'ms-BN', // Malay (Brunei) (*)\n\t'no-NO', // Norwegian (Norway)\n\t'pl-PL', // Polish (Poland)\n\t'pt-AO', // Portuguese (Angola)\n\t'pt-BR', // Portuguese (Brazil)\n\t'pt-CV', // Portuguese (Cape Verde)\n\t'pt-MZ', // Portuguese (Mozambique)\n\t'pt-PT', // Portuguese (Portugal)\n\t'pt-ST', // Portuguese (São Tomé and Príncipe)\n\t'ro-MD', // Romanian (Moldova)\n\t'ro-RO', // Romanian (Romania)\n\t'ru-RU', // Russian (Russia)\n\t'sr-BA', // Serbian (Bosnia and Herzegovina)\n\t'sr-RS', // Serbian (Serbia)\n\t'sr-CS', // Serbian (Serbia and Montenegro)\n\t//'sh-BA', // Serbo-Croatian (Bosnia and Herzegovina) (*)\n\t//'sh-ME', // Serbo-Croatian (Montenegro) (*)\n\t//'sh-CS', // Serbo-Croatian (Serbia and Montenegro) (*)\n\t'sk-SK', // Slovak (Slovakia)\n\t'sl-SI', // Slovenian (Slovenia)\n\t'es-AR', // Spanish (Argentina)\n\t'es-BO', // Spanish (Bolivia)\n\t'es-CL', // Spanish (Chile)\n\t'es-CO', // Spanish (Colombia)\n\t'es-EC', // Spanish (Ecuador)\n\t'es-PY', // Spanish (Paraguay)\n\t//'es-ES-EURO', // Spanish (Spain, Euro) (**)\n\t'es-ES', // Spanish (Spain)\n\t'es-UY', // Spanish (Uruguay)\n\t'es-VE', // Spanish (Venezuela)\n\t'sv-SE', // Swedish (Sweden)\n\t'tr-TR', // Turkish (Turkey)\n\t'uk-UA', // Ukrainian (Ukraine)\n\t'vi-VN' // Vietnamese (Vietnam)\n];","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport class NumberFormatter {\n\n\tconstructor(editable, metadata, i18n, type, viewport) {\n\t\tthis.editable = editable;\n\t\tthis.metadata = metadata;\n\t\tthis.i18n = i18n;\n\t\tthis.type = type;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t\tthis.appContext = AppContext;\n\t}\n\n\t/**\n\t * Formats the provided number according to the current locale, possibly adding unit symbols for currency or percent.\n\t * @param {Number|null} value - The number to be formatted.\n\t * @param {Boolean} allowUnits - If true, unit symbols such as currency or % will be added based on the field type.\n\t * @returns {String}\n\t */\n\tformat(value, allowUnits) {\n\t\tlet opts = {};\n\t\tif (this.metadata.scale != undefined && this.metadata.scale >= 0) {\n\t\t\topts.minimumFractionDigits = this.metadata.scale;\n\t\t\topts.maximumFractionDigits = this.metadata.scale;\n\t\t}\n\n\t\t// To properly display the units on a given field, we must provide i18n with the correct formatting options.\n\t\tif (allowUnits) {\n\t\t\tif (this.type === 'currency') {\n\t\t\t\tthis._setCurrencyFormatOptions(opts);\n\t\t\t} else if (this.type === 'percent') {\n\t\t\t\tthis._setPercentFormatOptions(opts);\n\t\t\t\t// Intl expects fractional numbers when formatting percents. For example, if we tell it to format 15\n\t\t\t\t// as a percent, it will return 1,500% instead of 15%. To counter that, we divide the number by 100\n\t\t\t\t// before sending it through.\n\t\t\t\tvalue = value != null ? (value / 100) : null;\n\t\t\t}\n\t\t}\n\n\t\t// if editable, in mobile, and the number locale does not use a comma as a decimal\n\t\t// then omit the separators (comma or spaces) so we can display this editable number value in an input field of type number\n\t\t// so that the mobile device will leverage its number keyboard instead of its text keyboard\n\t\tif(this.editable && this.isMobile() && !Locale.isCommaDecimal())\n\t\t\topts.useGrouping = false;\n\n\t\tif(this.isNil(value))\n\t\t\treturn null;\n\n\t\ttry {\n\t\t\tlet formattedValue = this.i18n.format(value, opts);\n\t\t\tif (formattedValue === 'NaN')\n\t\t\t\tthrow new Error(`${value} is not a number`);\n\t\t\treturn formattedValue;\n\t\t} catch (err) {\n\t\t\treturn value;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || isNaN(value);\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * Adds properties to 'opts' such that it can be used to properly format a currency value.\n\t * @param {object} opts\n\t * @private\n\t */\n\t_setCurrencyFormatOptions (opts) {\n\t\topts.style = 'currency';\n\t\tif (this.appContext.org.isMultiCurrencyOrg) {\n\t\t\topts.currency = (this.metadata && this.metadata.CurrencyIsoCode) ? this.metadata.CurrencyIsoCode  : this.appContext.org.defaultCurrency;\n\t\t\topts.currencyDisplay = 'code';\n\t\t} else {\n\t\t\topts.currencyDisplay = 'symbol';\n\t\t\tif (!this.appContext.org.currencySymbol) {\n\t\t\t\topts.currency = this.appContext.org.defaultCurrency;\n\t\t\t} else {\n\t\t\t\topts.currency = 'XXX';  // International symbol for No Currency\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Adds properties to 'opts' such that it can be used to properly format a percent value.\n\t * @param {object} opts\n\t * @private\n\t */\n\t_setPercentFormatOptions(opts) {\n\t\topts.style = 'percent';\n\t}\n}","import {Locale} from 'common/forms/Locale.js';\n\nexport class NumberParser {\n\tconstructor(locale) {\n\t\tthis.locale = locale || Locale.get();\n\t\tthis.isCommaDecimalLocale = Locale.isCommaDecimal(this.locale);\n\t}\n\n\tparse(numberStr, strict = false, scale) {\n\t\tif(typeof numberStr !== 'string')\n\t\t\treturn this.applyScale(numberStr, scale); // if numberStr is not a string, then nothing to parse\n\n\t\t// some locales uses unusual separators such as spaces or apostrophes, so lets remove them\n\t\tnumberStr = this.removeUnusualSeparators(numberStr);\n\n\t\t// 4,200.50 in US becomes 4200.50, but 4.200,50 in French stays 4.200,50\n\t\tnumberStr = this.removeNonDecimalCommas(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4.200,50 in French becomes 4200,50\n\t\tnumberStr =\tthis.removeDecimalSepartors(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4200,50 in French becomes 4200.50\n\t\tnumberStr = this.replaceCommaDecimalWithPeriod(numberStr);\n\n\t\tlet number = parseFloat(numberStr);\n\n\t\t// if not strict simply return the number where the string \"5/\" would return 5\n\t\tif(!strict)\n\t\t\treturn this.applyScale(number, scale);\n\n\t\t// if strict ensure the number coalesces to the numberStr or return NaN, this prevents \"5/\" from becoming 5 and instead returns NaN\n\t\treturn number == numberStr ? this.applyScale(number, scale) : NaN;\n\t}\n\n\tremoveUnusualSeparators(numberStr) {\n\t\treturn numberStr.replace(new RegExp('[\\\\\\s]+', 'g'), '').replace(new RegExp(\"'\", 'g'), '').replace(new RegExp(\"’\", 'g'), '');\n\t}\n\n\tremoveNonDecimalCommas(numberStr) {\n\t\treturn !this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '') : numberStr;\n\t}\n\n\tremoveDecimalSepartors(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp('[.]', 'g'), '') : numberStr\n\t}\n\n\treplaceCommaDecimalWithPeriod(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '.') : numberStr;\n\t}\n\n\tapplyScale(number, scale) {\n\t\tif(scale == null || typeof number !== 'number') {\n\t\t\treturn number;\n\t\t}\n\t\treturn parseFloat(number.toFixed(scale));\n\t}\n\n}","import {OAUTH_KEY} from 'common/oauth/oauth.local.js';\nimport {OAUTH_SECRET} from 'common/oauth/oauth.local.js';\nimport {PRIVATE_API_SECRET} from 'common/oauth/oauth.local.js';\nimport {OAUTH_PROXY_URL} from 'common/oauth/oauth.local.js';\nimport {OAUTH_LOGIN_URL} from 'common/oauth/oauth.local.js';\n\nlet url = 'http://localhost:' + location.port + '/common/oauth';\nlet oauth2 = {\n\tclientId : OAUTH_KEY,\n\tclientSecret: OAUTH_SECRET,\n\tredirectUri: url + '/callback',\n\tproxyUrl: OAUTH_PROXY_URL,\n\tloginUrl: OAUTH_LOGIN_URL\n};\n\nexport class OAuth {\n\n\tconstructor(tokens) {\n\t\tif(!oauth2.clientId || !oauth2.clientSecret)\n\t\t\tthrow Error(this._getNoOAuthClientKeyMessage());\n\n\t\t// Below we override jsforce.browser functions around token management to include the refresh token\n\t\tvar storeTokens = jsforce.browser.Client.prototype._storeTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._storeTokens = function(params) {\n\t\t\tstoreTokens(params);\n\t\t\tlocalStorage.setItem(this._prefix + '_refresh_token', params.refresh_token);\n\t\t}.bind(jsforce.browser);\n\n\t\tvar removeTokens = jsforce.browser.Client.prototype._removeTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._removeTokens = function() {\n\t\t\tremoveTokens();\n\t\t\tlocalStorage.removeItem(this._prefix + '_refresh_token');\n\t\t}.bind(jsforce.browser);\n\n\t\tvar getTokens = jsforce.browser.Client.prototype._getTokens.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype._getTokens = function() {\n\t\t\tvar tokens = getTokens();\n\t\t\tif(tokens)\n\t\t\t\ttokens.refreshToken = localStorage.getItem(this._prefix + '_refresh_token');\n\t\t\treturn tokens;\n\t\t}.bind(jsforce.browser);\n\n\t\tvar isLoggedIn = jsforce.browser.Client.prototype.isLoggedIn.bind(jsforce.browser);\n\t\tjsforce.browser.Client.prototype.isLoggedIn = function() {\n\t\t\tif(!isLoggedIn())\n\t\t\t\treturn false;\n\t\t   return this.connection.refreshToken;\n\t\t}.bind(jsforce.browser);\n\n\t\t// update the issued at to current date since we don't need to reauthorize since we have a never expire refresh token\n\t\t(function() {\n\t\t\t localStorage.setItem(this._prefix + '_issued_at', new Date().getTime());\n\t\t\t document.cookie = this._prefix + '_loggedin=true;';\n\t\t}).bind(jsforce.browser)();\n\n\t\tif(tokens)\n\t\t\tjsforce.browser._storeTokens(tokens);\n\n\t\t// override to refresh the access token via the proxy\n\t\tjsforce.OAuth2.prototype.refreshToken = this._refresAccessToken;\n\n\t\t// initialize with the OAUTH credentials\n\t\tjsforce.browser.init(oauth2);\n\t}\n\n\tlogin() {\n\t\tjsforce.browser.login();\n\t}\n\n\tgetConnection() {\n\t\tif(!jsforce.browser.isLoggedIn())\n\t\t\treturn Promise.reject('Please login before establishing a connection at http://localhost:' + location.port + '/common/oauth');\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tjsforce.browser.once('connect', function(conn) {\n\t\t\t\tconn.oik = PRIVATE_API_SECRET;\n\t\t\t\tconn.once(\"refresh\", function(accessToken) {\n\t\t\t\t\tthis.accessToken = accessToken;\n\t\t\t\t}.bind(this));\n\t\t\t   resolve(conn);\n\t\t\t}.bind(this));\n\t\t\tjsforce.browser.init(oauth2);\n\t\t}.bind(this));\n\t}\n\n\tset accessToken(accessToken) {\n\t\tlocalStorage.setItem(jsforce.browser._prefix + '_access_token', accessToken);\n\t}\n\n\tget tokens() {\n\t\treturn jsforce.browser._getTokens();\n\t}\n\n\tset tokens(tokens) {\n\t\tjsforce.browser._storeTokens(tokens);\n\t}\n\n\t_getNoOAuthClientKeyMessage() {\n\t\treturn 'Need to add a \\'.env.json\\' file in the CPQ dir whose contents contains the Consumer Key and Consumer Secret of the Salesforce CPQ Connected App, and then execute a gulp compile.\\n' +\n\t\t\t\t'{\"oauth_key\": \"<Consumer Key>, \"oauth_secret\": \"<Consumer Secret>\"}'\n\t}\n\n\t_refresAccessToken(refreshToken, callback) {\n\t\treturn this._transport.httpRequest({\n\t\t\tmethod: 'POST',\n\t\t\turl: oauth2.proxyUrl,\n\t\t\tbody: 'grant_type=refresh_token&refresh_token=' + refreshToken + '&client_id=' + this.clientId + '&client_secret=' + this.clientSecret,\n\t\t\theaders: {\n\t\t\t\t'SalesforceProxy-Endpoint': this.tokenServiceUrl,\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t\t\t}\n\t\t}).then(function (response) {\n\t\t\tvar res;\n\t\t\ttry {\n\t\t\t\tres = JSON.parse(response.body);\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t\tif (response.statusCode >= 400) {\n\t\t\t\tres = res || {error: \"ERROR_HTTP_\" + response.statusCode, error_description: response.body};\n\t\t\t\tvar err = new Error(res.error_description);\n\t\t\t\terr.name = res.error;\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn res;\n\t\t}).thenCall(callback);\n\t}\n\n\tencodeTokenUrl() {\n\t\tlet tokens = jsforce.browser._getTokens();\n\t\tlet refreshToken = tokens.refreshToken;\n\t\tlet orgUrl = encodeURIComponent(tokens.instanceUrl);\n\t\tlet id = encodeURIComponent(tokens.userInfo.url);\n\t\treturn url + '?rt=' + refreshToken + '&org=' + orgUrl + '&id=' + id;\n\t}\n\n\tstatic decodeTokenUrl(url) {\n\t\tif(!url) return;\n\t\tvar refreshToken = OAuth._getParameterByName('rt', url);\n\t\tvar orgUrl = OAuth._getParameterByName('org', url);\n\t\tvar id = OAuth._getParameterByName('id', url);\n\t\tif(refreshToken && orgUrl && id)\n\t\t\treturn { refresh_token: refreshToken, instance_url: orgUrl, id: id, access_token: 'xyz', issued_at: new Date().getTime() };\n\t}\n\n\tstatic _getParameterByName(name, url) {\n\t\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\t\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n\t\t\tresults = regex.exec(url);\n\t\tif (!results) return null;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n\t}\n}","export const OAUTH_KEY = 'undefined';\nexport const OAUTH_SECRET = 'undefined';\nexport const PRIVATE_API_SECRET = '';\nexport const OAUTH_PROXY_URL = 'http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/';\nexport const OAUTH_LOGIN_URL = 'https://test.salesforce.com';\n","import {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class RelationshipFieldManager {\n\n\tconstructor(field, record) {\n\t\tthis.field = field;\n\t\tthis.record = record;\n\t}\n\n\thasRelationship() {\n\t\treturn !!(this.getRelationship());\n\t}\n\n\tgetRelationship() {\n\t\tlet relationshipField = RelationshipFieldManager.getRelationshipField(this.field);\n\t\tif(!relationshipField)\n\t\t\treturn;\n\n\t\tif(typeof this.record === 'function')\n\t\t\treturn this.record(relationshipField);\n\n\t\treturn this.record[relationshipField];\n\t}\n\n\tgetRelationshipName(nameField) {\n\t\tlet relationship = this.getRelationship();\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tlet name = nameField || this._getLookupName(relationship);\n\t\treturn relationship[name];\n\t}\n\n\taddRelationshipName(id, display, tableName) {\n\t\tlet relationship = this.buildRelationship(id, display, tableName);\n\t\tif (!relationship.value.Id) {\n\t\t\trelationship.value = null;\n\t\t}\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tif(typeof this.record === 'function')\n\t\t\treturn this.record(relationship.field, relationship.value);\n\n\t\tthis.record[relationship.field] = relationship.value;\n\t}\n\n\tbuildRelationship(id, display, tableName) {\n\t\tlet relationshipField = (RelationshipFieldManager.getRelationshipField(this.field));\n\t\tif (!relationshipField)\n\t\t\treturn;\n\n\t\tlet relationship = this.getRelationship() || {};\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\n\t\trelationship.Id = id;\n\t\trelationship[nameField] = display;\n\t\treturn { value: relationship, field: relationshipField };\n\t}\n\n\t_getLookupName(relationship) {\n\t\tlet relationshipTable = relationship.attributes ? relationship.attributes.type : '';\n\t\treturn new LookupNameMapper(relationshipTable).getNameField();\n\t}\n\n\tstatic getRelationshipField(idField, tableName) {\n\t\tlet relationshipField;\n\t\tif(idField.endsWith('__c'))\n\t\t\trelationshipField = idField.replace(/__c$/, '__r');\n\t\telse if(idField.endsWith('Id'))\n\t\t\trelationshipField = idField.substring(0, idField.length - 2);\n\n\t\tif(!relationshipField || !tableName)\n\t\t\treturn relationshipField;\n\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\t\treturn relationshipField + '.' + nameField;\n\t}\n}","import {RuleExecutor} from 'common/rules/RuleExecutor.js';\nimport {RuleEvaluator} from 'common/rules/RuleEvaluator.js';\n\nexport class QuoteRuleExecutor extends RuleExecutor {\n\n\tconstructor(quote, rules, prefix, errorStrings) {\n\t\tsuper(rules, prefix, errorStrings);\n\t\tthis._init(quote);\n\t}\n\n\t_init(quote) {\n\t\tthis.quote = quote;\n\t\tthis.response = { 'requiredProductIds': [] };\n\t\tthis.lineItemsById = {};\n\t\tfor (let line of this.quote.lineItems || [])\n\t\t\tthis.lineItemsById[line.record[this.PRODUCT]] = line;\n\t}\n\n\texecute() {\n\t\tlet ruleEvaluator = new RuleEvaluator(this.rules, this.quote, this.prefix, this.errorStrings);\n\t\tfor (let rule of this.rules || []) {\n\t\t\tif (ruleEvaluator.isRuleSatisfied(rule))\n\t\t\t\tfor (let action of rule[this.ACTIONS].records)\n\t\t\t\t\tthis._conditionallyAddToResponseObject(action);\n\t\t}\n\n\t\treturn this.response;\n\t}\n\n\t_conditionallyAddToResponseObject(action) {\n\t\tlet responseType = super._getResponseType(action[this.TYPE]);\n\t\tif (responseType === null)\n\t\t\treturn;\n\t\tif (responseType === 'requiredProductIds' && this._productAdded(action[this.PRODUCT]))\n\t\t\treturn;\n\n\t\tthis.response[responseType].push(action[this.PRODUCT])\n\t}\n\n\t_productAdded(productId) {\n\t\treturn !!this.lineItemsById[productId];\n\t}\n}","import {OperatorsUtils} from 'common/rules/operators/OperatorsUtils.js';\n\nexport class RuleEvaluator {\n\n\tconstructor(rules, quote, prefix, errorStrings) {\n\t\tthis.rules = rules; //instantiated with rules originally, design changed. leaving for now to minimize change, expecting it to be useful on init eventually\n\t\tthis.quote = quote;\n\t\tthis.prefix = prefix === undefined ? '' : prefix;\n\t\tthis.errorStrings = errorStrings;\n\t\tthis._init();\n\t}\n\n\t_init() {\n\t\tthis._setConstants();\n\t\tthis._setAliasedFieldsMap();\n\t}\n\n\n\t_setConstants() {\n\t\tthis.ERROR_CONDITIONS = this.prefix + 'ErrorConditions__r';\n\t\tthis.TESTED_VARIABLE = this.prefix + 'TestedVariable__c';\n\t\tthis.CONDITIONS_MET = this.prefix + 'ConditionsMet__c';\n\t\tthis.TESTED_OBJECT = this.prefix + 'TestedObject__c';\n\t\tthis.TESTED_FIELD = this.prefix + 'TestedField__c';\n\t\tthis.FILTER_VALUE = this.prefix + 'FilterValue__c';\n\t\tthis.FILTER_TYPE = this.prefix + 'FilterType__c';\n\t\tthis.OPERATOR = this.prefix + 'Operator__c';\n\t\tthis.ACTIONS = this.prefix + 'Actions__r';\n\t}\n\n\t_setAliasedFieldsMap() {\n\t\tthis.aliasedFieldsMap = {\n\t\t\t'Quote': {\n\t\t\t\t'Group Line Items': this.prefix + 'LineItemsGrouped__c'\n\t\t\t}\n\t\t};\n\t}\n\n\tisRuleSatisfied(rule) {\n\t\tif (!this._hasActions(rule))\n\t\t\treturn false;\n\t\tif (!this._hasErrorConditions(rule))\n\t\t\treturn true;\n\n\t\tlet conditionsMet = rule[this.CONDITIONS_MET],\n\t\t\tresult = false;\n\n\t\tfor (let condition of rule[this.ERROR_CONDITIONS].records || []) {\n\t\t\tlet testedVariable = condition[this.TESTED_VARIABLE],\n\t\t\t\ttestedObject = condition[this.TESTED_OBJECT],\n\t\t\t\tconditionDetails = this.packageConditionDetails(condition);\n\n\t\t\tif (testedObject === 'Quote')\n\t\t\t\tresult = this.evaluateCondition(condition, this.quote.record, conditionDetails);\n\t\t\telse if (testedObject === 'Quote Line' && this.quote.lineItems.length > 0)\n\t\t\t\tresult = this.evaluateCollection(condition, this.quote.lineItems, conditionDetails);\n\t\t\telse if (testedObject === 'Quote Line Group' && this.quote.lineItemGroups.length > 0)\n\t\t\t\tresult = this.evaluateCollection(condition, this.quote.lineItemGroups, conditionDetails);\n\t\t\telse if (!!testedVariable) // Not currently supporting summary variables (left side)\n\t\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace(\"{0}\", condition.Id));\n\t\t\telse\n\t\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_no_tested_object.replace(\"{0}\", condition.Id));\n\n\t\t\tif (this._canReturnImmediately(result, conditionsMet))\n\t\t\t\treturn result;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpackageConditionDetails(condition) {\n\t\tlet op = new OperatorsUtils(condition[this.OPERATOR]).getInstance();\n\t\tif (op === null) {\n\t\t\tlet errorMsg = this.errorStrings.msg_jspr_err_invalid_operator\n\t\t\t\t.replace(\"{0}\", condition[this.OPERATOR])\n\t\t\t\t.replace(\"{1}\", condition.Id);\n\t\t\tthis._throwError(errorMsg);\n\t\t}\n\t\tif (condition[this.FILTER_TYPE] === 'Variable') // Not currently supporting summary variables (right side)\n\t\t\tthis._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace(\"{0}\", condition.Id));\n\n\t\treturn {\n\t\t\t'op': op,\n\t\t\t'filterValue': condition[this.FILTER_VALUE]\n\t\t};\n\t}\n\n\tevaluateCollection(condition, collection, conditionDetails) {\n\t\tlet i = 0,\n\t\t\tlen = collection.length,\n\t\t\tcollectionResult = false;\n\t\twhile (i < len && !collectionResult)\n\t\t\tcollectionResult = this.evaluateCondition(condition, collection[i++].record, conditionDetails);\n\n\t\treturn collectionResult;\n\t}\n\n\tevaluateCondition(condition, target, conditionDetails) {\n\t\tlet testedValue = this._getValue(condition, target);\n\t\treturn conditionDetails.op.evaluate(testedValue, conditionDetails.filterValue);\n\t}\n\n\t_getValue(condition, target) {\n\t\tlet testedObject = condition[this.TESTED_OBJECT],\n\t\t\ttestedField = condition[this.TESTED_FIELD],\n\t\t\taliasedField = this.aliasedFieldsMap[testedObject] && this.aliasedFieldsMap[testedObject][testedField] ? this.aliasedFieldsMap[testedObject][testedField] : null,\n\t\t\tfield = aliasedField === null ? testedField : aliasedField;\n\t\tif (Object.keys(target).indexOf(field) < 0) {\n\t\t\tlet errorMsg = this.errorStrings.msg_jspr_err_no_tested_field\n\t\t\t\t.replace(\"{0}\", condition.Id)\n\t\t\t\t.replace(\"{1}\", condition[this.TESTED_FIELD])\n\t\t\t\t.replace(\"{2}\", testedObject);\n\t\t\tthis._throwError(errorMsg);\n\t\t}\n\n\t\treturn target[field];\n\t}\n\n\t_throwError(msg) {\n\t\tthrow {'msg': msg, 'type': 'info'};\n\t}\n\n\t_canReturnImmediately(result, conditionsMet) {\n\t\treturn !!(conditionsMet == 'All' && !result) || !!(conditionsMet == 'Any' && result);\n\t}\n\n\t_hasErrorConditions(rule) {\n\t\treturn !!rule[this.ERROR_CONDITIONS];\n\t}\n\n\t_hasActions(rule) {\n\t\treturn !!rule[this.ACTIONS] && rule[this.ACTIONS].totalSize > 0;\n\t}\n}","export class RuleExecutor {\n\tconstructor(rules, prefix, errorStrings) {\n\t\tthis.rules = rules;\n\t\tthis.prefix = prefix === undefined ? '' : prefix;\n\t\tthis.errorStrings = errorStrings;\n\t\tthis._setConstants();\n\t}\n\n\t_setConstants() {\n\t\tthis.ACTIONS = this.prefix + 'Actions__r';\n\t\tthis.TYPE = this.prefix + 'Type__c';\n\t\tthis.PRODUCT = this.prefix + 'Product__c';\n\t}\n\n\t_getResponseType(actionType) {\n\t\tif (actionType === 'Add' || actionType === 'Enable & Add' || actionType === 'Show & Add')\n\t\t\treturn 'requiredProductIds';\n\n\t\treturn null;\n\t}\n}","export class AbstractFocusSignaler {\n\n\tconstructor(element, focusEvents, blurEvents) {\n\t\tthis.element = element;\n\t\tthis.focusEvents = focusEvents;\n\t\tthis.blurEvents = blurEvents;\n\t}\n\n\tsignalOnFocus(signalName, unregister) {\n\t\tthis.fireFocusSignal = this.fireFocusSignal || this._fireSignal.bind(this, signalName, true);\n\t\tthis.fireBlurSignal = this.fireBlurSignal || this._fireSignal.bind(this, signalName, false);\n\n\t\tfor(let focusEvent of this.focusEvents) {\n\t\t\tthis.element.removeEventListener(focusEvent, this.fireFocusSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(focusEvent, this.fireFocusSignal);\n\t\t}\n\n\t\tfor(let blurEvent of this.blurEvents) {\n\t\t\tthis.element.removeEventListener(blurEvent, this.fireBlurSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(blurEvent, this.fireBlurSignal);\n\t\t}\n\t}\n\n\tfireSignal(signalName, focused) {\n\t\tthis._fireSignals(signalName, focused);\n\n\t\tlet lastSignaler = this._getLastSignaler();\n\t\tif(lastSignaler === this)\n\t\t\treturn;\n\n\t\t// if we have a last signaler that is not this, then ensure it fires a signal with focus as false\n\t\tif(lastSignaler)\n\t\t\tlastSignaler._fireSignals(signalName, false);\n\n\t\t// set this as the last signaler\n\t\tthis._setLastSignaler();\n\t}\n\n\t/* abstract */ getSignalTargets() {\n\t\treturn [];\n\t}\n\n\tdisable() {\n\t\tthis._toggleDisabled(true);\n\t}\n\n\tenable() {\n\t\tthis._toggleDisabled(false);\n\t}\n\n\t_fireSignal(signalName, focused) {\n\t\tif(!this._isDisabled())\n\t\t\tthis.fireSignal(signalName, focused);\n\t}\n\n\t_fireSignals(signalName, focused) {\n\t\tlet targets = this.getSignalTargets();\n\t\tfor(let target of targets)\n\t\t\ttarget.fire( signalName,  { focused: focused, signaler: this } );\n\t}\n\n\t_getLastSignaler() {\n\t\treturn window && window.signaler ? window.signaler.last : null;\n\t}\n\n\t_isDisabled() {\n\t\treturn window && window.signaler && window.signaler.disabled;\n\t}\n\n\t_setLastSignaler() {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.last = this;\n\t\twindow.signaler = signaler;\n\t}\n\n\t_toggleDisabled(disabled) {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.disabled = disabled;\n\t\twindow.signaler = signaler;\n\t}\n}","import {AbstractFocusSignaler} from 'common/signal/AbstractFocusSignaler.js';\nimport {RowFieldSelector} from 'common/layout/tables/RowFieldSelector.js';\n\nexport class RowFocusSignaler extends AbstractFocusSignaler {\n\n\tconstructor(row, groupId, cellName, rowId, rowIndex, rowIndexAttribute, ironList) {\n\t\tsuper(row, ['tap', 'mouseenter'], ['mouseleave']);\n\t\tthis.groupId = groupId;\n\t\tthis.cellName = cellName;\n\t\tthis.rowId = rowId;\n\t\tthis.rowIndex = rowIndex;\n\t\tthis.rowIndexAttribute = rowIndexAttribute;\n\t\tthis.ironList = ironList;\n\t}\n\n\tgetSignalTargets() {\n\t\tlet groupIds = this.groupId.constructor === Array ? this.groupId : [this.groupId];\n\t\tlet fields = [];\n\t\tfor(let groupId of groupIds) {\n\t\t\tlet group = this.element.$$('#' + groupId);\n\t\t\tif (!group)\n\t\t\t\tcontinue;\n\n\t\t\tlet cells = Polymer.dom(group.root).querySelectorAll(this.cellName);\n\t\t\tfor (let cell of cells)\n\t\t\t\tfields.push(cell.$$('sb-field'));\n\t\t}\n\t\treturn fields;\n\t}\n\n\tsignalNextPreviousEditableTarget(current, next) {\n\t\tlet selector = this.selector;\n\t\tlet target = next ? selector.selectNextEditableField(current) : selector.selectPreviousEditableField(current);\n\t\tif(target) target.fire('sb-field-edit', { next: next } );\n\t}\n\n\tsignalFirstLastEditableTarget(first) {\n\t\tlet selector = this.selector;\n\t\tlet target = first ? selector.selectFirstEditableField() : selector.selectLastEditableField();\n\t\tif(target) target.fire('sb-field-edit', { next: first } );\n\t}\n\n\ttoggleRowFocus(signal) {\n\t\tif(signal.detail.focused && !this.element.focused) {\n\t\t\tthis.element.focused = true;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', true, this.element.$$('#' + this.rowId));\n\n\t\t} else if(!signal.detail.focused && this.element.focused) {\n\t\t\tthis.element.focused = false;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', false, this.element.$$('#' + this.rowId));\n\t\t}\n\t}\n\n\tget selector() {\n\t\treturn new RowFieldSelector(this.element, this.getSignalTargets(), this.rowIndex, this.rowIndexAttribute);\n\t}\n\n\tstatic signalFirstEditableTargetFirstRow(table, rowName, rowIndexAttribute) {\n\t\tlet target = RowFieldSelector.selectFirstEditableFieldInFirstRow(table, rowName, rowIndexAttribute);\n\t\tif(target) target.fire('sb-field-edit', { next: true } );\n\t}\n\n\tstatic signalLastEditableTargetLastRow(table, rowName, rowNum, rowIndexAttribute) {\n\t\tlet target = RowFieldSelector.selectLastEditableFieldInLastRow(table, rowName, rowNum, rowIndexAttribute);\n\t\tif(target) target.fire('sb-field-edit', { next: false } );\n\t}\n}","import {Page} from '../../common/core/Page.js';\n\n// TODO: remove prototype data\nvar templates = [\n\t{ name: 't1', title: 'My Favorite Template' },\n\t{ name: 't2', title: 'Okay Template' },\n\t{ name: 't3', title: 'Super Template' },\n\t{ name: 't4', title: 'Nasty Template' },\n\t{ name: 't5', title: 'Don\\'t Go Here' }\n];\n\nexport class DocgenPreview extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-docgen-preview';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: {  // object instance\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; }\n\t\t\t},\n\t\t\ttemplates: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return templates; }\n\t\t\t}\n\t\t}, Page.properties );\n\t}\n\n\tcancel() {\n\t\tthis.nav( '/entities/quote/detail?id=' + this.ctx.params.id );\n\t}\n\n\tpreview() {\n\t\tthis.nav( '/docgen/preview?id=' + this.ctx.params.id );\n\t}\n\n}\n\nPolymer( DocgenPreview );\n","import {Page} from 'common/core/Page.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class FavoriteLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-lookup';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tlineEditorModel: Object,\n\t\t\tfavoriteModel: Object,\n\t\t\tselectedFavorites: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tactions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tqId: String,\n\t\t\taId: String,\n\t\t\tgroupKey: Number,\n\t\t\tisMobile: Boolean\n\t\t}, Page.properties );\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.qId = this.qId || this.ctx.params.qId;\n\t\tthis.aId = this.aId || this.ctx.params.aId;\n\t\tthis.groupKey = parseInt(this.groupKey || this.ctx.params.groupKey) || null;\n\t\tthis.isMobile = this._isMobileViewport();\n\n\t\tthis.$.le.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t}.bind(this));\n\n\t\tthis.$.md.addEventListener('md-changed', function(e) {\n\t\t\tthis._setMetaData(e.detail.value.fields);\n\t\t}.bind(this));\n\n\t\tthis.$.fm.addEventListener('response-changed', function() {\n\t\t\tthis._setSelected();\n\t\t}.bind(this));\n\n\t\tthis.$.addFavorite.addEventListener('response-changed', function(e) {\n\t\t\tlet quote = e.detail.value;\n\t\t\tif (quote.partialVO) {\n\t\t\t\tquote = this._recombinePartialQuoteWithFullQuote(quote);\n\t\t\t}\n\t\t\tthis.lineEditorModel.quote = quote;\n\t\t\tthis._toggleSelected();\n\t\t\tif (!this.addMore) {\n\t\t\t\tlet queryParams = {qId : this.qId };\n\t\t\t\tif (Object.keys(this.selectedFavorites).length > 0)\n\t\t\t\t\tqueryParams.jspr = true;\n\t\t\t\tif (this.ctx.params.groupKey != null)\n\t\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\t\tNavigator.nav('#', queryParams, ['quote', 'le'], false, this);\n\t\t\t}\n\n\t\t\tthis.$.header.selected = false;\n\t\t\tthis.addMore = false;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('favorite-shared', function(e) {\n\t\t\tthis.$.shareFavorites.addEventListener('response-changed', function() {\n\t\t\t\tthis._toggleSelected();\n\t\t\t}.bind(this));\n\n\t\t\tlet model = new DataBuilder()\n\t\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t\t.add('groupIds', e.detail.groups)\n\t\t\t\t.add('userIds', e.detail.users)\n\t\t\t\t.build();\n\n\t\t\tthis.$.shareFavorites.model = model;\n\t\t}.bind(this));\n\n\t\tthis._handleOneFavoriteSelected();\n\t\tthis._handleAllFavoritesSelected();\n\t}\n\n\t_recombinePartialQuoteWithFullQuote(partialQuote) {\n\t\t// If the response quote was a partial VO, then it means we need to compare the new VO with the old one,\n\t\t// and combine the data from both.\n\t\tvar originalLines = this.le.quote.lineItems;\n\t\t// Append the new line items onto the existing ones.\n\t\tpartialQuote.lineItems = originalLines.concat(partialQuote.lineItems);\n\t\t// Delete all of the temporary attributes we added to the partial VO, and stop marking it as a partial VO.\n\t\tdelete partialQuote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\tdelete partialQuote.emptyGroupKeys;\n\t\tpartialQuote.partialVO = false;\n\t\treturn partialQuote;\n\t}\n\n\t_setMetaData(fields) {\n\t\t// used to set up the table row to display appropriate data\n\t\tthis.cols = this.favoriteModel.resultFieldNames;\n\t\tlet model = {};\n\t\tlet colsDisplay = {};\n\t\tlet fieldLabels = [];\n\t\tlet numFields = fields.length;\n\t\tfor (let i=0; i<numFields; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tmodel[field.name] = {type: field.type};\n\t\t\tcolsDisplay[field.name] = field.label;\n\t\t\tfieldLabels.push(field.label);\n\t\t}\n\t\tthis.model = model;\n\t\tthis.primaryMobileCols = ['Name', 'SBQQ__Description__c'];\n\t\tthis.colsDisplay = colsDisplay;\n\t\tthis.fieldLabels = fieldLabels;\n\t}\n\n\t_setSelected() {\n\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\tfavorite.selected = false;\n\t\t});\n\t}\n\n\t_handleOneFavoriteSelected() {\n\t\t// listen for selection changes to the favorite list\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tlet record = e.detail;\n\t\t\tlet selected = record.selected; // true if selected, false if unselected\n\t\t\tlet recordId = record.Id; // the id of the record that was just selected or unselected\n\n\t\t\tif (selected)\n\t\t\t\tthis.selectedFavorites[recordId] = record;\n\t\t\telse\n\t\t\t\tdelete this.selectedFavorites[recordId];\n\n\t\t}.bind(this));\n\t}\n\n\t_handleAllFavoritesSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function(e) {\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\n\t\t\tif (selected) {\n\t\t\t\tthis._toggleSelected(true);\n\t\t\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\t\t\tthis.selectedFavorites[favorite.record.Id] = favorite.record;\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\tthis._toggleSelected(false);\n\t\t\t\tthis.selectedFavorites = {};\n\t\t\t}\n\n\t\t}.bind(this));\n\t}\n\n\t_toggleSelected(bool) {\n\t\tlet selected = bool ? bool : false;\n\t\tthis.$.header.selected = selected;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\trow.selected = selected;\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeSelections() {\n\t\tthis.selectedFavorites = {};\n\t\tthis._setSelected();\n\t}\n\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tonDeleteFavorite() {\n\t\tlet model = new DataBuilder()\n\t\t\t.add('quoteFavIds', this.le.quote.favoriteIds || [])\n\t\t\t.add('favIdsToRemove', Object.keys(this.selectedFavorites))\n\t\t\t.build();\n\n\t\tthis.$.deleteFavorite.model = model;\n\t}\n\n\ttoggleAddProducts() {\n\t\tthis._toggleSelected();\n\t\tlet params = {qId : this.qId};\n\t\tif(this.groupKey != null)\n\t\t\tparams.groupKey = this.groupKey;\n\t\tif(this.aId)\n\t\t\tparams.aId = this.aId;\n\t\tNavigator.nav('#', params, ['product', 'lookup'], false, this);\n\t}\n\n\tonShareFavorite() {\n\t\tif (Object.keys(this.selectedFavorites).length === 0) {\n\t\t\tthis.error = [\"Please select at least one favorite to share.\"]; //TODO: custom label with sb18n\n\t\t\treturn;\n\t\t}\n\t\tthis.$.shareFavorite.$.dialog.toggle();\n\t}\n\n\tonSelect() {\n\t\tlet largeQuoteThreshold = this.le.settings.largeQuoteThreshold;\n\t\tlet largeQuoteMessage = this.le.customLabels.msg_large_quote_sent_without_lines;\n\t\tlet quote = this.le.quote;\n\t\tif (largeQuoteThreshold && quote.lineItems.length > largeQuoteThreshold) {\n\t\t\tquote = this._minimizeQuoteVO(quote);\n\t\t\tconsole.log(largeQuoteMessage.replace('{0}', quote.record.Id).replace('{1}', largeQuoteThreshold));\n\t\t}\n\t\tlet model = new DataBuilder()\n\t\t\t.addQuote('quote', quote)\n\t\t\t.add('groupKey', this.groupKey)\n\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t.build();\n\n\t\tthis.$.addFavorite.model = model;\n\t}\n\n\t_minimizeQuoteVO(largeQuote) {\n\t\tlet smallQuote = JSON.parse(JSON.stringify(largeQuote));\n\t\tlet qla = new QuoteLineAggregator(largeQuote);\n\t\t// In order to make sure that the proper number of MDQ segments gets added, we need to get maps of MDQ\n\t\t// templates.\n\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);\n\t\tsmallQuote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\tsmallQuote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey || -1) + ''] = templates;\n\t\t// In order to make sure that products with the New Quote Group flag checked are added to their own group\n\t\t// under the correct circumstances, we need to send a set of the groups that are empty.\n\t\tsmallQuote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\t\t// Now we remove all of the line items, and mark the quote as partial.\n\t\tsmallQuote.lineItems = [];\n\t\tsmallQuote.partialVO = true;\n\t\treturn smallQuote;\n\t}\n\n\tonSelectMore() {\n\t\tthis.addMore = true; // used to stay on page after adding favorites\n\t\tthis.onSelect();\n\t}\n\n\tonCancel() {\n\t\tlet queryParams = {qId : this.qId};\n\t\tif (this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tNavigator.nav('#', queryParams, ['quote', 'le'], false, this);\n\t}\n\n\tclearStackTrace() {\n\t\tif (this.errors.validations && this.errors.validations.length > 0) {\n\t\t\tthis.error = this.errors.validations;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t}\n}\n\nPolymer( FavoriteLookup );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FavoriteShareDialog{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-share-dialog';\n\t\tthis.properties = {\n\t\t\tfavdUsers: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavdGroups: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavoriteCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._favoriteCallbackFunction.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\ticonMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\tUser: 'sf-icon-user',\n\t\t\t\t\tGroup: 'sf-icon-groups'\n\t\t\t\t}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-share-fav', this.onCancel);\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis.toggleClass('mobile', true, this.$.dialog);\n\t}\n\n\t_favoriteCallbackFunction(searchValue) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (searchValue == null || searchValue.length < 2) {\n\t\t\t\tthis.viewport.isMobile() ? this.$.multilookup.updateTable([]) : resolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\n\n\t\t\tthis.$.service.uid = '';\n\t\t\tthis.$.service.context = searchValue;\n\t\t\tthis.$.multilookup.menuItemLabels = ['label'];\n\n\t\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\t\tlet results =  this._parseResults(e.detail.value);\n\t\t\t\tif (this.viewport.isMobile()) { // mobile => multilookup will handle results\n\t\t\t\t\tthis.$.multilookup.updateTable(results);\n\t\t\t\t} else { // desktop => send results to typeahead\n\t\t\t\t\tresolve(results);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\t\treject(e.detail.value);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t_parseResults(results) {\n\t\tlet groups = results.groups,\n\t\t\tnumGroups = groups.length,\n\t\t\tusers = results.users,\n\t\t\tnumUsers = users.length;\n\n\t\tfor (let i=0; i<numGroups; i++) {\n\t\t\tgroups[i].type = 'Group';\n\t\t\tgroups[i].label = `Group - ${groups[i].Name}`;\n\t\t}\n\n\t\tfor (let j=0; j<numUsers; j++) {\n\t\t\tusers[j].type = 'User';\n\t\t\tusers[j].label = `User - ${users[j].Name}`;\n\t\t}\n\t\treturn users.concat(groups);\n\t}\n\n\tonShare() {\n\t\tlet selected = this.$.multilookup.selectedIdsByItems,\n\t\t\titems = Object.keys(selected).map(function(k) {\n\t\t\t\treturn selected[k];\n\t\t\t}),\n\t\t\tnumItems = items.length;\n\n\t\tfor (let i=0; i<numItems; i++) {\n\t\t\tlet type = items[i].type === 'Group' ? 'favdGroups' : 'favdUsers';\n\t\t\tthis.push(type, items[i].Id);\n\t\t}\n\n\t\tthis.fire('favorite-shared', { groups: this.favdGroups, users: this.favdUsers });\n\n\t\tthis.$.dialog.toggle();\n\t\tthis._clearFavdLists();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t_clearFavdLists() {\n\t\tthis.set('favdUsers', []);\n\t\tthis.set('favdGroups', []);\n\t\tthis.$.multilookup.clear();\n\t}\n}\n\nPolymer( FavoriteShareDialog );","export class LocalizeFields {\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tlocalizeSearchModel(searchModel) {\n\t\t//localize product fields\n\t\tlet localizedProducts = searchModel.localizationByFieldByProductId;\n\t\tif (!localizedProducts)\n\t\t\treturn searchModel;\n\n\t\tfor (let result of searchModel.results) {\n\t\t\tlet localizedFields = localizedProducts[result.record.Product2Id];\n\t\t\tif (localizedFields) {\n\t\t\t\tfor (let field in localizedFields) {\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localizedFields[field].record);\n\t\t\t\t\tif (!localizedValue)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tresult.record.Product2[field] = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn searchModel;\n\t}\n\n\tlocalizeProduct(product) {\n\t\t//localize bundle name\n\t\tif(!product.localizationByFieldByProductId) {\n\t\t\treturn product;\n\t\t}\n\t\tlet localized = product.localizationByFieldByProductId[product.record.Id];\n\t\tif (localized && localized.Name) {\n\t\t\tlet localizedFeatureName = this.getLocalizedValue(localized.Name.record);\n\t\t\tif (localizedFeatureName){\n\t\t\t\t//need to store untranslated values to search against on configurator\n\t\t\t\tif (!product.untranslatedRecord)\n\t\t\t\t\tproduct.untranslatedRecord = {Name: JSON.parse(JSON.stringify(product.record.Name))};\n\t\t\t\tproduct.record.Name = localizedFeatureName;\n\t\t\t}\n\t\t}\n\n\t\t//localize option fields\n\t\tfor (let option of product.options) {\n\t\t\tlet untranslatedRecord = {};\n\t\t\tfor (let field in option.localizationByFieldName) {\n\t\t\t\tlet localizedOptionField = null;\n\t\t\t\t// Our understanding is that we only localize custom fields\n\t\t\t\tif (field.indexOf('__c') === -1)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet localized = option.localizationByFieldName[field];\n\t\t\t\tif (localized)\n\t\t\t\t\tlocalizedOptionField = this.getLocalizedValue(localized.record);\n\t\t\t\t// TODO: W-014862: Should fix the backend processes so that we only get one version of the localized values, we are currently getting a prefixed value and a non prefixed value.\n\t\t\t\tif (field === 'Description__c') // TODO: This should be handled in the backend as well\n\t\t\t\t\tfield = 'ProductDescription__c';\n\t\t\t\tif (field.replace('__c', '') !== localized.record[this.prefix + 'APIName__c'].replace('__c', '') || field === localized.record[this.prefix + 'APIName__c'].replace(this.prefix, ''))\n\t\t\t\t\tfield = this.prefix + field;\n\n\t\t\t\tuntranslatedRecord[field] = option.record[field];\n\t\t\t\tif (localizedOptionField && option.record[field])\n\t\t\t\t\toption.record[field] = JSON.parse(JSON.stringify(localizedOptionField));\n\n\t\t\t\telse if(localizedOptionField && option.record[this.prefix + field]) //TODO: Fix underlying problems; this should become unnecessary\n\t\t\t\t\toption.record[this.prefix + field] = JSON.parse(JSON.stringify(localizedOptionField));\n\t\t\t}\n\n\t\t\tif (!option.untranslatedRecord)\n\t\t\t\toption.untranslatedRecord = untranslatedRecord;\n\t\t}\n\n\t\t//localize feature names\n\t\tfor (let feature of product.features) {\n\t\t\tif (!feature.untranslatedRecord)\n\t\t\t\tfeature.untranslatedRecord = {Name: JSON.parse(JSON.stringify(feature.record.Name))};\n\t\t\tlet localizationByFieldName = feature.localizationByFieldName;\n\t\t\tif (localizationByFieldName) {\n\t\t\t\tif (localizationByFieldName.Name) {\n\t\t\t\t\tlet localized = localizationByFieldName.Name;\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localized.record);\n\t\t\t\t\tif (localizedValue)\n\t\t\t\t\t\tfeature.record.Name = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn product;\n\t}\n\n\tgetLocalizedValue(record) {\n\t\t//field text type can be 1 of 4\n\t\treturn record[this.prefix + 'Text__c'] ||\n\t\t\trecord[this.prefix + 'TextArea__c'] ||\n\t\t\trecord[this.prefix + 'LongTextArea__c'] ||\n\t\t\trecord[this.prefix + 'RichTextArea__c'];\n\t}\n}","/**\n * Created by jfeingold on 11/18/16.\n */\nexport class AssetQuantityValidator {\n\tconstructor(quoteModel, constants) {\n\t\tthis.quoteModel = quoteModel;\n\t\tthis.constants = constants;\n\t}\n\n\tvalidateAssetQuantityChanges() {\n\t\tlet quoteType = this.quoteModel.record[this.constants.TYPE_FIELD];\n\t\tif (quoteType === 'Renewal') {\n\t\t\treturn this._validateAssetQuantityChangeForRenewal();\n\t\t} else if (quoteType === 'Amendment') {\n\t\t\treturn this._validateAssetQuantityChangeForAmendment();\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t_validateAssetQuantityChangeForRenewal() {\n\t\tvar errMsgs = [];\n\t\t// TODO: Replace hardcoded string with label msg_qty_cannot_decrease_on_renewal\n\t\tvar cannotDecreaseTemplate = 'Quantity of Line {0} cannot decrease below original value {1} on a Renewal Quote.';\n\t\tthis.quoteModel.lineItems.forEach(function(line) {\n\t\t\t// Check if the line corresponds to an existing asset.\n\t\t\tlet renewal = line.record[this.constants.RENEWAL_CHECKBOX];\n\t\t\tlet existing = line.record[this.constants.EXISTING_FIELD];\n\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\tif (renewal && existing && (priorQty != null)) {\n\t\t\t\t// On renewal quotes, asset quantities cannot decrease\n\t\t\t\tlet currentQty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\t\tif (currentQty != 0 && currentQty < priorQty) {\n\t\t\t\t\tlet newErrMsg = cannotDecreaseTemplate\n\t\t\t\t\t\t.replace('{0}', line.record[this.constants.NUMBER_FIELD])\n\t\t\t\t\t\t.replace('{1}', priorQty);\n\t\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t\treturn errMsgs;\n\t}\n\n\t_validateAssetQuantityChangeForAmendment() {\n\t\tvar errMsgs = [];\n\t\tvar negativeQtyLines = [];\n\t\tvar linesWithTooManyUpgrades = [];\n\t\tvar linesWithTooFewUpgrades = [];\n\n\t\tvar getLineActualQty = (line) => {\n\t\t\tlet qty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD] || 0;\n\t\t\tlet upgradedQty = line.record[this.constants.UPGRADED_QUANTITY] || 0;\n\t\t\tlet existingProduct = line.record[this.constants.EXISTING_FIELD];\n\t\t\tlet carryoverLine = line.record[this.constants.CARRYOVER_LINE_FIELD];\n\t\t\treturn existingProduct || carryoverLine ? qty - priorQty + upgradedQty : qty;\n\t\t};\n\n\t\tthis.quoteModel.lineItems.forEach(function(line) {\n\t\t\t// Check if the line corresponds to an existing asset\n\t\t\tlet assetId = line.record[this.constants.UPGRADED_ASSET_FIELD];\n\t\t\tif (assetId != null) {\n\t\t\t\tlet qty = line.record[this.constants.QUANTITY_FIELD];\n\t\t\t\tif (qty < 0 ) {\n\t\t\t\t\t// The quantity cannot be negative.\n\t\t\t\t\t// If it's from the existing asset but removed the virtual quote line, it will skip this check\n\t\t\t\t\tif ( line.record[this.constants.EXISTING_FIELD] && line.record[this.constants.RENEWAL_CHECKBOX]) {\n\t\t\t\t\t\tnegativeQtyLines.push(line);\n\t\t\t\t\t}\n\t\t\t\t} else if (line.record[this.constants.EXISTING_FIELD] || line.record[this.constants.CARRYOVER_LINE_FIELD]) {\n\t\t\t\t\tlet upgradedQty = line.record[this.constants.UPGRADED_QUANTITY];\n\t\t\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\t\t\tif (upgradedQty > priorQty) {\n\t\t\t\t\t\t// You cannot upgrade more units of the product than you had to begin with.\n\t\t\t\t\t\tlinesWithTooManyUpgrades.push(line);\n\t\t\t\t\t} else if (!line.record[this.constants.ALLOW_ASSET_REFUND_FIELD] && getLineActualQty(line) < 0) {\n\t\t\t\t\t\t// If asset refunds are not allowed, the line's actual quantity may not decrease.\n\t\t\t\t\t\tlinesWithTooFewUpgrades.push(line);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\n\t\tif (negativeQtyLines.length > 0) {\n\t\t\t// TODO: Replace the hardcoded string with label msg_qty_no_negative_on_amend\n\t\t\tlet negativeQtyTemplate = 'The quantities of the assets in the Amendment Quote are not allowed to be negative. Please adjust line(s) {0}';\n\t\t\tlet lineNumbers = '';\n\t\t\tnegativeQtyLines.forEach(function(line) {\n\t\t\t\tlineNumbers += line.record[this.constants.NUMBER_FIELD] + ', ';\n\t\t\t}, this);\n\t\t\tlineNumbers = lineNumbers.substr(0, lineNumbers.lastIndexOf(','));\n\t\t\terrMsgs.push(negativeQtyTemplate.replace('{0}', lineNumbers));\n\t\t}\n\n\n\t\tif (linesWithTooManyUpgrades.length > 0) {\n\t\t\t// TODO: Replace hardcoded string with label msg_qty_of_upgrade_exceeds_source_prior;\n\t\t\tlet tooManyUpgradesTemplate = 'Combined quantity of upgrades to Line {0} cannot exceed {1}.';\n\t\t\tlinesWithTooManyUpgrades.forEach(function(line) {\n\t\t\t\tlet num = line.record[this.constants.NUMBER_FIELD];\n\t\t\t\tlet priorQty = line.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t\t\t\tlet newErrMsg = tooManyUpgradesTemplate\n\t\t\t\t\t.replace('{0}', num)\n\t\t\t\t\t.replace('{1}', priorQty);\n\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t}, this);\n\t\t}\n\n\t\tif (linesWithTooFewUpgrades.length > 0) {\n\t\t\t// TODO: Replace hardcoded string with label msg_qty_of_source_too_low\n\t\t\tlet tooFewUpgradesTemplate = 'Product \"{0}\" cannot be refunded. The quantity of Line {1} cannot decrease without a corresponding upgrade.';\n\t\t\tlinesWithTooFewUpgrades.forEach(function(line) {\n\t\t\t\tlet prodName = line.record[this.constants.PRODUCT_NAME_FIELD];\n\t\t\t\tlet num = line.record[this.constants.NUMBER_FIELD];\n\t\t\t\tlet newErrMsg = tooFewUpgradesTemplate\n\t\t\t\t\t.replace('{0}', prodName)\n\t\t\t\t\t.replace('{1}', num);\n\t\t\t\terrMsgs.push(newErrMsg);\n\t\t\t}, this);\n\t\t}\n\t\treturn errMsgs;\n\t}\n}","export function Constants(prefix) {\n\t//object names\n\tthis.QUOTE = `${prefix}Quote__c`;\n\tthis.QUOTE_LINE = `${prefix}QuoteLine__c`;\n\tthis.QUOTE_LINE_GROUP = `${prefix}QuoteLineGroup__c`;\n\n\t//field names\n\tthis.ACCOUNT_FIELD = `${prefix}Account__r`;\n\tthis.ACCOUNT_ID_FIELD = `${prefix}Account__c`;\n\tthis.ACTION_FIELD = `${prefix}Action__c`;\n\tthis.ADDITIONAL_DISCOUNT_AMOUNT_FIELD = `${prefix}AdditionalDiscountAmount__c`;\n\tthis.ADDITIONAL_DISCOUNT_FIELD = `${prefix}AdditionalDiscount__c`;\n\tthis.ADDITIONAL_DISCOUNT_RATE_FIELD = `${prefix}Discount__c`;\n\tthis.ADDITIONAL_QUANTITY_FIELD = `${prefix}AdditionalQuantity__c`;\n\tthis.ALLOW_ASSET_REFUND_FIELD = `${prefix}AllowAssetRefund__c`;\n\tthis.BATCH_QUANTITY = `${prefix}BatchQuantity__c`;\n\tthis.BUNDLE_FIELD = `${prefix}Bundle__c`;\n\tthis.BUNDLED_FIELD = `${prefix}Bundled__c`;\n\tthis.BUNDLED_QUANTITY_FIELD = `${prefix}BundledQuantity__c`;\n\tthis.CARRYOVER_LINE_FIELD = `${prefix}CarryoverLine__c`;\n\tthis.CLASS_FIELD = `${prefix}Class__c`;\n\tthis.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD = `${prefix}ComponentDiscountedByPackage__c`;\n\tthis.COMPONENT_LIST_TOTAL_FIELD = `${prefix}ComponentListTotal__c`;\n\tthis.COMPONENT_SUBSCRIPTION_SCOPE_FIELD = `${prefix}ComponentSubscriptionScope__c`;\n\tthis.COMPONENT_VISIBILITY_FIELD = `${prefix}ComponentVisibility__c`;\n\tthis.CONDITIONS_MET_FIELD = `${prefix}ConditionsMet__c`;\n\tthis.COST_EDITABLE_FIELD = `${prefix}CostEditable__c`;\n\tthis.CUSTOM_ACTION_CONDITIONS_FIELD = `${prefix}Custom_Action_Conditions__r`;\n\tthis.CUSTOMER_AMOUNT_FIELD = `${prefix}CustomerAmount__c`;\n\tthis.CUSTOMER_PRICE_FIELD = `${prefix}CustomerPrice__c`;\n\tthis.DEFAULT_SUBSCRIPTION_TERM_FIELD = `${prefix}DefaultSubscriptionTerm__c`;\n\tthis.DEFAULT_FIELD = `${prefix}Default__c`;\n\tthis.DESCRIPTION_FIELD = `${prefix}Description__c`;\n\tthis.DIMENSION_ID_FIELD = `${prefix}Dimension__c`;\n\tthis.DIMENSION_FIELD = `${prefix}Dimension__r`;\n\tthis.DISCOUNT_AMOUNT_FIELD = `${prefix}DiscountAmount__c`;\n\tthis.DISCOUNT_SCHEDULE_FIELD = `${prefix}DiscountSchedule__c`;\n\tthis.DISCOUNT_SCHEDULE_TYPE_FIELD = `${prefix}DiscountScheduleType__c`;\n\tthis.DISCOUNT_TIER_FIELD = `${prefix}DiscountTier__c`;\n\tthis.DISCOUNT_TIERS_FIELD = `${prefix}DiscountTiers__r`;\n\tthis.DISCOUNT_UNIT_FIELD = `${prefix}DiscountUnit__c`;\n\tthis.DISTRIBUTOR_DISCOUNT_FIELD = `${prefix}DistributorDiscount__c`;\n\tthis.DISTRIBUTOR_DISCOUNT_FIELD = `${prefix}DistributorDiscount__c`;\n\tthis.EFFECTIVE_QUANTITY = `${prefix}EffectiveQuantity__c`;\n\tthis.END_DATE_FIELD = `${prefix}EndDate__c`;\n\tthis.EVENT_HANDLER_NAME_FIELD = `${prefix}EventHandlerName__c`;\n\tthis.EXISTING_FIELD = `${prefix}Existing__c`;\n\tthis.FAVORITE_ID_FIELD= `${prefix}Favorite__c`;\n\tthis.FIELD_FIELD = `${prefix}Field__c`;\n\tthis.FILTER_VALUE_FIELD = `${prefix}FilterValue__c`;\n\tthis.GROUP_LINE_ITEMS_FIELD = `${prefix}LineItemsGrouped__c`;\n\tthis.ICON_CLASS_FIELD = `${prefix}IconClass__c`;\n\tthis.LABEL_FIELD = `${prefix}Label__c`;\n\tthis.LIST_PRICE_FIELD = `${prefix}ListPrice__c`;\n\tthis.LOCATION_FIELD = `${prefix}Location__c`;\n\tthis.LONG_TEXT_AREA_FIELD = `${prefix}LongTextArea__c`;\n\tthis.LOWER_BOUND_FIELD = `${prefix}LowerBound__c`;\n\tthis.MARKUP_AMOUNT_FIELD = `${prefix}MarkupAmount__c`;\n\tthis.MARKUP_FIELD = `${prefix}Markup__c`;\n\tthis.MARKUP_RATE_FIELD = `${prefix}MarkupRate__c`;\n\tthis.NET_AMOUNT_FIELD = `${prefix}NetAmount__c`;\n\tthis.NET_PRICE_FIELD = `${prefix}NetPrice__c`;\n\tthis.NET_TOTAL_FIELD = `${prefix}NetTotal__c`;\n\tthis.NON_DISCOUNTABLE_FIELD = `${prefix}NonDiscountable__c`;\n\tthis.NON_PARTNER_DISCOUNTABLE_FIELD = `${prefix}NonPartnerDiscountable__c`;\n\tthis.NUMBER_FIELD = `${prefix}Number__c`;\n\tthis.OPERATOR_FIELD = `${prefix}Operator__c`;\n\tthis.OPPORTUNITY_FIELD = `${prefix}Opportunity2__r`;\n\tthis.OPPORTUNITY_ID_FIELD = `${prefix}Opportunity2__c`;\n\tthis.OPTION_LEVEL_FIELD = `${prefix}OptionLevel__c`;\n\tthis.OPTION_TYPE_FIELD = `${prefix}OptionType__c`;\n\tthis.OPTIONAL_FIELD = `${prefix}Optional__c`;\n\tthis.ORIGINAL_QUOTE_LINE_FIELD = `${prefix}OriginalQuoteLine__c`;\n\tthis.ORIGINAL_SCHEDULE_FIELD = `${prefix}OriginalDiscountSchedule__c`;\n\tthis.OVERRIDE_BEHAVIOR_FIELD = `${prefix}OverrideBehavior__c`;\n\tthis.PAGE_FIELD = `${prefix}Page__c`;\n\tthis.PARENT_CUSTOM_ACTION_FIELD = `${prefix}ParentCustomAction__c`;\n\tthis.PARTNER_DISCOUNT_FIELD = `${prefix}PartnerDiscount__c`;\n\tthis.PARTNER_PRICE_FIELD = `${prefix}PartnerPrice__c`;\n\tthis.PRICE_EDITABLE_FIELD = `${prefix}PriceEditable__c`;\n\tthis.PRICEBOOK_ID_FIELD = `${prefix}PricebookId__c`;\n\tthis.PRICEBOOK_LOOKUP_ID_FIELD = `${prefix}PriceBook__c`;\n\tthis.PRICING_METHOD_EDITABLE_FIELD = `${prefix}PricingMethodEditable__c`;\n\tthis.PRICING_METHOD_FIELD = `${prefix}PricingMethod__c`;\n\tthis.PRIMARY_FIELD = `${prefix}Primary__c`;\n\tthis.BRAND_BUTTON_FIELD = `${prefix}BrandButton__c`;\n\tthis.PRIOR_QUANTITY_FIELD= `${prefix}PriorQuantity__c`;\n\tthis.PRODUCT = `${prefix}Product__c`;\n\tthis.PRODUCT_CODE_FIELD = `${prefix}ProductCode__c`;\n\tthis.PRODUCT_NAME_FIELD = `${prefix}ProductName__c`;\n\tthis.PRORATE_MULTIPLIER_FIELD = `${prefix}ProrateMultiplier__c`;\n\tthis.QUANTITY_FIELD = `${prefix}Quantity__c`;\n\tthis.QUOTE_PROCESS_FIELD = `${prefix}QuoteProcess__c`;\n\tthis.QUOTE_PROCESS_ID_FIELD = `${prefix}QuoteProcessId__c`;\n\tthis.REGULAR_PRICE_FIELD = `${prefix}RegularPrice__c`;\n\tthis.RENEWAL_CHECKBOX = `${prefix}Renewal__c`;\n\tthis.RENEWED_ASSET_ID_FIELD = `${prefix}RenewedAsset__c`;\n\tthis.RENEWED_ASSET_RELATIONSHIP_FIELD = `${prefix}RenewedAsset__r`;\n\tthis.RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD = `${prefix}RenewedSubscription__r`;\n\tthis.REQUIRED_BY_FIELD = `${prefix}RequiredBy__c`;\n\tthis.RICH_TEXT_AREA_FIELD = `${prefix}RichTextArea__c`;\n\tthis.SEGMENT_INDEX_FIELD = `${prefix}SegmentIndex__c`;\n\tthis.SEGMENT_KEY_FIELD = `${prefix}SegmentKey__c`;\n\tthis.SEGMENT_LABEL_FIELD = `${prefix}SegmentLabel__c`;\n\tthis.SOURCE_FIELD = `${prefix}Source__c`;\n\tthis.SPECIAL_PRICE_FIELD = `${prefix}SpecialPrice__c`;\n\tthis.START_DATE_FIELD = `${prefix}StartDate__c`;\n\tthis.SUBSCRIBED_ASSET_IDS_FIELD = `${prefix}SubscribedAssetIds__c`;\n\tthis.SUBSCRIPTION_BASE_FIELD = `${prefix}SubscriptionBase__c`;\n\tthis.SUBSCRIPTION_PRICING_FIELD = `${prefix}SubscriptionPricing__c`;\n\tthis.SUBSCRIPTION_SCOPE_FIELD = `${prefix}SubscriptionScope__c`;\n\tthis.SUBSCRIPTION_TERM_FIELD = `${prefix}SubscriptionTerm__c`;\n\tthis.TARGET_CUSTOMER_AMOUNT = `${prefix}TargetCustomerAmount__c`;\n\tthis.TARGET_OBJECT_FIELD = `${prefix}TargetObject__c`;\n\tthis.TEXT_FIELD = `${prefix}Text__c`;\n\tthis.TEXT_AREA_FIELD = `${prefix}TextArea__c`;\n\tthis.TYPE_FIELD = `${prefix}Type__c`;\n\tthis.UNIT_COST_FIELD = `${prefix}UnitCost__c`;\n\tthis.UPGRADE_CONVERSION_RATE = `${prefix}UpgradeConversionRate__c`;\n\tthis.UPGRADED_ASSET_FIELD = `${prefix}UpgradedAsset__c`;\n\tthis.UPGRADED_QUANTITY = `${prefix}UpgradedQuantity__c`;\n\tthis.UPGRADED_SUBSCRIPTION_FIELD = `${prefix}UpgradedSubscription__c`;\n\tthis.UPLIFT_FIELD = `${prefix}Uplift__c`;\n\tthis.UPPER_BOUND_FIELD = `${prefix}UpperBound__c`;\n\tthis.URL_TARGET_FIELD = `${prefix}URLTarget__c`;\n\tthis.URL_FIELD = `${prefix}URL__c`;\n\tthis.RETURN_URL_FIELD = `${prefix}ReturnURL__c`;\n\tthis.USE_PRICE_FOR_AMOUNT_FIELD = `${prefix}UsePriceForAmount__c`;\n\tthis.USER_DEFINED_FIELD = `${prefix}UserDefined__c`;\n\tthis.UNOPENED_FIELD = `${prefix}Unopened__c`;\n\n\t// Value\n\tthis.CUSTOM_VALUE = 'Custom';\n\tthis.PANEL_ADDED_INDEX = 2;\n\tthis.PERCENT_OF_TOTAL = 'Percent Of Total';\n\n\t// Dimension types\n\tthis.TYPE_STANDARD = 'Standard';\n\tthis.TYPE_YEARLY_DIMENSION = 'Year';\n\tthis.TYPE_QUARTERLY_DIMENSION = 'Quarter';\n\tthis.TYPE_MONTHLY_DIMENSION = 'Month';\n\tthis.TYPE_SINGLE_DIMENSION = 'One-time';\n\tthis.TYPE_CUSTOM_DIMENSION = 'Custom';\n\n\t// Quote Line Editor row types\n\tthis.STANDARD_LINE = 'STANDARD_LINE';\n\tthis.SEGMENTED_LINE = 'SEGMENTED_LINE';\n\tthis.GROUP_HEADER = 'GROUP_HEADER';\n\tthis.GROUP_FOOTER = 'GROUP_FOOTER';\n\n\t// Groups\n\tthis.QUANTITY_FIELDS = new Set([\n\t\tthis.ADDITIONAL_QUANTITY_FIELD,\n\t\tthis.BATCH_QUANTITY,\n\t\tthis.BUNDLED_QUANTITY_FIELD,\n\t\tthis.EFFECTIVE_QUANTITY,\n\t\tthis.PRIOR_QUANTITY_FIELD,\n\t\tthis.QUANTITY_FIELD,\n\t\tthis.UPGRADED_QUANTITY\n\t]);\n\tthis.UNIT_PRICE_FIELDS = new Set([\n\t\tthis.ADDITIONAL_DISCOUNT_FIELD,\n\t\tthis.CUSTOMER_PRICE_FIELD,\n\t\tthis.LIST_PRICE_FIELD,\n\t\tthis.MARKUP_AMOUNT_FIELD,\n\t\tthis.NET_PRICE_FIELD,\n\t\tthis.PARTNER_PRICE_FIELD,\n\t\tthis.REGULAR_PRICE_FIELD,\n\t\tthis.SPECIAL_PRICE_FIELD,\n\t\tthis.UNIT_COST_FIELD\n\t]);\n}","import {Util} from 'common/Util.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\n\n\nexport class CustomActionModel {\n\tconstructor(editorModel, customAction, customActionModelsByParentId, renderLocation) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.record = customAction; // CustomAction__c\n\t\tthis.customActionModelsByParentId = customActionModelsByParentId;\n\t\tthis.renderLocation = renderLocation;\n\n\t\tif (this.record) {\n\t\t\tthis.icon = this.record[this.editorModel.constants.ICON_CLASS_FIELD];\n\t\t\tthis.class = (this.icon ? this.icon : '');\n\t\t\tthis.caClass = this.record[this.editorModel.constants.CLASS_FIELD];\n\t\t\tthis.location = this.record[this.editorModel.constants.LOCATION_FIELD];\n\t\t\tthis.eventHandlerName = this.record[this.editorModel.constants.EVENT_HANDLER_NAME_FIELD];\n\t\t\tthis.label = this.record[this.editorModel.constants.LABEL_FIELD];\n\t\t\tthis.title = this.icon ? this.record[this.editorModel.constants.LABEL_FIELD] : null;\n\t\t\tthis.type = this.record[this.editorModel.constants.TYPE_FIELD];\n\t\t\tthis.isSeparator = (this.type === 'Separator');\n\t\t\tthis.primary = this.record[this.editorModel.constants.BRAND_BUTTON_FIELD];\n\t\t\tthis.urlTarget = this.record[this.editorModel.constants.URL_TARGET_FIELD];\n\t\t\tthis.url = this.record[this.editorModel.constants.URL_FIELD];\n\t\t\tthis.name = this.record.Name;\n\t\t}\n\n\t\tif (this.renderLocation === 'Line') {\n\t\t\tthis.class = `${this.class} ${this.eventHandlerName} lineAction`;\n\t\t}\n\t}\n\n\tisHidden(model) {\n\t\tif (model) {\n\t\t\tthis.model = model;\n\t\t}\n\t\tif (model && !this._customActionsConditionsMet) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.renderLocation === 'Line' && model) {\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onAddToFavorites\":\n\t\t\t\t\treturn model.favorite || model.hasParent || model.existing;\n\t\t\t\tcase \"onRemoveFromFavorites\":\n\t\t\t\t\treturn !model.favorite || model.existing;\n\t\t\t\tcase \"onDeleteLine\":\n\t\t\t\t\treturn model.hasParent || (model.existing && this.editorModel.quoteModel.isAmendment);\n\t\t\t\tcase \"onCloneLine\":\n\t\t\t\t\treturn model.hasParent;\n\t\t\t\tcase \"onReconfigureLine\":\n\t\t\t\t\treturn model.hasParent || !model.configurable;\n\t\t\t\tcase \"onResegmentLine\":\n\t\t\t\t\treturn !model.lineVO.productHasDimensions || model.segmented || model.existing || model.bundle;\n\t\t\t\tcase \"onDesegmentLine\":\n\t\t\t\t\treturn !model.lineVO.productHasDimensions || !model.segmented || model.existing || model.bundle;\n\t\t\t\tcase \"showDSModal\":\n\t\t\t\t\tlet dsField = this.editorModel.constants.DISCOUNT_SCHEDULE_FIELD;\n\t\t\t\t\tlet dsId = model.lineVO.record[dsField];\n\t\t\t\t\treturn dsId == null || model.isDiscountScheduleIdExcluded(model.lineVO.record[dsField]);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.renderLocation === 'Quote' && this.location === 'Quote/Group' && this.editorModel.quoteModel.grouped)\n\t\t\t\treturn true;\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onUngroup\":\n\t\t\t\t\treturn !this.editorModel.quoteModel.grouped;\n\t\t\t\tcase \"updateLineOptional\":\n\t\t\t\t\tif (!this.editorModel.toggleOptionalShown) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t// Both Optional: All and Optional: None should always show on Group level if toggleOptionalShown is true\n\t\t\t\t\t} else if (this.location === 'Group') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.caClass === 'optionalAllBtn' === this.editorModel.quoteModel.allOptional;\n\t\t\t\t\t}\n\t\t\t\tcase \"onRenewSubscriptions\":\n\t\t\t\t\treturn !this.editorModel.data.settings.renewSubscriptionsButtonRendered || this.editorModel.quoteModel.isAmendmentOrChangeQuote;\n\t\t\t\tcase \"onAmendSubscriptions\":\n\t\t\t\t\treturn !this.editorModel.quoteModel.isAmendment;\n\t\t\t\tcase \"onUpgradeAssets\":\n\t\t\t\t\treturn !this.editorModel.data.settings.upgradeAssetsButtonRendered;\n\t\t\t\tcase \"onDeleteLines\":\n\t\t\t\t\treturn !this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget _customActionsConditionsMet() {\n\t\tlet constants = this.editorModel.constants;\n\t\tif (!this.record || !this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD]) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet evaluateCondition = (condition) => {\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Product') {\n\t\t\t\tif (!this.model.productVO) return true; // not enough information to say condition is not met\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.model.productVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Quote') {\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.editorModel.quoteModel.quoteVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\t\t\treturn true; // if a target object isn't set, then there isn't enough information to say condition is not met\n\t\t}\n\n\t\tlet meetAllConditions = this.record[constants.CONDITIONS_MET_FIELD] !== 'Any';\n\t\tlet conditions = this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD].records;\n\n\t\tfor (let i = 0, l = conditions.length; i < l; i++) {\n\t\t\tif (evaluateCondition(conditions[i])) {\n\t\t\t\tif (!meetAllConditions) return true;\n\t\t\t} else {\n\t\t\t\tif (meetAllConditions) return false;\n\t\t\t}\n\t\t};\n\n\t\treturn meetAllConditions;\n\t}\n\n\tget hasMenu() {\n\t\tif (!this.children) {\n\t\t\tthis.children = this.customActionModelsByParentId ? this.customActionModelsByParentId[this.record.Id] : null;\n\t\t}\n\t\tif (this.type === \"Menu\" && this.children && this.children.length > 0) {\n\t\t\tfor (let i = 0, l = this.children.length; i < l; i++) {\n\t\t\t\tif (!this.children[i].isHidden(this.model))\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget default() {\n\t\tlet isDefault = this.record[this.editorModel.constants.DEFAULT_FIELD];\n\t\tthis.record[this.editorModel.constants.DEFAULT_FIELD] = false;\n\t\treturn isDefault;\n\t}\n\n\tget customActionId() {\n\t\treturn this.record.Id;\n\t}\n}\n","export class DiscountTierModel {\n\tconstructor(discountTierRecord, discountScheduleRecord) {\n\t\tthis.template = discountTierRecord;\n\t\tthis.discountSchedule = discountScheduleRecord;\n\t\tthis.selected = false;\n\t\tthis.hidden = false;\n\t\tthis.disabled = false;\n\t\tthis.tiers = [];\n\t}\n}","export class DiscountTiersValidator {\n\n\tconstructor(discountSchedule, editorModel) {\n\t\tthis.schedule = discountSchedule;\n\t\tthis.editorModel = editorModel;\n\t\tthis.constants = editorModel.constants;\n\t\tthis.unitPriceScale = editorModel.data.settings.priceScale;\n\t\tthis.isMultiCurrencyOrg = editorModel.data.settings.isMultiCurrencyOrg;\n\t}\n\n\tvalidate(rows) {\n\t\tlet errors = new Map();\n\t\tlet lastTier = null;\n\t\tlet label = this.editorModel.data.customLabels;\n\t\tlet schedule = this.schedule;\n\t\trows.forEach(function(row) {\n\t\t\tlet error = null;\n\t\t\tlet number = row.template[this.constants.NUMBER_FIELD];\n\t\t\tlet lowerBound = row.template[this.constants.LOWER_BOUND_FIELD];\n\t\t\tlet upperBound = row.template[this.constants.UPPER_BOUND_FIELD];\n\t\t\tlet lastUpperBound = lastTier != null ? lastTier[this.constants.UPPER_BOUND_FIELD] : null;\n\t\t\tlet discountUnit = schedule[this.constants.DISCOUNT_UNIT_FIELD];\n\t\t\tlet discount = row.template[this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD];\n\t\t\t// Price is added to record for discount schedule modal so remove it here\n\t\t\tdelete row.template.Price;\n\t\t\tif (lowerBound == null) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_lower_bound_tier, [number]);\n\t\t\t} else if ( lastTier != null && lowerBound != lastUpperBound) {\n\t\t\t\terror = this.formatLabel(label.msg_unequal_lower_upper_bounds_tier, [number]);\n\t\t\t} else if ( discount == null && ( discountUnit == null || discountUnit.toUpperCase() === 'PERCENT')) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_discount_tier, [number]);\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound ) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t} else if ( discountUnit && discountUnit.toUpperCase() === 'AMOUNT') {\n\t\t\t\trow.tiers.forEach(function(tier) {\n\t\t\t\t\tif (this.discountFormatted(tier) === null) {\n\t\t\t\t\t\tif (this.isMultiCurrencyOrg) {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier_currency, [number, row.CurrencyIsoCode]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier, [number]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t}\n\t\t\tif (error != null) {\n\t\t\t\terrors.set(Number(number), error);\n\t\t\t}\n\t\t\tlastTier = row.template;\n\t\t}.bind(this));\n\t\treturn errors;\n\t}\n\n\tdiscountFormatted(tier) {\n\t\treturn tier[this.constants.DISCOUNT_AMOUNT_FIELD] == null ? null : (Number(tier[this.constants.DISCOUNT_AMOUNT_FIELD]).toFixed(this.unitPriceScale));\n\t}\n\n\tformatLabel(label, args) {\n\t\tfor (let i = 0, l = args.length; i < l; i++) {\n\t\t\tlabel = label.replace('{' + i + '}', args[i].toString());\n\t\t}\n\t\treturn label;\n\t}\n}","/**\n *  DragDropModel class - To create instances of the dragDrop model which holds data to be used during drag and drop of\n *  components in the line editor page.\n *\n *  Features:\n *      - Instantiate this model in the direct parent component where elements will be dragged and dropped.\n *      - Method to handle the three states of drag and drop: start, track, and stop.\n *      - Appends a placeholder component to the dom should the setting be enabled.\n *      - Uses a ghost element to indicate to the user that dragging is in progress.\n *      - Optional highlighting of drop zone is possible where appropriate.\n **/\n\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\n\nconst topBorderHighlightClass = 'droppableTopBorder';\nconst bottomBorderHighlightClass = 'droppableBottomBorder';\nconst DEFAULT_GHOST_X_OFFSET = 60;\nconst DEFAULT_GHOST_Y_OFFSET = 23;\n\nlet dragging = false;\n\nexport class DragDropModel {\n\tconstructor(/*Host component direct parent to draggable*/ host,\n\t\t\t\t/*Boolean, keep bundle together setting*/ keepBundle,\n\t\t\t\t/*Draggable element name*/ draggable,\n\t\t\t\t/*Array of container elements that draggable can target based on element name & class*/ validTargets,\n\t\t\t\t/*Function to handle 'start' state*/ dragFunc,\n\t\t\t\t/*Function to handle 'track' state*/ trackFunc,\n\t\t\t\t/*Function to handle 'end' state*/ dropFunc,\n\t\t\t\t/*Integer*/ ghostXOffset,\n\t\t\t\t/*Integer*/ ghostYOffset) {\n\n\t\tthis.host = host;                           //{Element} The component implementing the DragDropModel class\n\t\tthis.keepBundleTogether = keepBundle;       //{Boolean} Keep bundle together setting that determines how bundles are treated\n\t\tthis.draggable = draggable;                 //{String} Name of the draggable element\n\t\tthis.validTargets = validTargets;           //{Set(String)} Set of classnames for drop targets\n\t\tthis.sourceElement;                         //{Element} The component/element being dragged\n\t\tthis.hoverOver;                             //{Element} Element that the mouse is hovering over.\n\t\tthis.placeHolderComp = null;                //{Element} Element acting as placeholder appended before or after a\n\t\t\t\t\t\t\t\t\t\t\t\t\t//          valid drop target to indicate where dropping would occur\n\t\tthis.ghostField;\n\t\tthis.targetClass;                           //{String} Classname of the valid drop area.\n\t\tthis.dropBefore;                            //{Boolean} Whether to drop before a valid drop target\n\t\tthis.usePlaceholder;                        //{Boolean} If a placeholder is to be used.\n\t\tthis.highlightTargetPosition;               //{Boolean} If want to highlight target component border\n\t\tthis.highlightableElements = [];            //{Elements} Array of elements whose border can be highlighted on hover.\n\t\tthis.enableHighLight;                       //{Boolean} If a drop zone is to be highlighted.\n\t\tthis.lineEditor = document.body.querySelector('sb-page-container') ? Polymer.dom(document.body.querySelector('sb-page-container').root).querySelector('sb-line-editor') : document.body.querySelector('sb-line-editor');\n\t\tthis.linesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.linesByParentItemKey : null;\n\t\tthis.standardLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.standardLinesByParentItemKey : null;\n\t\tthis.segmentedLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.segmentedLinesByParentItemKey : null;\n\n\t\t/**\n\t\t * Ghost information:\n\t\t * */\n\t\tthis.ghost = null;\n\t\tthis.ghostXOffset = (ghostXOffset == null) ? DEFAULT_GHOST_X_OFFSET : ghostXOffset;\n\t\tthis.ghostYOffset = (ghostYOffset == null) ? DEFAULT_GHOST_Y_OFFSET : ghostYOffset;\n\n\t\t/**\n\t\t* Call back functions passed from the host element\n\t\t* Allows user to define custom drag, track, and drop logic\n\t\t*/\n\n\t\tthis.handleDrag = dragFunc;\n\t\tthis.handleTrack = trackFunc;\n\t\tthis.handleDrop = dropFunc;\n\n\t\tthis._bootstrapMetricsService();\n\t}\n\n\t/**\n\t * Bootstrap qtcMetricsService so that it's available for tracking dnd actions\n\t * @private\n\t */\n\t_bootstrapMetricsService() {\n\t\tif (window.sb && window.sb.MetricsService && !this.metricsService) {\n\t\t\tthis.metricsService = new MetricsService();\n\t\t}\n\t}\n\n\t/**\n\t * Primary method that handles the three states ('start, 'track', 'stop) of Polymer 'track' gesture events.\n\t * Called by the 'onTrack' event on the component that is using the DragDropModel Class.\n\t * @private\n\t */\n\n\t_onTrack(e) {\n\t\t// Check viewport, if mobile then return\n\t\tlet mouseX = e.detail.x,\n\t\t\tmouseY = e.detail.y;\n\n\t\t_pauseEvent(e);\n\t\tswitch(e.detail.state) {\n\t\t\tcase 'start':\n\t\t\t\tif (Math.abs(e.detail.dx) < 9 && Math.abs(e.detail.dy) < 4) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag start ept');\n\t\t\t\t}\n\t\t\t\tdragging = true;\n\t\t\t\t//Disable text highlighting in Line Editor during drag and drop.\n\t\t\t\tthis.lineEditor.toggleClass('disable-selection', true);\n\n\t\t\t\tthis.sourceElement = Polymer.dom(e).localTarget;\n\t\t\t\tlet sourceBox = this.sourceElement.getBoundingClientRect();\n\t\t\t\tthis.sourceWidth = sourceBox.width;\n\t\t\t\tthis.sourceHeight = sourceBox.height;\n\t\t\t\tthis.handleDrag(this.sourceElement, e);\n\t\t\t\tthis._appendGhostImage(mouseX, mouseY);\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'track':\n\t\t\t\tif(!dragging) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag tracking ept');\n\t\t\t\t}\n\t\t\t\ttry{\n\t\t\t\t\t// Have ghost track mouseremoveTableRowBorderClass position\n\t\t\t\t\tthis._moveGhost(mouseX, mouseY);\n\t\t\t\t\t// Component that mouse is hovering over.\n\t\t\t\t\tlet hoverOverComp = Polymer.dom(e).event.detail.hover();\n\t\t\t\t\tif ((this.draggable === 'sb-le-table-row' || this.draggable === 'sf-le-table-row') && (hoverOverComp.id === 'panel' || hoverOverComp.classList.contains('nav-item'))) {\n\t\t\t\t\t\tthis._hideGhost();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._showGhost();\n\t\t\t\t\t}\n\t\t\t\t\t// Call handleTrack function for custom logic during track phase\n\t\t\t\t\tthis.handleTrack(hoverOverComp);\n\t\t\t\t\tthis.host.debounce('Cursor flipping', function() {\n\t\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this.lineEditor, () => {\n\t\t\t\t\t\t\tif (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n\t\t\t\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (hoverOverComp !== this.previousHoverOverComp){\n\t\t\t\t\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor',true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.previousHoverOverComp = this.hoverOver.comp;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this), 15);\n\n\t\t\t\t\t// Return early if hoverOver object is null, which represents invalid drop target\n\t\t\t\t\tif (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n\t\t\t\t\t\tthis._removeHighlightHover(this.previousHoverOverComp);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// if 'usePlaceholder' is truthy, append placeholder to new position.\n\t\t\t\t\tthis.host.debounce('Apply Placeholder', function() {\n\t\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\t\tif (this.usePlaceholder && this.hoverOver && Object.keys(this.hoverOver).length != 0) {\n\t\t\t\t\t\t\tthis._usePlaceholder(mouseX, mouseY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this), 22);\n\t\t\t\t\t// if 'enableHighlight' of drop zone is truthy,remove previously highlighted background and highlight\n\t\t\t\t\t// current element's background.\n\t\t\t\t\tif (this.enableHighLight) {\n\t\t\t\t\t\tthis._removeHighlightHover(this.previousHoverOverComp);\n\t\t\t\t\t\tthis._highlightHover(this.hoverOver.comp);\n\t\t\t\t\t}\n\t\t\t\t} catch (e){\n\t\t\t\t\t//  Revert dom changes if error is encountered\n\t\t\t\t\tthis.sourceElement.toggleAttribute ? this.sourceElement.toggleAttribute('hidden', false) :\n\t\t\t\t\t\tthis.sourceElement.removeAttribute('hidden');\n\t\t\t\t\tthis._removeGhost();\n\t\t\t\t\tthis._removePlaceholder();\n\t\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'end':\n\t\t\t\tif(!dragging) return;\n\t\t\t\tif (this.metricsService) {\n\t\t\t\t\tthis.metricsService.startTransaction('CPQ Performance Metrics Service: drag end ept');\n\t\t\t\t}\n\t\t\t\tthis._removePlaceholder();\n\t\t\t\tthis._removeGhost();\n\n\t\t\t\tif(this.hoverOver){\n\t\t\t\t\tthis.handleDrop(this.sourceElement, this.hoverOver.comp, this.targetClass, this.dropBefore);\n\t\t\t\t\tthis._removeHighlightHover(this.hoverOver.comp);\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleDrop(this.sourceElement, null, this.targetClass, this.dropBefore);\n\t\t\t\t}\n\n\t\t\t\tthis.lineEditor.toggleClass('dropCursor', false);\n\t\t\t\tthis.sourceElement = null;\n\t\t\t\tthis.previousHoverOverComp = null;\n\t\t\t\tthis.hoverOver = {};\n\t\t\t\tdragging = false;\n\n\t\t\t\t//Re-enable text highlighting in Line Editor.\n\t\t\t\tthis.lineEditor.toggleClass('disable-selection', false);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Method that fires an event that affects the ghost element.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\t * Fires an event to sb-line-editor component to add a ghost element to the page.\n\t * @event changed-ghost\n\t * @param {String} - sends a string of 'add' to indicate that a ghost will be added.\n\t * @param {String} - x location in terms of number of pixels.\n\t * @param {String} - y location in terms of nuber of pixels.\n\t * @param {String} - width in terms of number of pixels.\n\t * @param {String} - height in terms of number of pixels.\n\t */\n\n\t_appendGhostImage(x, y) {\n\t\tlet ghostElement = this._clonePolymerElement(this.sourceElement);\n\t\tlet loadingSpinner = ghostElement.querySelector('.loadingSpinner');\n\t\tif (loadingSpinner) loadingSpinner.remove();\n\n\t\tghostElement.hidden = false;\n\t\tlet gX = (x - this.ghostXOffset) + 'px';\n\t\tlet gY = (y - this.ghostYOffset) + 'px';\n\t\tthis.ghost.style.width = this.sourceWidth + 'px';\n\t\tthis.ghost.style.height = this.sourceHeight + 'px';\n\t\tthis.ghost.style.left = gX;\n\t\tthis.ghost.style.top = gY;\n\t\tthis.ghost.style.visibility = 'visible';\n\t\tthis.ghost.appendChild(ghostElement);\n\t}\n\n\t/**\n\t * Method that takes mouse location as parameter and moves the ghost.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\n\t */\n\n\t_moveGhost(x, y) {\n\t\t//let xOffset = (this.sourceWidth + 15)/2;\n\t\tlet gX = (x - this.ghostXOffset) + 'px',\n\t\t\tgY = (y - this.ghostYOffset) + 'px';\n\n\t\tthis.ghost.style.left = gX;\n\t\tthis.ghost.style.top = gY;\n\t}\n\n\t/**\n\t * Method that removes the ghost from page.\n\t * @param {Number} x - real number.\n\t * @param {Number} y - real number.\n\t * @private\n\t *\n\t */\n\n\t_removeGhost() {\n\t\tthis.ghost.innerHTML = '';\n\t\tthis.ghost.style.left = '';\n\t\tthis.ghost.style.top = '';\n\t\tthis.ghost.style.width = '';\n\t\tthis.ghost.style.height = '';\n\t\tthis.ghost.style.visibility = 'hidden';\n\t}\n\n\t/**\n\t * Method that hides the ghost.\n\t * @private\n\t *\n\t */\n\t_hideGhost() {\n\t\tthis.ghost.style.visibility = 'hidden';\n\t}\n\n\t/**\n\t * Method that shows the ghost.\n\t * @private\n\t *\n\t */\n\t_showGhost() {\n\t\tthis.ghost.style.visibility = 'visible';\n\t}\n\n\t/**\n\t * Recursive method to find the droppable component where the draggable element is standard lines.\n\t * During hover, the mouse may target a non-valid element. Method will recursively look for domHost, host or\n\t * parentNode to find a valid drop target. If none is found, then null is returned.\n\t * @param {Element} el - element that the mouse is hovering over during tracking.\n\t * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n\t * before, after, or both.\n\t * @private\n\t */\n\n\t_findTableRowValidTarget(el) {\n\t\tif (!el) return null;\n\t\tif (this._ifParentIsValidTarget(el) && !el.classList.contains('tfoot') && el.id !== 'header'\n\t\t\t&& el.localName !== 'template' && el.localName !== 'sb-le-summary-row') {\n\t\t\t//  Exceptions needed for standard lines to exclude footer and summary row.\n\t\t\treturn el;\n\t\t}\n\t\tif (el.domHost){\n\t\t\treturn this._findTableRowValidTarget(el.domHost);\n\t\t} else if (el.host){    // For Safari and FF\n\t\t\treturn this._findTableRowValidTarget(el.host);\n\t\t} else if (el.parentNode) {\n\t\t\treturn this._findTableRowValidTarget(el.parentNode);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t_updateMDQTableRowHoverOverObject(drag, hover){\n\t\tif (hover.lineModel.dimensionType !== drag.lineModel.dimensionType) {\n\t\t\tthis.hoverOver = null;\n\t\t}else if(!this.keepBundleTogether) {\n\t\t\tthis.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n\t\t} else if (drag.lineModel.component && hover.lineModel.groupModel.groupKey !== drag.lineModel.groupModel.groupKey) {\n\t\t\tthis.hoverOver = null;\n\t\t} else {\n\t\t\tthis.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n\t\t}\n\t}\n\n\t/**\n\t * Method to find the valid droppable element if the draggable element is a side panel group.\n\t * @param {Object} el - object that contains the element targed on hover. Check if it's a valid drop target.\n\t * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n\t * before, after, or both.\n\t * @private\n\t */\n\t_findSidePanelGroupValidTarget(el) {\n\t\tif( this._ifParentIsValidTarget(el) ) {\n\t\t\treturn el;\n\t\t} else if(el.id === 'panel') {\n\t\t\tlet navItems = el.querySelectorAll('.nav-item');\n\t\t\treturn navItems[navItems.length - 1];\n\t\t}\n\t\treturn null;\n\t}\n\n\t_updateTableRowHoverOverObject(hoverElement, last) {\n\t\tif (!hoverElement) {return;}\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.ref === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tif (!this.keepBundleTogether && hoverElement.lineModel) {\n\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t} else if (hoverElement.lineModel) {\n\t\t\tlet lineKey = hoverElement.lineModel.lineVO.key;\n\t\t\tif (!isComponent(this.sourceElement) ){\n\t\t\t\tif (!this.standardLinesByParentKey[lineKey] && !hoverElement.lineModel.component){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t\t\t} else if ( hoverElement.lineModel.bundle && !hoverElement.lineModel.component ){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n\t\t\t\t} else {\n\t\t\t\t\tthis.hoverOver = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (isComponent(this.sourceElement) ){\n\t\t\t\tif (ifLineElementsShareParent(hoverElement, this.sourceElement) && ifLineElementsAreParentChild(hoverElement, hoverElement.nextElementSibling)){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n\t\t\t\t} else if (ifLineElementsShareParent(hoverElement, this.sourceElement)){\n\t\t\t\t\tthis.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\t\t\t} else {\n\t\t\t\t\tthis.hoverOver = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(hoverElement.classList.contains('tfoot')){\n\t\t\tthis.hoverOver = null;\n\t\t} else {\n\t\t\tthis.hoverOver = null;\n\t\t}\n\t}\n\n\t/**\n\t * Recursive method to find the dom custom element given the element's name.\n\t * @param {String} nodeName - element name.\n\t * @param {String} value of select; could be a value representing 'id', 'class', 'nodeName'\n\t * @param {String} selector - selector used to fine element valid entries ('id', 'class', 'nodeName').\n\t * @returns {Object} - Return the element if found.\n\t * @public\n\t */\n\n\t_findParentCustomElement(el, value, selector) {\n\t\tif (!el) return null;\n\t\tswitch(selector) {\n\t\t\tcase 'id':\n\t\t\t\tif (el.id === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'class':\n\t\t\t\tif (el.classList.contains(value)) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'nodeName':\n\t\t\t\tif (el.nodeName === value) {\n\t\t\t\t\treturn el;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (el.rootNode){\n\t\t\treturn this._findParentCustomElement(el.rootNode, value, selector);\n\t\t} else if (el.host){\n\t\t\treturn this._findParentCustomElement(el.host, value, selector);\n\t\t} else if (el.parentNode) {\n\t\t\treturn this._findParentCustomElement(el.parentNode, value, selector);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\t_highlightHover(selected) {\n\t\tthis.host.toggleClass('hoverover', true, selected);\n\t}\n\n\t/**\n\t * Helper method to determine whether the element being passed is a valid target.\n\t * Criteria is whether the element's parent has a css class we're looking for.\n\t * @param {Element} element.\n\t * @private\n\t */\n\n\t_ifParentIsValidTarget(element) {\n\t\tif (!element || !element.parentElement) return false;\n\t\tlet classArr = Array.from(element.parentElement.classList);\n\t\tfor (let i = 0, len = classArr.length; i < len; i ++){\n\t\t\tif (this.validTargets.has(classArr[i])){\n\t\t\t\tthis.targetClass = classArr[i];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\n\t_removePlaceholder() {\n\t\tif (this.placeHolderComp && this.placeHolderComp.parentElement) {\n\t\t\tthis.placeHolderComp.parentElement.removeChild(this.placeHolderComp);\n\t\t\tthis.placeHolderComp = null;\n\t\t}\n\t}\n\n\t/**\n\t * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n\t * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n\t * @private\n\t */\n\t_removeHighlightHover(selected) {\n\t\tif (!selected || !selected.parentNode) return;\n\t\tPolymer.dom(selected.parentNode).querySelectorAll(selected.localName).forEach(\n\t\t\t(node) => {\n\t\t\t\tthis.host.toggleClass('hoverover', false, node);\n\t\t\t}\n\t\t)\n\t}\n\n\t/**\n\t * If 'highlightTargetPosition' property is truthy, css class to highlight the top or bottom highlightableElements\n\t * element border during tracking.\n\t * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n\t * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n\t * @private\n\t */\n\n\t_highlightDroppableBorder(x, y) {\n\t\tlet boundBox = this.hoverOver.comp.getBoundingClientRect(),\n\t\t\tmidHeight = boundBox.top + boundBox.height / 2,\n\t\t\tresults = this.highlightableElements;\n\n\t\tswitch (this.hoverOver.phLoc) {\n\n\t\t\tcase 'both':\n\t\t\t\tif (y < midHeight) {\n\t\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t\t_addTopBorderClass(results[m]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t} else if (y > midHeight) {\n\t\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t\t_addBottomBorderClass(results[m]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'before':\n\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t_addTopBorderClass(results[m]);\n\t\t\t\t}\n\t\t\t\tthis.dropBefore = true;\n\t\t\t\tbreak;\n\t\t\tcase 'after':\n\t\t\t\tfor (let m = 0, l = results.length; m < l; m++) {\n\t\t\t\t\tremoveTopBottomBorderClass(results[m]);\n\t\t\t\t\t_addBottomBorderClass(results[m]);\n\t\t\t\t}\n\t\t\t\tthis.dropBefore = false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Remove the css class used to highlight the top or bottom previous highlightableElements border during tracking.\n\t * @private\n\t */\n\n\t_removeHighlightDroppableBorder(elements) {\n\t\tif (!elements) {return;}\n\n\t\tfor (let m = 0, l = elements.length; m < l; m++) {\n\t\t\tremoveTopBottomBorderClass(elements[m]);\n\t\t}\n\t}\n\n\t/**\n\t * If 'usePlaceholder' property is truthy, apply a placeholder to indicate to user a valid drop area.\n\t * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n\t * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n\t * @private\n\t */\n\n\t_usePlaceholder(mouseX, mouseY) {\n\t\t//Target hoverOver only if element is valid, not the same as source element, and not the placeholder.\n\t\tif (this.hoverOver && this.hoverOver.comp !== this.placeHolderComp){\n\t\t\tlet boundBox = this.hoverOver.comp.getBoundingClientRect(),\n\t\t\t\tmidHeight = boundBox.top + boundBox.height/ 2;\n\t\t\tif(!this.placeHolderComp){\n\t\t\t\t// place holder component is the clone of the source element, or draggable\n\t\t\t\tif (this.sourceElement.deepCloneNode) {\n\t\t\t\t\tthis.placeHolderComp = this.sourceElement.deepCloneNode();\n\t\t\t\t\tthis.placeHolderComp.setAttribute('id', 'placeholder');\n\t\t\t\t\tthis.placeHolderComp.$$ ? this.placeHolderComp.toggleClass('placeholder', true, this.placeHolderComp.$$('.tr')) : null;\n\t\t\t\t} else {\n\t\t\t\t\tthis.placeHolderComp = this.host.create(this.draggable);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('id', 'placeholder');\n\t\t\t\t\tthis.placeHolderComp.$$ ? this.placeHolderComp.toggleClass('placeholder', true, this.placeHolderComp.$$('.tr')) : null;\n\t\t\t\t\tfor (let x in this.sourceElement.properties) {\n\t\t\t\t\t\tif (x === 'data') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.placeHolderComp[x] = this.sourceElement[x];\n\t\t\t\t\t\t} catch (e) {/* Just catch the exception in case property is read-only*/};\n\t\t\t\t\t}\n\t\t\t\t\tthis.placeHolderComp['data'] = this.sourceElement['data'];   // Ensure data is set last\n\t\t\t\t}\n\t\t\t\tthis.placeHolderComp.style.width = boundBox.width + 'px';\n\t\t\t\tthis.placeHolderComp.style.height = boundBox.height + 'px';\n\t\t\t\tthis.placeHolderComp.style.backgroundColor = '#d8dde6';\n\t\t\t}\n\n\t\t\tswitch(this.hoverOver.phLoc) {\n\t\t\t\tcase 'both':\n\t\t\t\t\tif (mouseY < midHeight){\n\t\t\t\t\t\tPolymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n\t\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'after');\n\t\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t\t} else if (mouseY > midHeight){\n\t\t\t\t\t\tPolymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n\t\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'before');\n\t\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'before':\n\t\t\t\t\tPolymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'after');\n\t\t\t\t\tthis.dropBefore = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'after':\n\t\t\t\t\tPolymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n\t\t\t\t\tthis.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n\t\t\t\t\tthis.placeHolderComp.setAttribute('ref', 'before');\n\t\t\t\t\tthis.dropBefore = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else if (this.hoverOver && this.hoverOver.comp === this.placeHolderComp){\n\t\t\tif (!this.placeHolderComp.hasAttribute('ref')) return;\n\t\t\tif (this.placeHolderComp.getAttribute('ref') === 'before'){\n\t\t\t\tthis.hoverOver.comp = this.hoverOver.comp.previousElementSibling;\n\t\t\t\tthis.dropBefore = false;\n\t\t\t} else if (this.placeHolderComp.getAttribute('ref') === 'after'){\n\t\t\t\tthis.hoverOver.comp = this.hoverOver.comp.nextElementSibling;\n\t\t\t\tthis.dropBefore = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_clonePolymerElement(node) {\n\t\t// use custom deepClone logic if available\n\t\tif (node.deepCloneNode) {\n\t\t\treturn node.deepCloneNode();\n\t\t}\n\t\tlet clonedElement = node.cloneNode(true);\n\t\tfor (let x in node.properties) {\n\t\t\tif (x === 'data') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttry{\n\t\t\t\tclonedElement[x] = node[x];\n\t\t\t}catch(e){/* Just catch the exception in case property is read-only*/};\n\t\t}\n\t\tclonedElement['data'] = node['data'];   // Ensure data is set last\n\t\treturn clonedElement;\n\t}\n\n}\n\n/**\n * Helper method that receives an event object and prevents further propagation of the event.\n * @param {Event} e - event object from the track event.\n * @private\n */\n\nfunction _pauseEvent(/* Event */e){\n\tif(e.stopPropagation) e.stopPropagation();\n\tif(e.preventDefault) e.preventDefault();\n\treturn false;\n}\n\n/**\n * Helper method that receives node and toggles style of the top border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addTopBorderClass(node) {\n\tnode.classList.add(topBorderHighlightClass);\n}\n\n/**\n * Helper method that receives node and toggles style of the bottom border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addBottomBorderClass(node) {\n\tnode.classList.add(bottomBorderHighlightClass);\n}\n\nexport function removeTableRowBorderClass(rowComp){\n\tlet tds =[];\n\ttds = Array.from(Polymer.dom(rowComp.root).querySelector('.tr').getElementsByClassName('td'));\n\tfor (let m = 0, l = tds.length; m < l; m++) {\n\t\tremoveTopBottomBorderClass(tds[m]);\n\t}\n}\n\n/**\n * Helper method that removes border style of the top and bottom border if exists.\n * @param {Element} node - DOM node.\n * @private\n */\n\nexport function removeTopBottomBorderClass(node) {\n\tif (node.classList.contains(topBorderHighlightClass)) {\n\t\tnode.classList.remove(topBorderHighlightClass);\n\t}\n\tif (node.classList.contains(bottomBorderHighlightClass)) {\n\t\tnode.classList.remove(bottomBorderHighlightClass);\n\t}\n}\n\n/**\n * Helper method check if a sb-le-table-row element is a component.\n * Check's the element's lineModel.component property.\n * @param {Element} el - checks whether element is a sb-le-table-row.\n * @public\n */\n\nexport function isComponent(/* 'sb-le-table-row' element*/ el) {\n\tif (!el || !el.lineModel) return;\n\treturn el.lineModel.component;\n}\n\n/**\n * Helper method to determine whether two sb-le-table-row's share a common parent line item.\n * @param {Element} eL1 - first sb-le-table-row element for comparison.\n * @param {Element} eL2 - second sb-le-table-row element for comparison.\n * @public\n */\n\nexport function ifLineElementsShareParent(/* 'sb-le-table-row' element*/eL1, /* 'sb-le-table-row' element*/ eL2) {\n\tif (!eL1.lineModel || !eL2.lineModel) return;\n\treturn eL1.lineModel.lineVO.parentItemKey === eL2.lineModel.lineVO.parentItemKey;\n}\n\n/**\n * Helper method to determine whether the one sb-le-table-row is the parent of the other.\n * @param {Element} eL1 - first sb-le-table-row element for comparison.\n * @param {Element} eL2 - second sb-le-table-row element for comparison.\n * @public\n */\n\nexport function ifLineElementsAreParentChild(/* 'sb-le-table-row' element*/eL1, /* 'sb-le-table-row' element*/ eL2) {\n\tif (!eL1.lineModel || !eL2.lineModel) return;\n\treturn eL1.lineModel.lineVO.key === eL2.lineModel.lineVO.parentItemKey\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {QuoteModel} from 'quotes/models/QuoteModel.js';\nimport {Constants} from 'quotes/models/Constants.js';\nimport {CustomActionModel} from 'quotes/models/CustomActionModel.js';\n\n/**\n * EditorModel class - To create a editorModel which contains the basic informaiton and reference which are used in clients \n *\n */\nexport class EditorModel {\n\tconstructor(data, md, lineEditor) {\n\t\tthis.i18n = AppContext.properties.i18n.value();\n\t\tthis._observers = new Map();\n\n\t\tthis.data = data; // editorModel returned from the server\n\t\tthis.md = md;\n\t\tthis.fieldsetMap = _createFieldsetMap(this.data, this.md);\n\t\tthis.constants = new Constants(data.developerPrefix);\n\t\tthis.deviceContext = lineEditor ? lineEditor.app.deviceContext : {};\n\t\tthis.fieldNameSet = lineEditor ? lineEditor.fieldNameSet : {};\n\t\t// Sets the required property of the field md so that the \"--None--\" picklist value won't show up.\n\t\tthis.md.fieldsMap[this.data.quoteLineObjectName][this.constants.SUBSCRIPTION_SCOPE_FIELD].required = true;\n\t\tthis.data.excludedDiscountScheduleIds = this.data.excludedDiscountScheduleIds && this.data.excludedDiscountScheduleIds.length > 0\n\t\t\t? this._convertExcludedDiscountScheduleIdsToObject(this.data.excludedDiscountScheduleIds)\n\t\t\t: {};\n\n\t\tthis.largeQuoteExperienceEnabled = data.settings.largeQuoteExperienceEnabled && !this.deviceContext.isMobile;\n\t\tthis.summarized = data.quote.summaries && Object.keys(data.quote.summaries).length > 0;\n\t\tthis.createQuoteModel(data.quote);\n\n\t\tthis.standardPrimaryMobileCols = [];\n\t\tthis.segmentedPrimaryMobileCols = [];\n\t\tthis.segmentedDetailsPrimaryMobileCols = [];\n\n\t\tthis.toggleOptionalShown = _isToggleOptionalShown(this);\n\n\t\tif (lineEditor && lineEditor.editorModel) {\n\t\t\tthis.customActionsByLocation = lineEditor.editorModel.customActionsByLocation;\n\t\t\tthis.customActionsByLocationMobile = lineEditor.editorModel.customActionsByLocationMobile;\n\t\t\tthis.groupMobileMenuButtonAction = lineEditor.editorModel.groupMobileMenuButtonAction;\n\t\t\t// Updates EditorModel property on CustomActionModels that have already been initialized\n\t\t\t_updateCustomActions(this);\n\t\t} else {\n\t\t\t_initCustomActions(data.customActions, this);\n\t\t}\n\t\tthis.quoteCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Quote : this.customActionsByLocation.Quote;\n\t\tthis.lineCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Line : this.customActionsByLocation.Line;\n\t\tthis.styleQuoteAndGroupActionButtons();\n\t\tthis.communityPrefix = this._getCommunityPrefix();\n\t\tthis.isMultiGroupViewEnabled = data.settings.multiGroupViewEnabled;\n\t}\n\n\t/**\n\t * Getter for Quote line actions on the left\n\t * @returns {boolean}\n\t */\n\tget actionsOnTheLeft() {\n\t\treturn this.data.settings.actionsColumnPlacement === 'Left';\n\t}\n\n\t/**\n\t * To create a new quote model when new QuoteVO is coming from the server\n\t *\n\t * @param quoteVO\n\t */\n\tcreateQuoteModel(quote) {\n\t\tthis.quoteModel = new QuoteModel(quote, this);\n\t}\n\n\tstyleQuoteAndGroupActionButtons() {\n\t\tlet styleActionButtons = (location) => {\n\t\t\tlet first = true;\n\t\t\tlet actions = this.customActionsByLocation[location];\n\t\t\tlet lastCustomAction = actions[0];\n\t\t\tfor (let i = 0, l = actions.length; i < l; i++) {\n\t\t\t\tif (actions[i].isHidden(this.quoteModel)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tactions[i].first = first;\n\t\t\t\tif (actions[i].isSeparator) {\n\t\t\t\t\tfirst = true;\n\t\t\t\t\tlastCustomAction.last = true;\n\t\t\t\t} else {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tlastCustomAction = actions[i];\n\t\t\t\t\tlastCustomAction.last = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastCustomAction) {\n\t\t\t\tlastCustomAction.last = true;\n\t\t\t}\n\t\t}\n\t\tstyleActionButtons('Quote');\n\t\tstyleActionButtons('Group');\n\t}\n\n\t_getCommunityPrefix() {\n\t\tlet path = document.location.pathname;\n\t\tlet idx = path.indexOf('/apex');\n\t\tif (idx < 0) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.substring(0, idx);\n\t}\n\n\t/**\n\t * Retrieve metadata object for the given field name\n\t * @param fieldName\n\t * @return {*}\n\t */\n\tgetFieldMetadata(fieldName) {\n\t\treturn this.md.fieldsMap[this.data.quoteLineObjectName][fieldName];\n\t}\n\t\n\t/**\n\t * Find all dependent picklist fields for the given control field\n\t * @param controllerFieldName\n\t */\n\tgetDependentFields(controllerFieldName) {\n\t\tlet fieldMetadata = this.md.fieldsMap[this.data.quoteLineObjectName];\n\t\treturn Object.keys(fieldMetadata).filter((field) => {\n\t\t\treturn fieldMetadata[field].controllerName === controllerFieldName;\n\t\t});\n\t}\n\n\t/**\n\t * @return {boolean} whether drawer field set has any fields\n\t */\n\thasDrawerFields() {\n\t\treturn this.fieldsetMap.standardLineItemDrawerFieldNames.length > 0;\n\t}\n\n\t/**\n\t * @return {boolean} whether product hierarchy view is turned on\n\t */\n\tisProductHierarchyVisualized() {\n\t\treturn this.data.settings.productHierarchyVisualized;\n\t}\n\n\n\t_convertExcludedDiscountScheduleIdsToObject(excludedDiscountScheduleIds) {\n\t\tif (excludedDiscountScheduleIds) {\n\t\t\treturn excludedDiscountScheduleIds.reduce(function(accumulator, current) {\n\t\t\t\taccumulator[current] = true;\n\t\t\t\treturn accumulator;\n\t\t\t}, {});\n\t\t}\n\t}\n}\n\n/**\n * Recreates fieldsets after applying field level security\n * Relies on the metadata retrieved from describe.js\n * @param data\n * @param md\n * @returns {{}} object of fieldsets mapped by fieldset name\n * @private\n */\nlet _createFieldsetMap = (data, md) => {\n\tlet fieldsetList = _createFieldsetList(data.developerPrefix);\n\tlet fieldsetMap = {};\n\tfieldsetList.forEach( (fieldset) => {\n\t\tif (!data[fieldset.name]) {\n\t\t\tfieldsetMap[fieldset.name] = data[fieldset.name];\n\t\t\treturn;\n\t\t}\n\t\tfieldsetMap[fieldset.name] = [];\n\t\tdata[fieldset.name].forEach( (field) => {\n\t\t\tif (md.fieldsMap[fieldset.table][field]) {\n\t\t\t\tfieldsetMap[fieldset.name].push(field);\n\t\t\t};\n\t\t});\n\t});\n\treturn fieldsetMap;\n};\n\nlet _createFieldsetList = (prefix) => {\n\treturn [{ table: prefix + 'QuoteLine__c', name : 'lineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesTablet' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesPhone' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'standardLineItemDrawerFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineSummaryFieldNames' },\n\t\t\t{ table: prefix + 'DiscountTier__c', name : 'discountScheduleModalFieldNames' },\n\t\t\t{ table: prefix + 'Quote__c', name : 'quoteFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLineGroup__c', name : 'groupFieldNames' }];\n};\n\nlet _isToggleOptionalShown = (editorModel) => {\n\tlet containsOptional_Field = (lineFieldNames) => {\n\t\tfor (let i = 0, l = lineFieldNames.length; i < l; i++) {\n\t\t\tif (lineFieldNames[i] === editorModel.constants.OPTIONAL_FIELD)\n\t\t\t\treturn true;\n\t\t}\n\t};\n\treturn containsOptional_Field(editorModel.fieldsetMap.lineFieldNames) || containsOptional_Field(editorModel.fieldsetMap.multiSegmentLineFieldNames) || containsOptional_Field(editorModel.fieldsetMap.standardLineItemDrawerFieldNames);\n};\n\n/**\n * [_initCustomActions description]\n * @param  {[type]} customActions [description]\n * @return {[type]}               [description]\n */\nlet _initCustomActions = (customActions, editorModel) => {\n\teditorModel.defaultCustomActions = [];\n\tlet validLocations = ['Quote', 'Group', 'Line'];\n\tlet customActionsByLocation = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByLocationMobile = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByParentId = {'Quote': {}, 'Group': {}, 'Line':{}};\n\tlet addGroupCustomActionModel;\n\n\tlet addToLocation = (customAction, location) => {\n\t\tif(validLocations.indexOf(location) === -1)\n\t\t\treturn; // not a valid location, so we bail\n\t\t\n\t\tlet customActionModel = new CustomActionModel(editorModel, customAction, customActionsByParentId[location], location);\n\t\tif (!customActionModel.isSeparator) {\n\t\t\tcustomActionsByLocationMobile[location].push(customActionModel);\n\t\t}\n\t\t\n\t\t// Grab all the default Custom Actions\n\t\tif (customActionModel.default) {\n\t\t\teditorModel.defaultCustomActions.push(customActionModel);\n\t\t}\n\n\t\t// Grab the addGroup custom action in case solution groups used. If so, add solution groups as children\n\t\tif (customActionModel.eventHandlerName === 'onAddGroup') {\n\t\t\taddGroupCustomActionModel = customActionModel;\n\t\t}\n\n\t\t// If it has a parent, add it to the parent and not main array.\n\t\tif (customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD]) {\n\t\t\tlet parentId = customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD];\n\t\t\tlet childCustomActions = customActionsByParentId[location][parentId];\n\t\t\tif (childCustomActions) {\n\t\t\t\tchildCustomActions.push(customActionModel);\n\t\t\t} else\n\t\t\t\tcustomActionsByParentId[location][parentId] = [customActionModel];\n\t\t} else {\n\t\t\tcustomActionsByLocation[location].push(customActionModel);\n\t\t}\n\t}\n\t\n\tfor (let i = 0, l = customActions.length; i < l; i++) {\n\t\tlet location = customActions[i][editorModel.constants.LOCATION_FIELD];\n\t\tif (location === 'Quote/Group') {\n\t\t\taddToLocation(customActions[i], 'Quote');\n\t\t\taddToLocation(customActions[i], 'Group');\n\t\t} else if (location && location !== 'Configurator')\n\t\t\taddToLocation(customActions[i], location);\n\t}\n\n\teditorModel.customActionsByLocation = customActionsByLocation;\n\teditorModel.customActionsByLocationMobile = customActionsByLocationMobile;\n\teditorModel.groupMobileMenuButtonAction = new CustomActionModel(editorModel);\n\teditorModel.groupMobileMenuButtonAction.children = customActionsByLocationMobile.Group;\n\n\t// Setup Solution Groups\n\tif (editorModel.data.settings.solutionGroupsEnabled && editorModel.data.solutionGroups.length > 0 && addGroupCustomActionModel) {\n\t\tlet solutionGroups = editorModel.data.solutionGroups;\n\t\tlet addGroupChildren = customActionsByParentId.Quote[addGroupCustomActionModel.record.Id] || [];\n\t\taddGroupCustomActionModel.type = 'Menu';\n\t\tfor (let j = 0, sgL = solutionGroups.length; j < sgL; j++) {\n\t\t\tlet solutionGroupAction = new CustomActionModel(editorModel, solutionGroups[j]);\n\t\t\tsolutionGroupAction.type = 'Solution Group';\n\t\t\tsolutionGroupAction.eventHandlerName = 'onAddGroup';\n\t\t\tsolutionGroupAction.label = solutionGroups[j].Name;\n\t\t\taddGroupChildren.push(solutionGroupAction);\n\t\t}\n\t\taddGroupCustomActionModel.children = addGroupChildren;\n\t}\n\n};\n\nexport function getSubchange(path, target, depth) {\n\tfor (let i = 0; i < depth; i ++) {\n\t\tif (path.length <= 1 || path[1] === 'splices') {\n\t\t\treturn null;\n\t\t}\n\t\ttarget = target[path[0].startsWith('#') ? path[0].substring(1) : path[0]];\n\t\tpath = path.slice(1);\n\t}\n\treturn { path, target };\n}\n\nlet _updateCustomActions = (editorModel) => {\n\tlet loopThroughActionsByLocation = function(map) {\n\t\tfor (let location in map) {\n\t\t\tfor (let customAction of map[location]) {\n\t\t\t\tcustomAction.editorModel = editorModel;\n\t\t\t}\n\t\t}\n\t};\n\tif (editorModel.deviceContext.isMobile) {\n\t\tloopThroughActionsByLocation(editorModel.customActionsByLocationMobile);\n\t\teditorModel.groupMobileMenuButtonAction.editorModel = editorModel;\n\t} else {\n\t\tloopThroughActionsByLocation(editorModel.customActionsByLocation);\n\t}\n};","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {setDiscountValue} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport {getSubchange} from 'quotes/models/EditorModel.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {register, notify, setThenNotify} from 'quotes/models/UiNotifier.js';\n\n/**\n * GroupModel - contains the QuoteLineGroupVO and linked with the quoteModel\n *\n * Feature:\n *      1. Contains QuoteLineGroupVO which is the same as the server\n *      2. Linked with QuoteModel\n *      3. Builds the standardLines array that stores the LineModels\n *      4. Builds the dimensions array that stores the price dimensions to keep the order of dimensions on the page\n *      5. Builds the segmentedLinesByDimension object that stores the segmented LineModels by dimension\n *      6. Builds the segmentedLinesBySegmentKey object that stores the segmented LineModels by segment key\n *      (Segment key is unique to each product)\n */\nexport class GroupModel {\n\tconstructor(groupVO, quoteModel) {\n\t\tthis.groupVO = groupVO;\n\t\tthis.quoteModel = quoteModel;\n\n\t\tthis.standardLines = [];\n\t\tthis.segmentedLines = [];\n\t\tthis.dimensions = [];\n\t\tthis.dimensionsMap = {};\n\t\tthis.segmentedLinesByDimension = {}; //stores lineModels in the order the UI needs (arrays of lineModels per dimension)\n\t\tthis.segmentedLinesBySegmentKey = {}; // stores lineModels by segment key for easy reference\n\t\tthis.segmentedLineKeysBySegmentKey = {}; // stores keys by segment key for easy reference\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t\tthis.groupObjectName = this.constants.QUOTE_LINE_GROUP;\n\t\tthis.summaries = this.quoteModel.grouped ? this.groupVO.summaries : this.quoteModel.quoteVO.summaries;\n\t\tthis.multiSegmentColumnTotals = this.groupVO.multiSegmentColumnTotals ? this.groupVO.multiSegmentColumnTotals : this.quoteModel.quoteVO.multiSegmentColumnTotals;\n\t\tthis.netMultiSegmentTotal = this.groupVO.netMultiSegmentTotal ? this.groupVO.netMultiSegmentTotal : this.quoteModel.quoteVO.netMultiSegmentTotal;\n\t\tthis.hasVisibleStandardLines = false;\n\t\tthis.hasVisibleSegmentedLines = {};\n\t\tthis.standardLineFieldNames = this._setStandardLineFieldNames();\n\t\tthis.groupFieldNames = this._getFieldSetNames();\n\t\tthis._setDrawerFields();\n\n\t\tregister(this, (path) => {\n\t\t\tif (path[0] === \"lineType\"\n\t\t\t\t|| (this.lineType === this.constants.TYPE_STANDARD ? path[0] === \"standardLines\"\n\t\t\t\t\t: (path[0] === \"segmentedLinesByDimension\" && path[1] === this.lineType))) {\n\t\t\t\tnotify(this, [ \"flattenedRows\" ]);\n\t\t\t}\n\t\t});\n\t}\n\n\t// getters\n\tget editorModel() {\n\t\treturn this.quoteModel.editorModel;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\tget lineType() {\n\t\tif (!this._lineType) {\n\t\t\tthis._lineType = this.standardLines.length > 0 || this.dimensions.length === 0 ? 'Standard'\n\t\t\t\t: this.dimensions[0];\n\t\t}\n\t\treturn this._lineType;\n\t}\n\tset lineType(lt) {\n\t\tthis._lineType = lt;\n\t\tnotify(this, ['lineType']);\n\t}\n\n\tget tabs() {\n\t\tconst tabNames = this.dimensions.length === 0 ? [ ]\n\t\t\t: this.standardLines.length > 0 ? [ 'Standard' ].concat(this.dimensions)\n\t\t\t\t: this.dimensions;\n\t\treturn tabNames.map((name) => ({ name, label: this.editorModel.i18n.l(name) }))\n\t}\n\n\tget groupMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE_GROUP];\n\t}\n\n\tget standardLineColumnWidths() {\n\t\treturn this.colWidth.Standard;\n\t}\n\n\tget groupKey() {\n\t\treturn this.groupVO.key;\n\t}\n\n\t/**\n\t * Adds to the appropriate array depending on type (standard vs segmented)\n\t * Will also populate the lineModelsByKey object in QuoteModel\n\t *\n\t * @param lineModel\n\t * @param lineToAdd\n\t */\n\n\tprocessQuoteLines(lineVO) {\n\t\tlet lineModel = new LineModel(lineVO, this);\n\t\tthis.quoteModel.lineModelsByKey[lineModel.lineVO.key] = lineModel;\n\n\t\tif (!lineModel.segmented)\n\t\t\tthis._addStandardLine(lineModel);\n\t\telse\n\t\t\tthis._addSegmentedLine(lineModel);\n\n\t\tif (lineModel.lineVO.parentItemKey && (!lineModel.segmented || (lineModel.segmented && lineModel.segments))) {\n\t\t\tthis.addToLinesByParentItemKey(lineModel);\n\t\t}\n\t}\n\n\t/**\n\t *  Add the lineModel to the Standard Line list\n\t *\n\t * @param lineModel\n\t * @private\n\t */\n\t_addStandardLine(lineModel) {\n\t\tif (lineModel.visible) {\n\t\t\tthis.hasVisibleStandardLines = true;\n\t\t}\n\t\tthis.quoteModel.indexByGroupKey[lineModel.lineVO.parentGroupKey].indexByLineKey[lineModel.lineVO.key] = this.standardLines.length;\n\t\tthis.standardLines.push(lineModel);\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped)\n\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t}\n\n\n\t/**\n\t * Each segment of a segmented product is represented as a separate lineVO and eventually lineModel.\n\t * We create a lineModel to represent the summary line item on the segmented products table off of the 1st segment.\n\t * And all segments are added to the segments array of their parent lineModel (summary line item).\n\t *\n\t * Creates a segments array for the lineModel, and either adds the lineModel to the appropriate dimension or\n\t * adds the lineModel to the segments array of its parent summary.\n\t * @param lineModel\n\t * @private\n\t */\n\t_addSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.quoteVO.multiSegmentKeys) ? this.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\n\t\tif (this.segmentedLinesBySegmentKey[segmentKey]) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = this.segmentedLinesBySegmentKey[segmentKey].segments.length;\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tlineModel.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segments.push(lineModel);\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segmentsByLabel[segmentLabel] = lineModel;\n\t\t} else {\n\t\t\tif (lineModel.visible && !this.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tthis.hasVisibleSegmentedLines[dimension] = true;\n\t\t\t}\n\t\t\tlet firstSegment = new LineModel(lineVO, this);\n\t\t\tthis.setDimensionProperties(dimension);\n\t\t\tlineModel.addToSegmentsArray(firstSegment); // create list of lineModels per segments (in order)\n\t\t\tlineModel.addToSegmentsByLabel(segmentLabel, lineModel); // create map of lineModels by segment label for easy access\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = lineModel.segments.length - 1;\n\t\t\tfirstSegment.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLines.push(lineModel);\n\t\t\tif ( dimension ) {\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = this.segmentedLinesByDimension[dimension].length;\n\t\t\t\tthis.segmentedLinesByDimension[dimension].push(lineModel);\n\t\t\t\tthis.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\t\t\tlineModel.dimensionType = dimension;\n\t\t\t}\n\t\t}\n\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped)\n\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t}\n\n\tremoveDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (this.segmentedLinesByDimension[dim] && this.segmentedLinesByDimension[dim].length === 0) {\n\t\t\tdelete this.segmentedLinesByDimension[dim];\n\t\t\tif (this.dimensionsMap[dim]) {\n\t\t\t\tdelete this.dimensionsMap[dim];\n\t\t\t}\n\t\t\tthis.dimensions.splice(this.dimensions.indexOf(dim), 1);\n\t\t}\n\t}\n\n\tsetDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (!this.dimensionsMap[dim]) {\n\t\t\tthis.dimensionsMap[dim] = true;\n\t\t\tthis.dimensions.push(dim);\n\t\t}\n\t\tif (!this.segmentedLinesByDimension[dim]) {\n\t\t\tthis.segmentedLinesByDimension[dim] = [];\n\t\t}\n\t}\n\n\t/**\n\t * Adds lineModels into linesByParentItemKey map on the quoteModel\n\t * @param lineModel\n\t */\n\taddToLinesByParentItemKey(lineModel) {\n\t\tlet map = this.quoteModel.linesByParentItemKey,\n\t\t\tstdMap = this.quoteModel.standardLinesByParentItemKey,\n\t\t\tmdqMap = this.quoteModel.segmentedLinesByParentItemKey,\n\t\t\tparentItemKey = lineModel.lineVO.parentItemKey;\n\t\tif (parentItemKey) {\n\t\t\tif (!map[parentItemKey]) {\n\t\t\t\tmap[parentItemKey] = [];\n\t\t\t}\n\t\t\tmap[parentItemKey].push(lineModel);\n\t\t\tif (!lineModel.segmented) {\n\t\t\t\tif (!stdMap[parentItemKey]) {\n\t\t\t\t\tstdMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tstdMap[parentItemKey].push(lineModel);\n\t\t\t} else {\n\t\t\t\tif (!mdqMap[parentItemKey]) {\n\t\t\t\t\tmdqMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tmdqMap[parentItemKey].push(lineModel);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a clone of the passed in standard lineModel\n\t * @param line - lineModel\n\t * @returns {lineModel} - cloned lineModel\n\t */\n\tcloneLine(line, parentItemKey, groupSelected) {\n\t\tlet newLineVO = JSON.parse(JSON.stringify(line.lineVO));\n\t\tnewLineVO.record = JSON.parse(JSON.stringify(line.lineVO.record));\n\t\tlet groupModel = groupSelected ? groupSelected : line.groupModel;\n\t\tlet clone = new LineModel(newLineVO, groupModel);\n\t\tclone.lineVO.parentItemKey = parentItemKey ? parentItemKey : null; // Update clone's parentItemKey to create the new bundle-component linkage\n\t\tif (clone.segmented && !line.segmentedLineKey) {\n\t\t\tclone.segments = [];\n\t\t\tclone.segmentsByLabel = {};\n\t\t}\n\n\t\tif(this._hasCards(line)){\n\t\t\tthis._cloneCards(line,clone);\n\t\t}\n\n\t\tclone.lineVO.record.Id = null; // Record Id needs to be removed to avoid upsert duplication error\n\t\t// Avoid original cloned bundle quote line RequiredBy__c field being referenced after it had been deleted\n\t\tclone.lineVO.record[this.constants.REQUIRED_BY_FIELD] = null;\n\t\t// Add original quote line as the source in the cloned quote line\n\t\tclone.lineVO.record[this.constants.SOURCE_FIELD] = line.lineVO.record['Id'];\n\t\t// If line is being cloned from amend on contract\n\t\tif (line.editorModel.quoteModel.quoteVO.record[this.constants.TYPE_FIELD] === 'Amendment') {\n\t\t\tclone.lineVO.record[this.constants.EXISTING_FIELD] = false;\n\t\t\tclone.lineVO.record[this.constants.RENEWAL_CHECKBOX] = false;\n\t\t\tclone.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.UPGRADED_SUBSCRIPTION_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.NET_TOTAL_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] = null;\n\t\t}\n\t\tclone.lineVO.key = ++clone.editorModel.quoteModel.quoteVO.nextKey;\n\t\tif (groupSelected) {\n\t\t\tclone.lineVO.parentGroupKey = groupSelected.groupKey;\n\t\t}\n\t\tthis._updateColWidths(line);\n\t\treturn clone;\n\t}\n\tnumberOfRateCards(line){\n\t\tlet cards = line.getRateCards();\n\t\tif(cards){\n\t\t\treturn cards.length;\n\t\t}\n\t\treturn 0;\n\t}\n\n\n\t_hasCards(line){\n\t\treturn line.getRateCards() && line.getRateCards().length !=0;\n\t}\n\n\t_cloneCards(line, clone){\n\t\tlet oldCards = line.getRateCards();\n\t\tlet newCards = JSON.parse(JSON.stringify(oldCards));\n\t\tlet prefix = this.editorModel.data.developerPrefix;\n\n\t\tlet originalRateCard = prefix + 'OriginalUsageRateCard__c';\n\t\tlet rateProperty = prefix + 'UsageRates__r';\n\n\n\t\tfor (let l = 0; l < newCards.length; l++){\n\t\t\t// If the original rate card had an ID (i.e. had already been saved), then we should clear out the ID on the clone,\n\t\t\t// and set the clone's OriginalRateCard__c field to the original's ID.\n\t\t\tif (newCards[l].Id) {\n\t\t\t\tnewCards[l][originalRateCard] = newCards[l].Id;\n\t\t\t\tnewCards[l].Id = null;\n\t\t\t}\n\t\t\t// If the card has Rates, their IDs must be cleared out as well.\n\t\t\tif (newCards[l][rateProperty]){\n\t\t\t\tlet rates = newCards[l][rateProperty].records;\n\t\t\t\tfor (let k = 0; k < rates.length; k++){\n\t\t\t\t\trates[k].Id= null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tclone.setCards(newCards);\n\t}\n\n\t/**\n\t * Creates a clone of the passed in segmented lineModel including cloned segments\n\t * @param line - original segmented summary lineModel\n\t * @param parentItemKey - key of the parent lineModel if this lineModel is a component\n\t * @returns {lineModel} - returns cloned summary segmented lineModel with its cloned segment\n\t */\n\tcloneSegmentedLine(line, parentItemKey, groupSelected) {\n\t\tlet clone = this.cloneLine(line, parentItemKey, groupSelected);\n\n\t\t// Replacing segment key as datetime with a random hash string, to prevent overlap of values\n\t\t//  which causes segments and lines to disappear.\n\t\tlet segmentKey = Math.random().toString(36).substr(2, 9);\n        clone.lineVO.record[this.constants.SEGMENT_KEY_FIELD] = segmentKey;\n\t\tlet cloneSegmentKey = clone.lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tlet lineSegmentKey = line.lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tlet multiSegmentRowTotals = this.quoteModel.quoteVO.multiSegmentRowTotals;\n\t\tif (multiSegmentRowTotals) {\n\t\t\tmultiSegmentRowTotals[cloneSegmentKey] = multiSegmentRowTotals[lineSegmentKey]; // There is a bug where multiSegmentedRowTotals aren't reproduced in new groups.\n\t\t}\n\n\t\tthis.segmentedLinesBySegmentKey[cloneSegmentKey] = clone;\n\t\tthis.quoteVO.multiSegmentKeys[cloneSegmentKey] = clone.lineVO.dimensionType; //TODO: Make sure this works with one-time segments as dimensionType is \"one-time\" instead of \"Year\", \"Quarter\", etc.\n\n\t\tfor (let i = 0, l = line.segments.length; i < l; i++) {\n\t\t\tlet clonedSegment = this.cloneLine(line.segments[i], null, groupSelected);\n\t\t\tclonedSegment.lineVO.record[this.constants.SEGMENT_KEY_FIELD] = cloneSegmentKey; // This needs to match its parent summary's segment key\n\t\t\tclonedSegment.lineVO.parentItemKey = clone.lineVO.parentItemKey; // Segments have the same parentItemKeys as its parent summary line, if it's bundled\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tclonedSegment.segmentedLineKey = clone.lineVO.key;\n\t\t\tif (clone.segments) {\n\t\t\t\tclone.segments.push(clonedSegment);\n\t\t\t}\n\t\t\tif (clone.segmentsByLabel) {\n\t\t\t\tlet label = clonedSegment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\t\tclone.segmentsByLabel[label] = clonedSegment;\n\t\t\t}\n\t\t}\n\t\tclone.dimensionType = line.dimensionType;\n\t\tlet dimension = clone.dimensionType;\n\t\tif (!this.segmentedLinesByDimension[dimension])\n\t\t\tthis.setDimensionProperties(dimension);\n\n\t\t// this data is only needed for clone to group, which is only enabled on a group quote\n\t\tif (this.quoteModel.grouped) {\n\t\t\tthis._updateColWidths(line, dimension);\n\t\t\tthis.groupVO.multiSegmentColumns[dimension] = line.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\t\tthis.groupVO.localizedMultiSegmentColumns[dimension] = line.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t}\n\n\t\treturn clone;\n\t}\n\n\t_updateColWidths(line, dimension) {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.colWidth) {\n\t\t\tthis.colWidth = {};\n\t\t}\n\t\t// Update the receiving groups colWidths object to handle MDQ dimensions if a certain dimension does not already exist\n\t\tif (!this.colWidth[dimension]) {\n\t\t\tthis.colWidth[dimension] = line.groupModel.colWidth[dimension];\n\t\t}\n\n\t\t// Update the receiving groups colWidths object to handle layout if Standard object does not already exist\n\t\tif (!this.colWidth.Standard) {\n\t\t\tthis.colWidth.Standard = line.groupModel.colWidth.Standard;\n\t\t}\n\t}\n\n\t_groupHasStandardProducts() {\n\t\tthis.hasVisibleStandardLines = false;\n\t\tfor (let j = 0, l = this.standardLines.length; j < l; j ++) {\n\t\t\tif (this.standardLines[j].visible) {\n\t\t\t\tthis.hasVisibleStandardLines = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this.hasVisibleStandardLines;\n\t}\n\n\t_groupHasSegmentedProducts() {\n\t\tlet dimensions = Object.keys(this.hasVisibleSegmentedLines);\n\t\tlet result = false;\n\t\tfor (let s in this.segmentedLinesByDimension) {\n\t\t\tthis.hasVisibleSegmentedLines[s] = false;\n\t\t\tfor(let k = 0, l = this.segmentedLinesByDimension[s].length; k < l; k ++ ){\n\t\t\t\tif (this.segmentedLinesByDimension[s][k].visible) {\n\t\t\t\t\tthis.hasVisibleSegmentedLines[s] = true;\n\t\t\t\t\tresult = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateStandardSubscriptionScopeEditable(removedLine) {\n\t\tfor (let j = 0, l = this.standardLines.length; j < l; j ++) {\n\t\t\tif (this.standardLines[j].visible && this.standardLines[j].subscriptionScopeEditable && this.standardLines[j] !== removedLine) {    //ignore the removed line\n\t\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateSegmentedSubscriptionScopeEditable(removedLine) {\n\t\tfor (let j = 0, l = this.segmentedLines.length; j < l; j ++) {\n\t\t\tif (this.segmentedLines[j].visible && this.segmentedLines[j].subscriptionScopeEditable && this.segmentedLines[j] !== removedLine) {     //ignore the removed line\n\t\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t}\n\n\tget serviceModel() {\n\t\treturn {\n\t\t\tkeys: [this.groupKey],\n\t\t\tfavIds: [this.groupVO.record[this.constants.FAVORITE_ID_FIELD]]\n\t\t}\n\t}\n\n\t/**\n\t * Recreates the indexByGroupKey after a front end operation that changes the index of line items\n\t */\n\trenumberStandardIndexes() {\n\t\tfor (let i = 0, l = this.standardLines.length; i < l; i++) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[this.standardLines[i].lineVO.key] = i;\n\t\t}\n\t}\n\n\trenumberSegmentedIndexes() {\n\t\tfor (let j = 0, d = this.dimensions.length; j < d; j++) {\n\t\t\tlet dimension = this.dimensions[j];\n\t\t\tlet lineItems = this.segmentedLinesByDimension[dimension];\n\t\t\tfor (let k = 0; k < lineItems.length; k++) {\n\t\t\t\tvar segmentKey = lineItems[k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = k;\n\t\t\t\tlet segments = lineItems[k].segments;\n\t\t\t\tfor (let m = 0, len = segments.length; m < len; m ++) {\n\t\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[segments[m].lineVO.key] = m;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Specifies whether this group can be deleted\n\t * @returns {boolean} - Whether the group can be deleted\n\t */\n\tcanDelete() {\n\t\tconst canDeleteLines = (lines) => lines.every((line) => !line.existing);\n\t\treturn canDeleteLines(this.standardLines) && canDeleteLines(this.segmentedLines);\n\t}\n\n\tget flattenedRows() {\n\t\tconst rowType = this.lineType === this.constants.TYPE_STANDARD ? this.constants.STANDARD_LINE\n\t\t\t: this.constants.SEGMENTED_LINE;\n\t\tconst lines = rowType === this.constants.STANDARD_LINE ? this.standardLines\n\t\t\t: this.segmentedLinesByDimension[this.lineType];\n\t\treturn [\n\t\t\t{ rowType: this.constants.GROUP_HEADER, model: this },\n\t\t\t...lines.map((model) => ({ rowType, model })),\n\t\t\t{ rowType: this.constants.GROUP_FOOTER, model: this }\n\t\t];\n\t}\n\n\t_setStandardLineFieldNames() {\n\t\tlet fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis.fieldSet = fieldSetHandler.getByViewport(PageContainer.getViewport());\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\treturn this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.standardSubscriptionScopeEditable ? [this.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t_setDrawerFields() {\n\t\tlet drawerFields = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,\n\t\t\tisMobile = this.editorModel.deviceContext.isMobile;\n\n\t\tif (drawerFields && !isMobile) {\n\t\t\tthis.standardLineDrawerFieldNames = drawerFields;\n\t\t} else if (drawerFields && isMobile) {\n\t\t\t// if there are fields in the line item drawer field set and we're in mobile, append the fields to the field set used\n\t\t\tthis.standardLineFieldNames = this.standardLineFieldNames.concat(drawerFields);\n\t\t}\n\t}\n\n\ttoggleOptional(optional) {\n\t\tthis._callChildren((model) => {\n\t\t\tsetThenNotify(model, ['lineVO', 'record', this.constants.OPTIONAL_FIELD], optional)\n\t\t});\n\t}\n\n\tnotifyUi(path) {\n\t\tconst subchange = path[0] === 'segmentedLinesByDimension' ? getSubchange(path, this, 3)\n\t\t\t: path[0] === 'standardLines' ? getSubchange(path, this, 2) : null;\n\t\tif (subchange !== null) {\n\t\t\tnotify(subchange.target, subchange.path);\n\t\t} else {\n\t\t\tnotify(this, path);\n\t\t}\n\t}\n\n\t/**\n\t * Filters out Description and Name field from QuoteLineGroup fieldset\n\t * Used to render all of QuoteLineGroup fields in the QuoteLineGroup fieldset\n\t */\n\t_getFieldSetNames() {\n\t\tlet groupFieldNames = this.editorModel.fieldsetMap.groupFieldNames.slice();\n\t\t// Name and Description fields are handled else where\n\t\tfor (let i = 0, l = groupFieldNames.length; i < l; i++) {\n\t\t\tif (!this.isMobile && (this.constants.DESCRIPTION_FIELD == groupFieldNames[i] ||  'Name' == groupFieldNames[i])) {\n\t\t\t\tgroupFieldNames.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn groupFieldNames;\n\t}\n\n\t/**\n\t * QuoteLineGroup field metadata\n\t * @param fieldName\n\t * @returns {*}\n\t */\n\tgetFieldMD(fieldName) {\n\t\treturn this.groupMD[fieldName];\n\t}\n\n\ttoggleSelected(selected) {\n\t\tthis._callChildren((model) => {\n\t\t\tsetThenNotify(model, ['selected'], selected)\n\t\t});\n\t}\n\n\tresetDiscounts() {\n\t\tthis._callChildren((model) => {\n\t\t\tsetDiscountValue(model, this.constants.ADDITIONAL_DISCOUNT_FIELD, null)\n\t\t});\n\t}\n\n\t_callChildren(callback) {\n\t\tthis.standardLines.forEach(callback);\n\t\tthis.dimensions.forEach((dimension) => {\n\t\t\tthis.segmentedLinesByDimension[dimension].forEach((line) => {\n\t\t\t\tline.segments.forEach(callback);\n\t\t\t});\n\t\t});\n\t}\n}\n","/**\n * JSQCNotifier class - Sends out notifyPaths each time a property on QuoteModel, QuoteLineGroupModel, or QuoteLineModel change\n *\n * Used to make polymer components aware of sub-property changes during JSQC calculate\n */\nexport class JSQCNotifier {\n\tconstructor(lineEditorComponent) {\n\t\tthis.lineEditorComponent = lineEditorComponent;\n\t\tthis.editorModel = this.lineEditorComponent.editorModel;\n\t\tthis.indexByGroupKey = this.editorModel.quoteModel.indexByGroupKey;\n\t\tthis.fieldNameSet = this.lineEditorComponent.editorModel.fieldNameSet;\n\t\tthis.propertyNameSet = new Set();\n\t\tthis.propertyNameSet.add('multiSegmentRowTotals');\n\t\tthis.propertyNameSet.add('multiSegmentColumnTotals');\n\t\tthis.propertyNameSet.add('netMultiSegmentTotal');\n\t\tthis.propertyNameSet.add('summaries');\n\t\tthis.propertyNameSet.add('fieldVisibility');\n\t\tthis.propertyNameSet.add('fieldEditability');\n\t\tthis.pathNameSet = new Set(this.fieldNameSet);\n\t\tfor (var elem of this.propertyNameSet) {\n\t\t\tif (!this.pathNameSet.has(elem)) {\n\t\t\t\tthis.pathNameSet.add(elem);\n\t\t\t}\n\t\t}\n\t\tthis.constants = this.editorModel.constants;\n\t\tthis.pathsToNotify = {};\n\t\tthis.originalPathValues = {};\n\t\tthis.pathsToSet = {};\n\n\t\tthis.groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tthis.quoteVO = this.editorModel.quoteModel.quoteVO;\n\t}\n\n\t/**\n\t * notifies the correct path based on which sub-property was changed and what object it came from in the JSQC\n\t *\n\t * @param root\n\t * @param path\n\t * @param value\n\t * @param modelVO\n\t *\n\t */\n\tnotify(root, path, value, modelVO, previous) {\n\t\tlet groupIndex;\n\t\tlet lineIndex;\n\n\t\t// Only notifies paths for fields on the quote, quote line group, or quote line field sets\n\t\t// Currently manually adding fields to set from VO's that are related to rendered fields\n\t\tif (!this.pathNameSet.has(path.split('.').pop())) {\n\t\t\treturn;\n\t\t}\n\t\tif (root == 'QuoteModel') {\n\t\t\t// Notify QuoteVO and record level fields\n\t\t\tthis.notifyPath(`editorModel.quoteModel.quoteVO.${path}`, value, previous, root);\n\t\t\t// Used to update the total column for MDQ products\n\t\t\tif (path == 'multiSegmentRowTotals') {\n\t\t\t\tif (!value)\n\t\t\t\t\treturn;\n\n\t\t\t\tfor (let i = 0, l = this.groupModels.length; i < l; i++) {\n\t\t\t\t\tlet dimensions = this.groupModels[i].dimensions;\n\t\t\t\t\tfor (let j = 0, length = dimensions.length; j < length; j ++) {\n\t\t\t\t\t\tfor (let k = 0, len = this.groupModels[i].segmentedLinesByDimension[dimensions[j]].length; k < len; k++) {\n\t\t\t\t\t\t\tlet segmentKey = this.groupModels[i].segmentedLinesByDimension[dimensions[j]][k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\t\t\t\t// TODO Use localized value for total\n\t\t\t\t\t\t\tthis.notifyPath(`groupModels.${i}.segmentedLinesByDimension.${dimensions[j]}.${k}.total`, value[segmentKey], previous, root);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (modelVO.grouped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet groupIndex = this.indexByGroupKey[this.groupModels[0].groupVO.key].index;\n\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t// Notify GroupVO and record level fields\n\t\t} else if (root == 'QuoteLineGroupModel') {\n\t\t\tif ( this.indexByGroupKey[modelVO.key] != null && this.indexByGroupKey[modelVO.key].index != null ) {\n\t\t\t\tgroupIndex = this.indexByGroupKey[modelVO.key].index;\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.groupVO.${path}`, value, previous, root);\n\t\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t\t}\n\t\t// Notify LineVO and record level fields\n\t\t} else if (root == 'QuoteLineModel') {\n\t\t\tgroupIndex = this.indexByGroupKey[modelVO.parentGroupKey].index;\n\t\t\tlineIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexByLineKey[modelVO.key];\n\t\t\t// Used to update the horizontal MDQ row that displays net total of each segment for a single product\n\t\t\tif (modelVO.record[this.constants.SEGMENT_KEY_FIELD]) {\n\t\t\t\tvar dimensionType = modelVO.parentQuote.multiSegmentKeys[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tlet segmentIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexBySegmentKey[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.segments.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t\tif (path == 'record.' + [this.constants.NET_TOTAL_FIELD]) {\n\t\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.` + modelVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, ''), value, previous, root);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// StandardLines notification\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.standardLines.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Used to update the subtotal row that sums all the net totals at the bottom of MDQ section\n\t * Also updates summary lines\n\t * These paths have to match properties set on the polymer group component to work\n\t * @param element\n\t * @param path\n\t * @param modelVO\n\t * @param value\n\t */\n\tnotifySpecificPath(groupIndex, path, modelVO, value, previous, root) {\n\t\tif (path != 'multiSegmentColumnTotals' && path != 'netMultiSegmentTotal' && path != 'summaries') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (path == 'summaries') {\n\t\t\tthis.set(`groupModels.${groupIndex}.summaries`, value, previous, root);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!value)\n\t\t\treturn;\n\n\t\tvar dimensions = modelVO.localizedMultiSegmentColumns ? Object.keys(modelVO.localizedMultiSegmentColumns) : Object.keys(modelVO.multiSegmentColumnTotals);\n\n\t\t// Updates segmented lines sub totals\n\t\tfor (let i = 0, dimensionsLength = dimensions.length; i < dimensionsLength; i++) {\n\t\t\tlet columns = (path == 'netMultiSegmentTotal') ? modelVO.netMultiSegmentTotal[dimensions[i]] : modelVO.multiSegmentColumnTotals[dimensions[i]];\n\t\t\tif (path == 'netMultiSegmentTotal') {\n\t\t\t\tthis.set(`groupModels.${groupIndex}.netMultiSegmentTotal.${dimensions[i]}`, value[dimensions[i]], previous, root);\n\t\t\t} else {\n\t\t\t\tlet columnKeys = Object.keys(columns);\n\t\t\t\tfor (let j = 0, columnsLength = columnKeys.length; j < columnsLength; j++) {\n\t\t\t\t\tthis.set(`groupModels.${groupIndex}.multiSegmentColumnTotals.${dimensions[i]}.${columnKeys[j]}`, value[dimensions[i]][columnKeys[j]], previous, root);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Collects map of paths and values to notify after calculate is complete\n\t * @param path\n\t * @param value\n\t */\n\tnotifyPath(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToNotify[path] = { value : value, root : root };\n\t}\n\n\tset(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToSet[path] = { value : value, root : root };\n\t}\n}\n","export class LineModel {\n\tconstructor(lineVO, groupModel) {\n\t\tthis.lineVO = lineVO;\n\t\tthis.groupModel = groupModel;\n\t\tthis.selected = false;\n\t\tthis.lineItemDrawerIconClass = this._getLineItemDrawerIconClass();\n\t\tthis.expandedIconClass = this._getExpansionClass();\n\t\tthis.visible = this.isVisibleInLineEditor();\n\t\tthis.hasParent = this.hasParentLine();\n\t\tthis.setItemClassMap();\n\n\t\t// Default pricing method\n\t\tif (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == null) {\n\t\t\tthis.lineVO.record[this.constants.PRICING_METHOD_FIELD] = 'List';\n\t\t}\n\t}\n\n\tget editorModel() {\n\t\treturn this.quoteModel.editorModel;\n\t}\n\n\tget quoteModel() {\n\t\treturn this.groupModel.quoteModel;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget fieldNames() {\n\t\treturn this.constants;\n\t}\n\n\tget component() {\n\t\treturn (this.lineVO.record[this.constants.OPTION_LEVEL_FIELD] != null);\n\t}\n\n\tget subscription() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] != null);\n\t}\n\n\tget isMDQ() {\n\t\treturn (this.lineVO.record[this.constants.SEGMENT_LABEL_FIELD] != null);\n\t}\n\n\tget dynamicSubscription() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total');\n\t}\n\n\tget dynamic() {\n\t\treturn (this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total' || this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Percent Of Total');\n\t}\n\n\tget isBundle() {\n\t\t// A Quote line is a bundle line only if it has components underneath it in the quote\n\t\t// The bundle field on the quote line is not marked consistently therefore we are also checking whether the line key exists in the lineByParentItemKey map.\n\t\treturn this.bundle && this.quoteModel.linesByParentItemKey[this.lineVO.key];\n\t}\n\n\tget subscriptionScopeEditable() {\n\t\treturn this.dynamic && (this.lineVO.record[this.constants.COMPONENT_SUBSCRIPTION_SCOPE_FIELD] == null) && (this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] == null);\n\t}\n\n\tget rootPackage() {\n\t\treturn (this.bundle || (this.lineVO.productPullIns && (this.lineVO.productPullIns.hasConfiguration || this.lineVO.productPullIns.hasConfigurationAttributes))) && !this.component;\n\t}\n\n\tget legacySupport() {\n\t\treturn (!(this.lineVO.record[this.constants.RENEWAL_CHECKBOX] == true && this.lineVO.record[this.constants.EXISTING_FIELD] != true && this.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD] == null)) || this.editorModel.data.settings.renewalQuotesWithoutAssetsAllowed;\n\t}\n\n\tget quantityEditable() {\n\t\treturn ((this.lineVO.record[this.constants.BUNDLED_QUANTITY_FIELD] == null) || !this.component) && this.legacySupport && (this.lineVO.productQuantityEditable) || (this.lineVO.quantityEditable == true);\n\t}\n\n\tget costEditable() {\n\t\treturn (this.lineVO.record[this.constants.COST_EDITABLE_FIELD] == true);\n\t}\n\n\tget unitCostEditable() {\n\t\treturn this.costEditable && !this.bundled && !this.dynamic;\n\t}\n\n\tget pricingMethodList() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'List');\n\t}\n\n\tget pricingMethodCustom() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Custom');\n\t}\n\n\tget pricingMethodCost() {\n\t\treturn (this.lineVO.record[this.constants.PRICING_METHOD_FIELD] == 'Cost');\n\t}\n\n\tget pricingMethodDisabled() {\n\t\treturn this.dynamicSubscription || this.bundled || !(this.lineVO.record[this.constants.PRICING_METHOD_EDITABLE_FIELD]);\n\t}\n\n\tget bundled() {\n\t\treturn (this.lineVO.record[this.constants.BUNDLED_FIELD] == true);\n\t}\n\n\tget bundle() {\n\t\treturn (this.lineVO.record[this.constants.BUNDLE_FIELD] == true);\n\t}\n\n\tget nonDiscountable() {\n\t\treturn (this.lineVO.record[this.constants.NON_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\tget nonPartnerDiscountable() {\n\t\treturn (this.lineVO.record[this.constants.NON_PARTNER_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\tget partnerDiscountEditable() {\n\t\treturn this.quoteModel.isAmendmentOrChangeQuote || this.existing;\n\t}\n\n\tget componentDiscountedByPackage() {\n\t\treturn (this.lineVO.record[this.constants.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD] == true);\n\t}\n\n\tget discountable() {\n\t\treturn !this.bundled && !this.nonDiscountable && !this.pricingMethodCustom && !this.componentDiscountedByPackage;\n\t}\n\n\tget discountEditable() {\n\t\treturn !this.quoteModel.isAmendmentOrChangeQuote || !this.existing;\n\t}\n\n\tget removable() {\n\t\treturn !this.component && (!this.quoteModel.isAmendment || (this.quoteModel.isAmendment && !this.existing));\n\t}\n\n\tget configurable() {\n\t\treturn this.rootPackage && !this.lineVO.reconfigurationDisabled && (this.lineVO.configurationType != 'Disabled') && ((this.lineVO.configurationEvent == null) || (this.lineVO.configurationEvent == 'Always') || (this.lineVO.configurationEvent == 'Edit'));\n\t}\n\n\tget listPriceEditable() {\n\t\treturn this.lineVO.record[this.constants.PRICE_EDITABLE_FIELD] && !this.bundled && !this.dynamicSubscription && this.pricingMethodList;\n\t}\n\n\tget segmented() {\n\t\treturn (this.lineVO.record[this.constants.SEGMENT_KEY_FIELD] != null);\n\t}\n\n\tget favorite() {\n\t\treturn (!this.component && (this.lineVO.record[this.constants.FAVORITE_ID_FIELD] != null));\n\t}\n\n\tget existing() {\n\t\treturn this.lineVO.record[this.constants.EXISTING_FIELD];\n\t}\n\n\tget descriptionLocked() {\n\t\treturn this.lineVO.descriptionLocked;\n\t}\n\n\tget hasStandardLineItemDrawer() {\n\t\treturn this._hasStandardLineItemDrawer();\n\t}\n\n\tget asset() {\n\t\treturn (this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] != null);\n\t}\n\n\tget renewal() {\n\t\treturn this.lineVO.record[this.constants.RENEWAL_CHECKBOX];\n\t}\n\n\tget hasSubscribedAssetIds() {\n\t\treturn this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] != null;\n\t}\n\n\tget isAsset() {\n\t\treturn this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] != null;\n\t}\n\n\tget isDeltaQty() {\n\t\treturn !this.existing || this.existing && !this.renewal && (this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] || this.asset);\n\t}\n\n\tget standardLineFieldNames() {\n\t\treturn this.groupModel.standardLineFieldNames;\n\t}\n\n\tget standardLineDrawerFieldNames() {\n\t\treturn this.groupModel.standardLineDrawerFieldNames;\n\t}\n\n\tget standardLineColumnWidths() {\n\t\treturn this.editorModel.layout.colWidths[this.groupModel.groupKey]['Standard'];\n\t}\n\n\tisDiscountScheduleIdExcluded(discountScheduleId) {\n\t\treturn this.editorModel.data.excludedDiscountScheduleIds.hasOwnProperty(discountScheduleId);\n\t}\n\n\tgetFieldMD(fieldName) {\n\t\treturn this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName][fieldName];\n\t}\n\n\tgetField(fieldName) {\n\t\treturn this.lineVO.record[fieldName];\n\t}\n\n\t_getExpansionClass() {\n\t\tif (!this.segmented) {\n\t\t\treturn '';\n\t\t}\n\t\treturn this.lineVO.expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t}\n\n\t_hasStandardLineItemDrawer() {\n\t\treturn this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames && this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0\n\t\t\t&& !this.editorModel.deviceContext.isMobile && !this.segmented;\n\t}\n\n\t_getLineItemDrawerIconClass() {\n\t\tif (this.segmented || !this.hasStandardLineItemDrawer) {\n\t\t\treturn '';\n\t\t}\n\t\treturn this.lineVO.expanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright';\n\t}\n\n\tisEditable(fieldName) {\n\t\tlet field = this.getFieldMD(fieldName);\n\n\t\tif (!field) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.lineVO.fieldEditability && this.lineVO.fieldEditability[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn this.lineVO.fieldEditability[fieldName];\n\t\t}\n\n\t\tif(field.extraTypeInfo === 'richtextarea' && this.editorModel.deviceContext.isMobile) {\n\t\t\treturn false; // Mobile RT Fields should be non editable\n\t\t}\n\n\t\tif (field.name == this.constants.QUANTITY_FIELD || field.name == this.constants.ADDITIONAL_QUANTITY_FIELD) {\n\t\t\treturn field.updateable && this.quantityEditable;\n\t\t} else if (field.name == this.constants.LIST_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.listPriceEditable;\n\t\t} else if (field.name == this.constants.ADDITIONAL_DISCOUNT_FIELD) {\n\t\t\treturn this.discountable && this.discountEditable;\n\t\t} else if (field.name == this.constants.PARTNER_DISCOUNT_FIELD) {\n\t\t\treturn !this.nonPartnerDiscountable && !this.partnerDiscountEditable;\n\t\t} else if (field.name == this.constants.DISTRIBUTOR_DISCOUNT_FIELD) {\n\t\t\treturn this.discountEditable;\n\t\t} else if (field.name == this.constants.UPLIFT_FIELD) {\n\t\t\treturn field.updateable && this.lineVO.upliftable;\n\t\t} else if (field.name == this.constants.UNIT_COST_FIELD) {\n\t\t\treturn field.updateable && this.unitCostEditable;\n\t\t} else if (field.name == this.constants.CUSTOMER_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.pricingMethodCustom;\n\t\t} else if (field.name == this.constants.PRICING_METHOD_FIELD) {\n\t\t\treturn field.updateable && !this.pricingMethodDisabled;\n\t\t} else if (field.name == this.constants.MARKUP_FIELD) {\n\t\t\treturn !this.bundled && this.pricingMethodCost && this.discountEditable;\n\t\t} else if (field.name == this.constants.NET_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.PARTNER_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.DESCRIPTION_FIELD) {\n\t\t\treturn !this.descriptionLocked;\n\t\t} else if (field.name == this.constants.PACKAGE_PRODUCT_CODE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.PRORATED_LIST_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.REGULAR_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.constants.START_DATE_FIELD || field.name == this.constants.END_DATE_FIELD) {\n\t\t\treturn this.subscription && !this.isMDQ; // only editable for non-MDQ product\n\t\t} else if (field.name === this.constants.SUBSCRIPTION_SCOPE_FIELD) {\n\t\t\treturn field.updateable && this.subscriptionScopeEditable;\n\t\t}\n\n\t\treturn !!field && field.updateable;\n\t}\n\n\tisFieldRendered(fieldName, isMobile) {\n\t\tif (this.lineVO.fieldVisibility && this.lineVO.fieldVisibility[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn this.lineVO.fieldVisibility[fieldName];\n\t\t}\n\n\t\tlet field = this.getFieldMD(fieldName);\n\t\tif (field && field.name == this.constants.SUBSCRIPTION_TERM_FIELD) {\n\t\t\treturn this.subscription;\n\t\t} else if (field && field.extraTypeInfo === 'richtextarea') {\n\t\t\treturn !isMobile || (this.lineVO.record[fieldName] && isMobile);\n\t\t}\n\t\treturn true;\n\t}\n\n\tget serviceModel() {\n\t\tlet keys = [];\n\t\t// Only MDQ Summary Lines have a segments array. Standard Lines' segments property is undefined\n\t\tif (this.segments) {\n\t\t\tfor (let i = 0, segmentsLength = this.segments.length; i < segmentsLength; i++)\n\t\t\t\tkeys.push(this.segments[i].lineVO.key);\n\t\t} else \n\t\t\tkeys.push(this.lineVO.key)\n\t\t\t\n\t\treturn {\n\t\t\tkeys: keys,\n\t\t\tsegmentKey: this.getField(this.constants.SEGMENT_KEY_FIELD),\n\t\t\tsegmented: this.segmented,\n\t\t\tupdateCustomSegments: false,\n\t\t\tfavIds: [this.getField(this.constants.FAVORITE_ID_FIELD)],\n\t\t\tscheduleId: this.getField(this.constants.DISCOUNT_SCHEDULE_FIELD)\n\n\t\t};\n\t}\n\n\tisVisibleInLineEditor() {\n\t\tlet visible = (this.lineVO.componentVisibility == null) || (this.lineVO.componentVisibility == '') || (this.lineVO.componentVisibility == 'Always') || (this.lineVO.componentVisibility == 'Editor Only');\n\t\tif (visible && (this.renewedAssetId != null) && this.editorModel.data.settings.renewedAssetsHiddenWhenEditing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn visible;\n\t}\n\tgetRateCards(){\n\t\treturn this.lineVO.rateCards;\n\t}\n\n\tsetCards(newCards){\n\t\tthis.lineVO.rateCards = newCards;\n\t}\n\n\thasParentLine() {\n\t\treturn this.lineVO.parentItemKey !== null;\n\t}\n\n\taddToSegmentsArray (lineModel) {\n\t\tif (!this.segments) {\n\t\t\tthis.segments = []; // list of lineModels per segments (in order)\n\t\t}\n\t\tthis.segments.push(lineModel);\n\t}\n\n\tremoveFromSegmentsArray (lineModel) {\n\t\tthis.segments.splice(this.segments.indexOf(lineModel), 1);\n\t\tif (this.segments.length === 0) {\n\t\t\tdelete this.segments;\n\t\t}\n\t}\n\n\taddToSegmentsByLabel (segmentLabel, lineModel) {\n\t\tif (!this.segmentsByLabel) {\n\t\t\tthis.segmentsByLabel = {}; // map of lineModels by segment label for easy access\n\t\t}\n\t\tthis.segmentsByLabel[segmentLabel] = lineModel;\n\t}\n\n\tremoveFromSegmentsByLabel (segmentLabel) {\n\t\tif (this.segmentsByLabel[segmentLabel]) {\n\t\t\tdelete this.segmentsByLabel[segmentLabel];\n\t\t}\n\t\tif (Object.keys(this.segmentsByLabel).length == 0) {\n\t\t\tdelete this.segmentsByLabel;\n\t\t}\n\t}\n\n\tsetLineTypeClass() {\n\t\tif(this.bundle) {\n\t\t\treturn 'parent-line';\n\t\t} else if(this.component) {\n\t\t\treturn 'component';\n\t\t} else {\n\t\t\treturn 'standalone';\n\t\t}\n\t}\n\n\tsetItemClassMap() {\n\t\tlet isMobile = this.editorModel.deviceContext.isMobile,\n\t\t\titemClassMap = {};\n\n\t\tfor (let field in this.lineVO.record) {\n\t\t\tif (!this.isFieldRendered(field, isMobile)) {\n\t\t\t\titemClassMap[field] = isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t}\n\n\t\t\tif(this.segmented) {\n\t\t\t\t// Use mdqSummaryRow as the indicator to prevent editing summary MDQ fields in LETableCell\n\t\t\t\tif (itemClassMap[field]) {\n\t\t\t\t\titemClassMap[field] += ' mdqSummaryRow';\n\t\t\t\t} else {\n\t\t\t\t\titemClassMap[field] = 'mdqSummaryRow';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titemClassMap['total'] = 'hiddenInMobile';\n\t\t}\n\n\t\tthis.itemClassMap = itemClassMap;\n\t}\n\n\t/**\n\t * @return {string} Path to record, e.g., lineModel.lineVO.record\n\t */\n\tstatic get recordPath() {\n\t\treturn 'lineModel.lineVO.record';\n\t}\n}\n","import {LineModel} from 'quotes/models/LineModel.js';\n\n/**\n * Created by jfeingold on 9/30/16.\n */\nexport class MDQSegmentHelper {\n\tconstructor(editorModel, groupModelsByKey) {\n\t\tthis.MONTHLY_DIM = 'Month';\n\t\tthis.YEARLY_DIM = 'Year';\n\t\tthis.QUARTERLY_DIM = 'Quarter';\n\t\tthis.editorModel = editorModel;\n\t\tthis.groupModelsByKey = groupModelsByKey;\n\t\tthis.prefix = editorModel.developerPrefix;\n\t\tthis.START_DATE_FIELD = this.prefix + 'StartDate__c';\n\t\tthis.END_DATE_FIELD = this.prefix + 'EndDate__c';\n\t\tthis.SUBSCRIPTION_TERM_FIELD = this.prefix + 'SubscriptionTerm__c';\n\t\tthis.LINES_GROUPED_FIELD = this.prefix + 'LineItemsGrouped__c';\n\t\tthis.SEGMENT_KEY_FIELD = this.prefix + 'SegmentKey__c';\n\t\tthis.SEGMENT_INDEX_FIELD = this.prefix + 'SegmentIndex__c';\n\t\tthis.SEGMENT_LABEL_FIELD = this.prefix + 'SegmentLabel__c';\n\t\tthis.FIRST_SEGMENT_END_DATE_FIELD = this.prefix + 'FirstSegmentTermEndDate__c';\n\t\tthis.TYPE_FIELD = this.prefix + 'Type__c';\n\t\tthis.EXISTING_FIELD = this.prefix + 'Existing__c';\n\n\t\tthis._segmentsChanged = false;\n\t}\n\n\tupdateSegments() {\n\t\tvar quote = this.editorModel.quote;\n\t\tif (this._hasMultiSegmentLines(quote)) {\n\t\t\tif (quote.grouped || quote.record[this.LINES_GROUPED_FIELD]) {\n\t\t\t\tquote.lineItemGroups.forEach(function(group) {\n\t\t\t\t\tthis._adjustSegments(quote, group);\n\t\t\t\t}, this);\n\t\t\t} else {\n\t\t\t\tthis._adjustSegments(quote, null);\n\t\t\t}\n\t\t}\n\t\treturn this._segmentsChanged;\n\t}\n\n\t_hasMultiSegmentLines(obj) {\n\t\tvar lineCount = obj.lineItems.length;\n\t\tfor (var i = 0; i < lineCount; i++) {\n\t\t\tif (obj.lineItems[i].record[this.SEGMENT_KEY_FIELD] != null) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_adjustSegments(quote, group) {\n\t\tvar term = this._calculateSubscriptionTerm(quote, group);\n\t\tvar lines = group ? quote.lineItems.filter((line) => line.parentGroupKey === group.key) : quote.lineItems;\n\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.YEARLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.MONTHLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.QUARTERLY_DIM);\n\t}\n\n\t_calculateSubscriptionTerm(quote, group) {\n\t\tvar startDateFieldValue = group\n\t\t\t? group.record[this.START_DATE_FIELD] || quote.record[this.START_DATE_FIELD]\n\t\t\t: quote.record[this.START_DATE_FIELD];\n\t\tvar endDateFieldValue = group\n\t\t\t? group.record[this.END_DATE_FIELD] || quote.record[this.END_DATE_FIELD]\n\t\t\t: quote.record[this.END_DATE_FIELD];\n\t\tvar subscriptionTermValue = (group && (group.record[this.SUBSCRIPTION_TERM_FIELD] != null))\n\t\t\t? group.record[this.SUBSCRIPTION_TERM_FIELD]\n\t\t\t: quote.record[this.SUBSCRIPTION_TERM_FIELD];\n\n\t\tvar startDate = startDateFieldValue ? new Date(startDateFieldValue) : null;\n\t\tvar endDate = endDateFieldValue ? new Date(endDateFieldValue) : null;\n\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\n\t\tif (firstSegEndDate) {\n\t\t\tstartDate = startDate ? startDate : new Date();\n\t\t\tif (!endDate) {\n\t\t\t\tendDate = new Date(startDate.getTime());\n\t\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() + subscriptionTermValue - 1);\n\t\t\t\t} else {\n\t\t\t\t\tSB.addMonths(endDate, subscriptionTermValue);\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(firstSegPlusOneDay, endDate);\n\t\t\t} else {\n\t\t\t\treturn SB.monthsBetweenRoundPartialUp(firstSegPlusOneDay, endDate);\n\t\t\t}\n\t\t} else if (startDate && endDate) {\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(startDate, endDate);\n\t\t\t} else {\n\t\t\t\treturn SB.monthsBetweenRoundPartialUp(startDate, endDate);\n\t\t\t}\n\t\t} else {\n\t\t\treturn subscriptionTermValue;\n\t\t}\n\t}\n\n\t_calculateSegmentDeltasAndModifySegments(quote, group, lines, term, dimType) {\n\t\tvar segmentDeltasBySegmentKey = this._calculateSegmentDeltas(quote, lines, term, dimType);\n\t\tif (segmentDeltasBySegmentKey.size != 0) {\n\t\t\tthis._modifySegmentsBasedOnDelta(quote, group, segmentDeltasBySegmentKey, dimType);\n\t\t}\n\t}\n\n\t_calculateSegmentDeltas(quote, lines, term, dimType) {\n\t\tvar termIsDay = this.editorModel.settings.subscriptionTermUnitIsDay;\n\n\t\t// Term might be null if there wasn't enough information to calculate it. In that case, default to 1 year.\n\t\tterm = (term == null) ? (termIsDay ? 365 : 12) : term;\n\n\t\t// Map all segment keys to the number of time-based segments with that key.\n\t\tvar segmentCountsBySegmentKey = mapSegmentCountsBySegmentKeys.bind(this)();\n\t\tvar trueSegmentCount = determineDesiredNumberOfSegments.bind(this)();\n\t\tvar segmentDeltasBySegmentKey = new Map();\n\t\tsegmentCountsBySegmentKey.forEach(function(currentSegCount, segKey) {\n\t\t\tsegmentDeltasBySegmentKey.set(segKey, trueSegmentCount - currentSegCount);\n\t\t});\n\t\treturn segmentDeltasBySegmentKey;\n\n\n\t\tfunction mapSegmentCountsBySegmentKeys() {\n\t\t\tvar segmentCountsBySegmentKey = new Map();\n\t\t\tvar lineCount = lines.length;\n\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\tlet line = lines[i];\n\t\t\t\tif (line.dimensionType == dimType) {\n\t\t\t\t\tlet lineSegKey = line.record[this.SEGMENT_KEY_FIELD];\n\t\t\t\t\tlet currentSegCount = segmentCountsBySegmentKey.get(lineSegKey) || 0;\n\t\t\t\t\tsegmentCountsBySegmentKey.set(lineSegKey, currentSegCount + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn segmentCountsBySegmentKey;\n\t\t}\n\n\t\tfunction determineDesiredNumberOfSegments() {\n\t\t\t// Calculate the number of segments represented by the given term and dimension type.\n\t\t\tvar trueSegmentCount = 0;\n\t\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\t\t\t// If the first segment has a specified end date, we must take that into account as we calculate the\n\t\t\t// number of segments\n\t\t\tif (firstSegEndDate) {\n\t\t\t\t// We immediately include the first term in our count.\n\t\t\t\ttrueSegmentCount = 1;\n\n\t\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\t}\n\n\t\t\t// Convert term expressed as days into months if termIsDay to ensure the number of segments is correct.\n\t\t\tif (termIsDay) {\n\t\t\t\tlet termStartDate = firstSegPlusOneDay ? firstSegPlusOneDay : new Date(this.editorModel.quote.record[this.START_DATE_FIELD]);\n\t\t\t\tlet quoteEndDate = this.editorModel.quote.record[this.END_DATE_FIELD] ? new Date(this.editorModel.quote.record[this.END_DATE_FIELD]) : new Date(termStartDate.setUTCDate(termStartDate.getUTCDate() + term));\n\t\t\t\tterm = SB.monthsBetween(termStartDate, quoteEndDate);\n\t\t\t\ttermStartDate.setUTCMonth(termStartDate.getUTCMonth() + term);\n\t\t\t\ttermStartDate.setUTCDate(termStartDate.getUTCDate() - 1);\n\t\t\t\t// If the date in the month of the termStartDate is less than the end date of the quote we need to add one more month to the term,\n\t\t\t\t// this ensures that the number of segments will be calculated correctly.\n\t\t\t\tif (termStartDate < quoteEndDate) {\n\t\t\t\t\tterm += 1\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Now we calculate the number of segments based on our dimension type and the term.\n\t\t\tswitch (dimType) {\n\t\t\t\tcase this.YEARLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 12);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.QUARTERLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 3);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.MONTHLY_DIM:\n\t\t\t\t\ttrueSegmentCount += term;\n\t\t\t}\n\t\t\treturn trueSegmentCount;\n\t\t}\n\t}\n\n\t_modifySegmentsBasedOnDelta(quote, group, deltaMap, dimType) {\n\t\tdeltaMap.forEach(function(delta, segmentKey) {\n\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\n\t\t\tvar noDelta = delta === 0;\n\t\t\tvar amendmentLine = quote.record[this.TYPE_FIELD] === 'Amendment' && lastSegment.record[this.EXISTING_FIELD];\n\n\t\t\tvar lastSegStartDateFieldValue = lastSegment.record[this.START_DATE_FIELD];\n\t\t\tvar lastSegEndDateFieldValue = lastSegment.record[this.END_DATE_FIELD];\n\n\t\t\tvar lastSegStartDate = lastSegStartDateFieldValue ? new Date(lastSegStartDateFieldValue) : null;\n\t\t\tvar lastSegEndDate = lastSegEndDateFieldValue ? new Date(lastSegEndDateFieldValue) : null;\n\t\t\tvar startDateBeforeEndDate = lastSegEndDate >= lastSegStartDate;\n\t\t\tif (noDelta || amendmentLine) {\n\t\t\t\t// If we're amending an old line, or the delta is 0, do nothing\n\t\t\t\treturn;\n\t\t\t} else if (delta > 0 && startDateBeforeEndDate) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\tfor (let i = 1; i <= delta; i++) {\n\t\t\t\t\t// We need to add additional segments, which we do by repeatedly cloning the last segment\n\t\t\t\t\tvar newSegmentVO = this._createNewSegment(quote, lastSegment, i);\n\t\t\t\t\tquote.lineItems.push(newSegmentVO);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Add line to group model, so that the models can have a handle on the new segment and reflect it in the UI\n\t\t\t\t\t\tthis.groupModelsByKey[newSegmentVO.parentGroupKey].processQuoteLines(newSegmentVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (delta < 0) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\t// If the delta is negative, we need to remove that many segments\n\t\t\t\tfor (let i = 0; i > delta; i--) {\n\t\t\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\t\t\t\t\tthis._removeSegment(quote, lastSegment);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Remove deleted line from segments array on the given group model\n\t\t\t\t\t\tlet line = this.groupModelsByKey[lastSegment.parentGroupKey].segmentedLinesBySegmentKey[segmentKey];\n\t\t\t\t\t\tline.segments.splice(line.segments.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t}\n\n\t_getLastSegmentFromQuote(quote, segmentKey, dimType) {\n\t\tvar lineItem = null;\n\t\tvar maxIndex = null;\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tif (line.record[this.SEGMENT_KEY_FIELD] === segmentKey && line.dimensionType === dimType) {\n\t\t\t\tlet index = line.record[this.SEGMENT_INDEX_FIELD];\n\t\t\t\tif ((index != null) && ((maxIndex == null) || (maxIndex < index))) {\n\t\t\t\t\t// If the segment index is higher than the highest we've seen so far, store this line\n\t\t\t\t\tmaxIndex = index;\n\t\t\t\t\tlineItem = line;\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t\treturn lineItem;\n\t}\n\n\t_createNewSegment(quote, sourceSegment, offset) {\n\t\tvar clone = JSON.parse(JSON.stringify(sourceSegment));\n\t\t// We need to update the clone's key, and delete its ID\n\t\tclone.key = ++quote.nextKey;\n\t\tclone.record.Id = null;\n\t\t// We also need to offset the segment indices\n\t\tclone.record[this.SEGMENT_KEY_FIELD] = sourceSegment.record[this.SEGMENT_KEY_FIELD];\n\t\tclone.record[this.SEGMENT_INDEX_FIELD] = sourceSegment.record[this.SEGMENT_INDEX_FIELD] + offset;\n\t\tvar whitespace = (clone.record[this.SEGMENT_INDEX_FIELD] < 10) ? '  ' : ' ';\n\t\tclone.record[this.SEGMENT_LABEL_FIELD] = sourceSegment.dimensionType + whitespace + clone.record[this.SEGMENT_INDEX_FIELD];\n\t\t// If the original segment had any usage rate cards, they and their Rates must have the IDs cleared out for proper cloning.\n\t\tif (clone.rateCards && clone.rateCards.length > 0) {\n\t\t\tclone.rateCards.forEach((card) => {\n\t\t\t\tcard.Id = null;\n\t\t\t\tcard[this.prefix + \"QuoteLine__c\"] = null;\n\t\t\t\tlet rates = card[this.prefix + 'UsageRates__r'];\n\t\t\t\tif (rates && rates.records.length > 0) {\n\t\t\t\t\trates.records.forEach((rate) => {\n\t\t\t\t\t\trate.Id = null;\n\t\t\t\t\t\trate[this.prefix + \"UsageRateCard__c\"] = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn clone;\n\t}\n\n\t_removeSegment(quote, segmentToRemove) {\n\t\tvar lineCount = quote.lineItems.length;\n\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\tvar line = quote.lineItems[i];\n\t\t\tif (line.key === segmentToRemove.key) {\n\t\t\t\tquote.lineItems = quote.lineItems.slice(0, i).concat(quote.lineItems.slice(i + 1, lineCount));\n\t\t\t\tif (quote.deletedLineIds && line.record && line.record.Id) {\n\t\t\t\t\tquote.deletedLineIds.push(line.record.Id);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n}","export class QuoteMessenger {\n\n\tconstructor(editorModel, targetRecord) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.targetRecord = targetRecord;\n\t}\n\n\tgetRequest() {\n\t\tlet message = {\n\t\t\ttarget: this.targetRecord,\n\t\t\tquote: this.editorModel.quoteModel.quoteVO.record,\n\t\t\tlines: [],\n\t\t\tactions: []\n\t\t};\n\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif (!message)\n\t\t\treturn;\n\n\t\tswitch (message.actions[0].toLowerCase().replace(' ', '')) {\n\t\t\tcase 'save':\n\t\t\t\treturn {lines: message.lines, action: 'save'};\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\treturn {lines: message.lines, action: 'quicksave'};\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\treturn {lines: message.lines, action: 'reload'};\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t\t\treturn {lines: message.lines, action: 'none'};\n\t\t}\n\t}\n\n}","import {getSubchange} from 'quotes/models/EditorModel.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {register, notify} from 'quotes/models/UiNotifier.js';\n\nlet quoteTypes = {RENEWAL: 'Renewal', AMENDMENT: 'Amendment', CHANGE_ORDER: 'Re-Quote'};\n\n/**\n *  QuoteModel - contains the quoteVO and linked with the editorModel\n *\n * Feature:\n *      1. Contains QuoteVO which is the same as the server\n *      2. Linked with EditorModel\n *      3. Rebuild the groupsByKey to link GroupVO and QuoteVO together\n */\nexport class QuoteModel {\n\tconstructor(quoteVO, editorModel) {\n\t\tthis.quoteVO = quoteVO; // quote returned from the server\n\t\tthis.editorModel = editorModel;\n\n\t\tthis.grouped = quoteVO.record[this.constants.GROUP_LINE_ITEMS_FIELD];\n\n\t\tthis.groupsByKey = {};\n\t\tthis.lineModelsByKey = {};\n\t\tthis.indexByGroupKey = {};\n\t\tthis.lineGroups = [];\n\t\t// stores lineModels by parentItemKey (parenItemKey: [array of components])\n\t\t// this map is on the quoteModel instead of each group because users can drag components to other groups when Keep Bundle Together setting is off\n\t\tthis.linesByParentItemKey = {};\n\t\tthis.standardLinesByParentItemKey = {};\n\t\tthis.segmentedLinesByParentItemKey = {};\n\n\t\t// stores selected lines by key used in clone to group\n\t\tthis.selectedLinesByKey = {};\n\n\t\tthis.allOptional = true;\n\t\tthis.isPrimary = this.quoteVO.record[this.constants.PRIMARY_FIELD];\n\t\tthis.isRenewal = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.RENEWAL;\n\t\tthis.isAmendment = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.AMENDMENT;\n\t\tthis.isChangeQuote = this.quoteVO.record[this.constants.TYPE_FIELD] === quoteTypes.CHANGE_ORDER;\n\t\tthis.isAmendmentOrChangeQuote = this.isAmendment || this.isChangeQuote;\n\n\t\t// If Group Line Items is true but there are no Groups in the Model, create an empty one and add all lines to it\n\t\tif (this.grouped && this.quoteVO.lineItemGroups.length == 0) {\n\t\t\tlet groupRecord = {Name: `Group${1}`};\n\t\t\tlet groupVO = {key: ++this.quoteVO.nextKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\t\tlet group = new GroupModel(groupVO, this);\n\t\t\tthis.quoteVO.lineItemGroups.push(groupVO);\n\t\t\tthis.groupsByKey[group.groupVO.key] = group;\n\t\t\tthis.indexByGroupKey[group.groupVO.key] = {index: Object.keys(this.indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t\tlet lineVOs = this.quoteVO.lineItems;\n\t\t\tfor (let i = 0; i < lineVOs.length; i++) {\n\t\t\t\tlet lineVO = lineVOs[i];\n\t\t\t\tlineVO.parentGroupKey = group.groupVO.key;\n\t\t\t}\n\t\t}\n\t\t// form the Group Models looping through the GroupVOs on the QuoteVO\n\t\tlet groups = this.grouped ? this.quoteVO.lineItemGroups : [{key: null, record: {}}];\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tlet groupModel = new GroupModel(groups[i], this);\n\t\t\tthis.lineGroups.push(groupModel);\n\t\t\tthis.groupsByKey[groupModel.groupVO.key] = groupModel;\n\t\t\tthis.indexByGroupKey[groupModel.groupVO.key] = {index: i, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t}\n\n\t\t// form the Line Models and push each model into its Group Model's lines array depending on type (standard vs segmented)\n\t\tfor (let line of this.quoteVO.lineItems) {\n\t\t\tif (!line.record[this.constants.OPTIONAL_FIELD])\n\t\t\t\tthis.allOptional = false;\n\t\t\tthis.groupsByKey[line.parentGroupKey].processQuoteLines(line);\n\t\t}\n\n\t\tlet shouldNotify = true;\n\t\tlet observer = () => {\n\t\t\tif (shouldNotify) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tnotify(this, [ 'flattenedRows' ]);\n\t\t\t\t\tshouldNotify = true;\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tshouldNotify = false;\n\t\t};\n\t\tregister(this, (path) => {\n\t\t\tif (path[0] === 'lineGroups') {\n\t\t\t\tobserver();\n\t\t\t}\n\t\t});\n\t\tthis.lineGroups.forEach((group) => {\n\t\t\tregister(group, (path) => {\n\t\t\t\tif (path[0] === 'flattenedRows') {\n\t\t\t\t\tobserver();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget quoteMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.editorModel.data.quoteObjectName];\n\t}\n\n\tgetFieldMD(fieldName) {\n\t\treturn this.quoteMD[fieldName];\n\t}\n\n\trenumberIndexes(/*Boolean*/ deepRenumber) {\n\t\t// if deepRenumber is true, it will renumber all of the line items as well\n\t\tfor (let i = 0, l = this.lineGroups.length; i < l; i ++) {\n\t\t\tlet groupKey = this.lineGroups[i].groupKey;\n\t\t\tthis.indexByGroupKey[groupKey].index = i;\n\t\t\tif (deepRenumber) {\n\t\t\t\tthis.lineGroups[i].renumberStandardIndexes();\n\t\t\t\tthis.lineGroups[i].renumberSegmentedIndexes();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Used to renumber all lines in a quote - performed after operations such as delete/clone lines\n\trenumber() {\n\t\tlet idx = 1,\n\t\t\tinvisibleIdx = 3000;\n\t\tfor (let i = 0, numOfGroups = this.lineGroups.length; i < numOfGroups; i++) { // loop through each group model\n\t\t\tlet groupModel = this.lineGroups[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) { //loop through each dimension for the current group\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) { // loop through all the segmented summary lines for the current dimension\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tif (segmentedLines[k].visible) {\n\t\t\t\t\t\tthis.lineGroups[i].segmentedLinesByDimension[dim][k].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tidx++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsegmentedLines[k].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop through standard lines\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++) {\n\t\t\t\tlet line = groupModel.standardLines[n];\n\t\t\t\tif (line.visible) {\n\t\t\t\t\tthis.lineGroups[i].standardLines[n].lineVO.record[this.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\tidx++;\n\t\t\t\t} else {\n\t\t\t\t\tgroupModel.standardLines[n].lineVO.record[this.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(optional, groupKey) {\n\t\tthis._callChildren(groupKey, (model) => {\n\t\t\tmodel.toggleOptional(optional);\n\t\t});\n\t}\n\n\tresetDiscounts(groupKey) {\n\t\tthis._callChildren(groupKey, (model) => {\n\t\t\tmodel.resetDiscounts();\n\t\t});\n\t}\n\n\t_callChildren(groupKey, callback) {\n\t\tif (groupKey) {\n\t\t\tcallback(this.groupsByKey[groupKey]);\n\t\t} else {\n\t\t\tthis.lineGroups.forEach(callback);\n\t\t}\n\t}\n\n\tget flattenedRows() {\n\t\treturn [].concat(...this.lineGroups.map((model) => model.flattenedRows));\n\t}\n\n\tnotifyUi(path) {\n\t\tconst subchange = path[0] === 'lineGroups' ? getSubchange(path, this, 2) : null;\n\t\tif (subchange !== null) {\n\t\t\tsubchange.target.notifyUi(subchange.path);\n\t\t} else {\n\t\t\tnotify(this, path);\n\t\t}\n\t}\n}\n","import {Constants} from 'quotes/models/Constants.js';\n\nexport class SortLinesHandler {\n\tconstructor(prefix) {\n\t\tthis.constants = new Constants(prefix);\n\t}\n\n\tsortLineItems(lines, lineSortField) {\n\t\tlines.sort(function(a, b) {\n\t\t\ta.lineSortValue = a.record[lineSortField];\n\t\t\tb.lineSortValue = b.record[lineSortField];\n\t\t\tif (a.lineSortValue != null && b.lineSortValue != null && a.lineSortValue != b.lineSortValue) {\n\t\t\t\t// We know both values are non-null and non-equal, so we can try to compare them.\n\t\t\t\t// Try subtraction, on the chance we're dealing with numeric strings or numbers\n\t\t\t\tvar difference = a.lineSortValue - b.lineSortValue;\n\t\t\t\tif (difference === difference) {\n\t\t\t\t\t// There's only one value in all of JS that's not equal to itself, and it's NaN. So if the difference\n\t\t\t\t\t// is equal to itself, we can just return it, since it's going to be a number.\n\t\t\t\t\treturn difference;\n\t\t\t\t} else {\n\t\t\t\t\t// If the difference isn't equal to itself, then we're dealing with a non-numeric string.\n\t\t\t\t\t// Just use '<'. It should be fine.\n\t\t\t\t\treturn a.lineSortValue < b.lineSortValue ? -1 : 1;\n\t\t\t\t}\n\t\t\t} else if (a.lineSortValue == b.lineSortValue) {\n\t\t\t\tvar aSecondary = a.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tvar bSecondary = b.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tif (aSecondary == bSecondary) {\n\t\t\t\t\t// If both of the secondary sort values are equal, then we should try using the Number__c field\n\t\t\t\t\treturn a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n\t\t\t\t} else if (aSecondary == null) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (bSecondary == null) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn aSecondary - bSecondary;\n\t\t\t\t}\n\t\t\t} else if (a.lineSortValue == null) {\n\t\t\t\treturn -1;\n\t\t\t} else if (b.lineSortValue == null) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\t// There's no reason we should end up in this branch, but if we somehow do, then we should compare the\n\t\t\t\t// Number__c fields.\n\t\t\t\treturn a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n\t\t\t}\n\t\t}.bind(this));\n\t\treturn lines;\n\t}\n}\n","const observers = new Map();\n\n/**\n * Register observer function.\n * @param {Model} model - The model to observe.\n * @param {function(string[])} observer - The function to be called when the model changes.\n *     notifier will send the path of the changed data to the observer.\n * @returns {function()} The function that unregisters the observer.\n */\nexport function register(model, observer) {\n\tif (!observers.has(model)) {\n\t\tobservers.set(model, new Set());\n\t}\n\tconst modelObservers = observers.get(model);\n\tmodelObservers.add(observer);\n\treturn () => {\n\t\tmodelObservers.delete(observer);\n\t}\n}\n\n/**\n * Tell the notifier that some data changed\n * @param {Model} model - The model that contains the data.\n * @param {string[]} path - The path of the data within the model.\n */\nexport function notify(model, path) {\n\tif (observers.has(model)) {\n\t\tobservers.get(model).forEach((observer) => {\n\t\t\tobserver(path);\n\t\t});\n\t}\n}\n\nconst unregisterMap = new Map();\n\n/**\n * Convenience function for registering a component to observe a model.\n *     If the component is already refistered it will unregister from the previous model\n *     Hooks into the polymer notifier directly.\n * @param {PolymerComponent} component - The component that is observing the model.\n * @param {string} [modelAttr=model] - The attribute name that contains the model to observe\n */\nexport function registerComponent(component, modelAttr = 'model') {\n\tif (unregisterMap.has(component)) {\n\t\tunregisterMap.get(component)();\n\t}\n\tunregisterMap.set(component, register(component[modelAttr], (path) => {\n\t\tcomponent.notifyPath([ modelAttr ].concat(path).join('.'));\n\t}));\n}\n\n/**\n * Convenience function for telling a model to set a value and notify observers of the change.\n * @param {Model} model - The model that contains the data.\n * @param {string[]} path - The path of the data within the model.\n * @param {*} value - The value to set in the data\n */\nexport function setThenNotify(model, path, value) {\n\tconst lastInd = path.length - 1;\n\tpath.slice(0, lastInd).reduce((obj, key) => obj[key], model)[path[lastInd]] = value;\n\tnotify(model, path);\n}\n","/**\n * Created by jfeingold on 10/13/16.\n */\nmodule.exports = convertTo18;\n\nvar CONVERSION_TABLE = {\n\t\"00000\": \"A\",\n\t\"00001\": \"B\",\n\t\"00010\": \"C\",\n\t\"00011\": \"D\",\n\t\"00100\": \"E\",\n\t\"00101\": \"F\",\n\t\"00110\": \"G\",\n\t\"00111\": \"H\",\n\t\"01000\": \"I\",\n\t\"01001\": \"J\",\n\t\"01010\": \"K\",\n\t\"01011\": \"L\",\n\t\"01100\": \"M\",\n\t\"01101\": \"N\",\n\t\"01110\": \"O\",\n\t\"01111\": \"P\",\n\t\"10000\": \"Q\",\n\t\"10001\": \"R\",\n\t\"10010\": \"S\",\n\t\"10011\": \"T\",\n\t\"10100\": \"U\",\n\t\"10101\": \"V\",\n\t\"10110\": \"W\",\n\t\"10111\": \"X\",\n\t\"11000\": \"Y\",\n\t\"11001\": \"Z\",\n\t\"11010\": \"0\",\n\t\"11011\": \"1\",\n\t\"11100\": \"2\",\n\t\"11101\": \"3\",\n\t\"11110\": \"4\",\n\t\"11111\": \"5\"\n};\n\n/**\n * Converts the ID provided to an 18-digit Apex ID\n * @param {String} id An Apex ID string\n * @returns {string|null}\n * @throws Throws an error if argument is not 15 or 18 characters long\n */\nfunction convertTo18(id) {\n\tif (!id) {\n\t\treturn null;\n\t} else if (id.length === 18) {\n\t\treturn id;\n\t} else if (id.length === 15) {\n\t\tvar part1 = convertToDigit(id.slice(0, 5));\n\t\tvar part2 = convertToDigit(id.slice(5, 10));\n\t\tvar part3 = convertToDigit(id.slice(10, 15));\n\t\treturn (id + part1 + part2 + part3);\n\t} else {\n\t\treturn null;\n\t}\n}\n\n\n/**\n * Reverses the characters in an alphanumeric string, i.e., \"SpinOn\" becomes \"nOnipS\"\n * @param {String} str An alphanumeric string\n * @returns {string}\n * @private\n */\nfunction reverseString(str) {\n\treturn str.split(\"\").reverse().join(\"\");\n}\n\n/**\n * Replaces all numeric or lowercase characters with 0, and all uppercase characters with 1, i.e. \"0Sa0Z\" becomes \"01001\"\n * @param {String} string\n * @returns {string}\n * @private\n */\nfunction replaceWithBinary(string) {\n\tvar res = string.replace(/[^A-Z]/g, \"0\");\n\treturn res.replace(/[A-Z]/g, \"1\");\n}\n\n/**\n * Uses the Conversion Table to turn a 5-digit binary string into a single character\n * @param {String} seg A 5-digit string of 1s and 0s\n * @returns {String} A single character in the range A-Z or 0-5\n * @private\n */\nfunction convertToDigit(seg) {\n\treturn CONVERSION_TABLE[replaceWithBinary(reverseString(seg))];\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nself.addEventListener('message', function(e) {\n\tvar startTime = new Date().getTime();\n\t// We need to import these scripts so that we have access to JSForce and a Promise polyfill.\n\timportScripts(\"//cdnjs.cloudflare.com/ajax/libs/jsforce/1.7.0/jsforce.min.js\");\n\timportScripts(\"https://www.promisejs.org/polyfills/promise-7.0.4.min.js\");\n\t// Create JSForce connection using the access token provided by the event's context.\n\n\tvar conn = new jsforce.Connection({\n\t\tsessionId : e.data.sessionId,\n\t\tinstanceUrl: e.data.siteUrl\n\t});\n\tconn.oik = e.data.oik;\n\t// Create a proxy REST connection to the org.\n\tvar client = require('./PrecacheRestClient.js')(conn, e.data.orgUrl, e.data.siteUrl, e.data.proxyUrl);\n\t// Create a wrapper object to manage the apex connection and simplify interaction.\n\tvar apex = apexFactory(client);\n\n\t// The specific precaching actions are all handled by separate files that we've called 'Sequence Runners'.\n\t// Every Sequence Runner contains a method that takes several parameters and returns\n\t// an object with a method called executeSequence(), which actually performs the precaching.\n\t// We identify which runner to use, and create an array of arguments to pass into an apply call.\n\tvar precacheSequence = e.data.precacheSequence;\n\tvar runnerConstructor = getRunnerConstructor(precacheSequence);\n\tif (!runnerConstructor) {\n\t\tself.postMessage({failure: true, sequence: precacheSequence, msg: 'Unrecognized sequence'});\n\t\tclose();\n\t}\n\tvar argumentList = getArgumentList(precacheSequence, apex, e.data, self.postMessage);\n\tvar runner = runnerConstructor.apply(null, argumentList);\n\trunner.executeSequence()\n\t\t.then(function() {\n\t\t\tclose();\n\t\t});\n});\n\n/**\n * Requires the right constructor for the sequence runner associated with the precache sequence \n * @param {String} sequence Indicates which precache sequence to use\n * @returns {function} A constructor for an object with an executeSequence() method.\n */\nfunction getRunnerConstructor(sequence) {\n\tvar requiredModulesBySequence = {\n\t\t'PriceRuleSequence': require('./PrecacheSequenceRunners/PriceRuleSequenceRunner.js'),\n\t\t'MetadataSequence': require('./PrecacheSequenceRunners/MetadataSequenceRunner.js'),\n\t\t'OptionSequence': require('./PrecacheSequenceRunners/OptionSequenceRunner.js'),\n\t\t'DiscountAndAccountSequence': require('./PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js'),\n\t\t'ProductSequence': require('./PrecacheSequenceRunners/ProductSequenceRunner.js'),\n\t\t'RelatedRecordSequence': require('./PrecacheSequenceRunners/RelatedRecordSequenceRunner.js')\n\t};\n\treturn requiredModulesBySequence[sequence] || null;\n}\n\n/**\n * Creates a list of arguments to be passed into a sequence runner using .apply().\n * @param {String} sequence Indicates which sequence is in progress.\n * @param {Object} apex A wrapper to provide access to the SFDC org\n * @param {Object} data The context passed in from the main thread\n * @param {Function} resultPoster self.postMessage() passed in as a parameter.\n * @returns {*}\n */\nfunction getArgumentList(sequence, apex, data, resultPoster) {\n\t// All sequence runners receive these three arguments.\n\tvar result = [apex, data.prefix, resultPoster];\n\t// Each runner requires extra data, so we get that data and append it to the argument list.\n\tswitch(sequence) {\n\t\tcase 'PriceRuleSequence':\n\t\t\t// In addition to the standard data, we must also include the Account ID for this quote, so assets and subscriptions\n\t\t\t// may be loaded.\n\t\t\treturn result.concat([data.accountId]);\n\t\tcase 'MetadataSequence':\n\t\t\t// In addition to the standard data, the context will include the Referenced Field Map from the inner class\n\t\t\t// EditorSettings in QuoteEditorModel.cls. This indicates which fields must have their metadata queried.\n\t\t\treturn result.concat([data.referencedFieldMap]);\n\t\tcase 'DiscountAndAccountSequence':\n\t\t\t// In addition to the standard data, we must also include the Quote JSON, and the account ID. The former\n\t\t\t// is swept for schedule IDs, and the latter is used to get asset and subscription summary information.\n\t\t\treturn result.concat([data.quote, data.accountId]);\n\t\tcase 'RelatedRecordSequence':\n\t\t\t// In addition to the standard data, we must also include the QuoteJSON, the referenced field map,\n\t\t\t// and a map of lookup fields. The quote is swept for data, the the lookup map indicates which fields must\n\t\t\t// be checked for IDs, and the referenced field map indicates which fields on the corresponding objects must\n\t\t\t// be queried.\n\t\t\treturn result.concat([data.quote, data.lookupFieldMap, data.referencedFieldMap]);\n\t\tcase 'ProductSequence':\n\t\tcase 'OptionSequence':\n\t\t\t// Both the Option and Product sequences require the Quote JSON, and a list of referenced fields.\n\t\t\treturn result.concat([data.quote, data.referencedFields]);\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n\nfunction apexFactory(client) {\n\tfunction read(prefix, provider, uid) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.read(prefix, provider, uid).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.load(prefix, provider, uid || '', context).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\tclient.setOptions(opts);\n\t}\n\n\tfunction md(mdType, fields, prefix) {\n\t\treturn load(prefix, 'MetaDataServiceProvider.FieldMetaDataLoader', null, {fields});\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tmd: md,\n\t\tsetOptions: setOptions\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n */\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class JSQCPrecacheWorkerManager {\n\tconstructor(data) {\n\t\tthis.data = data;\n\t\tthis.orgUrl = this.data.settings.orgUrl;\n\t\tthis.siteUrl = this.data.settings.siteUrl;\n\t\tthis.proxyUrl = this.data.settings.proxyUrl;\n\t\tthis.oik = this.data.settings.oik;\n\t\tthis.prefix = this.data.developerPrefix ? 'SBQQ' : '';\n\t\tthis.constants = new Constants(this.data.developerPrefix);\n\t\tthis.filePath = this.siteUrl + '/resource/' + new Date().getTime() + '/' + this.data.developerPrefix + 'PrecacherUI2';\n\t}\n\n\tbeginPrecaching() {\n\t\tthis.sessionId = window.sb.vfSessionId;\n\t\tthis._spoolWorkers();\n\t}\n\n\t_spoolWorkers() {\n\t\tvar accountId = this.data.quote.record[this.constants.ACCOUNT_ID_FIELD];\n\t\tvar settings = this.data.settings;\n\t\tvar quote = this.data.quote;\n\t\tvar referencedFieldMap = this.data.settings.referencedFieldMap;\n\n\n\t\tvar priceRuleWorker = this._createWorker();\n\t\tvar priceRuleContext = this._createWorkerContext('PriceRuleSequence',\n\t\t\t// We must include the account ID so that the sequence runner can retrieve asset and subscription records.\n\t\t\tnew Map([['accountId', accountId]]));\n\t\tpriceRuleWorker.postMessage(priceRuleContext);\n\n\t\tvar metadataWorker = this._createWorker();\n\t\tvar metadataContext = this._createWorkerContext('MetadataSequence',\n\t\t\t// We must include the referenced field map so that the sequence runner knows which fields it needs metadata for.\n\t\t\tnew Map([['referencedFieldMap', referencedFieldMap]])\n\t\t);\n\t\tmetadataWorker.postMessage(metadataContext);\n\n\t\tvar discountWorker = this._createWorker();\n\t\tvar discountContext = this._createWorkerContext('DiscountAndAccountSequence',\n\t\t\t// We must include the Account Id so its assets and subscriptions may be summarized, and the quote so we\n\t\t\t// can sweep it for discount schedule Ids.\n\t\t\tnew Map([['accountId', accountId], ['quote', quote]])\n\t\t);\n\t\tdiscountWorker.postMessage(discountContext);\n\n\t\tvar relatedRecordWorker = this._createWorker();\n\t\tvar lookupFieldMap = {\n\t\t\tquoteLookups: settings.quoteLookups || {},\n\t\t\tgroupLookups: settings.groupLookups || {},\n\t\t\tlineLookups: (function() {\n\t\t\t\tvar allLineLookups = settings.lineLookups || {};\n\t\t\t\tvar nonstandardLineLookups = {};\n\t\t\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\t\t\tfor (var key in allLineLookups) {\n\t\t\t\t\tif (key !== fieldPrefix + 'Product__c' && key !== fieldPrefix + 'ProductOption__c') {\n\t\t\t\t\t\tnonstandardLineLookups[key] = allLineLookups[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn nonstandardLineLookups;\n\t\t\t})()\n\t\t};\n\t\tvar relatedRecordContext = this._createWorkerContext('RelatedRecordSequence',\n\t\t\t// We must include the quote so it can be swept for Ids, the lookup field map to know what fields point to other\n\t\t\t// records, and the referenced field map so we can know what fields on those objects to query.\n\t\t\tnew Map([['quote', quote], ['referencedFieldMap', referencedFieldMap], ['lookupFieldMap', lookupFieldMap]])\n\t\t);\n\t\trelatedRecordWorker.postMessage(relatedRecordContext);\n\t\t\n\t\tvar productWorker = this._createWorker();\n\t\tvar productContext = this._createWorkerContext('ProductSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap['Product2']]])\n\t\t);\n\t\tproductWorker.postMessage(productContext);\n\t\t\n\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\tvar optionWorker = this._createWorker();\n\t\tvar optionContext = this._createWorkerContext('OptionSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap[fieldPrefix + 'ProductOption__c']]])\n\t\t);\n\t\toptionWorker.postMessage(optionContext);\n\t}\n\n\t_createWorkerContext(sequence, extrasMap) {\n\t\tvar baseContext = {\n\t\t\torgUrl: this.orgUrl,\n\t\t\tsiteUrl: this.siteUrl,\n\t\t\tproxyUrl: this.proxyUrl,\n\t\t\tsessionId: this.sessionId,\n\t\t\tprecacheSequence: sequence,\n\t\t\tprefix: this.prefix,\n\t\t\toik: this.oik\n\t\t};\n\t\tif (extrasMap && extrasMap.size != 0) {\n\t\t\textrasMap.forEach(function(val, key) {\n\t\t\t\tbaseContext[key] = val;\n\t\t\t});\n\t\t}\n\t\treturn baseContext;\n\t}\n\n\t_createWorker() {\n\t\tvar wrkr = new Worker(this.filePath);\n\t\tvar precachingFn = this._precache;\n\t\twrkr.addEventListener('message', function(e) {\n\t\t\tif (e.data.successful) {\n\t\t\t\tprecachingFn(e.data.provider, e.data.uid, e.data.results);\n\t\t\t} else if (e.data.failure) {\n\t\t\t\tconsole.error('Main thread received failure from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t} else if (e.data.err) {\n\t\t\t\tconsole.error('Main thread received error from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t}\n\t\t});\n\t\treturn wrkr;\n\t}\n\n\t_precache(provider, uid, results) {\n\t\tif (SB && SB.JSQCPrecacher) {\n\t\t\tvar precacher = new SB.JSQCPrecacher();\n\t\t\tprecacher.precacheValue(provider, uid, results);\n\t\t}\n\t}\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nmodule.exports= restClient;\nfunction restClient(conn, orgUrl, siteUrl, proxyUrl) {\n\tvar proxy = restProxy(conn, orgUrl, siteUrl, proxyUrl);\n\n\tfunction read(prefix, provider, uid) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.get(endpoint + '?reader=' + provider + '&uid=' + uid).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\tvar body = JSON.stringify({context: JSON.stringify(context)});\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.patch(endpoint + '?loader=' + provider + '&uid=' + uid, body).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\t// not supported\n\t}\n\n\tfunction getEndpoint(prefix) {\n\t\tvar endpoint = '/ServiceRouter';\n\t\treturn prefix ? ('/' + prefix + endpoint) : endpoint;\n\t}\n\n\tfunction parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch (e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tsetOptions: setOptions\n\t};\n}\n\nfunction restProxy(conn, orgUrl, siteUrl, proxyUrl) {\n\n\tfunction get(endpoint) {\n\t\treturn send(endpoint, 'GET');\n\t}\n\n\tfunction patch(endpoint, body) {\n\t\treturn send(endpoint, 'PATCH', body);\n\t}\n\n\tfunction send(endpoint, method, body) {\n\t\tendpoint += (conn.oik  === undefined ? '' : '&oik=' + conn.oik);\n\t\tvar params = {\n\t\t\turl: siteUrl != '' ? (siteUrl + '/services/apexrest' + endpoint) : proxyUrl,\n\t\t\tmethod: method,\n\t\t\theaders: {\n\t\t\t\t'SalesforceProxy-Endpoint': orgUrl + '/services/apexrest' + endpoint,\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t};\n\n\t\tif(body)\n\t\t\tparams.body = body;\n\n\t\treturn conn.request(params);\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tpatch: patch\n\t};\n}","import {Navigator} from 'common/core/Navigator.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {JSQCNotifier} from 'quotes/models/JSQCNotifier.js';\nimport {SortLinesHandler} from 'quotes/models/SortLinesHandler.js';\nimport {QuoteMessenger} from 'quotes/models/QuoteMessenger.js';\nimport {JsonFormatter} from 'common/data/format/JsonFormatter.js';\nimport {MDQSegmentHelper} from 'quotes/models/MDQSegmentHelper.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js'\nimport {AppContext} from 'common/core/AppContext.js';\nimport {AssetQuantityValidator} from 'quotes/models/AssetQuantityValidator.js';\n\n/**\n *  <sb-le-custom-action-services>\n *\n *  Features:\n *\n **/\nexport class LECustomActionServices {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-custom-action-services';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\teventDetail: Object,\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Finds the sb-service component and sets its model\n\t * @param  {String} eventHandlerName   - Id of the sb-service component\n\t * @param  {Object} pseudoServiceModel - The initial value of the model to set the sb-service component\n\t * @param {lineFilterCallback} [lineFilterFn] - An optional method by which non-essential quote lines will be excluded\n\t *                                              from the JSON, thus minimizing JSON bloat.\n\t */\n\t_executeServiceAction(eventHandlerName, pseudoServiceModel, lineFilterFn) {\n\t\tlet serviceModel = pseudoServiceModel || (this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null);\n\t\tif(this.editorModel) {\n\t\t\tif (this._usesClientCalculator())\n\t\t\t\tthis.sortLines(this.editorModel.quoteModel.quoteVO, false);\n\t\t\t// Replaces lineItems on quoteVO with a reordered version after front end operations (i.e. drag and drop, clone lines, delete lines, etc) so the lineVOs are indexed correctly before sent to server\n\t\t\tthis.editorModel.quoteModel.quoteVO.lineItems = this._reorderLineItems();\n\t\t\tthis._reorderGroups();\n\t\t}\n\t\tlet quoteVO = this.editorModel ? this.editorModel.quoteModel.quoteVO : this.data.quote;\n\t\tlet referencedFieldMap = this.editorModel ? this.editorModel.data.settings.referencedFieldMap : this.data.settings.referencedFieldMap;\n\t\tconst essentialLines = (lineFilterFn && serviceModel) ? lineFilterFn(quoteVO, serviceModel) : quoteVO.lineItems;\n\t\tlet allLines = quoteVO.lineItems;\n\t\tquoteVO.partialVO = (allLines.length != essentialLines.length);\n\t\tquoteVO.lineItems = essentialLines;\n\t\tlet largeQuoteThreshold = this.data.settings.largeQuoteThreshold;\n\t\tlet isLargeQuote = largeQuoteThreshold && quoteVO.lineItems.length > largeQuoteThreshold;\n\t\tif ( (eventHandlerName === 'saveService' || eventHandlerName === 'quickSaveService') && isLargeQuote && SB && SB.QuoteDAO) {\n\t\t\tquoteVO.lineItems = allLines;\n\t\t\tquoteVO.partialVO = false;\n\t\t\tthis._saveLargeQuote(quoteVO, eventHandlerName);\n\t\t\treturn;\n\t\t}\n\t\tif (serviceModel) {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tserviceModel.quote = new JsonFormatter(true, false, false, referencedFieldMap).format(quoteVO);\n\t\t\tthis.$[eventHandlerName].model = serviceModel;\n\t\t} else {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tthis.$[eventHandlerName].model = new JsonFormatter(true, false, false, referencedFieldMap).format(quoteVO);\n\t\t}\n\t\tquoteVO.lineItems = allLines;\n\t\tquoteVO.partialVO = false;\n\t}\n\n\t_executeQuotelessServiceAction(eventHandlerName, pseudoServiceModel) {\n\t\tlet serviceModel = pseudoServiceModel || (this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null);\n\t\tif (serviceModel) {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tthis.$[eventHandlerName].model = serviceModel;\n\t\t} else {\n\t\t\tconsole.log('no service model means nothing to do');\n\t\t}\n\t}\n\n\t_saveLargeQuote(quoteVO, eventHandlerName) {\n\t\tlet prefix = this.app.org.prefix;\n\t\tlet client = new ConnectionClient(prefix);\n\t\tclient.getConnection().then(function(connection) {\n\t\t\tlet quoteDAO = new SB.QuoteDAO(prefix, connection, this.data.settings);\n\t\t\tlet promise = quoteDAO.saveQuote(quoteVO);\n\n\t\t\tpromise.then(function() {\n\t\t\t\t// override the sobject on connection here to avoid using apex batch jobs in QLE\n\t\t\t\tconnection.sobject = function() {\n\t\t\t\t\tconst self = this;\n\t\t\t\t\tfunction upsertBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncUpserter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction insertBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncInserter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction deleteBulk(records) {\n\t\t\t\t\t\treturn self._bulkService('oppSyncDeleter', records);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tupsertBulk: upsertBulk,\n\t\t\t\t\t\tinsertBulk: insertBulk,\n\t\t\t\t\t\tdeleteBulk: deleteBulk\n\t\t\t\t\t};\n\t\t\t\t}.bind(this);\n\t\t\t\tlet oppSync = new SB.QuoteOpportunitySynchronizer(this.data.settings, connection, prefix);\n\t\t\t\tlet promiseArray = [];\n\t\t\t\tpromiseArray.push(oppSync.updateOpportunityProducts(quoteVO));\n\t\t\t\tpromiseArray.push(this._checkIfRecordJobFailed(connection,prefix));\n\t\t\t\treturn Promise.all(promiseArray)\n\t\t\t\t\t.then((results) => {\n\t\t\t\t\t\tlet afterPromiseArray = [];\n\t\t\t\t\t\tafterPromiseArray.push(this._saveRateCardsAttachedToQuote(quoteVO));\n\t\t\t\t\t\tafterPromiseArray.push(Promise.resolve(results));\n\t\t\t\t\t\treturn Promise.all(afterPromiseArray);\n\t\t\t\t\t}).then( results => {\n\t\t\t\t\t\tif (results[1][1] === 'Failed') {\n\t\t\t\t\t\t\treturn this._SetRecordJobCompleted(connection,prefix).then(\n\t\t\t\t\t\t\t\tthis._handleLargeQuoteSaveResponse(eventHandlerName)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}else {\n\t\t\t\t\t\t\tthis._handleLargeQuoteSaveResponse(eventHandlerName);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.catch(function(err) {\n\t\t\t\tthis.error = this.$[eventHandlerName].createError(err);\n\t\t\t\tthis.showSpinner = false;\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t// TODO: THIS METHOD NEEDS TO BE DELETED ONCE WE SWITCH TO A CONSOLIDATED DAO SYSTEM.\n\t/**\n\t *\n\t * @param quoteVO\n\t * @private\n\t */\n\t_saveRateCardsAttachedToQuote(quoteVO) {\n\t\t// Put the rate cards we need to save into a list.\n\t\tlet rateCards = [];\n\t\tlet prefix = this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t\tquoteVO.lineItems.forEach((line) => {\n\t\t\t// If the line has any rate cards, add them to the list.\n\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\tline.rateCards.forEach((rateCard) => {\n\t\t\t\t\trateCard[prefix + 'QuoteLine__c'] = line.record.Id;\n\t\t\t\t});\n\n\t\t\t\trateCards = rateCards.concat(line.rateCards);\n\t\t\t}\n\t\t});\n\n\t\t// Declare a list to hold the saved rate cards.\n\t\tlet savedRateCards = [];\n\t\tlet cardSaverService = this.$['rateCardSaver'];\n\t\t// Feed the unsaved rate cards into the service, 200 records at a time, using this recursive method.\n\t\tlet saveBatch = (index) => {\n\t\t\tif (index >= rateCards.length) {\n\t\t\t\t// Base Case:\n\t\t\t\t// If the index is past the length of the list, we're done and can resolve to the saved cards array.\n\t\t\t\treturn Promise.resolve(savedRateCards);\n\t\t\t} else {\n\t\t\t\t// Induction Case:\n\t\t\t\t// If the index isn't past the end of the list, we feed the next 200 records into the service.\n\t\t\t\t// Then we concatenate the results onto our saved cards array and call the method again with the next 200 records.\n\t\t\t\treturn cardSaverService.save({model: rateCards.slice(index, index + 200)})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tsavedRateCards = savedRateCards.concat(response);\n\t\t\t\t\t\treturn saveBatch(index + 200);\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\t// Call the method with index 0 to start the process.\n\t\treturn saveBatch(0)\n\t\t\t.then(() => {\n\t\t\t\t// After having saved every rate card, we need to put them on the lines that they came from.\n\t\t\t\tlet cardIndex = 0;\n\t\t\t\tquoteVO.lineItems.forEach((line) => {\n\t\t\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\t\t\tline.rateCards = savedRateCards.slice(cardIndex, cardIndex + line.rateCards.length);\n\t\t\t\t\t\tcardIndex += line.rateCards.length;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t_checkIfRecordJobFailed(conn, prefix) {\n\t\tlet recordId = this.editorModel.quoteModel.quoteVO.record.Id;\n\t\tlet baseUrl = '/ServiceRouter?';\n\t\tif (prefix)\n\t\t\tbaseUrl = '/' + prefix + baseUrl;\n\n\t\tif(conn.oik !== undefined)\n\t\t\tbaseUrl += 'oik=' + conn.oik + '&';\n\n\t\tlet context = {\n\t\t\tcontext: JSON.stringify({\n\t\t\t\trecordId:recordId,\n\t\t\t\tjobType: \"QuoteCalculator\"\n\t\t\t})\n\t\t};\n\n\t\treturn conn.apex.patch(baseUrl+\"loader=JobCheckerServiceProvider.GetRecordJobStatus&uid=\"+ 'AllJobs', context);\n\t}\n\n\t_SetRecordJobCompleted(conn, prefix) {\n\t\tlet recordId=this.editorModel.quoteModel.quoteVO.record.Id;\n\t\tlet baseUrl = '/ServiceRouter';\n\t\tif (prefix)\n\t\t\tbaseUrl = '/' + prefix + baseUrl;\n\n\t\tif(conn.oik !== undefined)\n\t\t\tbaseUrl += '?oik=' + conn.oik;\n\n\t\tconst context = {\n\t\t\tsaver: \"JobCheckerServiceProvider.SetJobsStatus\",\n\t\t\tmodel: JSON.stringify({\n\t\t\t\trecordIds: [recordId],\n\t\t\t\tjobType: \"QuoteCalculator\",\n\t\t\t\tjobStatus: \"Completed\"\n\t\t\t})\n\t\t};\n\n\t\treturn conn.apex.post(baseUrl, context)\n\t\t\t.then(function(result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\t_bulkService(service, records) {\n\t\tlet results = [];\n\t\t// Make a copy so original array is not affected because it is used to populate parentID's\n\t\tlet recordsCopy = records.slice();\n\t\tlet executeBatch = function(service, records) {\n\t\t\treturn this.$[service].save({model: records.splice(0,200)})\n\t\t\t\t.then( (response) => {\n\t\t\t\t\tresults = results.concat(response);\n\t\t\t\t\tif (records.length > 0) {\n\t\t\t\t\t\treturn executeBatch(service, records);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.resolve(results);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}.bind(this);\n\n\t\treturn executeBatch(service, recordsCopy);\n\t}\n\n\t_handleLargeQuoteSaveResponse(eventHandlerName) {\n\t\tif (eventHandlerName === 'saveService') {\n\t\t\tthis.saverResponse = 'SUCCESS';\n\t\t} else if (eventHandlerName === 'quickSaveService') {\n\t\t\t// Ignores checking for product rule validation on large quotes\n\t\t\tthis._reloadEditor();\n\t\t\tlet lineEditorReader = this.domHost.$.sbLineEditorRead;\n\t\t\tlineEditorReader.clearFromCache();\n\t\t\tlineEditorReader.read();\n\t\t}\n\t}\n\n\t/**\n\t * Reorders lineItems on quoteVO before sent to server after front end operations (i.e. drag and drop, clone lines, delete lines, etc)\n\t * @return  {Array} lineItems - lineVOs that have been reordered\n\t * @private\n\t */\n\t_reorderLineItems() {\n\t\tlet lineItems = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, numOfGroups = groupModels.length; i < numOfGroups; i++) {\n\t\t\tlet groupModel = groupModels[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) {\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) {\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) {\n\t\t\t\t\t\t// push segments lineVO\n\t\t\t\t\t\tlineItems.push(segments[m].lineVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++)\n\t\t\t\tlineItems.push(groupModel.standardLines[n].lineVO);\n\t\t}\n\t\treturn lineItems;\n\t}\n\n\t_reorderGroups() {\n\t\tlet groupModels = this.domHost.groupModels;\n\t\tfor (let i = 0; i < groupModels.length; i ++ ) {\n\t\t\tgroupModels[i].groupVO.record[this.editorModel.constants.NUMBER_FIELD] = i + 1;    // Update groupVO number field\n\t\t}\n\t}\n\n\tupdateUIAfterCalculate(quoteVO) {\n\t\t// Runs after a calculate to update the UI\n\t\tlet sortRequired = quoteVO.lineSortField && quoteVO.lineSortField == this.editorModel.constants.NUMBER_FIELD;\n\t\tthis.domHost.updateAfterJSQC(this.notifier, sortRequired);\n\t\t// Sorts lines after a normal calculate\n\t\tif (!this.sortLines(quoteVO, true)) {\n\t\t\tthis.fire('iron-signal', {name: 'refresh-table'});\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-favorite-saved': '_saveFavorite',\n\t\t\t'sb-clone-to-group-selected': '_cloneToGroup',\n\t\t\t'job-completed': '_jobCompleted'\n\t\t};\n\t}\n\n\t_saveFavorite(e) {\n\t\t/**\n\t\t * Filters all lines except for lines contained in a bundle whose key is included in serviceModel.keys.\n\t\t * @callback lineFilterCallback\n\t\t * @param {Object} quote A quote whose lines will be filtered\n\t\t * @param {Object} serviceModel The service model object containing information about which lines should be kept.\n\t\t * @param {Number[]} serviceModel.keys A list of line keys that should be kept\n\t\t * @return {[]} An array of the quote lines that must be sent to the server\n\t\t */\n\t\tlet lineFilterFn = (quote, serviceModel) => {\n\t\t\t// If there are no lines, there's nothing to filter.\n\t\t\tlet noLines = quote.lineItems == null || quote.lineItems.length == 0;\n\t\t\t// If there are no specified keys, then we have nothing to filter.\n\t\t\tlet noEssentialKeys = serviceModel.keys == null || serviceModel.keys.length == 0;\n\t\t\tif (noLines || noEssentialKeys) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tlet keysToKeep = new Set();\n\t\t\t// This method will let us get the keys of all lines whose parent item has the provided key.\n\t\t\tlet getComponentKeys = (key) => {\n\t\t\t\t// Add the provided key to the set.\n\t\t\t\tkeysToKeep.add(key);\n\t\t\t\tquote.lineItems.forEach((line) => {\n\t\t\t\t\t// For every line whose parent has the provided key, add that line's key to the set.\n\t\t\t\t\tif (line.parentItemKey === key) {\n\t\t\t\t\t\tkeysToKeep.add(line.key);\n\t\t\t\t\t\t// If the child line is itself the root of a bundle, call the function recursively.\n\t\t\t\t\t\tif (line.record[this.data.developerPrefix + 'Bundle__c']) {\n\t\t\t\t\t\t\tgetComponentKeys(line.key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tserviceModel.keys.forEach(getComponentKeys);\n\t\t\tlet linesToKeep = [];\n\t\t\tquote.lineItems.forEach((line) => {\n\t\t\t\tif (keysToKeep.has(line.key)) {\n\t\t\t\t\tlinesToKeep.push(line);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn linesToKeep;\n\t\t};\n\t\tthis._executeServiceAction('favoriteLinesService', {keys: e.detail.keys, favName: e.detail.name, groupKey: e.detail.groupKey}, lineFilterFn);\n\t}\n\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_executeCustomAction(eventDetail)',\n\t\t\t'_handleCalculateResponse(calculateResponse)',\n\t\t\t'_checkForGuidedMessages(saverResponse)',\n\t\t\t'_reloadEditor(quoteEditorModelResponse)',\n\t\t\t'_handleFavoriteResponse(favoriteResponse)',\n\t\t\t'_handleUnfavoriteResponse(unfavoriteResponse)',\n\t\t\t'_handleResegmentResponse(resegmentResponse)',\n\t\t\t'_updateQuote(quoteVOResponse)',\n\t\t\t'_handleToggleGroupResponse(toggleGroupResponse)',\n\t\t\t'_handlePopupResponse(popupResponse)'\n\t\t];\n\t}\n\n\t_handleFavoriteResponse() {\n\t\t// The response we received from the server is going to be a partial quote that only has the lines that we favorited.\n\t\t// So we need to define a function that copies those changes back to the original quote.\n\t\tlet quoteReconcileFn = (updatedQuote, originalQuote) => {\n\t\t\tlet originalLines = originalQuote.lineItems;\n\t\t\t// First, we need to replace any lines that were sent to the server with their updated versions.\n\t\t\tlet originalLineCount = originalLines.length;\n\t\t\tif (updatedQuote.lineItems && updatedQuote.lineItems.length !== 0) {\n\t\t\t\tupdatedQuote.lineItems.forEach((line) => {\n\t\t\t\t\t// Get the key of the response line...\n\t\t\t\t\tlet key = line.key;\n\t\t\t\t\t// Then search the original line list for that key.\n\t\t\t\t\tfor (let i = 0; i < originalLineCount; i++) {\n\t\t\t\t\t\tif (originalLines[i].key === key) {\n\t\t\t\t\t\t\t// When we find that key, we replace the old line with the new one.\n\t\t\t\t\t\t\toriginalLines[i] = line;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t// Then we need to replace any groups that were sent to the server with their updated versions too.\n\t\t\tlet originalGroups = originalQuote.lineItemGroups;\n\t\t\tlet originalGroupCount = originalGroups.length;\n\t\t\tif (updatedQuote.lineItemGroups && updatedQuote.lineItemGroups.length !== 0) {\n\t\t\t\tupdatedQuote.lineItemGroups.forEach((group) => {\n\t\t\t\t\t// Get the key of the response group...\n\t\t\t\t\tlet key = group.key;\n\t\t\t\t\t// Then search the original group list for that key.\n\t\t\t\t\tfor (let i = 0; i < originalGroupCount; i++) {\n\t\t\t\t\t\tif (originalGroups[i].key === key) {\n\t\t\t\t\t\t\t// When we find that key, we replace the old group with the new one.\n\t\t\t\t\t\t\toriginalGroups[i] = group;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tupdatedQuote.lineItems = originalLines;\n\t\t\tupdatedQuote.lineItemGroups = originalGroups;\n\t\t\treturn updatedQuote;\n\t\t};\n\t\tthis.domHost.updateQuote(this.favoriteResponse, quoteReconcileFn);\n\t}\n\n\t_handleUnfavoriteResponse() {\n\t\tthis._removeFavoritesFromQuote(this.unfavoriteResponse);\n\t}\n\n\t_removeFavoritesFromQuote(favoriteIds) {\n\t\t// removeFavoriteResponse is going to be an array of all the IDs that were deleted. We convert it into a Set\n\t\t// so we can call the .has() method to easily check whether a line's favorite ID is one that was removed.\n\t\tlet favIdSet = new Set(favoriteIds);\n\t\tlet favFieldName = this.editorModel.constants.FAVORITE_ID_FIELD;\n\t\t// Any line that had this favorite ID should have its favorite field nulled.\n\t\tthis.editorModel.quoteModel.quoteVO.lineItems.forEach((line) => {\n\t\t\tif (favIdSet.has(line.record[favFieldName])) {\n\t\t\t\tline.record[favFieldName] = null;\n\t\t\t}\n\t\t});\n\n\t\t// Ditto for groups.\n\t\tthis.editorModel.quoteModel.quoteVO.lineItemGroups.forEach((group) => {\n\t\t\tif (favIdSet.has(group.record[favFieldName])) {\n\t\t\t\tgroup.record[favFieldName] = null;\n\t\t\t}\n\t\t});\n\t\t// Then we remove the favorite IDs from the quote's set of favorite IDs\n\t\tif (this.editorModel.quoteModel.quoteVO.favoriteIds) {\n\t\t\tlet favs = this.editorModel.quoteModel.quoteVO.favoriteIds;\n\t\t\tthis.editorModel.quoteModel.quoteVO.favoriteIds = favs.filter((favId) => {\n\t\t\t\t\treturn !favIdSet.has(favId);\n\t\t\t});\n\t\t}\n\t\t// Then we pass the QuoteVO up to the domHost to update it.\n\t\tthis._updateQuote(this.editorModel.quoteModel.quoteVO);\n\t}\n\n\n\n\t/**\n\t * Invoked with eventDetail is set. The eventDetail object looks like {customAction: CustomActionModel, model: QuoteModel, GroupModel, or LineModel}\n\t * If there is a function with the same name as the eventHandlerName, invoke it. Otherwise, execute the action.\n\t */\n\t_executeCustomAction() {\n\t\tlet action = this.eventDetail.customAction;\n\t\tif (typeof this[action.eventHandlerName] == \"function\") {\n\t\t\tthis[action.eventHandlerName]();\n\t\t} else if (action.url && action.urlTarget) {\n\t\t\tthis._executeCustomURLAction(action.url, action.urlTarget, this.eventDetail.model);\n\t\t} else {\n\t\t\tthis._executeServiceAction(this.eventDetail.customAction.eventHandlerName);\n\t\t}\n\t}\n\n\t/**\n\t * Interface to the onSave function to be used if custom action === \"Save and Navigate\"\n\t *\n\t * W-4682308: Custom action of Save And Navigate.\n\t * It saves the quote using the save logic however instead of navigating to return url,\n\t * we return the url given to us by the user.\n\t */\n\tonSaveAndNavigate() {\n\t\tthis.onSave();\n\t}\n\n\t_executeCustomURLAction(url, target, model) {\n\t\tif (model.quoteVO)\n\t\t\tthis.model = model.quoteVO;\n\t\telse if (model.lineVO)\n\t\t\tthis.model = model.lineVO;\n\t\telse if (model.groupVO)\n\t\t\tthis.model = model.groupVO;\n\n\t\tlet parsedURL = this._parseURL(url, this.model);\n\t\tif (target === 'Popup')\n\t\t\tthis._handlePopup(parsedURL, this.model.record);\n\t\telse\n\t\t\tthis._navigateToURL(parsedURL);\n\t}\n\n\t_handleCalculateResponse() {\n\t\tlet response = this.calculateResponse;\n\t\tif (response) {\n\t\t\t// if job id is exist, this implies that the background calculate was executed before.\n\t\t\tif ( response.jobId != null) {\n\t\t\t\tthis._onJobChecker(response);\n\t\t\t} else {\n\t\t\t\tthis._updateQuote(response);\n\t\t\t}\n\t\t}\n\t}\n\n\t_updateQuote(quoteVO) {\n\t\tthis.domHost.updateQuote(quoteVO);\n\t}\n\n\t_checkForGuidedMessages() {\n\t\tif (this.saverResponse.guidedMessages && this.saverResponse.guidedMessages.length > 0) {\n\t\t\tthis.domHost.handleProductRuleAlertModal('saveService', this.saverResponse);\n\t\t\tthis.showSpinner = false;\n\t\t} else {\n\t\t\t// Pass true to ensure validation process is called in navigateToReturnUrl\n\t\t\tthis.navigateToReturnUrl(true);\n\t\t}\n\t}\n\n\tnavigateToReturnUrl(args) {\n\t\t// when cancelling, no args are passed and we can just go to the detail page, skipping the validation process\n\t\tif(args && this.saverResponse && this.saverResponse.messages && this.saverResponse.messages.length > 0) {\n\t\t\tif (this.showSpinner)\n\t\t\t\tthis.showSpinner = false;\n\t\t\tthis.domHost.error = {validations: this.saverResponse.messages};\n\t\t\treturn;\n\t\t}\n\t\tlet returnUrl = \"\";\n\n\t\t// W-4682308: Custom action of Save And Navigate.\n\t\t// It saves the quote using the save logic however instead of navigating to return url,\n\t\t// we return the url given to us by the user.\n\t\tif (this.eventDetail.customAction.eventHandlerName === \"onSaveAndNavigate\") {\n\t\t\treturnUrl = this._parseURL(this.eventDetail.customAction.url, this.editorModel.quoteModel.quoteVO, this.editorModel.quoteModel);\n\t\t} else {\n\t\t\tlet sobjectId = this.editorModel.quoteModel.quoteVO.record.Id;\n\t\t\treturnUrl = this.eventDetail.customAction.record ? this.eventDetail.customAction.record[this.editorModel.constants.RETURN_URL_FIELD] : null;\n\t\t\tif (returnUrl) {\n\t\t\t\treturnUrl = this._parseURL(returnUrl, this.editorModel.quoteModel.quoteVO, this.editorModel.quoteModel);\n\t\t\t\tif ((returnUrl.length === 15 || returnUrl.length === 18) && returnUrl.match(/^[a-zA-Z0-9]*$/)) {\n\t\t\t\t\t// This is an ID\n\t\t\t\t\tsobjectId = returnUrl;\n\t\t\t\t\treturnUrl = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Only true if Large Quote Experience is enabled and the user is in full screen mode\n\t\t\tif (this.domHost.inFullScreenMode) {\n\t\t\t\tthis.domHost.exitFullScreenMode();\n\t\t\t}\n\n\t\t\t// Send a message to LDS to invalidate the quote in their cache\n\t\t\twindow.postMessage({acknowledgement: \"I acknowledge that this is an unsupported feature that may stop working at any time.\", recordId: sobjectId}, window.location.origin);\n\n\t\t\tif (!returnUrl) {\n\t\t\t\tif (this._isLightningExperience()) {\n\t\t\t\t\t//W-014658: mobile does not have a way to exit the Visualforce page besides the back button\n\t\t\t\t\tif (PageContainer.getViewport().isMobile() === true) {\n\t\t\t\t\t\tthis._navigateToURL('#/sObject/' + sobjectId + '/view');\n\t\t\t\t\t} else  {\n\t\t\t\t\t\tsforce.one.navigateToSObject(sobjectId);\n\t\t\t\t\t}\n\t\t\t\t\t// dismiss spinner if it's showing\n\t\t\t\t\tif (this.showSpinner) {\n\t\t\t\t\t\tthis.showSpinner = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t} else if (typeof Sfdc !== 'undefined' && Sfdc && Sfdc.Url) {\n\t\t\t\t\t// handle classic console app, which has isdtp=vw and needs to be preserved. Fix for W-4057287\n\t\t\t\t\tlet params = Sfdc.Url.getUrlParameters(window.location.href);\n\t\t\t\t\tif (params && params.isdtp === 'vw') {\n\t\t\t\t\t\twindow.location.href = `${this.editorModel.communityPrefix}/${sobjectId}?isdtp=vw`;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Check if in partner portal\n\t\t\treturnUrl = returnUrl || (this.editorModel.communityPrefix + '/') + sobjectId;\n\t\t}\n\n\t\tif (window.parent) {\n\t\t\t// For org\n\t\t\twindow.parent.location.href = returnUrl;\n\t\t} else {\n\t\t\t// For localhost\n\t\t\twindow.location.href = returnUrl;\n\t\t}\n\t}\n\n\t_reloadEditor() {\n\t\tthis.domHost.destampGroups(); //destroy the groups so that they can be rerendered;\n\t\tthis.domHost.md = undefined;\n\n\t\t// Wrap this in after next render so destampGroups has time to remove group elements.\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tlet largeQuoteThreshold = this.editorModel.data.settings.largeQuoteThreshold;\n\t\t\tif (largeQuoteThreshold == null || (this.editorModel.quoteModel.quoteVO.lineItems.length <= largeQuoteThreshold)) {\n\t\t\t\tthis.domHost.rawData = this.quoteEditorModelResponse;\n\t\t\t\tif (this.quoteEditorModelResponse.guidedMessages && this.quoteEditorModelResponse.guidedMessages.length > 0) {\n\t\t\t\t\tthis.domHost.handleProductRuleAlertModal('quickSaveService', this.quoteEditorModelResponse);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.showSpinner = false;\n\t\t});\n\t}\n\n\t/**\n\t * Event handler for response-event changed from sb-service (id=\"toggleGroupService\") component.\n\t * @private\n\t */\n\t_handleToggleGroupResponse() {\n\t\tthis.domHost.set('editorModel.quoteModel.quoteVO', this.toggleGroupResponse);\n\t\tif (this.domHost.$$('#quoteTabs'))\n\t\t\tthis.domHost.$$('#quoteTabs').destroyTabs();\n\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\n\t\tlet lineItemGroups = quoteModel.quoteVO.lineItemGroups;\n\t\tif (!quoteModel.grouped){ //Grouping the quote\n\t\t\tif (this.eventDetail.customAction.type === 'Solution Group') { this._extendSolutionGroupRecord(lineItemGroups[0].record)};\n\t\t\tthis.set('editorModel.quoteModel.grouped', true);\n\t\t\tthis.set('editorModel.quoteModel.quoteVO.lineItemGroups', quoteModel.quoteVO.lineItemGroups);\n\t\t} else { //Ungrouping the quote\n\t\t\tthis.domHost.set('editorModel.quoteModel.grouped', false);\n\t\t\t// Hides the \"Groups\" button that toggles the side panel\n\t\t\tthis.domHost.rightSideButton = false;\n\t\t\t// Notifies LEGroupLayout to close the group side panel\n\t\t\tthis.fire('iron-signal', {name: 'close-group-panel'});\n\t\t\tfor (let i =0; i < this.domHost.groupModels.length; i++) {\n\t\t\t\tthis.domHost.set('groupModels.' + i + '.groupVO', {});\n\t\t\t}\n\t\t}\n\t\tthis._updateQuote(quoteModel.quoteVO);\n\t\tif (this.domHost.viewport.isMobile()) {\n\t\t\tthis.domHost.buildQuoteTabs();\n\t\t}\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_handlePopupResponse() {\n\t\tswitch (this.popupResponse.action) {\n\t\t\tcase 'save':\n\t\t\t\tthis.onSave();\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\tthis.onQuickSave();\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\tlocation.reload();\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t_handlePopup(url, record) {\n\t\tlet popup = this.$.popup;\n\t\tpopup.url = url;\n\t\tpopup.messenger = new QuoteMessenger(this.editorModel, record);\n\t\tpopup.open();\n\t}\n\n\t_parseURL(url, targetModel, quoteModel) {\n\t\tlet parsedURL = url.replace(/{!(.*?)}/g, function(match, value) {\n\t\t\tlet record;\n\t\t\tlet splitValues = value.split('.');\n\t\t\tlet objectName = splitValues[0];\n\t\t\tif (objectName == 'SBQQ__Quote__c' || objectName == 'SBQQ__Quote__r' || objectName == 'Quote__c' || objectName == 'Quote__r') {\n\t\t\t\trecord = quoteModel.quoteVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else if (objectName == 'SBQQ__Group__c' || objectName == 'SBQQ__Group__r' || objectName == 'Group__c' || objectName == 'Group__r') {\n\t\t\t\trecord = quoteModel.groupsByKey[this.model.parentGroupKey].groupVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else {\n\t\t\t\trecord = targetModel.record;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < splitValues.length; i++) {\n\t\t\t\tif (i === splitValues.length - 1)\n\t\t\t\t\treturn record[splitValues[i]];\n\t\t\t\telse\n\t\t\t\t\trecord = record[splitValues[i]];\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn parsedURL;\n\t}\n\n\t_navigateToURL(url, isRedirect) {\n\t\tif (this._isLightningExperience()) {\n\t\t\t// W-3762767: isRedirect helps ensure canceling out of LE in Lightning Console does not open a new tab and leave the LE hanging in the current one\n\t\t\tsforce.one.navigateToURL(url, !!isRedirect);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce != 'undefined') && sforce && (!!sforce.one);\n\t}\n\n// Quote Actions\n\n\t/**\n\t * Sets the calculate service model\n\t *\n\t * @private\n\t */\n\tonFlagCalculate(showSpinner, updateQuoteRequired, doneCallback) {\n\t\tthis.domHost.errors = null;\n\t\tif (this._usesClientCalculator()) {\n\t\t\tthis._jsqcCalculate(showSpinner).then(function(res){\n\t\t\t\t// Runs after a quote service comes back from the server and it requires a calculation\n\t\t\t\t// Or if custom segments have changed and need to be reflected in UI\n\t\t\t\tif (updateQuoteRequired || res.updateQuoteRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tthis._updateQuote(res.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Runs after add products\n\t\t\t\tif (this.data.quote.calculationRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tif ( res.value.lineSortField && res.value.lineSortField != this.data.developerPrefix + 'Number__c' ) {\n\t\t\t\t\t\t// Unique sort to handle sorting line items that haven't been rendered yet (navigating from add products)\n\t\t\t\t\t\tres.value.lineItems = new SortLinesHandler(this.data.developerPrefix).sortLineItems(res.value.lineItems, res.value.lineSortField);\n\t\t\t\t\t}\n\t\t\t\t\tthis.domHost._createEditorModel();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.updateUIAfterCalculate(res.value);\n\t\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\t\tdoneCallback();\n\t\t\t}.bind(this), function(rej) {\n\t\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\t\tdoneCallback();\n\t\t\t\tif (this.editorModel !== undefined) {\n\t\t\t\t\tthis.domHost.error = rej;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//When errors get caught here the LE page is not usable.  So we display an alert with the message and a button that goes back to the last page\n\t\t\t\tthis.$.alertModal.displayContinueButton = false;\n\t\t\t\tthis.$.alertModal.cancelCB = function() {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}.bind(this);\n\t\t\t\tthis.$.alertModal.alerts = [rej.message];\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tthis.$.calculateService.model = undefined;\n\t\t\tthis.$.calculateService.background = showSpinner === false;\n\t\t\tthis._executeServiceAction('calculateService');\n\t\t\tif(typeof doneCallback === 'function')\n\t\t\t\tdoneCallback();\n\t\t}\n\t}\n\n\tonSave() {\n\t\tthis.showSpinner = true;\n\t\tthis.$.saveService.background = true;\n\t\tthis._save('saveService');\n\t}\n\n\tonQuickSave() {\n\t\tthis.$.quickSaveService.uid = this.editorModel.quoteModel.quoteVO.record.Id.substring(0, 15);\n\t\tthis.showSpinner = true;\n\t\tthis.$.quickSaveService.background = true;\n\t\t// Find the right key to navigate to after quick saving because the group keys of newly added groups will change after saving\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tlet groups = this.editorModel.quoteModel.lineGroups;\n\t\t\tfor (let i = 0, l = groups.length; i < l; i++) {\n\t\t\t\tif (groups[i].groupKey == this.domHost.selectedGroupKey) {\n\t\t\t\t\t// Group keys start at 2 after saving so use group index and add 2\n\t\t\t\t\tthis.domHost.returnGroupKeyAfterQuickSave = i + 2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.domHost.returnGroupKeyAfterQuickSave = null;\n\t\t}\n\t\tthis._save('quickSaveService');\n\t\tthis.fire('iron-signal', { name: 'quote-saved' });\n\t}\n\n\tonCancel() {\n\t\tthis.showSpinner = true;\n\t\tthis.navigateToReturnUrl();\n\t}\n\n\tonAddProducts() {\n\t\tthis._navigateToLookup('product');\n\t}\n\n\tonAddFavorites() {\n\t\tthis._navigateToLookup('favorite');\n\t}\n\n\t/**\n\t *   Invoked by the Quote-level multi-line Delete action\n\t */\n\tonDeleteLines() {\n\t\tif (this._usesClientCalculator()) {\n\t\t\tlet keysToDelete = new Set();\n\t\t\tthis._retrieveKeysOfSelected().forEach((key) => {\n\t\t\t\tkeysToDelete.add(key);\n\t\t\t});\n\t\t\tthis._deleteLines(keysToDelete, this.editorModel.quoteModel.quoteVO, true);\n\t\t\tthis.domHost.renumber();\n\t\t\tthis.onFlagCalculate(true, false);\n\t\t\tthis.domHost.quoteHasNoLines();\n\t\t\t// Render new tabs on large quote experience/mobile so that segmented or standard lines tabs can be re-rendered if needed\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled || this.editorModel.deviceContext.isMobile) {\n\t\t\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t\t\tthis.domHost.buildQuoteTabs();\n\t\t\t\t}\n\t\t\t\tfor (let i = 0, len = this.editorModel.quoteModel.lineGroups.length; i < len; i++) {\n\t\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: this.editorModel.quoteModel.lineGroups[i].groupKey}});\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis._executeServiceAction('onDeleteLine', {keys: this._retrieveKeysOfSelected()});\n\t\t}\n\t}\n\n\t/**\n\t *   Invoked by line-level Delete action\n\t */\n\tonDeleteLine() {\n\t\tif (this._usesClientCalculator()) {\n\t\t\tlet keyToDelete = new Set();\n\t\t\tkeyToDelete.add(this.eventDetail.model.serviceModel.keys[0]);\n\t\t\tthis._deleteLines(keyToDelete, this.editorModel.quoteModel.quoteVO, true);\n\t\t\tthis.domHost.renumber();\n\t\t\tthis.onFlagCalculate(true, false);\n\t\t\tthis.domHost.quoteHasNoLines();\n\t\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t\tthis.domHost.buildQuoteTabs();\n\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: this.eventDetail.model.groupModel.groupKey}});\n\t\t\t}\n\t\t\t// Render new tabs on large quote experience so that segmented or standard lines tabs can be re-rendered if needed\n\t\t\telse if (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: this.domHost.selectedGroupKey}});\n\t\t\t}\n\t\t} else {\n\t\t\tthis._executeServiceAction('onDeleteLine', {keys: this.eventDetail.model.serviceModel.keys});\n\t\t}\n\t}\n\n\tonAddGroup() {\n\t\tthis._resetOnActionSignal();\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis._addGroup(); // Called when quote is grouped to add a new empty group.\n\t\t} else {\n\t\t\tthis._groupQuote();\n\t\t}\n\t}\n\n\tonUngroup() {\n\t\tthis._resetOnActionSignal();\n\t\tthis._ungroupQuote();\n\t}\n\n\t_groupQuote() {\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet quoteVO = quoteModel.quoteVO;\n\t\tquoteVO.record[this.data.developerPrefix + 'LineItemsGrouped__c'] = true;\n\t\tif(quoteVO.lineItemGroups.length === 0) {\n\t\t\tlet defaultName = this.editorModel.data.customLabels.lbl_default_group_name;\n\n\t\t\tif(quoteVO.record[this.data.developerPrefix + 'DefaultGroupName__c']) {\n\t\t\t\tconst defaultNameDefined = quoteVO.record[this.data.developerPrefix + 'DefaultGroupName__c'];\n\t\t\t\tif(defaultNameDefined)\n\t\t\t\t\tdefaultName = defaultNameDefined;\n\t\t\t}\n\n\t\t\tlet constants = this.editorModel.constants;\n\t\t\tlet groupRecord = this._createGroupRecord(quoteModel);\n\t\t\tgroupRecord.Name = defaultName;\n\t\t\tgroupRecord[constants.NUMBER_FIELD] = 1;\n\n\t\t\t// Create a copy of groupRecord to disconnect property values in memory\n\t\t\tgroupRecord = JSON.parse(JSON.stringify(groupRecord));\n\n\t\t\tif (this.eventDetail.customAction.type === 'Solution Group') {\n\t\t\t\tthis._extendSolutionGroupRecord(groupRecord);\n\t\t\t}\n\n\t\t\tquoteModel.lineGroups[0].groupVO = {key: ++quoteModel.quoteVO.nextKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\n\t\t\tif(sb.common.core.AppContext.org.isMultiCurrencyOrg) {\n\t\t\t\tquoteModel.lineGroups[0].groupVO.CurrencyIsoCode = quoteVO.record['CurrencyIsoCode'];\n\t\t\t}\n\n\t\t\tquoteModel.grouped = true;\n\t\t\tquoteVO.lineItemGroups.push(quoteModel.lineGroups[0].groupVO);\n\t\t\tquoteModel.groupsByKey[quoteModel.lineGroups[0].groupVO.key] = quoteModel.lineGroups[0];\n\t\t\tdelete quoteModel.groupsByKey[null];\n\t\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\t\tindexByGroupKey[quoteModel.lineGroups[0].groupVO.key] = {index: Object.keys(indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\n\t\t\tquoteVO.lineItems.forEach(function (line) {\n\t\t\t\tline.parentGroupKey = quoteModel.lineGroups[0].groupVO.key;\n\t\t\t});\n\n\t\t\tthis.onFlagCalculate(true, true);\n\n\t\t\t// update selectedGroupKey to first group's key to render the first group in Single Group View\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis.domHost.set('selectedGroupKey', quoteModel.lineGroups[0].groupVO.key);\n\t\t\t}\n\t\t}\n\t}\n\n\t_ungroupQuote() {\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tquoteModel.indexByGroupKey[null] = {index: 0, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\tquoteModel.grouped = false;\n\t\tlet quoteVO = quoteModel.quoteVO;\n\t\tlet thePrefix = this.data.developerPrefix;\n\t\tlet deletedGroupIds = [];\n\t\t// Clear all groups in the quote\n\t\tif(quoteVO.lineItemGroups.length !== 0) {\n\t\t\tquoteVO.lineItemGroups.forEach((group) => {\n\t\t\t\tif(group.record.Id && deletedGroupIds.indexOf(group.record.Id) === -1)\n\t\t\t\t\tdeletedGroupIds.push(group.record.Id)\n\t\t\t});\n\t\t\t// clearGroups\n\t\t\tquoteVO.lineItemGroups = [];\n\t\t\tquoteVO.deletedGroupIds = deletedGroupIds;\n\t\t\tquoteVO.lineItems.forEach(function (line) {\n\t\t\t\tline.parentGroupKey = null;\n\t\t\t\tline.record[thePrefix + 'Group__c'] = null;\n\t\t\t});\n\t\t}\n\t\tquoteVO.record[thePrefix + 'LineItemsGrouped__c'] = false;\n\n\t\tthis.onFlagCalculate(true, true);\n\n\t\t// Hides the \"Groups\" button that toggles the side panel\n\t\tthis.domHost.rightSideButton = false;\n\t\t// Notifies LEGroupLayout to close the group side panel\n\t\tthis.fire('iron-signal', {name: 'close-group-panel'});\n\n\t\t// update selectedGroupKey to null to render the table/(s) for ungrouped quote in Single Group View\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.domHost.set('groupModels', []); //need this step to make sure it renders correctly after ungrouping a multi-group quote with an empty first group\n\t\t\tthis.domHost.set('selectedGroupKey', null);\n\t\t}\n\t}\n\n\tonResegmentLine() {\n\t\t// Before we do anything else, we should check whether the quote's size exceeds the Large Quote Threshold.\n\t\tlet largeQuoteThreshold = this.editorModel.data.settings.largeQuoteThreshold;\n\t\tlet largeQuoteMsg = this.editorModel.data.customLabels.msg_large_quote_sent_without_lines;\n\t\tif (largeQuoteThreshold != null && (largeQuoteThreshold < this.editorModel.quoteModel.quoteVO.lineItems.length)) {\n\t\t\t// If we exceeded the large quote threshold, we need to send a partial VO instead of a full one. We can provide a\n\t\t\t// filter function to _executeServiceAction() to make sure that unnecessary lines are omitted, but we still\n\t\t\t// need to manually populate extra aggregate data.\n\n\t\t\t// First, we need to define our filter function.\n\t\t\t/**\n\t\t\t * Returns a singleton list consisting solely of the line being resegmented.\n\t\t\t * @callback lineFilterCallback\n\t\t\t * @param {Object} quote A quote whose lines will be filtered\n\t\t\t * @param {Object} serviceModel The service model object containing information about which lines should be kept.\n\t\t\t * @param {Number[]} serviceModel.keys A list of line keys that should be kept\n\t\t\t * @return {[]} An array of the quote lines that must be sent to the server\n\t\t\t */\n\t\t\tlet filterFn = (quote, serviceModel) => {\n\t\t\t\t// We're resegmenting a single line, meaning that serviceModel.keys will be a singleton array.\n\t\t\t\tlet targetKey = serviceModel.keys[0];\n\t\t\t\t// Since we're only looking for one key, there will only be one line. However, we still must return it\n\t\t\t\t// as a singleton list.\n\t\t\t\tlet keptLines = [];\n\t\t\t\tlet lineCount = quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = quote.lineItems[i];\n\t\t\t\t\tif (line.key == targetKey) {\n\t\t\t\t\t\tkeptLines.push(line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn keptLines;\n\t\t\t};\n\t\t\t// Now that we've got a filter function, we need to get MDQ template information. That requires an aggregator\n\t\t\t// and the group key.\n\t\t\tlet groupKey = this.eventDetail.model.lineVO.parentGroupKey;\n\t\t\tlet quoteVO = this.editorModel.quoteModel.quoteVO;\n\t\t\tlet qla = new QuoteLineAggregator(quoteVO);\n\t\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(groupKey);\n\t\t\tquoteVO.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\t\tquoteVO.segmentTemplatesByDimensionTypeByGroupKey[(groupKey || -1) + ''] = templates;\n\t\t\t// Finally, we can't forget to log a message to the console indicating that lines are being skipped.\n\t\t\tlet lineOmissionMsg = largeQuoteMsg\n\t\t\t\t.replace('{0}', quoteVO.record.Id)\n\t\t\t\t.replace('{1}', largeQuoteThreshold);\n\t\t\tconsole.log(lineOmissionMsg);\n\t\t\t// Now that we've defined a function to omit the proper lines, provided the right MDQ template data\n\t\t\t// to the quote, and logged a message indicating what's happening, we can invoke _executeServiceAction().\n\t\t\tthis._executeServiceAction('onResegmentLine', null, filterFn);\n\t\t} else {\n\t\t\t// If we didn't exceed the large quote threshold, we can just invoke _executeServiceAction() as normal.\n\t\t\tthis._executeServiceAction('onResegmentLine');\n\t\t}\n\t}\n\n\t_handleResegmentResponse() {\n\t\t// We should remove the segment template information from the response quote so it doesn't linger around.\n\t\tdelete this.resegmentResponse.segmentTemplatesByDimensionTypeByGroupKey;\n\t\t// We can call this._updateQuote(), which will pass the response to the Line Editor. We need to provide that method\n\t\t// with a callback that it can use to reconcile the original QuoteVO with a partialVO.\n\t\tlet recombineFn = (updatedQuote, originalQuote) => {\n\t\t\t// In this case, all but one of the lines on Updated Quote are going to be new lines representing segments.\n\t\t\t// The other line is going to be the original line that was sent to the server, having been transformed into an MDQ line.\n\t\t\t// To recombine the two lists, we should remove the original version of the line from the list, and append all of the new\n\t\t\t// versions to the list.\n\n\t\t\t// Find the line for the first segment in the updated quote.\n\t\t\tlet firstSegmentKey;\n\t\t\tlet segCount = updatedQuote.lineItems.length;\n\t\t\tlet constants = this.editorModel.constants;\n\t\t\tfor (let i = 0; i < segCount; i++) {\n\t\t\t\tlet line = updatedQuote.lineItems[i];\n\t\t\t\tif (line.record[constants.SEGMENT_INDEX_FIELD] == 1) {\n\t\t\t\t\tfirstSegmentKey = line.key;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet combinedLineList = [];\n\t\t\toriginalQuote.lineItems.forEach((line) => {\n\t\t\t\t// All lines except for the original version of the resegmented line are added to the combined list.\n\t\t\t\tif (line.key !== firstSegmentKey) {\n\t\t\t\t\tcombinedLineList.push(line);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Now we append all of the new quote lines to the end of the list, and set that as our new list.\n\t\t\tcombinedLineList = combinedLineList.concat(updatedQuote.lineItems);\n\t\t\tupdatedQuote.lineItems = combinedLineList;\n\t\t\treturn updatedQuote;\n\t\t};\n\t\tthis.domHost.updateQuote(this.resegmentResponse, recombineFn);\n\t}\n\n\tonDesegmentLine() {\n\t\tlet constants = this.editorModel.constants;\n\t\t/**\n\t\t * @property {String} segmentKey - A key shared by all segments of the MDQ product being segmented.\n\t\t */\n\t\tlet serviceModel = this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null;\n\t\tlet segmentKey = serviceModel.segmentKey;\n\n\t\t// First, we need to find all of the lines in the MDQ product.\n\t\t// We need to do a serialization round-trip in order to avoid updating an in-use model, which would cause\n\t\t// all sorts of issues.\n\t\tlet quote = JSON.parse(JSON.stringify(this.editorModel.quoteModel.quoteVO));\n\t\tlet firstSegmentLine;\n\t\tlet keysToDelete = new Set();\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.record[constants.SEGMENT_KEY_FIELD] === segmentKey) {\n\t\t\t\t// We want to get the object corresponding to the first segment, and we want to get the keys of all the\n\t\t\t\t// other segments so we can delete them.\n\t\t\t\tif (line.record[constants.SEGMENT_INDEX_FIELD] === 1) {\n\t\t\t\t\tfirstSegmentLine = line;\n\t\t\t\t} else {\n\t\t\t\t\tkeysToDelete.add(line.key);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlet transformedLine = this._transformLineToNonSegmentedLine(firstSegmentLine);\n\t\t// If there are other segments, we need to delete those lines.\n\t\tif (keysToDelete.size !== 0) {\n\t\t\tthis._deleteLines(keysToDelete, quote, false);\n\t\t}\n\n\t\t// Create a new line item list, adding the original lines one-at-a-time.\n\t\tlet finalLineList = [];\n\t\t// If the transformed line is a child of something, we need to add it right after its parent.\n\t\tlet lookingForParent = transformedLine.parentItemKey != null;\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.key != transformedLine.key) {\n\t\t\t\tfinalLineList.push(line);\n\t\t\t}\n\t\t\tif (lookingForParent && transformedLine.parentItemKey == line.key) {\n\t\t\t\t// If this line is the parent line of our desegmented line, we also add that line and stop looking for\n\t\t\t\t// a parent.\n\t\t\t\tfinalLineList.push(transformedLine);\n\t\t\t\tlookingForParent = false;\n\t\t\t}\n\t\t});\n\n\t\t// If there was no parent line to look for, we should add the line to the list at the very end.\n\t\tif (transformedLine.parentItemKey == null) {\n\t\t\tfinalLineList.push(transformedLine);\n\t\t}\n\t\tquote.lineItems = finalLineList;\n\t\tquote.calculationRequired = true;\n\t\tthis._updateQuote(quote);\n\t}\n\n\t_deleteLines(keysToDelete, quote, includeSiblingSegments) {\n\t\tlet constants = this.editorModel.constants;\n\t\t// Get the indexes of every line we're deleting, so that we can easily remove them from the line item list later.\n\t\tlet deletedLineIndexes = new Set();\n\t\tlet deletedLineIds = new Set();\n\t\tlet deletedRateCardIds = new Set();\n\n\t\t// Add the keys for all related lines i.e. components and sibling MDQ segments\n\t\tlet relatedKeysToDelete = this._getAllRelatedKeys(keysToDelete, includeSiblingSegments);\n\t\tkeysToDelete = new Set([...keysToDelete, ...relatedKeysToDelete]);\n\n\t\tquote.lineItems.forEach((line, index) => {\n\t\t\tif (keysToDelete.has(line.key)) {\n\t\t\t\t// Store the list index for deletion later.\n\t\t\t\tdeletedLineIndexes.add(index);\n\t\t\t\t// Store the ID so we can remove it later.\n\t\t\t\tif (line.record.Id) {\n\t\t\t\t\tdeletedLineIds.add(line.record.Id);\n\t\t\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\t\t\tline.rateCards.forEach((rateCard) => {\n\t\t\t\t\t\t\tif (rateCard.Id) {\n\t\t\t\t\t\t\t\tdeletedRateCardIds.add(rateCard.Id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// If we delete a line from a favorited group, we've changed the structure of the group, and must therefore\n\t\t\t\t// unfavorite the group.\n\t\t\t\tif (line.parentGroup) {\n\t\t\t\t\tline.parentGroup.record[constants.FAVORITE_ID_FIELD] = null;\n\t\t\t\t}\n\t\t\t\t// If the line itself is a favorite, we must remove the favorite ID from the quote's list of favorite IDs\n\t\t\t\tif (line.record[constants.FAVORITE_ID_FIELD] && quote.favoriteIds) {\n\t\t\t\t\tlet favId = line.record[constants.FAVORITE_ID_FIELD];\n\t\t\t\t\tlet newFavIdList = [];\n\t\t\t\t\tquote.favoriteIds.forEach((fId) => {\n\t\t\t\t\t\tif (fId != favId) {\n\t\t\t\t\t\t\tnewFavIdList.push(fId);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tquote.favoriteIds = newFavIdList;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tlet updatedLineList = [];\n\n\t\t// Now that we know the indexes and IDs of all lines we're going to be deleting, we can create a new line item list\n\t\t// without those lines or any references to them.\n\t\tquote.lineItems.forEach(function(line, index) {\n\t\t\t// If the line index isn't one we're supposed to delete...\n\t\t\tif (!deletedLineIndexes.has(index)) {\n\t\t\t\t// Null out the Source ID field if it references a deleted line...\n\t\t\t\tif (deletedLineIds.has(line.record[constants.SOURCE_FIELD])) {\n\t\t\t\t\tline.record[constants.SOURCE_FIELD] = null;\n\t\t\t\t}\n\t\t\t\t// ...And add the line to the new line list.\n\t\t\t\tupdatedLineList.push(line);\n\t\t\t\t// Also null out the OriginalUsageRateCard__c field on any of the rate cards that reference deleted cards.\n\t\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\t\tline.rateCards.forEach((rateCard) => {\n\t\t\t\t\t\tif (deletedRateCardIds.has(rateCard[this.prefix + 'OriginalUsageRateCard__c'])) {\n\t\t\t\t\t\t\trateCard[this.prefix + 'OriginalUsageRateCard__c'] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Update the group models to ensure changes are reflected in later operations such as reorderLineItems (especially for when Enable Summary Lines is enabled)\n\t\t\t\tlet groupKey = line.parentGroupKey,\n\t\t\t\t\tgroupIndex = this.editorModel.quoteModel.indexByGroupKey[line.parentGroupKey].index;\n\t\t\t\tif (line.record[this.editorModel.constants.SEGMENT_KEY_FIELD]) {\n\t\t\t\t\tlet segmentKey = line.record[this.editorModel.constants.SEGMENT_KEY_FIELD],\n\t\t\t\t\t\tsegmentedLineModel = this.editorModel.quoteModel.lineModelsByKey[line.key];\n\n\t\t\t\t\t// Only MDQ Summary Lines (the one that's rendered on the UI) have a segments array, so we need to check if it's defined first\n\t\t\t\t\tif (segmentedLineModel.segments && segmentedLineModel.segments.length > 0) {\n\t\t\t\t\t\tlet dimType = segmentedLineModel.dimensionType,\n\t\t\t\t\t\t\tsegmentIndex = this.editorModel.quoteModel.indexByGroupKey[groupKey].indexBySegmentKey[segmentKey];\n\t\t\t\t\t\tsegmentedLineModel.segments = [];\n\t\t\t\t\t\t// Deletes the MDQ line from the UI, as the assignment only removes the segments from the data model\n\t\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimType}`, segmentIndex, 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet lineIndex = this.editorModel.quoteModel.indexByGroupKey[groupKey].indexByLineKey[line.key];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.standardLines`, lineIndex, 1);\n\t\t\t\t}\n\t\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t\t}\n\t\t}.bind(this));\n\t\tquote.lineItems = updatedLineList;\n\t\t// Now we need to combine the deletedLineIds set with the deletedLineIds array on the quoteVO.\n\t\tquote.deletedLineIds = quote.deletedLineIds || [];\n\t\tdeletedLineIds.forEach((id) => {\n\t\t\tquote.deletedLineIds.push(id);\n\t\t});\n\t}\n\n\n\t_transformLineToNonSegmentedLine(line) {\n\t\tlet constants = this.editorModel.constants;\n\n\t\t// Clear out these fields and properties to transform the first segment into a non-MDQ line.\n\t\tline.dimensionType = null;\n\t\tline.record[constants.DIMENSION_ID_FIELD] = null;\n\t\tline.record[constants.DIMENSION_FIELD] = null;\n\t\tline.record[constants.SEGMENT_KEY_FIELD] = null;\n\t\tline.record[constants.SEGMENT_INDEX_FIELD] = null;\n\t\tline.record[constants.SEGMENT_LABEL_FIELD] = null;\n\t\tline.record[constants.START_DATE_FIELD] = null;\n\t\tline.record[constants.END_DATE_FIELD] = null;\n\n\t\t// Respect the line's BundledQuantity.\n\t\tlet optionType = line.record[constants.OPTION_TYPE_FIELD];\n\t\tif (optionType && (optionType.toLowerCase() === 'component')) {\n\t\t\tline.record[constants.BUNDLED_QUANTITY_FIELD] = getActualQuantity(line);\n\t\t} else if (optionType && (optionType.toLowerCase() === 'accessory')) {\n\t\t\tline.record[constants.BUNDLED_QUANTITY_FIELD] = line.record[constants.QUANTITY_FIELD];\n\t\t}\n\t\treturn line;\n\n\t\tfunction getActualQuantity(line) {\n\t\t\tif (line.actualQuantity != null) {\n\t\t\t\treturn line.actualQuantity;\n\t\t\t}\n\t\t\tlet qty = line.record[constants.QUANTITY_FIELD];\n\t\t\tlet priorQty = line.record[constants.PRIOR_QUANTITY_FIELD] || 0;\n\t\t\tlet upgradedQty = line.record[constants.UPGRADED_QUANTITY] || 0;\n\n\t\t\treturn line.record[constants.EXISTING_FIELD] || line.record[constants.CARRYOVER_LINE_FIELD] ? qty - priorQty + upgradedQty : qty;\n\t\t}\n\t}\n\n// Quote/Group Actions\n\n\tonResetDiscounts() {\n\t\tthis.editorModel.quoteModel.resetDiscounts(this.eventDetail.model.groupKey);\n\t}\n\n\tupdateLineOptional() {\n\t\tlet groupKey;\n\t\tif (this.eventDetail.model.groupKey) {\n\t\t\tgroupKey = this.eventDetail.model.groupKey;\n\t\t}\n\t\tthis.editorModel.quoteModel.allOptional = this.eventDetail.customAction.caClass === 'optionalAllBtn';\n\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\tthis.notifyPath('editorModel.quoteModel.allOptional', this.editorModel.quoteModel.allOptional);\n\t\tthis.fire('iron-signal', {name: 'toggle-optional-clicked', data : {toggleOptionalBoolean : this.editorModel.quoteModel.allOptional, groupKey: groupKey}});\n\t}\n\n\tonUpgradeAssets() {\n\t\tthis._navigateToLookup('asset');\n\t}\n\n\tonRenewSubscriptions() {\n\t\tthis._navigateToLookup('subscription');\n\t}\n\n\tonAmendSubscriptions() {\n\t\tthis._navigateToLookup('subscription');\n\t}\n\n// Group Actions\n\n\tonCloneGroup() {\n\t\tthis.$.showSpinner = true;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet groupKey = this.eventDetail.model.serviceModel.keys[0];\n\t\tthis._cloneGroup(quoteModel, groupKey);\n\t\t// Delete the model so that the legacy calculator will send just the quote VO if enabled.\n\t\tdelete this.eventDetail.model;\n\t\tthis.onFlagCalculate(true, false);\n\t}\n\n\t_cloneGroup(quoteModel, groupKey) {\n\t\tlet groupModel = quoteModel.groupsByKey[groupKey];\n\t\tif(groupModel) {\n\t\t\tthis._addGroup(groupModel.groupVO);\n\t\t\tlet newGroup = quoteModel.groupsByKey[quoteModel.quoteVO.nextKey];\n\n\t\t\tif(newGroup) {\n\t\t\t\tlet linesInOtherGroupKey = new Set();\n\t\t\t\tlet allStandardLinesMap = groupModel.quoteModel.lineModelsByKey;\n\t\t\t\tfor(let key in allStandardLinesMap) {\n\t\t\t\t\tif(allStandardLinesMap.hasOwnProperty(key)) {\n\t\t\t\t\t\tif(!allStandardLinesMap[key].lineVO.parentItemKey && allStandardLinesMap[key].lineVO.parentGroupKey != groupKey) {\n\t\t\t\t\t\t\t// This is the collection of all line keys have no parent line and in a different group\n\t\t\t\t\t\t\tlinesInOtherGroupKey.add(allStandardLinesMap[key].lineVO.key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// For mdq items\n\t\t\t\tgroupModel.segmentedLines.forEach((originalLine) => {\n\t\t\t\t\tlet rootPackage = null;\n\t\t\t\t\t// A mdq's parent line is not in the target group\n\t\t\t\t\tif(originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// Check whether this mdq is part of a bundle whose root is in another group.\n\t\t\t\t\t\trootPackage = this._getRootPackage(allStandardLinesMap[originalLine.lineVO.parentItemKey], allStandardLinesMap);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the mdq's parent is in another group, the mdq is cloned by it's parent\n\t\t\t\t\tif(rootPackage && linesInOtherGroupKey.has(rootPackage.lineVO.key)) {\n\t\t\t\t\t\tthis._cloneLine(rootPackage, newGroup);\n\t\t\t\t\t} else if(!originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// When the mdq is a standalone, clone it.\n\t\t\t\t\t\tthis._cloneLine(originalLine, newGroup);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tgroupModel.standardLines.forEach((originalLine) => {\n\t\t\t\t\tif (!originalLine.lineVO.key) return; // Skip lines with undefined keys (ie. summary and subtotal rows when large quote experience is enabled)\n\t\t\t\t\tlet rootPackage = null;\n\t\t\t\t\t// A component's parent line is not in the target group\n\t\t\t\t\tif(originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// Check whether this component is part of a bundle whose root is in another group.\n\t\t\t\t\t\trootPackage = this._getRootPackage(allStandardLinesMap[originalLine.lineVO.parentItemKey], allStandardLinesMap);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(rootPackage && linesInOtherGroupKey.has(rootPackage.lineVO.key)) {\n\t\t\t\t\t\tthis._cloneLine(rootPackage, newGroup);\n\t\t\t\t\t} else if(!originalLine.lineVO.parentItemKey) {\n\t\t\t\t\t\t// When parent line is in the target group, send the parent line to clone the bundle.\n\t\t\t\t\t\tthis._cloneLine(originalLine, newGroup);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_getRootPackage(component, allStandardLinesMap) {\n\t\tif(component.lineVO.parentItemKey) {\n\t\t\treturn this._getRootPackage(allStandardLinesMap[component.lineVO.parentItemKey], allStandardLinesMap);\n\t\t} else {\n\t\t\treturn component;\n\t\t}\n\t}\n\n\tonDeleteGroup() {\n\t\tif (this.editorModel.quoteModel.isAmendmentOrChangeQuote && !this.eventDetail.model.canDelete()) {\n\t\t\tthis.domHost.errors = [this.domHost.i18n.l(\"You cannot delete this Group as it contains Quote Lines being amended.\")];\n\t\t\treturn;\n\t\t}\n\n\t\tif (confirm('All lines will also be deleted. Are you sure you want to delete this group?')) {\n\t\t\tthis._deleteGroup();\n\t\t}\n\t}\n\n\t_deleteGroup() {\n\t\tlet groupKey = this.eventDetail.model.serviceModel.keys[0];\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\n\t\t// This is for onFlagCalculate function.\n\t\t// When using legacy calculator,\n\t\t// set eventDetail model to undefined so in _executeServiceAction can generate correct JSON.\n\t\t// The _executeServiceAction is run only when it's using legacy calculator in onFlagCalculate function.\n\t\tthis.eventDetail.model = undefined;\n\n\t\tif (quoteModel.groupsByKey != null) {\n\t\t\tthis._removeGroup(quoteModel, groupKey);\n\t\t\tthis.onFlagCalculate(true, true);\n\t\t\tthis._updateQuote(quoteModel.quoteVO);\n\n\t\t\t// Close panel when number of groups is reduced to one because there is no side panel in that case\n\t\t\tif (quoteModel.lineGroups.length == 1) {\n\t\t\t\tthis.fire('iron-signal', {name: 'close-group-panel'});\n\t\t\t}\n\n\t\t\t// update selectedGroupKey to first group's key to render the first group in Single Group View\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled && quoteModel.lineGroups[0]) {\n\t\t\t\tthis.fire('iron-signal', {name: 'group-deleted', data: {groupKey: quoteModel.lineGroups[0].groupKey}});\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeGroup(quoteModel, groupKey) {\n\t\t// Check to make sure no components are deleted unless the parent is also deleted\n\t\tlet removeGroup = true;\n\t\tlet parentItemKeys = new Set();\n\t\tif(quoteModel.quoteVO.lineItems.length > 0) {\n\t\t\t// Get the all the parents from the lines in the target group,\n\t\t\t// then use the collection to make sure the parents are also in the target group.\n\t\t\t// The lines can only be deleted when the parents and the lines are in the target group.\n\t\t\tquoteModel.quoteVO.lineItems.forEach(function (lineItem) {\n\t\t\t\tif (lineItem.parentItemKey && lineItem.parentGroupKey == groupKey) {\n\t\t\t\t\tparentItemKeys.add(lineItem.parentItemKey);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tquoteModel.quoteVO.lineItems.forEach(function (lineItem) {\n\t\t\t\tif (lineItem.parentGroupKey != groupKey && parentItemKeys.has(lineItem.key)) {\n\t\t\t\t\t// Do not delete the group\n\t\t\t\t\tremoveGroup = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(removeGroup) {\n\t\t\t\tlet deletedLineIds = new Set();\n\t\t\t\tlet deletedRateCardIds = new Set();\n\t\t\t\t// Create a new line list consisting of only lines not in the target group\n\t\t\t\tlet newLines = [];\n\t\t\t\tquoteModel.quoteVO.lineItems.forEach((line) => {\n\t\t\t\t\tif (line.parentGroupKey != groupKey) {\n\t\t\t\t\t\tnewLines.push(line);\n\t\t\t\t\t} else if(line.record.Id && !deletedLineIds.has(line.record.Id)) {\n\t\t\t\t\t\tdeletedLineIds.add(line.record.Id);\n\t\t\t\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\t\t\t\tline.rateCards.forEach((rateCard) => {\n\t\t\t\t\t\t\t\tif (rateCard.Id) {\n\t\t\t\t\t\t\t\t\tdeletedRateCardIds.add(rateCard.Id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnewLines.forEach((line) => {\n\t\t\t\t\tif (deletedLineIds.has(line.record[this.editorModel.constants.SOURCE_FIELD])) {\n\t\t\t\t\t\tline.record[this.editorModel.constants.SOURCE_FIELD] = null;\n\t\t\t\t\t}\n\t\t\t\t\tif (line.rateCards && line.rateCards.length > 0) {\n\t\t\t\t\t\tline.rateCards.forEach((rateCard) => {\n\t\t\t\t\t\t\tif (deletedRateCardIds.has(rateCard[this.prefix + 'OriginalUsageRateCard__c'])) {\n\t\t\t\t\t\t\t\trateCard[this.prefix + 'OriginalUsageRateCard__c'] = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tquoteModel.quoteVO.deletedLineIds = quoteModel.quoteVO.deletedLineIds.concat(...deletedLineIds);\n\t\t\t\tquoteModel.quoteVO.lineItems = newLines;\n\t\t\t}\n\t\t}\n\n\t\tif(removeGroup) {\n\t\t\t// Create a new line item group list consisting of only line item groups not in the target group\n\t\t\tlet newlineItemGroups = [];\n\t\t\tlet deletedGroupIds = [];\n\t\t\tquoteModel.quoteVO.lineItemGroups.forEach((ligroup) => {\n\t\t\t\tif (ligroup.key != groupKey) {\n\t\t\t\t\tnewlineItemGroups.push(ligroup);\n\t\t\t\t} else if(ligroup.record.Id && deletedGroupIds.indexOf(ligroup.record.Id) == -1) {\n\t\t\t\t\tdeletedGroupIds.push(ligroup.record.Id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tquoteModel.quoteVO.lineItemGroups = newlineItemGroups;\n\t\t\tquoteModel.quoteVO.deletedGroupIds = quoteModel.quoteVO.deletedGroupIds.concat(deletedGroupIds);\n\n\t\t\t// Create a new line group list consisting of only line groups not in the target group\n\t\t\tlet newlineGroups = [];\n\t\t\tquoteModel.lineGroups.forEach((lgroup) => {\n\t\t\t\tif (lgroup.groupKey != groupKey) {\n\t\t\t\t\tnewlineGroups.push(lgroup);\n\t\t\t\t}\n\t\t\t});\n\t\t\tquoteModel.lineGroups = newlineGroups;\n\n\t\t\tdelete quoteModel.groupsByKey[groupKey];\n\t\t\tdelete quoteModel.indexByGroupKey[groupKey];\n\t\t}\n\t}\n\n// Line Actions\n\n\tonReconfigureLine() {\n\t\tlet params = {\n\t\t\tlineKey: this.eventDetail.model.lineVO.key,\n\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\tignoreCache: true\n\t\t};\n\t\t// Pass in the group key when quote is grouped, in order to make sure that any satisfied product rules add new lines\n\t\t// to the correct group.\n\t\tif (this.eventDetail.model.groupModel.quoteModel.grouped) {\n\t\t\tparams.groupKey = this.eventDetail.model.groupModel.groupKey;\n\t\t}\n\t\tNavigator.nav('#', params, ['product', 'pc'], false, this);\n\t}\n\n\tonAddToFavorites() {\n\t\tthis._openDialog('favDialog');\n\t}\n\n\tonRemoveFromFavorites() {\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tif (!confirm('Are you sure you want to remove the favorite?'))\n\t\t\t\treturn;\n\t\t} else {\n\t\t\tif (!confirm('All lines will be removed from favorites. Are you sure you want to remove this group from favorites?'))\n\t\t\t\treturn;\n\t\t}\n\t\tthis._executeQuotelessServiceAction('onRemoveFromFavorites');\n\t}\n\n\t/**\n\t * Executed after the dual-list-box component sends back the selected groups, takes each selected line and clones into the group selected\n\t * @private\n\t * @param e - Object, the event containing the selected groups sent from the dual-list-box component\n\t */\n\t_cloneToGroup(e) {\n\t\tlet selectedGroups = e.detail;\n\t\tif (selectedGroups.length === 0)\n\t\t\treturn;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet constants = this.editorModel.constants;\n\t\tlet lineEditor = this.domHost;\n\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\tfor (let lineKey in this.selectedLinesByKey) {\n\t\t\tlet originalLine = this.selectedLinesByKey[lineKey];\n\t\t\tfor (let i = 0, l = selectedGroups.length; i < l; i++) {\n\t\t\t\t// The value of the selected group is the groupKey\n\t\t\t\tlet groupModel = quoteModel.groupsByKey[selectedGroups[i].value];\n\t\t\t\tthis._cloneLine(originalLine, groupModel);\n\t\t\t}\n\t\t\tlet indexes = indexByGroupKey[originalLine.lineVO.parentGroupKey];\n\t\t\tlet groupIndex = indexes.index;\n\t\t\tlet lineIndex = originalLine.segmented ? indexes.indexBySegmentKey[originalLine.lineVO.record[constants.SEGMENT_KEY_FIELD]] : indexes.indexByLineKey[lineKey];\n\t\t\tthis._clearSelectedCheckbox(lineIndex, groupIndex, lineEditor, originalLine.lineVO.dimensionType);\n\t\t}\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tfor (let j = 0, len = selectedGroups.length; j < len; j++) {\n\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: selectedGroups[j].value}});\n\t\t\t}\n\t\t}\n\t\tthis.onFlagCalculate(true, false);\n\t}\n\n\t_clearSelectedCheckbox(lineIndex, groupIndex, emitter, dimension) {\n\t\tif (dimension) {\n\t\t\temitter.set(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimension}.${lineIndex}.selected`, false);\n\t\t} else {\n\t\t\temitter.set(`groupModels.${groupIndex}.standardLines.${lineIndex}.selected`, false);\n\t\t}\n\t}\n\n\t/**\n\t * Clones line items\n\t * @private\n\t * cloneLines and clonedSegmentedLines are holding arrays used to keep a list of the lines that need to be cloned\n\t */\n\tonCloneLine() {\n\t\t// Check if current line is selected there are multiple lines selected\n\t\t// else call cloneLine\n\t\tlet originalLine = this.eventDetail.model;\n\t\tif (originalLine.selected && this.editorModel.quoteModel.grouped) {\n\t\t\tthis.selectedLinesByKey = this.editorModel.quoteModel.selectedLinesByKey;\n\n\t\t\tlet cloneToGroupDialog = this.$.cloneToGroupDialog;\n\t\t\tcloneToGroupDialog.quoteModel = this.editorModel.quoteModel;\n\n\t\t\tcloneToGroupDialog.open();\n\t\t} else {\n\t\t\tthis._cloneLine(originalLine);\n\t\t}\n\t\t// We need to delete the event detail model, in order to make sure that flag calculating will send just the quote VO\n\t\t// when the legacy calculator is enabled.\n\t\tdelete this.eventDetail.model;\n\t\tthis.onFlagCalculate(true, false);\n\t}\n\n\t_cloneLine(line, groupSelected) {\n\t\tlet clonedLines = []; // list of cloned standard lines\n\t\tlet clonedSegmentedLines = {Year: {lines: []}, Quarter: {lines: []}, Month: {lines: []}, Custom: {lines: []}}; // list of cloned segmented summary lines by dimension\n\t\tlet groupModels = this.domHost.groupModels;\n\t\tlet groupKey = groupSelected ? groupSelected.groupKey : line.lineVO.parentGroupKey;\n\t\tlet groupIndex = groupKey ? this.editorModel.quoteModel.indexByGroupKey[groupKey].index : 0;\n\n\t\t/**\n\t\t * Recursively populates the clonedLines and clonedSegmentedLines arrays that hold cloned line models\n\t\t * @param line - lineModel, will either be the standard line being cloned and if bundle first is the parent line of the bundle then recursively called for each option that belongs to the bundle\n\t\t * @param parentItemKey - unique identifier that establishes the link between bundle and component line\n\t\t * @param clonedLines - array that holds cloned standard lines\n\t\t * @param clonedSegmentedLines - array that holds clones segmented lines\n\t\t * @private\n\t\t */\n\t\tlet _addParentAndAllChildLineItems = (line, parentItemKey) => {\n\t\t\tlet clone;\n\t\t\tif (line.segmented) {\n\t\t\t\tclone = groupModels[groupIndex].cloneSegmentedLine(line, parentItemKey, groupSelected);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].lines.push(clone);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].key = line.lineVO.key;\n\t\t\t} else {\n\t\t\t\tclone = groupModels[groupIndex].cloneLine(line, parentItemKey, groupSelected);\n\t\t\t\tclonedLines.push(clone);\n\t\t\t}\n\t\t\tgroupModels[groupIndex].addToLinesByParentItemKey(clone); // update linesByParentItemKey map for the new bundle\n\n\t\t\t// if line is a bundle, execute this method for each component recursively\n\t\t\tif (line.bundle) {\n\t\t\t\tif (groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key]) {\n\t\t\t\t\tlet components = groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key];\n\t\t\t\t\tfor (let i = 0, l = components.length; i < l; i++) {\n\t\t\t\t\t\t_addParentAndAllChildLineItems(components[i], clone.lineVO.key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned standard lines into the group's standardLines array and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedLines - the holding array containing the lines that need to be cloned, will be spliced into groupModel.standardLines\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tlet _addClonedLines = () => {\n\t\t\tlet standardLinesLength = groupModels[groupIndex].standardLines.length;\n\t\t\tif (clonedLines.length > 0) {\n\t\t\t\t// find the index of the original line within the group\n\t\t\t\tlet idx;\n\t\t\t\tlet i,\n\t\t\t\t\tlen = groupModels[groupIndex].standardLines.length;\n\t\t\t\t// if clone to group is invoking this method, set the index to the end of the group\n\t\t\t\t// else find the index to insert it at\n\t\t\t\tif (groupSelected) {\n\t\t\t\t\tidx = len;\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tif (line.lineVO.key === groupModels[groupIndex].standardLines[i].lineVO.key) {\n\t\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// if the original line is a bundle, increment the index until we reach a non-component item\n\t\t\t\tif (line.bundle) {\n\t\t\t\t\tif (!this.editorModel.data.settings.bundleKeptTogether) {\n\t\t\t\t\t\tidx = len;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let j = i; j < len; j++) {\n\t\t\t\t\t\t\tif (!groupModels[groupIndex].standardLines[j].component && groupModels[groupIndex].standardLines[j].lineVO.key !== line.lineVO.key) {\n\t\t\t\t\t\t\t\tidx = j;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else { // Assign idx to end of groupModel.standardLines in case bundle is indexed at the end to avoid idx not getting set, will be overridden by the above if assignment in case the bundle is not at the end of the array\n\t\t\t\t\t\t\t\tidx = len;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// add cloned lines to the standardLines array of the group and the lineVO's to the quoteVO\n\t\t\t\tfor (let k = 0, l = clonedLines.length; k < l; k++) {\n\t\t\t\t\tlet clonedLine = clonedLines[k];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.standardLines`, idx, 0, clonedLine);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(clonedLine.lineVO);\n\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[clonedLine.lineVO.key] = clonedLine;\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\n\t\t\t\tif (this.editorModel.deviceContext.isMobile && standardLinesLength === 0) {\n\t\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: groupSelected.groupKey}});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned segmented lines into the group's segmentedLinesByDimension array it should belong in and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedSegmentedLines - the holding array containing the lines that need to be cloned, will be spliced into the dimensionType on segmentedLinesByDimension\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tlet _addClonedSegmentedLines = () => {\n\t\t\tfor (let dimension in clonedSegmentedLines) {\n\t\t\t\tif (!(clonedSegmentedLines[dimension].lines.length > 0)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet idx = 0;\n\t\t\t\tlet segmentedLinesToSplice = clonedSegmentedLines[dimension].lines;\n\t\t\t\tlet segmentedLines = groupModels[groupIndex].segmentedLinesByDimension[dimension];\n\t\t\t\tlet segmentedLinesLength = segmentedLines.length; // used to check if we need to destroy tabs for clone to group\n\t\t\t\tlet lastSegmentedLineKey = clonedSegmentedLines[dimension].key;\n\t\t\t\t// if clone to group is invoking this method, set the index to the end of the segmented lines table for the group\n\t\t\t\t// else find the index to insert it at\n\t\t\t\tif (groupSelected) {\n\t\t\t\t\tidx = segmentedLinesLength;\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, l = segmentedLines.length; i < l; i++) {\n\t\t\t\t\t\tif (segmentedLines[i].lineVO.key === lastSegmentedLineKey) {\n\t\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let j = 0, len = segmentedLinesToSplice.length; j < len; j++) {\n\t\t\t\t\tlet segmentedLineModelToSplice = segmentedLinesToSplice[j];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimension}`, idx + j, 0, segmentedLineModelToSplice);\n\t\t\t\t\t// Need to push it in the segmentsLines array as well because the segmentLines are being used in the delete lines @ Quote level\n\t\t\t\t\tthis.domHost.push(`groupModels.${groupIndex}.segmentedLines`, segmentedLineModelToSplice);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tfor (let k = 0; k < segmentedLineModelToSplice.segments.length; k++) {\n\t\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(segmentedLineModelToSplice.segments[k].lineVO);\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[k].lineVO.key] = segmentedLineModelToSplice.segments[k];\n\t\t\t\t\t}\n\t\t\t\t\tif (segmentedLineModelToSplice.segments.length > 0) {\n\t\t\t\t\t\t// set segments and dimensionType of the first segment only\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[0].lineVO.key].segments = segmentedLineModelToSplice.segments;\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[0].lineVO.key].dimensionType = segmentedLineModelToSplice.dimensionType;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (segmentedLinesLength === 0) {\n\t\t\t\t\tthis.fire('iron-signal', {name: 'render-new-tab', data: {groupKey: groupSelected.groupKey}});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t_addParentAndAllChildLineItems(line);\n\t\t_addClonedLines();\n\t\t_addClonedSegmentedLines();\n\t\tthis.domHost.renumber();\n\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t}\n\n\n// Helper functions\n\n\t_usesClientCalculator() {\n\t\treturn this.data.settings.usesClientCalculator;\n\t}\n\n\t_jsqcCalculate(showSpinner) {\n\t\t// Prevents this showSpinner from overriding showSpinner initiated by a save\n\t\tthis.showSpinner = showSpinner || showSpinner == null ? true : this.showSpinner;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (SB && SB.JSQC) {\n\t\t\t\tlet res = {};\n\t\t\t\tlet settings = this.data.settings;\n\t\t\t\tlet client = new ConnectionClient(this.app.org.prefix);\n\t\t\t\tthis.notifier = !this.data.quote.calculationRequired && this.domHost.editorModel ? new JSQCNotifier(this.domHost) : null;\n\t\t\t\tsettings.displayedLookupMap = this.getDisplayedLookupNames(this.data);\n\t\t\t\tlet mdqHelper = this.editorModel ? new MDQSegmentHelper(this.data, this.editorModel.quoteModel.groupsByKey) : new MDQSegmentHelper(this.data, null);\n\t\t\t\tconst segmentsChanged = mdqHelper.updateSegments();\n\t\t\t\tif (segmentsChanged && !this.data.quote.calculationRequired) {\n\t\t\t\t\tres.updateQuoteRequired = true;\n\t\t\t\t\tthis.notifier = null;\n\t\t\t\t}\n\t\t\t\tlet qc = new SB.JSQC(settings, this.data.quote, this.notifier);\n\t\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\t\tlet connectionPromiseArray = [client.getConnection(), client.getConnection()];\n\t\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\t\tlet promise = qc.onCalc();\n\t\t\t\t\tpromise.then(function(successQuote) {\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\tres.value = successQuote;\n\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\treject({message: \"ERROR: Could not find the Client-Side Calculator\"});\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetDisplayedLookupNames(data) {\n\t\tlet results = {'line': [], 'group': [], 'quote': []};\n\n\t\t// Retrieve lookup objects and convert to array so we can cycle through and replace the fields with their relationship fields\n\t\tlet lineFields = (data.settings.lineLookups) ? Object.keys(data.settings.lineLookups) : [];\n\t\tlet groupFields = (data.settings.groupLookups) ? Object.keys(data.settings.groupLookups) : [];\n\t\tlet quoteFields = (data.settings.quoteLookups) ? Object.keys(data.settings.quoteLookups) : [];\n\n\t\tlineFields.forEach(function (field) {\n\t\t\tresults.line.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tgroupFields.forEach(function (field) {\n\t\t\tresults.group.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tquoteFields.forEach(function (field) {\n\t\t\tresults.quote.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\treturn results;\n\t}\n\n\t_onJobChecker(job){\n\t\tjob.jobType = 'QuoteCalculator';\n\t\tthis.$.jobchecker.useSpinner = !this.$.calculateService.background;\n\t\tthis.$.jobchecker.data = job;\n\t}\n\n\t_jobCompleted() {\n\t\tif (this.$.jobchecker.result.payload != null) {\n\t\t\tlet quote = JSON.parse(this.$.jobchecker.result.payload);\n\t\t\tquote.backgroundCalculatePending = false;\n\t\t\tif (this.saveServiceAfterBackgroundCalc) {\n\t\t\t\t// Update quoteModel so the newly calculated quote reference is used in preparation for the save\n\t\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\t\tthis._executeServiceAction(this.saveServiceAfterBackgroundCalc);\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.domHost.updateQuote(quote);\n\t\t}\n\t}\n\n\t_save(saveService) {\n\t\tif (this.editorModel.data.settings.usesClientCalculator) { // Check if jsqc should be used\n\t\t\tthis._jsqcCalculate(false).then(function(res) {\n\t\t\t\t// Since the calculation was performed here, and the server will make no further changes, there is no reason\n\t\t\t\t// not to validate asset quantities here. So do that.\n\t\t\t\tlet aqv = new AssetQuantityValidator(this.editorModel.quoteModel.quoteVO, this.editorModel.constants);\n\t\t\t\tconst invalidQtyMessages = aqv.validateAssetQuantityChanges();\n\t\t\t\tif (invalidQtyMessages.length !== 0) {\n\t\t\t\t\t// If any messages about invalid quantities were returned, display them instead of triggering the service action.\n\t\t\t\t\tthis.domHost.error = {validations: invalidQtyMessages};\n\t\t\t\t} else {\n\t\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t\t}\n\t\t\t}.bind(this), function(rej) {\n\t\t\t\tthis.domHost.error = rej;\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\t// If background calc enabled, need to run background calc and wait for response before triggering the correct save\n\t\t\tif (this.editorModel.data.settings.usesBackgroundCalculator) {\n\t\t\t\t// This property is used in _onJobChecker to trigger a save after job is complete\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = saveService;\n\t\t\t\tthis.onFlagCalculate(false);\n\t\t\t} else {\n\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t}\n\t\t}\n\t}\n\n\t_navigateToLookup(lookupName) {\n\t\tthis._resetOnActionSignal();\n\t\tthis.domHost.errors = null;\n\t\tlet queryParams = {\n\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\taId : this.eventDetail.customAction.customActionId\n\t\t};\n\t\tif (this.eventDetail.model && this.eventDetail.model.groupKey)\n\t\t\tqueryParams.groupKey = this.eventDetail.model.groupKey;\n\n\t\tNavigator.nav('#', queryParams, [lookupName, 'lookup'], false, this);\n\t}\n\n\t_retrieveKeysOfSelected() {\n\t\tlet keys = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, gmLength = groupModels.length; i < gmLength; i++) {\n\t\t\tlet standardLines = groupModels[i].standardLines;\n\t\t\tfor (let j = 0, standardLinesLength = groupModels[i].standardLines.length; j < standardLinesLength; j++) {\n\t\t\t\tif (standardLines[j].selected && standardLines[j].removable)\n\t\t\t\t\tkeys.push(standardLines[j].lineVO.key);\n\t\t\t}\n\t\t\tlet segmentedLines = groupModels[i].segmentedLines;\n\t\t\tfor (let j = 0, segmentedLinesLength = segmentedLines.length; j < segmentedLinesLength; j++) {\n\t\t\t\tif (segmentedLines[j].selected && segmentedLines[j].removable){\n\t\t\t\t\tlet segments = segmentedLines[j].segments;\n\t\t\t\t\tfor (let k = 0, segmentsLength = segments.length; k < segmentsLength; k++)\n\t\t\t\t\t\tkeys.push(segments[k].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn keys;\n\t}\n\n\t_getAllRelatedKeys(keys, includeSiblingSegments) {\n\t\tlet relatedKeysToDelete = new Set();\n\t\tkeys.forEach((key) => {\n\t\t\tif (!key) {\n\t\t\t\treturn;\n\t\t\t} // Skip lines with undefined keys (ie. summary and subtotal rows when large quote experience is enabled)\n\t\t\tlet thisLine = this.editorModel.quoteModel.lineModelsByKey[key];\n\t\t\tlet childLines = this.editorModel.quoteModel.linesByParentItemKey[key];\n\t\t\t// For bundle parents, we need to get the keys of all decendents\n\t\t\tif (childLines) {\n\t\t\t\tlet childKeys = new Set();\n\t\t\t\tfor (let i = 0; i < childLines.length; i++) {\n\t\t\t\t\tchildKeys.add(childLines[i].lineVO.key);\n\t\t\t\t}\n\t\t\t\tlet grandChildKeys = this._getAllRelatedKeys(childKeys, includeSiblingSegments);\n\t\t\t\trelatedKeysToDelete = new Set([...relatedKeysToDelete, ...childKeys, ...grandChildKeys]);\n\t\t\t}\n\t\t\t// For MDQ segments, we need to get the keys of its \"sibling\" segments\n\t\t\telse if (includeSiblingSegments && thisLine.segmented && thisLine.segments) {\n\t\t\t\tthisLine.segments.forEach((segment) => {\n\t\t\t\t\trelatedKeysToDelete.add(segment.lineVO.key);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn relatedKeysToDelete;\n\t}\n\n\t_addGroup(groupVO) {\n\t\tlet constants = this.editorModel.constants;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet standardSubScope = false, segmentedSubScope = false;\n\t\tif (!groupVO) {\n\t\t\tlet groupRecord = this._createGroupRecord(quoteModel);\n\t\t\tgroupRecord.Name = `Group${quoteModel.lineGroups.length + 1}`;\n\t\t\tgroupVO = {record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\t} else {\n\t\t\t// If a group is being cloned, update the scopes\n\t\t\tlet oldGroupModel = this.editorModel.quoteModel.groupsByKey[groupVO.key];\n\t\t\tstandardSubScope = oldGroupModel.standardSubscriptionScopeEditable;\n\t\t\tsegmentedSubScope = oldGroupModel.segmentedSubscriptionScopeEditable;\n\t\t}\n\n\t\tif (this.eventDetail.customAction.type === 'Solution Group') {\n\t\t\tthis._extendSolutionGroupRecord(groupVO.record);\n\t\t}\n\n\t\t// Create a copy of groupVO to disconnect property values in memory from _createGroupRecord\n\t\tgroupVO = JSON.parse(JSON.stringify(groupVO));\n\t\tgroupVO.key = ++quoteModel.quoteVO.nextKey;\n\t\tgroupVO.record.Id = undefined;\n\n\t\tlet group = new GroupModel(groupVO, quoteModel);\n\n\t\tgroup.standardSubscriptionScopeEditable = standardSubScope;\n\t\tgroup.segmentedSubscriptionScopeEditable = segmentedSubScope;\n\t\tquoteModel.quoteVO.lineItemGroups.push(groupVO);\n\t\tquoteModel.groupsByKey[group.groupVO.key] = group;\n\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\tindexByGroupKey[group.groupVO.key] = {index: Object.keys(indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\n\t\tthis.domHost.push('groupModels', group);\n\t\tfor (let i = 0; i < quoteModel.quoteVO.lineItemGroups.length; i++) {\n\t\t\tquoteModel.quoteVO.lineItemGroups[i].record[constants.NUMBER_FIELD] = i + 1;\n\t\t}\n\t\tthis.domHost.rightSideButton = quoteModel.lineGroups.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.domHost.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\n\t\tif(quoteModel.lineGroups.length == constants.PANEL_ADDED_INDEX) {\n\t\t\tthis.fire('iron-signal', { name: 'group-panel-created', groupKey: group.groupVO.key});\n\t\t} else {\n\t\t\tthis.fire('iron-signal', { name: 'build-layout', data: { group: group }});\n\t\t}\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.fire('iron-signal', { name: 'group-added', data: {groupKey: group.groupVO.key}});\n\t\t}\n\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_createGroupRecord(quoteModel) {\n\t\tlet groupRecord = {},\n\t\t\tconstants = this.editorModel.constants;\n\n\t\tgroupRecord[constants.QUOTE_PROCESS_FIELD] = this.editorModel.data.defaultQuoteProcessId;\n\t\tgroupRecord[constants.ACCOUNT_FIELD] = quoteModel.quoteVO.record[constants.ACCOUNT_FIELD];\n\t\tgroupRecord[constants.ACCOUNT_ID_FIELD] = quoteModel.quoteVO.record[constants.ACCOUNT_ID_FIELD];\n\t\treturn groupRecord;\n\t}\n\n\t_extendSolutionGroupRecord(groupRecord) {\n\t\tgroupRecord.Name = this.eventDetail.customAction.record.Name;\n\t\tgroupRecord[this.editorModel.constants.DESCRIPTION_FIELD] = this.eventDetail.customAction.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t}\n\n\n\t_openDialog(dialogName) {\n\t\tlet favDialog = this.$[dialogName];\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tfavDialog.favoritedLine = this.eventDetail.model.serviceModel.keys;\n\t\t} else {\n\t\t\tlet groupLines = [].concat(this.eventDetail.model.standardLines).concat(this.eventDetail.model.segmentedLines);\n\t\t\tif (groupLines.length === 0) {\n\t\t\t\tthis.domHost.errors = ['Please select a group with one or more lines to favorite.']; //TODO: custom label with sb18n\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tfavDialog.favoritedGroup = this.eventDetail.model.groupKey;\n\t\t\t\tfavDialog.groupLines = groupLines;\n\t\t\t}\n\t\t}\n\t\tfavDialog.$.dialog.toggle();\n\t}\n\n\tget prefix() {\n\t\tif(this.app === undefined)\n\t\t\treturn;\n\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tsortLines(quote, notify) {\n\t\tlet lineSortField = quote.lineSortField;\n\t\tif ( !quote.lineSortField || lineSortField == this.editorModel.constants.NUMBER_FIELD ) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.fire('iron-signal', {name: 'sort-lines-required', data: {lineSortField: lineSortField, notify: notify}});\n\t\treturn true;\n\t}\n\n\t_resetOnActionSignal() {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\t// Calls _resetOnAction to reset the expanded value to false\n\t\t\tthis.fire('iron-signal', {name: 'reset-on-action'});\n\t\t}\n\t}\n}\n\nPolymer( LECustomActionServices );\n","import {Localizer} from '../layout/sb-le-table-cell/Localizer.js';\n\nlet sortByField;\nlet lookupNameField;\nlet developerPrefix;\nlet constants;\n\n/**\n * For each node in the tree, starting at a given id and proceeding\n * depth-first (pre-order), sort the child nodes based on sortChildLinesAsc, and\n * call the callback with each child node.\n */\nfunction depthFirstTraversal(tree, id, byOrder, callback) {\n\tlet children = tree[id];\n\tif (!children) return;\n\n\tif(byOrder === '') {    // Scenario of reverting the sort\n\t\tchildren.sort(sortLinesAscByKey.bind(this));\n\t} else if (byOrder === 'asc'){\n\t\tchildren.sort(sortLinesAscByField.bind(this));\n\t} else if (byOrder === 'desc'){\n\t\tchildren.sort(sortLinesDescByField.bind(this));\n\t}\n\n\tfor (let i=0; i < children.length; i++) {\n\t\tcallback(children[i]);\n\t\tdepthFirstTraversal(tree, children[i].lineVO.key, byOrder, callback);\n\t}\n}\n\n/**\n * Returns an object, where each key is a node, and\n * its value is an array of child nodes.\n */\nfunction makeLineItemsTree(arr) {\n\tvar tree = {};\n\tfor (var i = 0; i < arr.length; i++) {\n\t\t// parentItemKey in tree object must not be null or undefined\n\t\tif (arr[i].lineVO.parentItemKey == null){\n\t\t\tarr[i].lineVO.parentItemKey = 0;\n\t\t}\n\n\t\tif (!tree[arr[i].lineVO.parentItemKey]){\n\t\t\ttree[arr[i].lineVO.parentItemKey] = [];\n\t\t}\n\t\ttree[arr[i].lineVO.parentItemKey].push(arr[i]);\n\t}\n\treturn tree;\n}\n\n// Child Lines are sorted ascending order by their line keys.\nfunction sortLinesAscByKey(a, b) {\n\treturn a.lineVO.key-b.lineVO.key;\n}\n\n// Parent lines are sorted by user defined ascending or descending.\nfunction sortLinesAscByField(a, b) {\n\tlet A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n\tlet B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n\tlet isABundled;\n\tlet isBBundled;\n\tif (sortByField === constants.LIST_PRICE_FIELD) {\n\t\tisABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n\t\tisBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n\t} else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n\t\tlet aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n\t\tlet bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n\t\tA = aLocalizedValue || A;\n\t\tB = bLocalizedValue || B;\n\t}\n\tA = updateFieldFormat(A, isABundled);\n\tB = updateFieldFormat(B, isBBundled);\n\tif (A == B) {\n\t\treturn 0;\n\t}else if ( A < B ){\n\t\treturn -1;\n\t}else if ( A > B ){\n\t\treturn 1;\n\t}else if (A == null){\n\t\treturn -1;\n\t}else if (B == null){\n\t\treturn 1;\n\t}else{\n\t\treturn 0;\n\t}\n}\n\nfunction sortLinesDescByField(a, b) {\n\tlet A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n\tlet B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n\tlet isABundled;\n\tlet isBBundled;\n\tif (sortByField === constants.LIST_PRICE_FIELD) {\n\t\tisABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n\t\tisBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n\t} else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n\t\tlet aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n\t\tlet bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n\t\tA = aLocalizedValue || A;\n\t\tB = bLocalizedValue || B;\n\t}\n\tA = updateFieldFormat(A, isABundled);\n\tB = updateFieldFormat(B, isBBundled);\n\tif (A == B) {\n\t\treturn 0;\n\t}else if ( A > B ){\n\t\treturn -1;\n\t}else if ( A < B ){\n\t\treturn 1;\n\t}else if (A == null){\n\t\treturn 1;\n\t}else if (B == null){\n\t\treturn -1;\n\t}else{\n\t\treturn 0;\n\t}\n}\n\n/**\n * Renumbers the Number__c field from record of LineViewModel to update displayed line numbers on line editor.\n * @param {arr}: Array of line items\n * @param {num}: String starting number taken from original line items array.\n */\nfunction reorderLineNumbers(lowestVisibleNumber, lowestInvisibleNumber, array){\n\tif (array.length > 0) {\n\t\tvar indexByGroupKey = array[0].groupModel.quoteModel.indexByGroupKey;\n\t\tvar groupKey = array[0].lineVO.parentGroupKey;\n\t}\n\tfor (let i = 0; i < array.length; i++){\n\t\t// Used to update key to index map that is used for JSQCNotifier to update correct paths\n\t\tvar lineKey = array[i].lineVO.key;\n\t\tif (array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]) {\n\t\t\t// Used to update MDQ summary line index\n\t\t\tindexByGroupKey[groupKey].indexBySegmentKey[array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]] = i;\n\t\t} else {\n\t\t\t// Used to update standard lines index only\n\t\t\tindexByGroupKey[groupKey].indexByLineKey[lineKey] = i;\n\t\t}\n\t\tif (array[i].visible) {\n\t\t\tarray[i].lineVO.record[constants.NUMBER_FIELD] = lowestVisibleNumber;\n\t\t\tlowestVisibleNumber++;\n\t\t} else {\n\t\t\tarray[i].lineVO.record[constants.NUMBER_FIELD] = lowestInvisibleNumber;\n\t\t\tlowestInvisibleNumber++;\n\t\t}\n\t}\n\treturn array;\n}\n\n\nfunction updateFieldFormat(field, isBundled) {\n\tif (isBundled) {\n\t\tfield = 0;\n\t}\n\tif (typeof field === 'string') {\n\t\tfield.toUpperCase();\n\t} else if (typeof field === 'undefined') {\n\t\tfield = null;\n\t}\n\treturn field;\n}\n\n/**\n * Returns lowest starting visible and invisible line numbers\n */\nfunction getStartingNumbers(arr) {\n\tlet lowestVisibleNumber;\n\tlet lowestInvisibleNumber;\n\tarr.forEach( function(line) {\n\t\tlet lineNumber = line.lineVO.record[constants.NUMBER_FIELD];\n\t\t// lowest numbers will be undefined the first time through so assign them to the first lineNumber\n\t\tif (line.visible) {\n\t\t\tlowestVisibleNumber = !lowestVisibleNumber || lineNumber < lowestVisibleNumber ? lineNumber : lowestVisibleNumber;\n\t\t} else {\n\t\t\tlowestInvisibleNumber = !lowestInvisibleNumber || lineNumber < lowestInvisibleNumber ? lineNumber : lowestInvisibleNumber;\n\t\t}\n\t}.bind(this));\n\treturn { lowestVisibleNumber : lowestVisibleNumber, lowestInvisibleNumber : lowestInvisibleNumber};\n}\n\n/**\n * Sorts line items while maintaining bundle hierarchy.\n * @param {arr}: Array of line items\n * @param {byOrder}: String 'asc' for ascending order, 'desc' for descending order\n */\nexport function depthFirstLineItemsTreeSort(arr, field, byOrder, keepBundle, nameField) {\n\tlet i = 0;\n\tconstants = arr[0].editorModel.constants;\n\tlet bundleKeptTogether = keepBundle;\n\tsortByField = arr[0].segmented && !arr[0].lineVO.record[field] ? constants.NET_TOTAL_FIELD : field;\n\tlookupNameField = nameField;\n\tlet startingNumbers = getStartingNumbers(arr);\n\n\t// bundleKeptTogether flag will only be true if bundleKeptTogether setting is true and the lines being sorted are from the standard lines table\n\t// Segmented lines table will send false because parent bundle hierarchy tree does not need to be created, skip directly to sorting\n\tif (bundleKeptTogether){\n\t\tlet tree = makeLineItemsTree(arr);\n\t\tdepthFirstTraversal(tree, 0, byOrder, function(node) {\n\t\t\tarr[i++] = node;\n\t\t});\n\t} else {\n\t\tif (byOrder === 'asc'){\n\t\t\tarr.sort(sortLinesAscByField.bind(this));\n\t\t} else if (byOrder === 'desc'){\n\t\t\tarr.sort(sortLinesDescByField.bind(this));\n\t\t} else if (byOrder === ''){     // Scenario of reverting the sort\n\t\t\tarr.sort(sortLinesAscByKey.bind(this));\n\t\t}\n\t}\n\n\t// Overwrite arr with the reordered result\n\tarr = reorderLineNumbers(startingNumbers.lowestVisibleNumber, startingNumbers.lowestInvisibleNumber, arr);\n\n\treturn arr;\n}","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {fieldFactory} from 'common/forms/sb-field/factory/FieldFactory.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {DependentPicklistBuilder} from 'common/forms/DependentPicklistBuilder.js';\n\nlet REF_DISPLAY = 'refDisplay';\n\n/**\n * Component Factory for instantiating web component of inline fields\n * Currently this is an adaptor for FieldFactory\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFComponentFactory {\n\n\tstatic getFieldComponent(fieldMetadata, lineModel, index) {\n\n\t\tlet type = fieldMetadata.type;\n\t\tlet fieldName = fieldMetadata.name;\n\t\tlet record = lineModel.lineVO.record;\n\t\tlet referenceDetails = null;\n\t\tlet selectOptions = null;\n\n\t\tif (type === 'reference') {\n\t\t\treferenceDetails = {\n\t\t\t\trefDisplay: record && fieldMetadata.relationshipName && record[fieldMetadata.relationshipName] ? record[fieldMetadata.relationshipName].Name : '',\n\t\t\t\trefDisplayName: REF_DISPLAY,\n\t\t\t\trefTable: computeRefTable(fieldMetadata),\n\t\t\t\trefObjects: [],\n\t\t\t\trecord: record\n\t\t\t};\n\t\t} else if (type === 'picklist' || type === 'multipicklist') {\n\t\t\tif (fieldMetadata.controllerName) {\n\t\t\t\tlet controllerValue = record[fieldMetadata.controllerName];\n\t\t\t\tselectOptions = new DependentPicklistBuilder(fieldMetadata, controllerValue).build();\n\t\t\t} else {\n\t\t\t\tselectOptions = fieldMetadata.picklistValues;\n\t\t\t}\n\t\t}\n\n\t\treturn fieldFactory(type, lineModel,\n\t\t\trecord[fieldName],  // value\n\t\t\ttrue,               // editable\n\t\t\tfalse,              // disabled\n\t\t\tfalse,              // hidden\n\t\t\tindex,              // index\n\t\t\tfieldMetadata,      // metadata\n\t\t\tAppContext.i18n,    // i18n\n\t\t\tfieldMetadata.extraTypeInfo === 'richtextarea' ? true : false, // render read-only, RTAs always read only so dialog shows on tap\n\t\t\tselectOptions,      // selectOptions\n\t\t\treferenceDetails);\n\t}\n\n}\n\n/** Compute the reference table for lookup or M/D fields */\nfunction computeRefTable( md ) {\n\tif( md === undefined ) {\n\t\treturn;\n\t}\n\tif(md.referenceTable) {\n\t\treturn md.referenceTable;\n\t}\n\t// if no referenceTable property on md, check the referenceTo array property which is same property on field metadata from sb-describe\n\treturn md.referenceTo && md.referenceTo.length > 0 ? md.referenceTo[0] : null;\n}\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\nimport {MobileLETemplateGenerator} from 'quotes/layout/template-generator/MobileLETemplateGenerator.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst ENTER_KEY = 13;\nconst SPACE_KEY = 32;\nconst ESC_KEY = 27;\nconst TAB_KEY = 9;\nconst LEFT_KEY = 37;\nconst RIGHT_KEY = 39;\nconst UP_KEY = 38;\nconst DOWN_KEY = 40;\n\nconst IGNORED_ELEMENT_KEYS = {\n\t'INPUT': new Set([LEFT_KEY, RIGHT_KEY]),\n\t'TEXTAREA': new Set([LEFT_KEY,RIGHT_KEY,UP_KEY,DOWN_KEY]),\n\t'SELECT': new Set([UP_KEY, DOWN_KEY])\n}\n\n/**\n * Abstract table-level component for QuoteLineEditor.  This contains common methods to all QLE table variants\n */\nexport class SFAbstractTable {\n\n\tgetTemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary) {\n\t\tif (AppContext.isMobile) {\n\t\t\treturn new MobileLETemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary);\n\t\t}\n\t\treturn new LETemplateGenerator(editorModel, groupModel, segmentedColumns, dimension, isSecondary);\n\t}\n\n\t/** focusout event listener.  Removes focused UI treatment if user clicks outside this table (either on document body or another table) */\n\t_onFocusOut(e) {\n\t\tif( !AppContext.isMobile ) {\n\t\t\t// need to use setTimeout here to avoid native event sequencing issues around document.activeElement\n\t\t\tsetTimeout(() => {\n\n\t\t\t\tlet cell = null;\n\t\t\t\tlet isSameTable = false;\n\n\t\t\t\tlet elem = document.activeElement;\n\t\t\t\twhile (elem) {\n\t\t\t\t\tif (elem.classList && elem.classList.contains('focusable')) {\n\t\t\t\t\t\tcell = elem;\n\t\t\t\t\t} else if (elem.tagName === 'SF-STANDARD-TABLE' || elem.tagName === 'SF-SEGMENTED-TABLE') {\n\t\t\t\t\t\tisSameTable = Polymer.dom(elem).node === this;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telem = elem.parentElement;\n\t\t\t\t}\n\n\t\t\t\tif (cell === null || !isSameTable) {\n\t\t\t\t\tthis.removeCellFocus(this.focusedCell);\n\t\t\t\t}\n\t\t\t}, 5);\n\t\t}\n\t}\n\n\t/** onkeydown event listener.  Performs common table-level key actions on cells */\n\t_onKeyDown( e ) {\n\t\tswitch ( e.keyCode ) {\n\t\t\tcase ENTER_KEY:\n\t\t\t\tthis._onEnterKeyPress(e);\n\t\t\t\tbreak;\n\t\t\tcase SPACE_KEY:\n\t\t\t\tthis._onSpaceBarPress(e);\n\t\t\t\tbreak;\n\t\t\tcase ESC_KEY:\n\t\t\t\tthis._onEscapePress(e);\n\t\t\t\tbreak;\n\t\t\tcase TAB_KEY:\n\t\t\t\tthis._moveCellFocus( e, e.shiftKey ? 'left' : 'right' );\n\t\t\t\tbreak;\n\t\t\tcase LEFT_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'left' );\n\t\t\t\tbreak;\n\t\t\tcase UP_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'up' );\n\t\t\t\tbreak;\n\t\t\tcase RIGHT_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'right' );\n\t\t\t\tbreak;\n\t\t\tcase DOWN_KEY:\n\t\t\t\tthis._moveCellFocus( e, 'down' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Handle escape key press\n\t * @param e\n\t * @private\n\t */\n\t_onEscapePress(e) {\n\t\tif (this._routeKeyEvent(e)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._toggleInlineEditIfFocused( e, false );\n\t\tthis._editOnFocus = false;\n\t\tif (this.focusedCell) {\n\t\t\tthis.applyCellFocus(this.focusedCell);\n\t\t}\n\t}\n\n\t/**\n\t * Handle space bar press\n\t * @param e\n\t * @private\n\t */\n\t_onSpaceBarPress(e) {\n\t\tif (this._routeKeyEvent(e)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._toggleInlineEditIfFocused( e, true );\n\t\tthis._editOnFocus = true;\n\t}\n\n\t/**\n\t * Route a keyboard event to row level\n\t * @param e\n\t * @return {boolean} whether event should stop propagation\n\t * @private\n\t */\n\t_routeKeyEvent(e) {\n\t\tlet parentRow = findParentRow(e.target);\n\t\tif (parentRow && parentRow.onKeyDown) {\n\t\t\t// this means the row decides to stop propagation\n\t\t\treturn parentRow.onKeyDown(e);\n\t\t}\n\n\t}\n\n\t/**\n\t * Handle ENTER key, which could be the trigger for both turning on or off inline edit\n\t * @param e\n\t * @private\n\t */\n\t_onEnterKeyPress(e) {\n\t\tlet cell = SFAbstractTable.findCell(e);\n\t\tif (this._isCellFocusedAndEditable(cell)) {\n\t\t\t// enter key can either trigger inline edit or commit a change, so it's truly toggling\n\t\t\tlet isEditing = cell.classList.contains(TemplateGenerator.classNames.EDIT_MODE);\n\t\t\tlet metadata = getCellMetadata( cell );\n\n\t\t\tif( metadata && isEditing && (metadata.type === 'textarea' || metadata.type === 'reference' || metadata.type === 'id') )\n\t\t\t\treturn; // do nothing with enter in textarea or lookup so those natively can handle\n\n\t\t\t// for IE and FF, we need to explicitly unfocus on the input element so that it fires onChange event\n\t\t\t// for Chrome the event is fired implicitly when write element is removed\n\t\t\tif (isEditing && document.activeElement) {\n\t\t\t\tdocument.activeElement.blur();\n\t\t\t}\n\t\t\tthis._toggleInlineEditIfFocused( e, !isEditing );\n\t\t\tif (isEditing && this.focusedCell) {\n\t\t\t\t// put the focus back on the cell after inline edit is off\n\t\t\t\tthis.applyCellFocus(this.focusedCell);\n\t\t\t}\n\t\t\tthis._editOnFocus = !isEditing;\n\t\t}\n\t}\n\n\t_openLookupDialog() {\n\t\tthis.keepEditableFocus = true; // keep cell in \"focus\" and in edit mode while Lookup Dialog is open\n\t}\n\n\t_closeLookupDialog() {\n\t\tthis.keepEditableFocus = false; // reset it so next key/mouse action can toggle inline edit on lookup cell\n\t}\n\n\t_toggleInlineEditIfFocused( e, isEdit ) {\n\t\tlet cell = SFAbstractTable.findCell(e);\n\t\tif (this._isCellFocusedAndEditable(cell)) {\n\t\t\tlet parentRow = findParentRow(cell);\n\t\t\tif (parentRow) {\n\t\t\t\tparentRow.toggleInlineEdit(cell, isEdit);\n\t\t\t}\n\t\t}\n\t}\n\n\t_isCellFocusedAndEditable(cell) {\n\t\treturn cell && cell.classList && cell.classList.contains(TemplateGenerator.classNames.HAS_FOCUS) && cell.classList.contains(TemplateGenerator.classNames.EDITABLE);\n\t}\n\n\tremoveCellFocus( cell ) {\n\t\tif( cell && cell.classList && cell.classList.contains( TemplateGenerator.classNames.HAS_FOCUS ) && !this.keepEditableFocus ) {\n\t\t\tcell.classList.remove( TemplateGenerator.classNames.HAS_FOCUS );\n\t\t\tlet parentRow = findParentRow( cell );\n\t\t\tif( parentRow ) {\n\t\t\t\tparentRow.toggleInlineEdit( cell, false );\n\t\t\t}\n\t\t\tif (cell === this.focusedCell) {\n\t\t\t\tthis.focusedCell = null;\n\t\t\t}\n\t\t\treturn parentRow;\n\t\t}\n\t}\n\n\tapplyCellFocus( cell ) {\n\t\t// apply focus if the cell isn't already in focus\n\t\tif( cell && cell.classList ) {\n\t\t\t// need to use setTimeout here as some browsers are quirky with native focus/blur event sequence\n\t\t\tsetTimeout( () => {\n\t\t\t\t// focus on the first focusable element if the cell is a container (e.g., sf-line-action)\n\t\t\t\tif (!cell.classList.contains('focusable') && cell.querySelector('.focusable')) {\n\t\t\t\t\tcell = cell.querySelector('.focusable');\n\t\t\t\t}\n\t\t\t\tcell.focus();\n\t\t\t\tcell.classList.add( TemplateGenerator.classNames.HAS_FOCUS );\n\t\t\t\tif (this.focusedCell !== cell) {\n\t\t\t\t\tthis.removeCellFocus(this.focusedCell);\n\t\t\t\t}\n\t\t\t\tthis.focusedCell = cell;\n\t\t\t}, 10 );\n\t\t}\n\t}\n\n\t/**\n\t * When editOnFocus is turned on, cell will enter edit mode immediately upon focus\n\t * @param value\n\t */\n\tsetEditOnFocus(value) {\n\t\tthis._editOnFocus = value;\n\t}\n\n\t/**\n\t * Moves the focus of the current cell in the direction specified (up/left/right/down)\n\t * @param  {event} e the current mouse/key event.  Must be an event on/or bubbled to a table Cell\n\t * @param  {string} direction up/down/left/right\n\t * @return {null}\n\t */\n\t_moveCellFocus( e, direction ) {\n\t\t// don't move focus if the key should be ignored for the native input/textarea/select element\n\t\tif( e && direction && !isIgnored( e ) ) {\n\t\t\tlet cell = SFAbstractTable.findCell( e, 'focusable' );\n\t\t\tif( cell ) {\n\t\t\t\tlet row = findParentRow( cell ), newParentRow = row;\n\t\t\t\tlet nextCell = null;\n\t\t\t\tlet parentEl = row.querySelector('#content > div');\n\t\t\t\tswitch( direction ) {\n\t\t\t\t\tcase 'up':\n\t\t\t\t\tcase 'down':\n\t\t\t\t\t\tlet isUp = direction === 'up' ? true : false;\n\t\t\t\t\t\tlet isEditing = cell.classList.contains(TemplateGenerator.classNames.EDIT_MODE);\n\t\t\t\t\t\tlet metadata = getCellMetadata(cell, row);\n\t\t\t\t\t\tif( metadata && isEditing && (metadata.type === 'reference' || metadata.type === 'id' || metadata.type === 'date' || metadata.type === 'datetime' ) )\n\t\t\t\t\t\t\treturn; // ignore up/down in lookup and datepicker so they can natively consume those keys\n\n\t\t\t\t\t\tlet adjRow = findAdjacentRow( row, isUp, this.editorModel.largeQuoteExperienceEnabled );\n\t\t\t\t\t\tif( adjRow ) {\n\t\t\t\t\t\t\tnewParentRow = adjRow;\n\t\t\t\t\t\t\tlet index = getCellRowIndex( parentEl, cell );\n\t\t\t\t\t\t\tnextCell = adjRow.getCellByIndex( index );\n\t\t\t\t\t\t\tif( nextCell ) {\n\t\t\t\t\t\t\t\tthis.applyCellFocus( nextCell );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'left':\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tlet focusableChildren = parentEl.querySelectorAll('.focusable');\n\t\t\t\t\t\tlet index = Array.from( focusableChildren ).indexOf( cell ),\n\t\t\t\t\t\t\t\tisLeft = direction == 'left' ? true : false,\n\t\t\t\t\t\t\t\tlen = focusableChildren.length;\n\n\t\t\t\t\t\tif( (index == 0 && isLeft) || (!isLeft && index == len-1) ) {\n\t\t\t\t\t\t\tlet adjRow = findAdjacentRow( row, isLeft, this.editorModel.largeQuoteExperienceEnabled );\n\t\t\t\t\t\t\tif( adjRow ) {\n\t\t\t\t\t\t\t\tnewParentRow = adjRow;\n\t\t\t\t\t\t\t\tnextCell = isLeft ? adjRow.getCellByIndex(len-1) : adjRow.getCellByIndex(0);\n\t\t\t\t\t\t\t\tthis.applyCellFocus( nextCell );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnextCell = focusableChildren[index + (isLeft ? -1 : 1)];\n\t\t\t\t\t\t\tif (nextCell) {\n\t\t\t\t\t\t\t\tthis.applyCellFocus(nextCell);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// also turn on inline edit if preserveEdit is true and the old cell is currently being edited\n\t\t\t\tif (this._editOnFocus && newParentRow && nextCell) {\n\t\t\t\t\tnewParentRow.toggleInlineEdit(nextCell, true, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Find the first td or decorated element in DOM ancestor tree from given event\n\t * @param event The event that contains the cell path\n\t * @param clazz The decorating CSS class, default is 'td'\n\t * @return the cell container element if found, null otherwise\n\t */\n\tstatic findCell(e, clazz = 'td') {\n\t\treturn Polymer.dom(e).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(clazz);\n\t\t});\n\t}\n}\n\nfunction getCellRowIndex( row, cell ) {\n\t// traverse up the DOM tree if cell is not a direct child of the row element\n\twhile (cell.parentElement !== row && cell.parentElement) {\n\t\tcell = cell.parentElement;\n\t}\n\treturn Array.from( row.children ).indexOf( cell );\n}\n\nfunction findAdjacentRow( cur, isUp, isLQE ) {\n\tif( cur ) {\n\t\tlet curTag = cur.tagName,\n\t\t\t\tprop = isUp ? 'previousElementSibling' : 'nextElementSibling';\n\n\t\tif (!isLQE) {\n\t\t\tlet adj = cur[prop];\n\t\t\twhile (adj) {\n\t\t\t\tif (adj && adj.tagName == curTag) {\n\t\t\t\t\treturn adj;\n\t\t\t\t}\n\t\t\t\tadj = adj[prop]\n\t\t\t}\n\t\t} else {\n\t\t\t// for LQE, there is a parent div\n\t\t\tlet adjParent = cur.parentElement[ prop ];\n\t\t\tif (adjParent) {\n\t\t\t\tfor (let child of adjParent.children) {\n\t\t\t\t\tif (child && child.tagName == curTag) {\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n}\n\n/**\n * Gets the metadata for the cell\n * @param  {object} cell the cell DOM element\n * @param  {object} [row]  the row DOM element, if already known.\n * @return {object}      the cell's metadata, null if not found\n */\nfunction getCellMetadata( cell, row ) {\n\tlet field = cell ? cell.getAttribute('field') : null;\n\tif( !row ) {\n\t\trow = cell ? findParentRow( cell ) : null;\n\t}\n\treturn row && field ? row._getFieldMetadata(field) : null;\n}\n\nfunction findParentRow(el) {\n\tif( el && el.parentElement ) {\n\t\tif( el.parentElement.tagName === 'SF-LE-TABLE-ROW' )\n\t\t\treturn el.parentElement;\n\t\telse\n\t\t\treturn findParentRow( el.parentElement );\n\t}\n}\n\n/**\n * Returns true if the keyCode of the event should be ignored for the target element.\n * @param  {[type]}  e The event object\n */\nfunction isIgnored( e ) {\n\tlet tag = e.target && e.target.tagName ? e.target.tagName : '',\n\t\t\tel = IGNORED_ELEMENT_KEYS[tag];\n\treturn el && el.has(e.keyCode);\n}\n\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.SFAbstractTable = SFAbstractTable.prototype;\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {SFComponentFactory} from 'quotes/sf-component-factory/SFComponentFactory.js';\nimport {Localizer} from 'quotes/layout/sb-le-table-cell/Localizer.js';\n\n/**\n * Data management utility to prepare presentation-ready data from raw record data\n *\n * @author kzheng\n * @since 212\n */\n\nexport class UIDataManager {\n\n\t/**\n\t * For each row, prepare the data required to stamp the row template\n\t * @param standardLines\n\t * @param fieldSet\n\t * @param quoteLineFields\n\t * @return Array of objects representing ui data\n\t */\n\tstatic prepareLineData(standardLines, fieldSet, quoteLineFields) {\n\t\tlet uiData = [];\n\t\tstandardLines.forEach(function(lineModel, lineIndex) {\n\t\t\tlet record = lineModel.lineVO.record;\n\t\t\tlet recordUI = { Id: record.Id };\n\t\t\tlet fieldVisibility = lineModel.lineVO.fieldVisibility;\n\n\t\t\tfieldSet.forEach(function(field) {\n\t\t\t\tlet fieldMetadata = quoteLineFields[field];\n\t\t\t\trecordUI[field] = this.prepareFieldData(record, field, fieldMetadata, lineModel, fieldVisibility);\n\t\t\t\tthis.computeCellClass(record, field, recordUI, lineModel, fieldVisibility, fieldMetadata);\n\t\t\t}.bind(this));\n\n\t\t\t// Add segmented line data to the recordUI property\n\t\t\tif (lineModel.hasOwnProperty('segments')) {\n\t\t\t\tthis.prepareSegmentedLineData(lineModel, record, recordUI, quoteLineFields, fieldVisibility);\n\t\t\t}\n\n\t\t\tlet constants = lineModel.editorModel.constants;\n\t\t\trecordUI.lineNumber = record[constants.NUMBER_FIELD];\n\t\t\trecordUI.rowIndex = lineIndex;\n\t\t\trecordUI.lineModel = lineModel;\n\t\t\t// disable checkbox when lineModel is a component (part of a product bundle)\n\t\t\tthis.prepareSelectionCheckbox(lineModel, recordUI);\n\t\t\t// warning icons\n\t\t\tthis.prepareWarningIcon(lineModel, recordUI);\n\t\t\tif(!recordUI._cellClasses) {\n\t\t\t\t// Add empty cell classes so if row changes, classes update.\n\t\t\t\trecordUI._cellClasses = {};\n\t\t\t}\n\t\t\tuiData.push(recordUI);\n\t\t}.bind(this));\n\t\treturn uiData;\n\t}\n\n\t/**\n\t * When multi-line delete is enabled, some checkboxes may need to be disabled\n\t * @param lineModel\n\t * @param recordUI\n\t */\n\tstatic prepareSelectionCheckbox(lineModel, recordUI) {\n\t\tif (lineModel.editorModel.data.settings.multiLineDeleteEnabled && lineModel.component) {\n\t\t\trecordUI._cellClasses = recordUI._cellClasses || {};\n\t\t\trecordUI._cellClasses._selectionCB = TemplateGenerator.classNames.DISABLED;\n\t\t}\n\t}\n\n\t/**\n\t * Each line may display a warning icon when valid pricebook entry doesn't exist\n\t * @param lineModel\n\t * @param recordUI\n\t */\n\tstatic prepareWarningIcon(lineModel, recordUI) {\n\t\tif (lineModel.lineVO.validPricebookEntryExists === false) {\n\t\t\trecordUI.hasLineWarning = true;\n\t\t\tif (lineModel.groupModel.quoteModel.isPrimary && lineModel.lineVO.opportunityLineItemExists == false) {\n\t\t\t\trecordUI.lineWarningKey = 'missingOpportunityLineItem';\n\t\t\t\trecordUI.lineWarningMsg = 'This product will not sync to the opportunity because a valid pricebook entry does not exist.';\n\t\t\t} else {\n\t\t\t\trecordUI.lineWarningKey = 'invalidPricebookEntry';\n\t\t\t\trecordUI.lineWarningMsg = 'There is not a valid price book entry for this line item.';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Prepare the content of each field\n\t * @param record\n\t * @param field\n\t * @param fieldMetadata\n\t * @param lineModel\n\t * @param fieldVisibility\n\t * @returns {*}\n\t */\n\tstatic prepareFieldData(record, field, fieldMetadata, lineModel, fieldVisibility) {\n\t\t// check field visibility\n\t\tif (fieldVisibility && fieldVisibility[field] === false) {\n\t\t\treturn '';\n\t\t}\n\t\t// suppress non-editable subscription scope field\n\t\tif (QuoteContext.isSubscriptionScopeField(field) && !lineModel.subscriptionScopeEditable) {\n\t\t\treturn '';\n\t\t}\n\t\t// override list unit price with \"Included\" for bundled QuoteLine\n\t\tif (lineModel.bundled && QuoteContext.isListPriceField(field)) {\n\t\t\treturn AppContext.properties.i18n.value().l('Included');\n\t\t}\n\t\t// localization\n\t\tlet localizedValue = Localizer.getLocalizedValue(lineModel, field);\n\t\tif (localizedValue) {\n\t\t\treturn localizedValue;\n\t\t}\n\t\tif (fieldMetadata) {\n\t\t\tthis._updateFieldMetadata(record, fieldMetadata, lineModel);\n\t\t\treturn Formatter.formatFieldData(lineModel, record[field], fieldMetadata, record);\n\t\t} else {\n\t\t\t// can't locate field metadata, just return the record data as is\n\t\t\treturn record[field];\n\t\t}\n\t}\n\n\t/**\n\t * Update metadata CurrencyIsoCode for currency types that are using multi-currency in their org\n\t * Also updates the Quantity Field if their scale has changed\n\t *\n\t * See NumberFormatter#_setCurrencyFormatOptions for CurrencyIsoCode usage.\n\t * @param record\n\t * @param metadata\n\t **/\n\tstatic _updateFieldMetadata(record, metadata, lineModel) {\n\t\tif(metadata.type === 'currency') {\n\t\t\tmetadata.CurrencyIsoCode = record.CurrencyIsoCode;\n\t\t}\n\n\t\tlet quantityFields = lineModel.editorModel.constants.QUANTITY_FIELDS;\n\t\tif (quantityFields && quantityFields.has(metadata.name) && lineModel.lineVO.productQuantityScale !== null) {\n\t\t\t// Properties in the target object will be overwritten by properties in the sources if they have the same key.\n\t\t\tmetadata.scale = lineModel.lineVO.productQuantityScale;\n\t\t}\n\t}\n\n\t/**\n\t * Prepare the segmented data for the line\n\t * @param lineModel\n\t * @param record\n\t * @param recordUI\n\t * @param quoteLineFields\n\t * @param fieldVisibility\n\t */\n\tstatic prepareSegmentedLineData(lineModel, record, recordUI, quoteLineFields, fieldVisibility) {\n\t\tlet segmentData = {};\n\t\t// carry currency iso code from main record so that currency fields are formatted properly\n\t\tif (record.CurrencyIsoCode) {\n\t\t\tsegmentData.CurrencyIsoCode = record.CurrencyIsoCode;\n\t\t}\n\t\tlet constants = lineModel.editorModel.constants;\n\t\t// Create a map(segment column, segment value)\n\t\tlineModel.segments.forEach((segment) => {\n\t\t\tlet label = segment.lineVO.record[constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, '');\n\t\t\t//Polymer doesn't stamp data correctly if the label is a number hence the following line\n\t\t\tlabel = isNaN(label) ? label : 'TimeSegment' + label;\n\t\t\tsegmentData[label] = segment.lineVO.record[constants.NET_TOTAL_FIELD];\n\t\t});\n\t\tlet quoteVO = lineModel.editorModel.quoteModel.quoteVO;\n\t\tsegmentData['total'] = quoteVO.multiSegmentRowTotals[record[constants.SEGMENT_KEY_FIELD]];\n\t\t// Add segment data to the recordUI\n\t\tObject.keys(segmentData).forEach((segment) => {\n\t\t\tlet fieldMetadata = quoteLineFields[constants.NET_TOTAL_FIELD];\n\t\t\trecordUI[segment] = this.prepareFieldData(segmentData, segment, fieldMetadata, lineModel, fieldVisibility);\n\t\t\tthis.computeCellClass(segmentData, segment, recordUI, lineModel, fieldVisibility, quoteLineFields[segment]);\n\t\t});\n\t}\n\n\t/**\n\t * Provide additional cell-level css classes, to be stamped from SFStandardTable#computeCellClass\n\t * @param record\n\t * @param field name of field for which css is being calculated\n\t * @param recordUI\n\t * @param lineModel\n\t * @param fieldVisibility\n\t */\n\tstatic computeCellClass(record, field, recordUI, lineModel, fieldVisibility, fieldMetadata) {\n\t\tlet cellClass = '';\n\t\t// editable class\n\t\tif (!fieldVisibility || fieldVisibility[field] !== false) {\n\t\t\tcellClass += lineModel.isEditable(field) ? `${TemplateGenerator.classNames.EDITABLE} ` : '';\n\t\t\tcellClass += lineModel.itemClassMap[field] ? lineModel.itemClassMap[field] : '';\n\t\t}\n\n\t\tif (fieldVisibility && fieldVisibility[field] === false && fieldMetadata && fieldMetadata.type === 'boolean') {\n\t\t\tcellClass += (TemplateGenerator.classNames.HIDE_CHECKBOX + ' ');\n\t\t}\n\n\t\t// product hierarchy classes (top-level, sbIndentx etc.)\n\t\tif (lineModel.editorModel.isProductHierarchyVisualized() && !lineModel.segmented) {\n\t\t\tcellClass += this.computeProductHierarchyCss(field, record, lineModel);\n\t\t}\n\t\tif (cellClass) {\n\t\t\trecordUI._cellClasses = recordUI._cellClasses || {};\n\t\t\trecordUI._cellClasses[field] = cellClass;\n\t\t}\n\t}\n\n\t/**\n\t * Compute cell css when product hierarchical view is turned on\n\t * @param field\n\t * @param record\n\t * @param lineModel\n\t * @returns {string}\n\t */\n\tstatic computeProductHierarchyCss(field, record, lineModel) {\n\t\tlet cellClass = '';\n\t\tlet classNames = TemplateGenerator.classNames;\n\t\tif (!AppContext.isMobile) {\n\t\t\tif (QuoteContext.isProductNameField(field)) {\n\t\t\t\tif (lineModel.isBundle) {\n\t\t\t\t\tcellClass += `${classNames.CHEVRON_DOWN_ICON} `;\n\t\t\t\t} else {\n\t\t\t\t\tif (!lineModel.component) {\n\t\t\t\t\t\tcellClass += `${classNames.TOP_LEVEL} `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (lineModel.component) {\n\t\t\t\t\tif (!lineModel.bundle) {\n\t\t\t\t\t\tcellClass += `${classNames.OPTION} `;\n\t\t\t\t\t}\n\t\t\t\t\tcellClass += `${classNames.INDENT}${record[QuoteContext.constants.OPTION_LEVEL_FIELD]} `;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ((QuoteContext.isProductNameField(field) || QuoteContext.isNetTotalField(field)) && record[QuoteContext.constants.OPTION_LEVEL_FIELD] !== null) {\n\t\t\tcellClass += `${classNames.INDENT}${record[QuoteContext.constants.OPTION_LEVEL_FIELD]} `;\n\t\t}\n\t\treturn cellClass;\n\t}\n}\n","export class QuoteAggregator {\n\tconstructor(clientQuote, serverQuote, requiredKeys) {\n\t\tthis.clientQuote = clientQuote;\n\t\tthis.serverQuote = serverQuote;\n\t\tthis.requiredKeys = requiredKeys;\n\t}\n\n\treconcileServerQuoteWithUIQuote() {\n\t\t// linesRequiringInjection is a map where the keys are line keys and the values are lists of lines.\n\t\t// The head of each list is an updated version of a line that was sent to the server.\n\t\t// Any other nodes in the list are going to be new quote lines that need to be added immediately after the\n\t\t// head. These new lines will be in the same bundle structure as the updated line they must follow.\n\t\tlet linesRequiringInjection = new Map();\n\t\t// linesBelongingAtEnd is the list of new lines that we can just append to the end of the quote. These will\n\t\t// all be lines in new bundles.\n\t\tlet linesBelongingAtEnd = [];\n\n\t\tlet serverLineCount = this.serverQuote.lineItems.length;\n\t\tlet existingLineKey;\n\t\tfor (let i = 0; i < serverLineCount; i++) {\n\t\t\tlet line = this.serverQuote.lineItems[i];\n\t\t\tif (this.requiredKeys.has(line.key)) {\n\t\t\t\t// If this line's key is in requiredKeys, it means that we sent it to the server and received an updated version.\n\t\t\t\t// So what we have to do is create a singleton list for this line and add it to the linesRequiringInjection set.\n\t\t\t\tlinesRequiringInjection.set(line.key, [line]);\n\t\t\t\t// We also mark this line as the existingLineKey, marking its list as the one to append new child lines to, for now.\n\t\t\t\texistingLineKey = line.key;\n\t\t\t} else {\n\t\t\t\t// If the line's key isn't in requiredKeys, it was created by the server.\n\t\t\t\tif (existingLineKey && line.parentItemKey) {\n\t\t\t\t\t// If the line is a child and we have a key corresponding to a known existing line, we append this line\n\t\t\t\t\t// to that line's list.\n\t\t\t\t\tlinesRequiringInjection.get(existingLineKey).push(line);\n\t\t\t\t} else {\n\t\t\t\t\t// If the line isn't a child line, or there's not an existing line it should be grouped with,\n\t\t\t\t\t// we should just add it to the list of lines belonging at the end, and blank out the existingLineKey.\n\t\t\t\t\texistingLineKey = null;\n\t\t\t\t\tlinesBelongingAtEnd.push(line);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Now that we've sorted all of our lines and grouped the ones that need to be added together, we need to create\n\t\t// the actual line list.\n\t\tlet resultLines = [];\n\t\tthis.clientQuote.lineItems.forEach((line) => {\n\t\t\tif (!this.requiredKeys.has(line.key)) {\n\t\t\t\t// If the line's key isn't in requiredKeys, it means we didn't send the line to the server, and therefore\n\t\t\t\t// it can't have changed. Use the original version.\n\t\t\t\tresultLines.push(line);\n\t\t\t} else if (linesRequiringInjection.has(line.key)) {\n\t\t\t\t// If the key is in requiredKeys, and there's an associated list in linesRequiringInjection, we concatenate\n\t\t\t\t// that list onto the result list.\n\t\t\t\tresultLines = resultLines.concat(linesRequiringInjection.get(line.key));\n\t\t\t}\n\t\t\t// Otherwise, the line was sent to the server but no result was returned, meaning the line was deleted and should\n\t\t\t// not be added to the result list.\n\t\t});\n\t\t// Now that we've injected all of the lines that need to be injected, we can append the rest.\n\t\tresultLines = resultLines.concat(linesBelongingAtEnd);\n\t\tthis.serverQuote.lineItems = resultLines;\n\t\treturn this.serverQuote;\n\t}\n}","/**\n * Created by jfeingold on 12/22/16.\n */\nimport {Constants} from 'quotes/models/Constants.js';\nexport class QuoteLineAggregator {\n\tconstructor(quote) {\n\t\tthis._quote = quote;\n\t\tthis._linesByKey = new Map();\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tthis._linesByKey.set(line.key, line);\n\t\t\t});\n\t\t}\n\t\t// Determine the prefix by examining the quote record\n\t\tvar devPrefix = (quote.record.attributes.type === 'Quote__c') ? '' : quote.record.attributes.type.slice(0, -8);\n\t\tthis._constants = new Constants(devPrefix);\n\t}\n\n\t/**\n\t * Returns a map from each line item's key to its Prior Bundled Quantity.\n\t * @returns {{}}\n\t */\n\tmapPriorBundledQuantityByLineKey() {\n\t\tlet result = {};\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tresult[line.key + ''] = this._getPriorBundledQuantity(line);\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a list containing every line's Upgraded Asset Id.\n\t * @returns {Array}\n\t */\n\tgetUpgradedAssetIdsAsArray() {\n\t\t// Collect all Asset IDs in a set to make sure that we don't have duplicates.\n\t\tlet idSet = new Set();\n\t\tlet upgradedAssetIdField = this._constants.UPGRADED_ASSET_FIELD;\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tlet upgradedAssetId = line.record[upgradedAssetIdField];\n\t\t\t\tif (upgradedAssetId != null) {\n\t\t\t\t\tidSet.add(upgradedAssetId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Now turn that set into an Array so it can be serialized properly.\n\t\tlet result = [];\n\t\tidSet.forEach((id) => {\n\t\t\tresult.push(id);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Retrieves all of the Product IDs from quote lines where the Existing Flag is true.\n\t * @returns {Array}\n\t */\n\tgetExistingProductIdsFromLines() {\n\t\tlet idSet = new Set();\n\t\tlet existingField = this._constants.EXISTING_FIELD;\n\t\tlet productIdField = this._constants.PRODUCT;\n\t\tif (this._quote.lineItems != null) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tif (line.record[existingField]) {\n\t\t\t\t\tidSet.add(line.record[productIdField]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet result = [];\n\t\tidSet.forEach((id) => {\n\t\t\tresult.push(id);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a map from a string representing a Dimension Type to the first set of MDQ lines it finds with that dimension,\n\t * in the provided group (or if no key is provided, lines without a group key).\n\t * @param {Number|null} groupKey A unique integer corresponding to a QuoteLineGroupVO, or null if no key is to be used.\n\t * @returns {{}}\n\t */\n\tgetSegmentTemplatesByDimensionTypeForGroupKey(groupKey) {\n\t\tlet result = {};\n\t\tlet customKey, yearlyKey, monthlyKey, quarterlyKey;\n\t\tlet customSegs = [];\n\t\tlet monthlySegs = [];\n\t\tlet yearlySegs = [];\n\t\tlet quarterlySegs = [];\n\n\t\tlet dimensionIdField = this._constants.DIMENSION_ID_FIELD;\n\t\tlet dimensionField = this._constants.DIMENSION_FIELD;\n\t\tlet typeField = this._constants.TYPE_FIELD;\n\t\tlet segmentKeyField = this._constants.SEGMENT_KEY_FIELD;\n\t\tif (this._quote.lineItems) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\tif (line.parentGroupKey == groupKey) {\n\t\t\t\t\tlet dimensionType = line.dimensionType || (line.record[dimensionIdField] ? line.record[dimensionField][typeField] : null);\n\t\t\t\t\tlet segmentKey = line.record[segmentKeyField];\n\t\t\t\t\tswitch (dimensionType) {\n\t\t\t\t\t\tcase this._constants.TYPE_CUSTOM_DIMENSION:\n\t\t\t\t\t\t\tif (!customKey || customKey == segmentKey) {\n\t\t\t\t\t\t\t\tcustomKey = segmentKey;\n\t\t\t\t\t\t\t\tcustomSegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_YEARLY_DIMENSION:\n\t\t\t\t\t\t\tif (!yearlyKey || yearlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tyearlyKey = segmentKey;\n\t\t\t\t\t\t\t\tyearlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_MONTHLY_DIMENSION:\n\t\t\t\t\t\t\tif (!monthlyKey || monthlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tmonthlyKey = segmentKey;\n\t\t\t\t\t\t\t\tmonthlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase this._constants.TYPE_QUARTERLY_DIMENSION:\n\t\t\t\t\t\t\tif (!quarterlyKey || quarterlyKey == segmentKey) {\n\t\t\t\t\t\t\t\tquarterlyKey = segmentKey;\n\t\t\t\t\t\t\t\tquarterlySegs.push(line);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tresult[this._constants.TYPE_CUSTOM_DIMENSION] = customSegs;\n\t\tresult[this._constants.TYPE_MONTHLY_DIMENSION] = monthlySegs;\n\t\tresult[this._constants.TYPE_YEARLY_DIMENSION] = yearlySegs;\n\t\tresult[this._constants.TYPE_QUARTERLY_DIMENSION] = quarterlySegs;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a list of keys corresponding to groups that have no lines.\n\t * @returns {Array}\n\t */\n\tgetKeysOfEmptyGroups() {\n\t\tif (!this._quote.lineItemGroups || this._quote.lineItemGroups.length == 0) {\n\t\t\t// If there are no groups, then just return an empty list.\n\t\t\treturn [];\n\t\t}\n\t\tlet groupKeySet = new Set();\n\t\tthis._quote.lineItemGroups.forEach((group) => {\n\t\t\t// Add all group keys to the set\n\t\t\tgroupKeySet.add(group.key);\n\t\t});\n\n\t\tif (this._quote.lineItems) {\n\t\t\tthis._quote.lineItems.forEach((line) => {\n\t\t\t\t// For every line, remove the line's parent group key from the group key set.\n\t\t\t\tgroupKeySet.delete(line.parentGroupKey);\n\t\t\t});\n\t\t}\n\t\t// At this point, the only group keys remaining in groupKeySet are the ones for groups that have no lines.\n\t\t// Turn that set into an array and return it.\n\t\tlet result = [];\n\t\tgroupKeySet.forEach((groupKey) => {\n\t\t\tresult.push(groupKey);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Calculates a line's Prior Bundled Quantity. For standard lines, this is the prior quantity divided by the parent\n\t * line's prior quantity. For option lines carried over from a source parent to an upgrade parent, also known as\n\t * Carryover Lines, this is the number of lines carried over from the source child divided by the upgrade parent's\n\t * current quantity.\n\t * @param {Object} line An object representing a quote line\n\t * @returns {Number|null}\n\t * @private\n\t */\n\t_getPriorBundledQuantity(line) {\n\t\tlet prior;\n\t\tlet parentPrior;\n\t\tif (this._isCarryoverLine(line)) {\n\t\t\tprior = this._getCarryoverQuantity(line);\n\t\t\tparentPrior = this._linesByKey.get(line.parentItemKey).record[this._constants.QUANTITY_FIELD];\n\t\t} else {\n\t\t\tprior = line.record[this._constants.PRIOR_QUANTITY_FIELD];\n\t\t\tparentPrior = this._linesByKey.get(line.parentItemKey) ? this._linesByKey.get(line.parentItemKey).record[this._constants.PRIOR_QUANTITY_FIELD] : null;\n\t\t}\n\t\tif (parentPrior == null || prior == null || !this._optionTypeIsComponent(line)) {\n\t\t\treturn prior;\n\t\t} else {\n\t\t\treturn prior / parentPrior;\n\t\t}\n\t}\n\n\t_isCarryoverLine(line) {\n\t\treturn line.record[this._constants.CARRYOVER_LINE_FIELD] == true;\n\t}\n\n\t_getCarryoverQuantity(line) {\n\t\tlet carryoverQuantity = line.record[this._constants.PRIOR_QUANTITY_FIELD];\n\t\tlet parentItem = this._linesByKey.get(line.parentItemKey);\n\t\tif (line.sourceLineKey != null && parentItem) {\n\t\t\tlet sourceLine = this._linesByKey.get(line.sourceLineKey);\n\t\t\tif (sourceLine) {\n\t\t\t\tcarryoverQuantity = this._getPriorBundledQuantity(sourceLine);\n\t\t\t\tif (this._optionTypeIsComponent(sourceLine)) {\n\t\t\t\t\tcarryoverQuantity *= parentItem.record[this._constants.QUANTITY_FIELD];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn carryoverQuantity;\n\t}\n\n\t_optionTypeIsComponent(line) {\n\t\tlet optionType = line.record[this._constants.OPTION_TYPE_FIELD];\n\t\treturn optionType != null && optionType.toLowerCase() === 'component';\n\t}\n}","export class AssetUpgradeQuantityCalculator {\n\n\tconstructor(upgradeHandler) {\n\t\tthis.upgradeHandler = upgradeHandler;\n\t}\n\n\tsetQuantitiesByRatio() {\n\t\tlet source;\n\t\tlet upgrade;\n\t\tlet isSourceLine = this.upgradeHandler.isSourceLine();\n\n\t\t// If the configuration changed by the user is a source line, we need to find the corresponding upgrade option\n\t\tif(isSourceLine) {\n\t\t\tsource = this.upgradeHandler.getLine();\n\t\t\tupgrade = this._getUpgrade(source, null);\n\t\t// If the configuration changed by the user is an upgrade, we need to find the corresponding source option\n\t\t} else {\n\t\t\tupgrade = this.upgradeHandler.getLine();\n\t\t\tsource = this._getSource(null, upgrade);\n\t\t}\n\n\t\tif(!source || !upgrade) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.upgradeHandler.setSourceAndUpgrade(source, upgrade);\n\t\tthis._setAutomaticQuantity(source, upgrade, isSourceLine);\n\t}\n\n\t_getSource(source, upgrade) {\n\t\treturn this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n\t}\n\n\t_getUpgrade(source, upgrade) {\n\t\treturn this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n\t}\n\n\t_setAutomaticQuantity(source, upgrade, didUserChangeSourceQuantity) {\n\t\tlet upgradeRatio = this._getUpgradeRatio(source, upgrade, this.upgradeHandler.getSourceIdField(), this.upgradeHandler.getUpgradeConversionRateField());\n\n\t\tif(upgradeRatio == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceCurrentQty = this.upgradeHandler.getSourceCurrentQuantityField(source);\n\t\tlet upgradeCurrentQty = this.upgradeHandler.getUpgradeCurrentQuantityField(upgrade);\n\t\tlet sourceRate = upgradeRatio.split(':')[0];\n\t\tlet upgradeRate = upgradeRatio.split(':')[1];\n\t\tlet sourceQtyAfterUpdate = sourceCurrentQty;\n\t\tlet upgradeQtyAfterUpdate = upgradeCurrentQty;\n\t\tlet sourcePriorQty = this.upgradeHandler.getSourcePriorQuantity(source);\n\n\t\tif(sourceCurrentQty < 0) {\n\t\t\tsource.invalidQuantity = sourceCurrentQty;\n\t\t\tsource.validQuantity = 0;\n\t\t} else if(upgradeCurrentQty < 0) {\n\t\t\tupgrade.invalidQuantity = upgradeCurrentQty;\n\t\t\tupgrade.validQuantity = 0;\n\t\t}\n\n\t\tif (this.upgradeHandler.didSourceQuantityChange(didUserChangeSourceQuantity, source, upgrade)) {\n\t\t\t// If the upgrade option is selected, then its quantity should automatically change if\n\t\t\t// the source option isn't selected, since that's the same as source quantity of 0\n\t\t\t// or the source configuration is selected and the user changes its quantity necessitating ratio enforcement\n\t\t\tupgradeQtyAfterUpdate = (sourcePriorQty - sourceCurrentQty) * (upgradeRate / sourceRate);\n\t\t} else if (this.upgradeHandler.didUpgradeQuantityChange(didUserChangeSourceQuantity, source)) {\n\t\t\t// If the source option is selected and the user changes the upgrade's quantity\n\t\t\t// the change must reflect on the source\n\t\t\tsourceQtyAfterUpdate = sourcePriorQty - (upgradeCurrentQty * (sourceRate / upgradeRate));\n\t\t}\n\n\t\tif (sourceQtyAfterUpdate < 0) {\n\t\t\tsourceQtyAfterUpdate = 0;\n\t\t\tif (this.upgradeHandler.isSelected(upgrade)) {\n\t\t\t\tupgradeQtyAfterUpdate = sourcePriorQty * (upgradeRate / sourceRate);\n\t\t\t\tif(upgradeCurrentQty > upgradeQtyAfterUpdate) {\n\t\t\t\t\tupgrade.invalidQuantity = upgradeCurrentQty;\n\t\t\t\t\tupgrade.validQuantity = upgradeQtyAfterUpdate;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (upgradeQtyAfterUpdate < 0) {\n\t\t\tupgradeQtyAfterUpdate = 0;\n\t\t\tif (this.upgradeHandler.isSelected(source)) {\n\t\t\t\tsourceQtyAfterUpdate = sourcePriorQty;\n\t\t\t\tif(sourceCurrentQty > sourceQtyAfterUpdate) {\n\t\t\t\t\tsource.invalidQuantity = sourceCurrentQty;\n\t\t\t\t\tsource.validQuantity = sourceQtyAfterUpdate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.upgradeHandler.setUpdatedQuantity(source, upgrade, sourceQtyAfterUpdate, upgradeQtyAfterUpdate);\n\t}\n\n\t_getUpgradeRatio(source, upgrade, sourceIdField, upgradeConversionRateField) {\n\t\tfor (let sourceId in upgrade.upgradeSourcesBySourceProductId) {\n\t\t\tif (sourceId === source.record[sourceIdField]) {\n\t\t\t\treturn upgrade.upgradeSourcesBySourceProductId[sourceId][upgradeConversionRateField];\n\t\t\t}\n\t\t}\n\t}\n}\n","let map = {};\n\nexport class Cache {\n\n\tstatic add(name, id, object, type, emitter) {\n\t\tif(!name || !id || !object)\n\t\t\treturn;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\tmap[type] = {};\n\n\t\tif(!map[type][name]) {\n\t\t\tmap[type][name] = {};\n\t\t\tif (emitter && type == 'value' && name == 'LineEditor') {\n\t\t\t\tvar event = document.createEvent('Event');\n\t\t\t\tevent.initEvent(name + '-cached', true, true);\n\t\t\t\tdocument.dispatchEvent(event);\n\t\t\t}\n\t\t}\n\n\t\tmap[type][name][id] = object;\n\t}\n\n\tstatic get(name, id, type) {\n\t\tif(!name || !id)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn null;\n\n\t\tif(!map[type][name])\n\t\t\treturn null;\n\n\t\treturn map[type][name][id];\n\t}\n\n\tstatic remove(name, id, type) {\n\t\tif(!name || !id || !type)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn;\n\t\tif(!map[type][name])\n\t\t\treturn;\n\n\t\tdelete map[type][name][id];\n\t}\n}","import {RemoteSession} from 'common/data/client/RemoteSession.js';\nimport {OAuth} from 'common/oauth/OAuth.js';\n\nexport class ConnectionClient {\n\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tgetConnection() {\n\t\tif (typeof Visualforce !== 'undefined')\n\t\t\treturn Promise.resolve(this.getRemoteConnection());\n\n\t\treturn new OAuth().getConnection();\n\t}\n\n\tgetRemoteConnection(version) {\n\t\treturn new RemoteSession(window.sb.vfSessionId, version).getConnection();\n\t}\n}","import {ConnectionClient} from 'common/data/client/ConnectionClient.js'\nimport {RestClient} from 'common/data/client/RestClient.js';\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\n\nexport class RemoteClient {\n\n\tconstructor(metricsService) {\n\t\tthis.VF_MAX_INPUT = 1000000;\n\t\tthis._remoteConnection = new ConnectionClient().getRemoteConnection();\n\t\tthis._restClient = new RestClient(this._remoteConnection);\n\t\tthis.metricsService = metricsService || new MetricsService();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn this._remote('read', reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\tlet _context = JSON.stringify(context);\n\t\tif (this._isPayloadTooLarge([_context, uid]) === true)\n\t\t\treturn this._restClient.load(prefix, loader, uid, context);\n\n\t\t\treturn this._remote('load', loader, uid, _context);\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\tvar _model = typeof model === 'string' ? model : JSON.stringify(model);\n\t\tif (this._isPayloadTooLarge([_model, saver]) === true)\n\t\t\treturn this._restClient.save(prefix, saver, model);\n\n\t\t\treturn this._remote('save', saver, _model);\n\t}\n\n\tdescribe(sObject) {\n\t\treturn this._remoteConnection.describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn new ConnectionClient().getRemoteConnection(version).query(soql);\n\t}\n\n\t_remote(method, provider, input, context) {\n\t\tvar action = this._getAction() + '.' + method;\n\n\t\tif(context)\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(provider);\n\t\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, context, this.metricsService.canGatherMetrics(), function(obj, event) {\n\t\t\t\t\tthis._callback(obj, event, resolve, reject, id);\n\t\t\t   }.bind(this), {escape: false, timeout: 120000});\n\t\t\t}.bind(this));\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tlet id = this.metricsService.startServiceRequest(provider);\n\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, this.metricsService.canGatherMetrics(), function(obj, event) {\n\t\t\t\tthis._callback(obj, event, resolve, reject, id);\n\t\t   }.bind(this), {escape: false, timeout: 120000});\n\t\t}.bind(this));\n\t}\n\n\t_getAction() {\n\t\treturn this._getPrefix() + 'ServiceRouter';\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? (this.prefix + '.') : '';\n\t}\n\n\t_callback(obj, event, resolve, reject, id) {\n\t\tif(!event.status) {\n\t\t\tthis.metricsService.stopServiceRequest(id);\n\t\t\treject(event.message);\n\t\t\treturn;\n\t\t}\n\n\t\tlet response = this._parse(obj);\n\t\tlet spt = Object.keys(response).indexOf('spt') != -1 ? response.spt : undefined;\n\t\tresponse = spt || spt === 0 ? this._parse(response.response) : response;\n\t\tthis.metricsService.stopServiceRequest(id, spt);\n\t\tresolve(response);\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n\n\t/**\n\t * Is the payload too big to VF remote?\n\t * @param content\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_isPayloadTooLarge(content) {\n\t\treturn (JSON.stringify(content).length > this.VF_MAX_INPUT);\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class RemoteSession {\n\n\tconstructor(sessionId, version) {\n\t\tthis.sessionId = sessionId;\n\t\tthis.version = version || '36.0';\n\t}\n\n\tgetConnection() {\n\t\tlet conn = new jsforce.Connection({\n\t\t\tsessionId : this.sessionId,\n\t\t\tversion: this.version,\n\t\t\tinstanceUrl: sb.common.core.AppContext.user.inCommunity ? sb.common.core.AppContext.org.orgUrl : sb.common.core.AppContext.org.orgInstanceUrl\n\t\t});\n\t\tconn.oik = AppContext.user.oik;\n\t\treturn conn;\n\t}\n}","import {OAuth} from 'common/oauth/OAuth.js';\nimport {MetricsService} from 'perfMetrics/MetricsService.js';\n\nexport class RestClient {\n\n\tconstructor(conn, metricsService) {\n\t\tthis.connection = conn;\n\t\tthis.metricsService = metricsService || new MetricsService();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet url = '&reader=' + reader + '&uid=' + uid + '&spt=' + this.metricsService.canGatherMetrics();\n\t\t\t\tlet id = this.metricsService.startServiceRequest(url);\n\t\t\t\tapex.get(this._getEndpoint() + url).then(function(result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet url = '&loader=' + loader + '&uid=' + uid + '&spt=' + this.metricsService.canGatherMetrics();\n\t\t\t\tlet id = this.metricsService.startServiceRequest(url);\n\t\t\t\tapex.patch(this._getEndpoint() + url, {\n\t\t\t\t\tcontext: JSON.stringify(context)\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(saver);\n\t\t\t\tapex.post(this._getEndpoint() + '&spt=' + this.metricsService.canGatherMetrics(), {\n\t\t\t\t\tsaver: saver,\n\t\t\t\t\tmodel: (typeof model === 'string' ? model : JSON.stringify(model))\n\t\t\t\t}).then(function (result) {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tdescribe(sObject) {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn conn.describe(sObject);\n\t\t});\n\t}\n\n\tquery(soql) {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn conn.query(soql);\n\t\t});\n\t}\n\n\tstreamFileContents(fileType, fileId, fileContentsField) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._getApex().then((apex) => {\n\t\t\t\tlet id = this.metricsService.startServiceRequest(fileId);\n\t\t\t\tapex.post(null, {\n\t\t\t\t\tsaver: 'sobjects',\n\t\t\t\t\tmodel: '/sobjects/' + fileType + '/' + fileId + '/' + fileContentsField\n\t\t\t\t})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tthis._resolve(this._parse(result), resolve, id);\n\t\t\t\t}, (err) => {\n\t\t\t\t\tthis._reject(reject, err.message || err, id);\n\t\t\t\t})\n\t\t\t}, (err) => {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetConnection(conn) {\n\t\tthis.connection = conn;\n\t}\n\n\tgetConnection() {\n\t\tif(this.connection)\n\t\t\treturn Promise.resolve(this.connection);\n\n\t\tif(typeof window === 'undefined')\n\t\t\treturn Promise.reject('Connection not set');\n\n\t\tthis.oauth = this.oauth || new OAuth();\n\t\treturn this._getConnection(this.oauth);\n\t}\n\n\t_getConnection(oauth) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\toauth.getConnection().then(function(conn) {\n\t\t\t\tthis.connection = conn;\n\t\t\t\tresolve(this.connection);\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\t_getApex() {\n\t\treturn this.getConnection().then(conn => {\n\t\t\treturn Promise.resolve(conn.apex);\n\t\t});\n\t}\n\n\t_getEndpoint() {\n\t\treturn this._getPrefix() + '/ServiceRouter?' + (this.connection.oik === undefined ? '' : 'oik=' + this.connection.oik);\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? ('/' + this.prefix) : '';\n\t}\n\n\t_resolve(response, resolve, id) {\n\t\tlet spt = Object.keys(response).indexOf('spt') != -1 ? response.spt : undefined;\n\t\tthis.response = spt || spt === 0 ? this._parse(response.response) : response;\n\t\tthis.metricsService.stopServiceRequest(id, spt);\n\t\tresolve(this.response);\n\t}\n\n\t_reject(reject, errorMessage, id) {\n\t\tnew MetricsService().stopServiceRequest(id);\n\t\treject(this._adjustErrorMessage(errorMessage));\n\t}\n\n\t_adjustErrorMessage(errorMessage) {\n\t\tif(errorMessage === 'expired access/refresh token')\n\t\t\terrorMessage += ' - to authorize go to http://localhost:' + location.port + '/common/oauth';\n\n\t\treturn errorMessage;\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n}","import {RemoteClient} from 'common/data/client/RemoteClient.js';\nimport {RestClient} from 'common/data/client/RestClient.js';\n\nexport class ServiceClient {\n\n\tconstructor() {\n\t\tthis.client = typeof Visualforce !== 'undefined' ? new RemoteClient() : new RestClient();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\treturn this.client.read(prefix, reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\treturn this.client.load(prefix, loader, uid, context);\n\t}\n\n\tsave(prefix, saver, model) {\n\t\treturn this.client.save(prefix, saver, model);\n\t}\n\n\tmd(prefix, type, fullNames) {\n\t\treturn this.client.load(prefix, 'OAuthExtension.MetadataReader', null, {type: type, items: fullNames});\n\t}\n\n\tdescribe(prefix, sObject) {\n\t\treturn this.client.describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn this.client.query(soql, version);\n\t}\n\n\tstreamFileContents(fileType, fileId, fileContentsField) {\n\t\treturn this.client.streamFileContents(fileType, fileId, fileContentsField);\n\t}\n\n\tsetConnection(conn) {\n\t\tif(typeof this.client.setConnection === 'function')\n\t\t\tthis.client.setConnection(conn);\n\t}\n}","import {JsonFormatter} from 'common/data/format/JsonFormatter.js';\n\nexport class DataBuilder {\n\n\tconstructor(pretty) {\n\t\tthis.pretty = pretty;\n\t\tthis.data = {};\n\t}\n\n\taddQuote(key, quote, omitRelationships) {\n\t\treturn this.addObject(key, quote, true, omitRelationships, false);\n\t}\n\n\t/**\n\t *\n\t * @param key\n\t * @param obj\n\t * @param omitNull\n\t * @param omitRelationships\n\t * @param stringify\n\t * @returns {DataBuilder}\n\t */\n\taddObject(key, obj, omitNull, omitRelationships, stringify) {\n\t\tthis.data[key] = obj != null ? new JsonFormatter(omitNull, omitRelationships, this.pretty).format(obj, stringify) : obj;\n\t\treturn this;\n\t}\n\n\t//currently unused as the parameters have been checked before reaching the DataBuilder\n\taddInt(key, int) {\n\t\ttry {\n\t\t\tint = parseInt(int);\n\t\t\tif(!isNaN(int))\n\t\t\t\tthis.data[key] = int;\n\t\t\treturn this;\n\t\t} catch (e) {\n\t\t\t// just in case parseInt throws exception in other browsers\n\t\t\treturn this;\n\t\t}\n\t}\n\n\tadd(key, val) {\n\t\tthis.data[key] = val;\n\t\treturn this;\n\t}\n\n\tbuild() {\n\t\treturn this.data;\n\t}\n}","export class ErrorFormatter {\n\n\tconstructor(message) { //takes string or array\n\t\tthis.message = typeof message === 'string' ? message : message[0];\n\t}\n\n\ttruncate() {\n\t\tlet topLine = this.message.split('\\n')[0].split(':');\n\t\tif (topLine.length > 1)\n\t\t\tif (topLine[0].startsWith('System'))\n\t\t\t\treturn [topLine.splice(1, topLine.length - 1).join(':')];\n\t\t\telse\n\t\t\t\treturn [topLine.join(':')];\n\t\telse\n\t\t\treturn topLine;\n\t}\n}","export class JsonFormatter {\n\n\tconstructor(omitNull, omitRelationships, pretty, fieldsToKeep) {\n\t\tthis.omitNull = omitNull;\n\t\tthis.omitRelationships = omitRelationships;\n\t\tthis.pretty = pretty;\n\t\tthis.requiredFieldSet = this.getRequiredFields(fieldsToKeep);\n\t}\n\n\tgetRequiredFields(fieldsToKeep){\n\t\tlet fieldSet = new Set();\n\t\tfor(let key in fieldsToKeep) {\n\t\t\tfor(let j=0, l = fieldsToKeep[key].length; j < l; j++){\n\t\t\t\tfieldSet.add(fieldsToKeep[key][j]);\n\t\t\t}\n\t\t}\n\t\treturn fieldSet;\n\t}\n\n\t/**\n\t * Formats an object\n\t * @param obj\n\t * @param stringify\n\t * @returns {*}\n\t */\n\tformat(obj, stringify) {\n\t\tif(obj === undefined)\n\t\t\treturn;\n\n\t\tif(obj === null)\n\t\t\treturn JSON.stringify(obj);\n\n\t\tlet pretty = this.pretty;\n\t\tif (typeof pretty !== 'number')\n\t\t\tpretty = pretty ? 2 : null;\n\n\t\tlet results = JSON.stringify(obj, this._replacer.bind(this), pretty);\n\n\t\treturn stringify === true ? results : JSON.parse(results);\n\t}\n\n\t_replacer(key, value) {\n\t\tif (value === undefined || key === '_transient_')\n\t\t\treturn;\n\n\t\tif (this.omitNull && value === null && !this.requiredFieldSet.has(key))\n\t\t\treturn;\n\n\t\t// if key is an number and not a string then key.endsWith is undefined so lets check its defined before we dereference it\n\t\t// without this check the underlying error affected apply immediately product rule execution for Nimble in Safari\n\t\tif(this.omitRelationships && key.endsWith && key.endsWith('__r'))\n\t\t\treturn;\n\n\t\tif(value === '#Error!')\n\t\t\treturn !this.omitNull ? null : undefined;\n\n\t\treturn value;\n\t}\n}","import {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class QuoteMinimizer {\n\tconstructor(quote, products, groupkey, stripLinesThreshold, stripLinesMessage) {\n\t\tthis.quote = quote;\n\t\tthis.products = products;\n\t\tthis.groupKey = groupkey;\n\t\tthis.stripLinesThreshold = stripLinesThreshold;\n\t\tthis.stripLinesMessage = stripLinesMessage;\n\t}\n\n\treduceQuote(hasRelatedLines) {\n\t\tthis.originalLines = this.quote.lineItems;\n\t\tthis.quote.partialVO = true;\n\n\t\tif (hasRelatedLines === false) {\n\t\t\t// When a quote scoped product selection rules will not have any related lines\n\t\t\tthis.quote.lineItems = [];\n\t\t\treturn this.quote;\n\t\t}\n\n\t\t// If the quote size exceeds the admin-declared large quote threshold, then we need to remove all non-essential\n\t\t// lines from the quote, and capture necessary data about the omitted lines.\n\t\t// Log a message to the console indicating that lines have been omitted.\n\t\tlet lineOmissionMsg = this.stripLinesMessage\n\t\t\t.replace('{0}', this.quote.record.Id)\n\t\t\t.replace('{1}', this.stripLinesThreshold);\n\t\tconsole.log(lineOmissionMsg);\n\n\t\t// Get aggregated data about the lines. Initialize a QuoteLineAggregator to do it.\n\t\tlet qla = new QuoteLineAggregator(this.quote);\n\t\t// We need the IDs of existing products, so that upgrade products can be loaded.\n\t\tthis.quote.existingProductIds = qla.getExistingProductIdsFromLines();\n\t\t// We need to get MDQ Segment Templates from the existing lines, filtering by a group key if one exists.\n\t\t// These let us know how many segments new MDQ products need.\n\t\tlet templates = qla.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);\n\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey || -1) + ''] = templates;\n\t\t// We need a list of the keys that correspond to empty groups, so we can guarantee that products whose\n\t\t// NewQuoteGroup__c field is checked will be added to new groups under the right circumstances.\n\t\tthis.quote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\n\t\t// Now we need to actually determine which lines can or cannot be omitted.\n\t\t// Get the set of keys we'll have to send. Save it on the component so that we can compare it to the set of lines\n\t\t// we get back.\n\t\tif (this.products)\n\t\t\tthis.requiredKeys = this._getNecessaryLineKeys();\n\t\t// Pull all of those lines into their own list.\n\t\tlet sentLines = [];\n\t\tfor (let line of this.quote.lineItems)\n\t\t\tif (this.requiredKeys.has(line.key))\n\t\t\t\tsentLines.push(line);\n\t\t// Store the original line list so we can restore it after we send the model.\n\t\t// Replace the quote's line item list with this new, abridged one.\n\t\tthis.quote.lineItems = sentLines;\n\n\t\t// Mark the quote VO as partial, and add it to the data model.\n\t\treturn this.quote;\n\t}\n\n\n\n\trevertQuote() {\n\t\tthis.quote.partialVO = false;\n\t\tthis.quote.lineItems = this.originalLines;\n\t\tdelete this.quote.existingProductIds;\n\t\tdelete this.quote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\tdelete this.quote.emptyGroupKeys;\n\t\treturn this.quote;\n\t}\n\n\tgetRequiredKeys() {\n\t\treturn this.requiredKeys;\n\t}\n\n\t_getNecessaryLineKeys() {\n\t\tlet prefix = this.quote.record.attributes.type == 'Quote__c' ? '' : this.quote.record.attributes.type.slice(0, -8);\n\t\tlet relevantKeys = new Set();\n\n\t\t// If we determine that a given line must be sent to the server, we also need to send any lines designated as its\n\t\t// children or its source. This method will add the given line's key to the set, along with its children and source.\n\t\tthis.products.forEach((product) => {\n\t\t\t// Each ProductVO we're sending to the server can require lines for two reasons.\n\t\t\t// 1. If the product has a configuration, the configuration's lineItemKey property can indicate an existing line.\n\t\t\tif (product.configuration && product.configuration.lineItemKey) {\n\t\t\t\tlet lineCount = this.quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = this.quote.lineItems[i];\n\t\t\t\t\tif (line.key === product.configuration.lineItemKey) {\n\t\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 2. If the product has an Upgraded Asset Id, the product requires the line that has that Upgraded Asset Id,\n\t\t\t// and is also marked Existing__c.\n\t\t\tif (product.upgradedAssetId) {\n\t\t\t\tlet lineCount = this.quote.lineItems.length;\n\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\tlet line = this.quote.lineItems[i];\n\t\t\t\t\tif (line.record[prefix + 'UpgradedAsset__c'] === product.upgradedAssetId && line.record[prefix + 'Existing__c']) {\n\t\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn relevantKeys;\n\t}\n\n\t_addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, rootLine) {\n\t\tif (relevantKeys.has(rootLine.key)) {\n\t\t\t// If the relevant key set already has this rootLine's key, we can be sure we've got all lines related to it too.\n\t\t\t// So we can exit early.\n\t\t\treturn;\n\t\t}\n\t\tlet rootIsParent = rootLine.record[prefix + 'Bundle__c'];\n\t\tlet rootIsUpgrade = rootLine.sourceLineKey != null;\n\t\tif (rootIsParent || rootIsUpgrade) {\n\t\t\t// If the line is a parent line, or an upgrade line, we need to get the line's children and its source.\n\t\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\t\tlet isChildOfRoot = rootIsParent && line.parentItemKey === rootLine.key;\n\t\t\t\tlet isSourceOfRoot = rootIsUpgrade && line.key === rootLine.sourceLineKey;\n\t\t\t\tif (isChildOfRoot || isSourceOfRoot) {\n\t\t\t\t\tthis._addLineKeyWithRecursiveCallOnChildrenAndSource(prefix, relevantKeys, line);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Now that we've got all of the keys related to the root line's key, we add the root line's key and return.\n\t\trelevantKeys.add(rootLine.key);\n\t}\n}","export class Describe {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-describe';\n\t\tthis.properties = {\n\t\t\tobjects: Array, // An array of objectNames for describing objects\n\t\t\tfields: Array, // An array of objectName.fieldName for describing fields\n\t\t\tcache: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'describe'\n\t\t\t},\n\t\t\tdescribe: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'describeObjects(objects)',\n\t\t\t'describeFields(fields)'\n\t\t];\n\t}\n\n\tdescribeObjects() {\n\t\tlet ordered = [];\n\t\tthis.objects.forEach(function (obj) {\n\t\t\tordered.push(obj);\n\t\t});\n\t\tthis._describe(this.objects).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet response = {objects: ordered};\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tmd[obj.name] = obj;\n\t\t\t}\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\tdescribeFields() {\n\t\tlet ordered = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tordered.push(field);\n\t\t});\n\t\tlet objectFields = {};\n\t\tfor (let i = 0, l = this.fields.length; i < l; i++) {\n\t\t\tlet parts = this.fields[i].split('.'), obj = parts[0], field = parts[1];\n\t\t\tobjectFields[obj] = objectFields[obj] || {};\n\t\t\tobjectFields[obj][field] = true;\n\t\t}\n\n\t\tthis._describe(Object.keys(objectFields)).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet allFields = {};\n\t\t\tlet response = {fields: ordered};\n\t\t\tlet controlledFields = [];\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tlet mdFields = objectFields[obj.name];\n\t\t\t\tfor (let i = 0, l = obj.fields.length; i < l; i++) {\n\t\t\t\t\tallFields[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\tif (mdFields[obj.fields[i].name]) {\n\t\t\t\t\t\tmd[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\t\tobj.fields[i].tableName = obj.name; // add a reference to the field's table\n\t\t\t\t\t\tif (obj.fields[i].controllerName != null) {\n\t\t\t\t\t\t\tcontrolledFields.push(obj.fields[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Loop through all controlled pick-list fields (children) on the requested set of fields\n\t\t\t// and find each child's corresponding controlling pick-list field (parent) and associate the two together\n\t\t\t// also add each controlling pick-list field (parent) to the response md object even if not part of the requested set of fields\n\t\t\tcontrolledFields.forEach((controlledField) => {\n\t\t\t\tlet controllingFieldName = controlledField.tableName + '.' + controlledField.controllerName;\n\t\t\t\tcontrolledField.controllingField = allFields[controllingFieldName];\n\t\t\t\tcontrolledField.controllingField.controllingPicklist = true;\n\t\t\t\tmd[controllingFieldName] = controlledField.controllingField;\n\t\t\t});\n\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\t_describe(objects) {\n\t\tthis.waiting = true;\n\t\tlet promises = [];\n\t\tfor (let i = 0, l = objects.length; i < l; i++)\n\t\t\tpromises.push(this.$.service.describe({sObject: objects[i]}));\n\n\t\treturn Promise.all(promises);\n\t}\n}\n\nPolymer(Describe);","import {AppContext} from 'common/core/AppContext.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {Cache} from 'common/data/cache/Cache.js';\n\nexport class Service {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-service';\n\t\tthis.properties = {\n\t\t\treader: String,\n\t\t\tloader: String,\n\t\t\tsaver: String,\n\t\t\tuid: String, // used for reader, loader, and saver\n\t\t\tmodel: Object, // user for saver\n\t\t\tcontext: Object, // used for loader\n\t\t\tmdType: String, // type of metadata to read (see https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_types_list.htm)\n\t\t\tmdItems: Array, // items of metadata to read\n\t\t\tsObject: String, // name of an sObject to be described\n\t\t\tsoql: String, // soql statement to be queried\n\t\t\tfileType: String, // SObject type of a file whose contents will be read\n\t\t\tfileId: String, // ID of a file whose contents will be read\n\t\t\tfileContentsField: String, // API Name of the field where a file's contents are stored\n\t\t\tcache: String, // the named cache used manage the server retrieve response\n\t\t\twaiting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclient: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn new ServiceClient();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttransient: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean, //Setting this to true will force a read from the service and not use the cache\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tversion: String // currently only supported for the query API for RemoteClient\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_read(reader, uid, prefix)',\n\t\t\t'_save(saver, model, prefix)',\n\t\t\t'_load(loader, uid, context, prefix)',\n\t\t\t'_md(mdType, mdItems, prefix)',\n\t\t\t'_describe(sObject, prefix)',\n\t\t\t'_query(soql)',\n\t\t\t// though uid is not used for the callout, it is necessary to cache the results, and thus included in the observer\n\t\t\t'_streamFileContents(uid, fileType, fileId, fileContentsField)',\n\t\t\t'_spinner(waiting, background)'];\n\t}\n\n\tread(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.read(this.prefix, this.reader, this.uid));\n\t}\n\n\tload(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.load(this.prefix, this.loader, this.uid, this.context));\n\t}\n\n\tsave(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tif (this.transient)\n\t\t\treturn this._response(Promise.resolve(this.model));\n\n\t\treturn this._response(this.client.save(this.prefix, this.saver, this.model));\n\t}\n\n\tmd(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.md(this.prefix, this.mdType, this.mdItems));\n\t}\n\n\tdescribe(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse(this.sObject);\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.describe(this.prefix, this.sObject), this.sObject);\n\t}\n\n\tstreamFileContents(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise) {\n\t\t\treturn promise;\n\t\t}\n\t\treturn this._response(this.client.streamFileContents(this.fileType, this.fileId, this.fileContentsField));\n\t}\n\n\tquery(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.query(this.soql, this.version));\n\t}\n\n\t_read() {\n\t\tthis.read().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_load() {\n\t\tthis.load().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_save() {\n\t\tthis.save().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_md() {\n\t\tthis.md().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_describe() {\n\t\tthis.describe().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_query() {\n\t\tthis.query().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_streamFileContents() {\n\t\tthis.streamFileContents().then(() => {\n\n\t\t}, (err) => {\n\t\t\tconsole.error(err.message || err);\n\t\t});\n\t}\n\n\t_spinner() {\n\t\tthis.spinner = this.waiting && !this.background;\n\t}\n\n\t_returnPromiseIfCachedResponse(uid) {\n\t\tif(this.ignoreCache === true)\n\t\t\treturn false;\n\n\t\tuid = uid || this.uid;\n\n\t\tvar cachedResponse = Cache.get(this.cache, uid);\n\t\tif (cachedResponse) {\n\t\t\tthis.response = cachedResponse;\n\t\t\treturn Promise.resolve(this.response);\n\t\t}\n\n\t\tvar cachedPromise = Cache.get(this.cache, uid, 'promise');\n\t\tif (cachedPromise) {\n\t\t\tcachedPromise._services = cachedPromise._services || [];\n\t\t\tif(cachedPromise._services.indexOf(this) === -1)\n\t\t\t\tcachedPromise._services.push(this);\n\t\t\treturn cachedPromise;\n\t\t}\n\n\t\tif (this.transient)\n\t\t\treturn Promise.resolve(this.response);\n\n\t\treturn null;\n\t}\n\n\t_response(promise, uid) {\n\t\tthis.waiting = true;\n\t\tCache.add(this.cache, uid || this.uid, promise, 'promise');\n\t\treturn promise.then(function (res) {\n\t\t\tthis.waiting = false;\n\t\t\tif (res != undefined) {\n\t\t\t\tthis.response = res;\n\t\t\t\tvar services = promise._services || [];\n\t\t\t\tservices.forEach(function(service) {\n\t\t\t\t\tservice.response = this.response;\n\t\t\t\t}.bind(this));\n\t\t\t\tCache.add(this.cache, uid || this.uid, this.response, 'value', this);\n\t\t\t}\n\t\t\tCache.remove(this.cache, uid || this.uid, 'promise');\n\t\t\treturn Promise.resolve(this.response);\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tif (err) {\n\t\t\t\tthis.error = this._createError(err);\n\t\t\t\tvar services = promise._services || [];\n\t\t\t\tservices.forEach(function(service) {\n\t\t\t\t\tservice.error = this.error;\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\tCache.remove(this.cache, uid || this.uid, 'promise');\n\t\t\treturn Promise.reject(this.error);\n\t\t}.bind(this));\n\t}\n\n\tcreateError(err) {\n\t\treturn this._createError(err);\n\t}\n\n\t_createError(err) {\n\t\tvar msg = err.message || err;\n\t\tvar error = {message: msg};\n\n\t\tvar validations;\n\t\tif (msg.indexOf('ValidationException: [') != -1 || msg.startsWith('[')) {\n\t\t\tvar start = msg.indexOf('[');\n\t\t\tvar end = msg.indexOf(']', start) + 1;\n\t\t\tif (end > start)\n\t\t\t\tvalidations = msg.substring(start, end);\n\t\t}\n\n\t\tif (validations) {\n\t\t\ttry {\n\t\t\t\tvar escapedValidations = validations.replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\\\\r\");\n\t\t\t\tvar validationsArray = JSON.parse(escapedValidations);\n\t\t\t\terror.validations = validationsArray;\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n\n\t\treturn error;\n\t}\n}\n\nPolymer(Service);","import {Util} from 'common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Searcher {\n\tconstructor(model) {\n\t\tthis.model = model;\n\t\tthis.searchFilterData = {};\n\t}\n\n\tbuildFields(fields) {\n\t\treturn fields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.model.targetObjectName;\n\t}\n\n\tgetGroupKey(filter) {\n\t\tif (this.model.hasCustomSearchFilters)\n\t\t\treturn filter.record.Id;\n\t\telse\n\t\t\treturn filter.targetFieldName;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tif (this.model.hasCustomSearchFilters) {\n\t\t\tfor (let id of group) {\n\t\t\t\tfor (let filter of this.model.searchFilters) {\n\t\t\t\t\tif (filter.record.Id === id) {\n\t\t\t\t\t\tif(searchFilterModel && this.isLookupType(searchFilterModel[id].model.type))\n\t\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(filter.stringValue, searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\t\tsearchFilterData[id] = {\n\t\t\t\t\t\t\tvalue: this.searchFilterData[id] === undefined ? (filter.stringValue ? filter.stringValue : '') : this.searchFilterData[id].value,\n\t\t\t\t\t\t\tfield: this.searchFilterData[id] === undefined ? (filter.targetFieldName ? filter.targetFieldName : '') : this.searchFilterData[id].field,\n\t\t\t\t\t\t\thidden: filter.hidden\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let filter of group) {\n\t\t\t\tsearchFilterData[filter] = {value: this.searchFilterData[filter] === undefined ? searchFilterModel[filter].stringValue : this.searchFilterData[filter].value};\n\t\t\t\tif(this.searchFilterData[filter] && this.searchFilterData[filter].label)\n\t\t\t\t\tsearchFilterData[filter].label = this.searchFilterData[filter].label;\n\t\t\t}\n\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = this.handleDynamicSearchFilters(searchFilterData);\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = this.handleDynamicSearchFilters(searchFilterData);\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleDynamicSearchFilters(searchFilterData) {\n\t\tif (!this.dynamicSearchFilters)\n\t\t\treturn searchFilterData;\n\t\telse {\n\t\t\tfor (let filter of this.dynamicSearchFilters) {\n\t\t\t\tif (filter.type === 'Optional Filter' && searchFilterData[filter.targetFieldName])\n\t\t\t\t\tsearchFilterData[filter.targetFieldName].value = filter.stringValue;\n\t\t\t}\n\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\tgetFilterContext() {\n\t\tlet searchFilterData = {};\n\t\tif (this.model.hasCustomSearchFilters) {\n\t\t\tfor (let value in this.searchFilterData) {\n\t\t\t\tfor (let filter of this.model.searchFilters) {\n\t\t\t\t\tif (value === filter.record.Id && this.searchFilterData[value]) {\n\t\t\t\t\t\t//some search filters evaluate equals instead of contains so need to avoid searching against only empty value\n\t\t\t\t\t\tif (this.isBlank(this.searchFilterData[value].value) === true)\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tsearchFilterData[filter.targetFieldName] = this.searchFilterData[value].value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn searchFilterData;\n\t\t} else\n\t\t\tfor (let value in this.searchFilterData) {\n\t\t\t\t//some search filters evaluate equals instead of contains so need to avoid searching against only empty value\n\t\t\t\tif (this.isBlank(this.searchFilterData[value].value) === true)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tsearchFilterData[value] = this.searchFilterData[value].value;\n\t\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\tgetAdditionalProperties() {\n\t\t//build object for DynamicOptionsLoader service\n\t\tif (this.dynamicSearchFilters) {\n\t\t\tlet filters = [];\n\t\t\tfor (let i = 0, numFilters = this.dynamicSearchFilters.length; i < numFilters; i++)\n\t\t\t\tif (this.dynamicSearchFilters[i].type === 'Default Filter')\n\t\t\t\t\tfilters.push(JSON.stringify(this.dynamicSearchFilters[i]));\n\t\t\treturn filters;\n\t\t}\n\t}\n\n\tclearFields() {\n\t\tlet searchFilterData = {};\n\t\tfor (let filter in this.searchFilterData) {\n\t\t\t// clone the previous object as we want to maintain all previous search filter data properties (i.e. field) and simply clear the value property\n\t\t\tsearchFilterData[filter] = JSON.parse(JSON.stringify(this.searchFilterData[filter]));\n\t\t\tsearchFilterData[filter].value = '';\n\t\t}\n\t\treturn this.searchFilterData = searchFilterData;\n\t}\n\n\trunOnLoad(filterValues) {\n\t\tthis.searchFilterData = filterValues;\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n\n\thasSearchFilterValues() {\n\t\tlet searchValues = this.getFilterContext();\n\t\tfor (let searchFilter in searchValues) {\n\t\t\tif (searchValues[searchFilter] != null)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Is the value blank?\n\t * @param value\n\t * @returns {boolean}\n\t */\n\tisBlank(value) {\n\t\treturn value === null || value === '' || value === undefined;\n\t}\n}\n","import {AppContext} from '../AppContext.js';\nimport {Util} from '../../Util.js';\n\n// Maps of cached Intl.DateTimeFormat and Intl.NumberFormat objects using their \"options\" object as 2nd-level keys\n// First level keys are locale strings\nlet dateFormatCache = new Util.Map(),\n\t\tnumberFormatCache = new Util.Map(),\n\t\tlocaleData;  // CLDR locale data for current user's locale, e.g. fr-CA\n\nexport class I18n {\n\n\tconstructor( app ) {\n\t\t// As a Polymer web component we get \"this.app\" from AppContext behavior.\n\t\t// But as regular ES6 class we have to set up ourselves (and we can't extend AppContext for circular dep reasons)\n\t\tthis.app = app;\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-i18n';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\t/**\n\t\t\t * The BCP 47 locale to use to format the data value or translate the message string (i.e. the language).\n\t\t\t * This will default to the user's locale or language so you only need to set it in \"override\" situations.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tlocale: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * The key to use to lookup the translated message string. Only set for overrides or complex/long messages.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tkey: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false\n\t\t\t},\n\t\t\t/**\n\t\t\t * The single value to replace the 0th wildcard in the provided translation key (e.g. '{0} items found')\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\t/**\n\t\t\t * The array of values to replace the multiple wildcard strings provided by the translation key (e.g. '{0} of {1} items found')\n\t\t\t * @type {Array}\n\t\t\t */\n\t\t\tvalues: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['localize(key, value, values)'];\n\t}\n\n\tattached() {\n\t\tthis.key = this.key ? this.key : this.innerHTML;\n\t\tif(/{[0-9]}/.test(this.innerHTML))\n\t\t\tthis.innerHTML = ''; // contains wildcard so lets hide until wildcard values are replaced\n\t}\n\n\tlocalize() {\n\t\tthis.innerHTML = this.l(this.key, this.value ? [this.value] : this.values);\n\t}\n\n\t/** Localize a string into a different language */\n\tl( key, values ) {\n\t\tlet label = this.labels[ key ] || key;\n\t\tif(/{[0-9]}/.test(label) && values && values.length > 0)\n\t\t\tlabel = this._replaceWildcards(label, values);\n\n\t\treturn label;\n\t}\n\n\tstatic addLocaleData( d ) {\n\t\tif( d )\n\t\t\tlocaleData = d;\n\t}\n\n\tstatic getLocaleData( locale ) {\n\t\treturn localeData;  // in future we may hold more than 1 data concurrently\n\t}\n\n\t_replaceWildcards(label, values) {\n\t\tfor(let i = 0, l = values.length; i < l; i++)\n\t\t\tlabel = label.replace(new RegExp('{[' + i + ']}', 'g'), values[i]);\n\t\treturn label;\n\t}\n\n\t_getFormat( locale, key, isDate ) {\n\t\tlet f = null;\n\t\tif( locale && key ) {\n\t\t\tlet loc = isDate ? dateFormatCache.get( locale ) : numberFormatCache.get( locale );\n\t\t\tif ( !loc ) {\n\t\t\t\tloc = new Util.Map();\n\t\t\t\tlet c = isDate ? dateFormatCache : numberFormatCache;\n\t\t\t\tc.set( locale, loc );\n\t\t\t}\n\n\t\t\tlet stringKey = JSON.stringify( key );\n\t\t\tf = loc.get( stringKey );\n\t\t\tif( !f ) {\n\t\t\t\tf = isDate ? new Intl.DateTimeFormat( locale, key ) : new Intl.NumberFormat( locale, key );\n\t\t\t\tloc.set( stringKey, f );\n\t\t\t}\n\t\t}\n\t\treturn f;\n\t}\n\n\t/**\n\t * Format a date or number.\n\t * @param  {Object|number} value   the Date object or number value (float or integer)\n\t * @param  {object} options the options object to pass into Intl.DateTimeFormat or Intl.NumberFormat constructor\n\t * @return {string}         the formated string\n\t */\n\tformat( value, options ) {\n\t\tlet v = '',\n\t\t\topts = options || {},\n\t\t\tlocale = this.user.locale === 'no-NO' ? 'nb-NO' : this.user.locale;\n\n\t\tif ( value || value == 0 ) {\n\t\t\tif ( value instanceof Date || opts.date ) {\n\t\t\t\tlet fmt = this._getFormat( locale, opts, true );\n\t\t\t\tif ( value instanceof Date ) {\n\t\t\t\t\tv = fmt.format( value );\n\t\t\t\t} else if ( typeof value == 'number' ) {\n\t\t\t\t\tv = fmt.format( new Date( value ) );\n\t\t\t\t} else if ( typeof value === 'string' ) {\n\t\t\t\t\t// Salesforce has dates in ISO-8601 format always\n\t\t\t\t\tlet pos = value.indexOf( 'T' );\n\t\t\t\t\tif( pos >= 0 )\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tv = fmt.format( Date.parse( value ) );  // assume it is in ISO-8601 format with correct TZ?\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tlet parts = value.split('T'),\n\t\t\t\t\t\t\t\tymd = parts[0].split( '-' );\n\t\t\t\t\t\t\tif( ymd && ymd.length == 3 )\n\t\t\t\t\t\t\t\tv = fmt.format( new Date( ymd[0], ymd[1]-1, ymd[2] ) );\n\t\t\t\t\t\t}\n\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet ymd = value.split( '-' );\n\t\t\t\t\t\tif( ymd && ymd.length == 3 )\n\t\t\t\t\t\t\tv = fmt.format( new Date( ymd[0], ymd[1]-1, ymd[2] ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet fmt = this._getFormat( locale, opts, false );\n\t\t\t\tv = fmt.format( value );\n\t\t\t\tif (opts.style === 'currency') {\n\t\t\t\t\tv = this._additionalCurrencyFormat(opts, v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn v;\n\t}\n\n\t/**\n\t * Applies extra formatting to currency values in order to properly add currency symbols.\n\t * @param {object} opts - An options object provided to the formatter.\n\t * @param {String} v - The output of the formatter, a string representing a formatted number.\n\t * @returns {String} The final formatted currency value.\n\t * @private\n\t */\n\t_additionalCurrencyFormat (opts, v) {\n\t\t// Allow a user defined Currency Symbol to override org default currency.\n\t\tlet formattedCurrency;\n\t\tif (opts.currency === 'XXX') {\n\t\t\tformattedCurrency = this.org.currencySymbol + v.replace(/[XXX]/g, '');\n\t\t} else {\n\t\t\tlet containsDash;\n\t\t\tif (opts.currencyDisplay == 'code') {\n\t\t\t\tcontainsDash = v.indexOf('-') > - 1;\n\t\t\t\tif (containsDash)  {\n\t\t\t\t\tv = v.replace('-', '');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Append a space after currency code if code is used.\n\t\t\tlet additionalContent = containsDash ? ' -' : ' ';\n\t\t\tformattedCurrency = v.replace(opts.currency, opts.currency + additionalContent) ;\n\t\t}\n\t\treturn formattedCurrency.trim();\n\t}\n}\n\nPolymer( I18n );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\n/**\n * THIS COMPONENT IS DEPRECATED.\n * For page level spinners, call: PageContainer.toggleSpinner(b);\n * For individual spinners on things like modals, use sf-loading-spinner\n */\nexport class LoadingSpinner {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-loading-spinner';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'toggle'\n\t\t\t},\n\t\t\tisReady: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpreviousState: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Component is ready\n\t */\n\tready() {\n\t\tthis.isReady = true;\n\t}\n\n\t/**\n\t * When the component detaches, disable spinner if previously turned on\n\t */\n\tdetached() {\n\t\tif (this.previousState === false) return;\n\n\t\tPageContainer.toggleSpinner(false);\n\t}\n\n\t/**\n\t * Turn spinner on/of\n\t * Some state logic in here due to the polymer lifecycle\n\t * @param {boolean} state Specify the toggle state\n\t */\n\ttoggle(state) {\n\t\t// check if the component has hit the ready function\n\t\t// it's possible it won't hit the ready function, but be toggled on\n\t\t// this happens when the property is set before the component is ready and we should honor that\n\t\tif (this.isReady !== true && state === false) return;\n\n\t\tif (state === this.previousState) return; // not a change in state\n\n\t\tPageContainer.toggleSpinner(state); // toggle the page spinner\n\t\tthis.previousState = state;\n\t}\n}\n\nPolymer(LoadingSpinner);","// Media Query breakpoints.  These need to be kept in sync with variables.less.\nlet bpXS = 0, bpS = 480, bpM = 800, bpL = 1024, bpXL = 1200,\n\t\tmqXS = window.matchMedia( 'screen and (max-width: ' + bpS + 'px)' ),\n\t\tmqSOnly = window.matchMedia( 'screen and (min-width: ' + (bpS + 1) + 'px) and (max-width: ' + bpM + 'px)' ),\n\t\tmqMOnly = window.matchMedia( 'screen and (min-width: ' + (bpM + 1) + 'px) and (max-width: ' + bpL + 'px)' ),\n\t\tmqLOnly = window.matchMedia( 'screen and (min-width: ' + (bpL + 1) + 'px) and (max-width: ' + bpXL + 'px)' ),\n\t\t// AA Fix to resolve button rendering issue\n\t\tmqXL = window.matchMedia( 'screen and (min-width: ' + (bpXL + 1) + 'px)' ),\n\t\tactiveSpinners = 0;\n\nimport {AppContext} from 'common/core/AppContext.js';\nexport class PageContainer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-container';\n\t\tthis.properties = {\n\t\t\troute: String,\n\n\t\t\tallRoutes: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; },\n\t\t\t\tobserver: '_allRoutesChanged'\n\t\t\t},\n\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_buildViewport( xs, s, m, l, xl ) {\n\t\tlet v = {\n\t\t\tXS: {},\n\t\t\tS: {},\n\t\t\tM: {},\n\t\t\tL: {},\n\t\t\tXL: {},\n\t\t\tcurrent: function() {\n\t\t\t\tif(this.XS.only)\n\t\t\t\t\treturn {size: 'XS', window: [bpXS, bpS]};\n\t\t\t\tif(this.S.only)\n\t\t\t\t\treturn {size: 'S', window: [bpS + 1, bpM]};\n\t\t\t\tif(this.M.only)\n\t\t\t\t\treturn {size: 'M', window: [bpM + 1, bpL]};\n\t\t\t\tif(this.L.only)\n\t\t\t\t\treturn {size: 'L', window: [bpL + 1, bpXL]};\n\t\t\t\tif(this.XL.only)\n\t\t\t\t\treturn {size: 'XL', window: [bpXL, 10000]};\n\t\t\t},\n\t\t\tisMobile: function() {\n\t\t\t\treturn this.isPhone() || this.isTablet();\n\t\t\t},\n\t\t\tisPhone: function() {\n\t\t\t\treturn AppContext.isPhone;\n\t\t\t},\n\t\t\tisTablet: function() {\n\t\t\t\treturn AppContext.isTablet;\n\t\t\t},\n\t\t\tisDesktop: function() {\n\t\t\t\treturn AppContext.isDesktop;\n\t\t\t}\n\t\t};\n\n\t\tv.XS.only = xs && !s && !m && !l && !xl;\n\t\tv.XS.down = v.XS.only;\n\t\tv.XS.up = xs || s || m || l || xl;\n\n\t\tv.S.only = !xs && s && !m && !l && !xl;\n\t\tv.S.down = (xs || s) && !m && !l && !xl;\n\t\tv.S.up = !xs && (s || m || l || xl);\n\n\t\tv.M.only = !xs && !s && m && !l && !xl;\n\t\tv.M.down = (xs || s || m) && !l && !xl;\n\t\tv.M.up = !xs && !s && (m || l || xl);\n\n\t\tv.L.only = !xs && !s && !m && l && !xl;\n\t\tv.L.down = (xs || s || m || l) && !xl;\n\t\tv.L.up = !xs && !s && !m && (l || xl);\n\n\t\tv.XL.only = !xs && !s && !m && !l && xl;\n\t\tv.XL.down = true;\n\t\tv.XL.up = v.XL.only;\n\n\t\treturn v;\n\t}\n\n\tready() {\n\t\tthis._setupViewportListeners();\n\t}\n\n\trenderPage( e, detail, sender ) {\n\n\t\tif( detail.route.comp && detail.route.comp != '' ) {\n\t\t\tlet ctx = {};\n\t\t\tctx.params = detail.params;\n\t\t\tctx.pathParams = detail.pathParams;\n\n\t\t\t// dynamically add component\n\t\t\t// todo: unbind stuff?\n\t\t\tconst html = (function(detail, ctx) {\n\t\t\t\treturn '<' + detail.route.comp + ' ctx=\\'' + JSON.stringify(ctx) + '\\'></' + detail.route.comp + '>';\n\t\t\t})(detail, ctx);\n\t\t\tif (detail.route.mod) {\n\t\t\t\tSystem.import( detail.route.mod ).then( function(m) {\n\t\t\t\t\tthis.$.content.innerHTML = html;\n\t\t\t\t\tthis._viewportChanged(); // update the Page's viewport\n\t\t\t\t\tPolymer.updateStyles();\n\t\t\t\t}.bind(this) ).catch( function(err){\n\t\t\t\t\tconsole.log( err );\n\t\t\t\t\tconsole.log( err.originalErr );\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.$.content.innerHTML = html;\n\t\t\t\tPolymer.updateStyles();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// load view HTML file - todo: cache\n\t\t\tthis.$.ajax.url = detail.route.view;\n\t\t\tif( this.$.ajax.url )\n\t\t\tthis.$.ajax.go();\n\t\t}\n\t}\n\n\t_allRoutesChanged( nv ) {\n\t\tthis.$.router.init( nv );\n\t}\n\n\t_viewportChanged() {\n\t\t// pass down the new value to the page instance and fire event for any other WC's that may be listening\n\t\tlet el = this.$.content.querySelector( '*:first-child' );\n\t\tif( el ) el.viewport = this.viewport;\n\n\t\t// some browsers (e.g. Firefox) need this setTimeout to break the event loop\n\t\tsetTimeout( function() {\n\t\t\tthis.fire( 'iron-signal', { name: 'sb-viewport-changed', data: { viewport: this.viewport } });\n\t\t}.bind(this), 10 );\n\t}\n\n\t// We listener for MQ stuff here and pass it down to page so we don't have to do this every time we create a new Page\n\t_setupViewportListeners() {\n\t\tvar self = this;\n\t\tfunction build(m) {\n\t\t\tif( m.matches )\n\t\t\t\tself.viewport = self._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t};\n\n\t\t// disable all viewport listeners for DreamForce\n\t\tmqXS.addListener( build );\n\t\tmqSOnly.addListener( build );\n\t\tmqMOnly.addListener( build );\n\t\tmqLOnly.addListener( build );\n\t\tmqXL.addListener( build );\n\t}\n\n\tstatic getContainer() {\n\t\treturn document.querySelector( '#' + PageContainer.domId );\n\t}\n\n\tstatic getViewport() {\n\t\tlet container = PageContainer.getContainer();\n\t\treturn container ? container.viewport : null;\n\t}\n\n\tstatic isMobile() {\n\t\tconst viewport = PageContainer.getViewport();\n\t\treturn viewport && viewport.isMobile();\n\t}\n\n\t/**\n\t * Toggle spinner state to on/off\n\t * @param {boolean} state Specify the toggle state\n\t */\n\tstatic toggleSpinner(state) {\n\t\tactiveSpinners += state === true ? 1 : -1;\n\t\tconst container = PageContainer.getContainer();\n\t\tif (container !== null) {\n\t\t\tcontainer.$.spinner.show = activeSpinners > 0;\n\t\t}\n\t}\n}\n\n// the id used in the DOM for this element\nPageContainer.domId = 'sbPageContainer';\n\nPolymer( PageContainer );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class PageHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-header';\n\t\tthis.properties = {\n\t\t\t/**\n\t\t\t * Viewport information for things like T-shirt size (S, M, L, XL)\n\t\t\t * @type {Object}\n\t\t\t */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowMenu: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\tmenuClosed : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\thideFullTitle: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tsearchbar: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_setSearchbarStyles'\n\t\t\t},\n\t\t\tdebugMode: Boolean,\n\t\t\tept: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tbpt: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tspt: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.debugMode = (window.sb.mode && window.sb.mode.debugMode) || false;\n\t\tif (this.debugMode) {\n\t\t\tthis._setupMetricsServiceListeners();\n\t\t}\n\t}\n\n\t_showFullTitle(e) {\n\t\tif (!this.viewport.isMobile()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hideFullTitle && !Polymer.dom(this).children[1].textContent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideFullTitle = !this.hideFullTitle;\n\n\t\tthis.$.fullTitle.innerText     = this.hideFullTitle ? Polymer.dom(this).children[1].textContent : \"\";\n\t\tthis.$.fullTitle.style.opacity = this.hideFullTitle ? 1 : 0;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tnavigationChanged() {\n\t\tthis._closeMenu();\n\t}\n\n\t_closeMenu() {\n\t\tthis.toggleClass('open', false, this.$.buttons);\n\t\tthis.toggleClass('autoLaunch', false, this.$.buttons);\n\t\tsetTimeout(function () {\n\t\t\t// defer setting the menuClosed flag in case _changeMenu is called after _closeMenu in the same event loop\n\t\t\tthis.menuClosed = true;\n\t\t}.bind(this), 1);\n\t}\n\n\t_changeMenu(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.getAttribute('data-target');\n\t\tif(target === \"Popup\")\n\t\t\treturn; // the popup will handle closing the menu when it closes\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed , this.$.buttons, 'open', this);\n\t\tif (this.menuClosed)\n\t\t\tthis.fire('sb-menu-closed');\n\t}\n\n\t_viewportChanged() {\n\t\t// need an explicit boolean + CSS here so we don't have race condition with dom-if\n\t\tthis.showMenu = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tif( this.showMenu )\n\t\t\tthis.$.buttons.classList.remove( 'normal' );\n\t\telse\n\t\t\tthis.$.buttons.classList.add( 'normal' );\n\t}\n\n\t_setSearchbarStyles() {\n\t\t//if (this.searchbar && this.viewport.isMobile())\n\t\t//\tthis.toggleClass('mobileSearch', true, this.$$('header'));\n\t}\n\n\t// Helper function that can be used with a menu dropdown button. It returns the flipped state of the menu button.\n\t// target element will be a dom element on which adding an openClass will show the menu and removing it will\n\t// close the menu\n\tstatic changeMenu(e, menuClosed, targetElement, openClass, toggler) {\n\t\t\tlet rect = e.currentTarget.getBoundingClientRect();\n\t\t\tlet\tbs = targetElement.style;\n\t\t\tbs.top = (rect.bottom+2) + 'px';\n\t\t\tbs.right = (window.innerWidth - rect.right) + 'px';\n\t\t\ttoggler.toggleClass(openClass, menuClosed, targetElement);\n\t\treturn !menuClosed;\n\t}\n\n\topenLookupDialog(e) {\n\t\tlet lookup = this.$.lookup;\n\t\tlookup.invoker = e.detail.lookup;\n\t\tlookup.open(e.detail.searchValue);\n\t}\n\n\topenRteDialog(e) {\n\t\tlet rte = this.$.rte;\n\t\trte.value = e.detail.value;\n\t\trte.rte = e.detail.rte;\n\t\trte.open();\n\t}\n\n\topenSearchDialog(e) {\n\t\tlet search = this.$.search;\n\t\tsearch.value = e.detail.value;\n\t\tsearch.quote = e.detail.quote;\n\t\tsearch.open();\n\t}\n\n\tallowAutoLaunchPopup() {\n\t\tif(this.showMenu) {\n\t\t\t// \"open\" the menu so the auto launched popup is visible\n\t\t\tthis.toggleClass('open', true, this.$.buttons);\n\t\t\tthis.toggleClass('autoLaunch', true, this.$.buttons);\n\t\t\tthis.menuClosed = false;\n\t\t}\n\t}\n\n\t_setupMetricsServiceListeners() {\n\t\tdocument.addEventListener('metrics-changed', function(e) {\n\t\t\tlet metricsData = e.detail;\n\t\t\tlet sticker = Polymer.dom(this.root).querySelector('.header').querySelector('.sticker');\n\t\t\tif (metricsData.ept != null) {\n\t\t\t\tthis.ept = Math.round(metricsData.ept);\n\t\t\t}\n\t\t\tif (metricsData.bpt != null) {\n\t\t\t\tthis.bpt = Math.round(metricsData.bpt);\n\t\t\t}\n\t\t\tif (metricsData.spt != null) {\n\t\t\t\tthis.spt = Math.round(metricsData.spt);\n\t\t\t}\n\t\t\tif (sticker) {\n\t\t\t\tsticker.style.display = \"block\";\n\t\t\t\tif (this.ept <= 2000) {\n\t\t\t\t\tsticker.style.backgroundColor = '#468847';\n\t\t\t\t} else if (this.ept > 2000 && this.ept <= 3000) {\n\t\t\t\t\tsticker.style.backgroundColor = '#daa520';\n\t\t\t\t} else {\n\t\t\t\t\tsticker.style.backgroundColor = '#b72020';\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( PageHeader );\n","export class Toast {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-toast';\n\t\tthis.properties = {\n\t\t\t/**\n\t\t\t * The array of messages used to build the messagesModel which renders the toasts\n\t\t\t * Can be an array of strings or it can be an array of objects with properties (msg and type)\n\t\t\t * where msg is a string and type is success, error, warning or info (default if type is undefined)\n\t\t\t */\n\t\t\tmessages: {       // Can be array of strings or objects with type and msg properties\n\t\t\t\ttype: Array,  // ['test', '123', 'abc']\n\t\t\t\tnotify: true  // [{type: error, msg: 'hello', type: warning, msg: 'test123', type: success, msg: 'great success'}]\n\t\t\t},\n\t\t\t/**\n\t\t\t * Used to determine the styling if messages is an array of strings.\n\t\t\t * Info styling is used if type is left undefined.\n\t\t\t * This property is not used if messages is an array of objects.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\ttype: String // Optional -- error, success, warning, info(default if undefined)\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.hasMessages = false;\n\t\tthis.messagesModel = [];\n\t\tthis.repeatHandlers = {};\n\t}\n\n\tget observers() {\n\t\treturn['validation(messages)'];\n\t}\n\n\t/**\n\t * Populates messagesModel that contains information on how to render each type of toast\n\t * Checks to see if first index of array is type String or Object, then it will group and style accordingly.\n\t */\n\tvalidation() {\n\t\tif (!this.messages) {\n\t\t\tthis.messagesModel = [];\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.repeatHandlers = {};\n\t\t\treturn\n\t\t}\n\n\t\tlet errorMsgs = {type : 'error', class : 'slds-theme--error', msgs : [], icon : 'sf-icon-error'};\n\t\tlet successMsgs = {type : 'success', class : 'slds-theme--success', msgs : [], icon : 'sf-icon-notification'};\n\t\tlet warningMsgs = {type : 'warning', class : 'slds-theme--warning', msgs : [], icon : 'sf-icon-warning'};\n\t\tlet infoMsgs = {type : 'info', class : '', msgs : [], icon : 'sf-icon-info'};\n\t\tlet numMessages = this.messages.length;\n\t\tif (typeof(this.messages[0]) == 'object') {\n\t\t\tfor (let i = 0; i < numMessages; i++) {\n\t\t\t\tlet messagesSplit = this.messages[i].msg.split('\\n');\n\t\t\t\tif (this.messages[i].type == 'error') {\n\t\t\t\t\terrorMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else if (this.messages[i].type == 'warning') {\n\t\t\t\t\twarningMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else if (this.messages[i].type == 'success') {\n\t\t\t\t\tsuccessMsgs.msgs.push(messagesSplit);\n\t\t\t\t} else {\n\t\t\t\t\tinfoMsgs.msgs.push(messagesSplit);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof(this.messages[0]) == 'string') {\n\t\t\tlet messagesSplit = [];\n\t\t\tfor (let i = 0; i < numMessages; i++) {\n\t\t\t\tmessagesSplit.push(this.messages[i].split('\\n'));\n\t\t\t}\n\t\t\tif (this.type == 'error') {\n\t\t\t\terrorMsgs.msgs = messagesSplit;\n\t\t\t} else if (this.type == 'success') {\n\t\t\t\tsuccessMsgs.msgs = messagesSplit;\n\t\t\t} else if (this.type == 'warning') {\n\t\t\t\twarningMsgs.msgs = messagesSplit;\n\t\t\t} else {\n\t\t\t\tinfoMsgs.msgs = messagesSplit;\n\t\t\t}\n\t\t}\n\n\t\tif (this.messages && this.messages.length > 0) {\n\t\t\tthis.removeRepeatedMessages(errorMsgs, 'error');\n\t\t\tif (errorMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', errorMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(successMsgs, 'success');\n\t\t\tif (successMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', successMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(successMsgs, 'warning');\n\t\t\tif (warningMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', warningMsgs);\n\t\t\t}\n\t\t\tthis.removeRepeatedMessages(infoMsgs, 'info');\n\t\t\tif (infoMsgs.msgs.length > 0) {\n\t\t\t\tthis.push('messagesModel', infoMsgs);\n\t\t\t}\n\t\t\tthis.hasMessages = true;\n\t\t} else {\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.messages = undefined;\n\t\t}\n\t}\n\n\tremoveRepeatedMessages(messages, type) {\n\t\tif(!this.messagesModel)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.messagesModel.length; i < l; i++) {\n\t\t\tlet msg = this.messagesModel[i];\n\t\t\tif(type !== msg.type)\n\t\t\t\tcontinue;\n\n\t\t\tlet repeat = this.isMessageRepeated(msg, messages);\n\t\t\tif(repeat) messages.msgs = [];\n\t\t\tthis.toggleRepeatClass(type, repeat, i);\n\t\t}\n\t}\n\n\tisMessageRepeated(msg1, msg2) {\n\t\tfor(let i = 0, l = msg1.msgs.length; i < l; i++) {\n\t\t\tfor (let j = 0, ll = msg1.msgs[i].length; j < ll; j++) {\n\t\t\t\tif (msg2.msgs[i] !== undefined && msg1.msgs[i][j] !== msg2.msgs[i][j])\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\ttoggleRepeatClass(type, repeat, index) {\n\t\tthis.removeAnimationListeners(type, index);\n\t\tlet container = this.addAnimationListeners(type, index);\n\t\tthis.toggleClass('repeat', repeat, container);\n\t}\n\n\tremoveAnimationListeners(type, index) {\n\t\tlet id = type + '_' + index;\n\t\tlet handler = this.repeatHandlers[id];\n\t\tif(!handler)\n\t\t\treturn;\n\n\t\tlet container = this.$$('#' + id);\n\t\tcontainer.removeEventListener('animationend', handler);\n\t\tcontainer.removeEventListener('webkitAnimationEnd', handler);\n\t}\n\n\taddAnimationListeners(type, index) {\n\t\tlet id = type + '_' + index;\n\t\tlet container = this.$$('#' + id);\n\t\tlet handler = this.repeatHandlers[id] || this.removeRepeatClass.bind(this, container);\n\t\tthis.repeatHandlers[id] = handler;\n\n\t\tcontainer.addEventListener('animationend', handler);\n\t\tcontainer.addEventListener('webkitAnimationEnd', handler);\n\t\treturn container;\n\t}\n\n\tremoveRepeatClass(container) {\n\t\tthis.toggleClass('repeat', false, container);\n\t}\n\n\tcloseMessage(e) {\n\t\tlet type = e.model.__data__.messages.type;\n\t\tlet index = 0;\n\t\tfor (let i = 0; i < this.messagesModel.length; i++) {\n\t\t\tif (this.messagesModel[i].type == type) {\n\t\t\t\tdelete this.repeatHandlers[type + '_' + (index++)];\n\t\t\t\tthis.splice('messagesModel', i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tif (this.messagesModel.length == 0) {\n\t\t\tthis.hasMessages = false;\n\t\t\tthis.messages = undefined;\n\t\t}\n\t}\n}\n\nPolymer( Toast );","let private_router,\n\t\troutes,\n\t\tPATH_PARAM_REGEX = /:[a-z0-9_$]*/g;\n\nexport class Router {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-router';\n\t\tthis.properties = {\n\t\t\tautoHash: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return false; }\n\t\t\t},\n\n\t\t\troute: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'routeChanged'\n\t\t\t},\n\n\t\t\trouter: {\n\t\t\t\ttype: Object,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif( !private_router ) {\n\t\t\t\t\t\tprivate_router = new window.Router();\n\t\t\t\t\t\tprivate_router.init();\n\t\t\t\t\t}\n\t\t\t\t\treturn private_router;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinit( allRoutes ) {\n\t\tlet modules = Object.keys(allRoutes);\n\n\t\tif( !routes && modules.length ) {\n\t\t\troutes = allRoutes;\n\t\t\tlet router = this.router,\n\t\t\tlen = modules ? modules.length : 0;\n\n\t\t\t// attach a Director handler for all configured routes (module + path = route)\n\t\t\tfor( let i=0; i < len; i++ ) {\n\t\t\t\tlet mod = modules[i],\n\t\t\t\tmodulePaths = Object.keys( routes[mod] ),\n\t\t\t\tpLen = modulePaths ? modulePaths.length : 0;\n\n\t\t\t\tfor( let p=0; p < pLen; p++ ) {\n\t\t\t\t\tlet path = modulePaths[p],\n\t\t\t\t\tpathParams = path ? path.match( PATH_PARAM_REGEX ) : null,\n\t\t\t\t\tparamNames = [],\n\t\t\t\t\tparamMap = {};\n\n\t\t\t\t\t// if path params exist build map of name=value for easy access\n\t\t\t\t\tif( pathParams ) {\n\t\t\t\t\t\tparamNames = pathParams.map( function( val, index ) {\n\t\t\t\t\t\t\tlet p = val.substring(1);\n\t\t\t\t\t\t\tparamMap[p] = null;\n\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\trouter.on( mod + path, function( m, p, paramNames, paramMap ) {\n\t\t\t\t\t\tlet pathParams = JSON.parse(JSON.stringify( paramMap )),  // clone\n\t\t\t\t\t\tparams = Array.prototype.slice.call(arguments,4),\n\t\t\t\t\t\tparamsLen = params ? params.length : 0;\n\n\t\t\t\t\t\t// map path parameter name to actual value\n\t\t\t\t\t\tfor( let j=0; j < paramsLen; j++ )\n\t\t\t\t\t\tpathParams[paramNames[j]] = params[j];\n\n\t\t\t\t\t\tthis.routeHandler( m, p, pathParams );\n\t\t\t\t\t}.bind(this, mod, path, paramNames, paramMap));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trouter.on( '/*', function() {\n\t\t\t\tconsole.log( 'got an unknown route. need to show 404 here' ); // todo\n\t\t\t});\n\n\t\t\trouter.on( '', function() {\n\t\t\t\tconsole.log( 'Got the <empty> route' );\n\t\t\t})\n\t\t}\n\t}\n\n\t/* the Director route handler */\n\trouteHandler( mod, path, params ) {\n\t\t// Director doesn't support query string-like params in the hash.  We have to manually get them.\n\t\tlet hash = window.location.hash.slice(1),\n\t\tpos = hash.indexOf( '?' ),\n\t\tqsParams = {};\n\n\t\tif( pos >= 0 && hash.length > pos ) {\n\t\t\t// use 3rd party to parse\n\t\t\tqsParams = queryString.parse( hash.substring( pos+1 ) );\n\t\t}\n\t\tthis.fire( 'sb-route-complete', {mod: mod, path: path, route: routes[mod][path], pathParams: params, params: qsParams } );\n\t}\n\n\t/** Observer for when the route property changes.  Update the window hash and fire event if needed */\n\trouteChanged( nv, ov ) {\n\t\tif( this.autoHash && nv ) {\n\t\t\tlet same = window.location.hash.slice(1) == this.route;\n\t\t\twindow.location.hash = this.route;\n\n\t\t\t// if you set the hash to be same value as it currently has you don't get a hashchange event\n\t\t\tif( same ) {\n\t\t\t\t// window.dispatchEvent(new HashChangeEvent(\"hashchange\"));  doesn't work in FF so manually dispatch event\n\t\t\t\tthis.router.dispatch( 'on', nv );\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Router );\n","/**\n * sf-loading-spinner is used to ensure that there is only one spinner on the page at a time. We can increment a counter when a service\n * wishes for a spinner to be shown and decrement it once the service is done loading. If the counter is 0, then the sf-loading-spinner hides.\n *\n * For page level spinners, call: PageContainer.toggleSpinner(b);\n * For individual spinners on things like modals, use sf-loading-spinner\n */\nexport class LoadingSpinner {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-loading-spinner';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'fixed',\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'large',\n\t\t\t},\n\t\t};\n\t}\n}\n\nPolymer(LoadingSpinner);","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class Checkbox {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-checkbox';\n\t\tthis.properties = {\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_boolify'\n   \t\t\t},\n\t\t\thide: { // this could be a boolean or an object with properties {hidden:true|false and type:hide:invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'hideShow'\n\t\t\t}\n\t\t}\n\t}\n\n\t_boolify() {\n\t\t// if a non-boolean value is pased in, convert it to a boolean\n\t\tif (typeof this.value !== 'boolean')\n\t\t\tthis.value = (this.value !== null && this.value.toLowerCase() === \"true\");\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.checkbox.focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\thideShow() {\n\t\tlet hider = new FieldHider(this.hide, Polymer.Base);\n\t\thider.applyTo(this.$.checkbox);\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Checkbox);","export class DateRange{\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-daterange';\n\t\tthis.properties = {\n\t\t\tformattedValue: Object\n\t\t}\n\t}\n\n\tready() {\n\t\t// Fire daterange change event after datepicker event chain is concluded\n\t\t// Otherwise datepicker event will overwrite filter data\n\t\tthis.addEventListener('selected-date-changed', function() {\n\t\t\tthis.fire('selected-date-range-changed', {value: this.formattedValue});\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( DateRange );","import {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\nimport {DateParser} from 'common/forms/DateParser.js';\n\nexport class Datepicker extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-datepicker';\n\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedDate: { // if not empty, this property needs to be in ISO-8601 format\n\t\t\t\ttype: Date,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'selectedDateChanged'\n\t\t\t},\n\t\t\trange: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 30\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tdateParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new DateParser();\n\t\t\t\t}\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n\n\tready() {\n\t\tlet localeData = I18n.getLocaleData();\n\t\tthis.isActive = false;\n\n\t\tthis.weeks = [];\n\t\tthis.weekDays = localeData && localeData.date ? localeData.date.calendars.gregory.days.short : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\t\tthis.months = localeData && localeData.date ? localeData.date.calendars.gregory.months.long : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\n\t\tthis.year = this.date.getFullYear();\n\t\tthis.month = this.date.getMonth();\n\t\tthis.monthName = this.months[this.month].toUpperCase();\n\t\tthis.day = this.date.getDate();\n\t}\n\n\t// methods for rendering\n\tgetDate(date) {\n\t\tif (typeof date != 'object') {\n\t\t\treturn new Date(this.year, this.month, date);\n\t\t}\n\t\treturn date.getDate();\n\t}\n\n\tgetClass(day) {\n\t\tif (typeof day != 'object') {\n\t\t\tday = new Date(this.year, this.month, day);\n\t\t}\n\t\tvar className = '';\n\t\tif (day.getMonth() !== this.month ) {\n\t\t\tclassName += 'notCurrent';\n\t\t} else {\n\t\t\tif ( (day.getFullYear() === this.date.getFullYear()) && (day.getMonth() === this.date.getMonth()) && (day.getDate() === this.date.getDate()) ) {\n\t\t\t\tclassName += 'selected';\n\t\t\t}\n\t\t\tif ( (day.getFullYear() === this.year) && (day.getMonth() === this.month) && (day.getDate() === this.date.getDate()) ) {\n\t\t\t\tclassName += ' current';\n\t\t\t}\n\t\t}\n\t\treturn className;\n\t}\n\n\t// observers\n\tselectedDateChanged(newDate, oldDate) {\n\t\tif (this.initialized || (this.selectedDate && !isNaN(new Date(this.selectedDate).getTime()))) {\n\t\t\t//handle clicking Clear Fields button on lookup pages\n\t\t\tif (this.selectedDate === '' && this.dateFormatted !=='') {\n\t\t\t\tthis.dateFormatted = '';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._selectedDateChanged(oldDate, this.selectedDate, this.selectedDate == null);\n\t\t\treturn\n\t\t}\n\t\tthis._selectedDateChanged(oldDate, new Date(), true, true);\n\t\tthis.focus();\n\t}\n\n\t_selectedDateChanged(oldDate, selectedDate, isBlank, internal) {\n\t\tthis.initialized = true;\n\t\tlet dateObj = null;\n\t\t// if string and in YYYY-MM-DD format than instantiate explicitly\n\t\tif( selectedDate && typeof selectedDate === 'string' ) {\n\t\t\tlet pos = selectedDate.indexOf( 'T'),\n\t\t\t\tymd;\n\t\t\tif( pos < 0 ) {\n\t\t\t\tymd = selectedDate.split( '-' );\n\t\t\t} else {\n\t\t\t\tlet parts = selectedDate.split( 'T');\n\t\t\t\tymd = parts[0].split( '-' );\n\n\t\t\t}\n\t\t\tif( ymd && ymd.length == 3 ){\n\t\t\t\tdateObj = new Date( ymd[0], ymd[1]-1, ymd[2] );\n\t\t\t}\n\t\t}\n\n\t\t// default\n\t\tif( !dateObj ) {\n\t\t\tdateObj = selectedDate != null ? new Date( selectedDate ) : new Date();\n\t\t}\n\n\t\tthis.date = dateObj;\n\t\tthis.updateVariables();\n\n\t\tif(!isBlank)\n\t\t\ttry {\n\t\t\t\tthis.dateFormatted = this.date.toLocaleDateString(this.user.locale);\n\t\t\t} catch (e) {\n\t\t\t\tthis.dateFormatted = this.date.toLocaleDateString(); // Catch error as FF does not accept parameter\n\t\t\t}\n\t\tif(!internal) {\n\t\t\t// flag we use to determine if calculateImmediately should be fired\n\t\t\t// we prevent firing calculate immediately if this is the first time browser loads (this.selectedDate is undefined)\n\t\t\tlet suppressImmediateCalcuation  = oldDate === undefined;\n\t\t\tthis.fire( 'selected-date-changed', { value:  selectedDate, suppressImmediateCalcuation } );\n\t\t}\n\n\t}\n\n\t// event handlers\n\tshowCalendar() {\n\t\tif(this.disabled)\n\t\t\treturn;\n\n\t\tthis.ensureProperYearInSelectedAndShowCalendar();\n\t}\n\n\tensureProperYearInSelectedAndShowCalendar() {\n\t\tif(this.year === this.date.getFullYear() && this.haveEnsured)\n\t\t\tthis._showCalendar();\n\n\t\tthis.haveEnsured = true;\n\t\tthis.date.getFullYear();\n\t\tlet years = [];\n\t\tvar start = this.year - this.range;\n\t\tvar end = this.year + this.range + 1;\n\t\tfor ( var i = start; i < end; i++) {\n\t\t\tyears.push(i);\n\t\t}\n\t\tif (AppContext.isIE()) {\n\t\t\tif (!this.yearsCreated) {\n\t\t\t\tthis.$.years.remove(0); // IE creates an extra options\n\t\t\t\tfor (let j = 0, len = years.length; j < len; j++) {\n\t\t\t\t\tthis._createOptionElements(this.$.years, years[j]);\n\t\t\t\t}\n\t\t\t\tthis.yearsCreated = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.years = years;\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.yearSelection = this.$.years;\n\t\t\tif (this.yearSelection.selectedOptions) {\n\t\t\t\tthis.yearSelection.selectedOptions[0].selected = '';\n\t\t\t}\n\t\t\tthis.yearSelection.options[this.range].selected = 'selected';\n\t\t\tthis._showCalendar();\n\t\t}.bind(this));\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option;\n\t\toptionEl.value = option;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\t_showCalendar() {\n\t\tthis.isActive = true;\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t\tthis.fire('datepicker-opened', {datepicker: this.$.datePicker, dateContainer: this.$.dateContainer});\n\t\tdocument.addEventListener('click', this._clickHandler.bind(this));\n\t}\n\n\t_clickHandler(e) {\n\t\tlet shouldKeepCalendarOpen = Polymer.dom(e).path.some(element => {return element === this});\n\t\tif (!shouldKeepCalendarOpen) {\n\t\t\tthis.hideCalendar();\n\t\t}\n\t}\n\n\thideCalendar() {\n\t\tif (this.isActive) {\n\t\t\tthis.isActive = false;\n\t\t\tthis.focus();\n\t\t}\n\t\tdocument.removeEventListener('click', this._clickHandler);\n\t}\n\n\tfindToday() {\n\t\tthis.selectedDate = new Date();\n\t\tthis.updateYearPicklist();\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tupdateYearPicklist() {\n\t\tlet options = this.yearSelection.options;\n\t\tfor (let i= 0, l=options.length; i<l; i++) {\n\t\t\toptions[i].selected = this.year == options[i].text;\n\t\t}\n\t}\n\n\tchangeYear() {\n\t\tthis.year = parseInt(this.yearSelection.selectedOptions[0].text);\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tdecreaseMonth() {\n\t\tthis.month = this.month - 1;\n\t\tif(this.month < 0){\n\t\t\tthis.month = 11;\n\t\t\tthis.year = this.year -1;\n\t\t\tthis.updateYearPicklist();\n\t\t}\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.updateCalendar();\n\t}\n\n\tincreaseMonth() {\n\t\tthis.month = this.month + 1;\n\t\tif(this.month>11){\n\t\t\tthis.month = 0;\n\t\t\tthis.year = this.year + 1;\n\t\t\tthis.updateYearPicklist();\n\t\t}\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.updateCalendar();\n\t}\n\n\tselectDay(e) {\n\t\tthis.selectedDate = e.model ? e.model.day : this.date;\n\t\tthis.hideCalendar();\n\t}\n\n\t// helper methods\n\tupdateVariables() {\n\t\tthis.year = this.date.getFullYear();\n\t\tthis.month = this.date.getMonth();\n\t\tthis.monthName = this.months && this.months[this.month] ? this.months[this.month].toUpperCase(): '';\n\t\tthis.day = this.date.getDate();\n\t}\n\n\tupdateDate(increment) {\n\t\tthis.date.setDate(this.date.getDate() + increment);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t}\n\n\tupdateCalendar() {\n\t\tthis.weeks = [];\n\t\tvar firstDay = new Date(this.year, this.month, 1);\n\t\tvar index = firstDay.getDay();\n\t\tvar numOfDays = 6 * 7;\n\t\tvar week = [];\n\t\tvar dayIdx = 0;\n\t\tfor ( var i = 0; i < numOfDays; i++) {\n\t\t\tvar day = new Date(firstDay);\n\t\t\tday.setDate(firstDay.getDate() + (i - index));\n\t\t\tweek[dayIdx] = day;\n\t\t\tdayIdx++;\n\n\t\t\tif ( ((i+1) % 7) === 0 || i+1 === numOfDays) {\n\t\t\t\tthis.push('weeks', week);\n\t\t\t\tweek = [];\n\t\t\t\tdayIdx = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidateInput() {\n\t\tif (this.noblur)\n\t\t\treturn;\n\n\t\tlet error;\n\t\tlet invalid = false;\n\t\tlet dateString = this.$.dateInput.value;\n\t\tlet emptyDate = dateString.trim() === '';\n\t\tlet localeDate = !emptyDate ? this.getLocaleDate() : '';\n\t\tlet dateChanged = dateString !== localeDate;\n\t\tif (dateChanged) {\n\t\t\tlet parsedDate = this.dateParser.parse(dateString, function(year) {\n\t\t\t\treturn year >= this.year - this.range && year <= this.year + this.range;\n\t\t\t}.bind(this));\n\t\t\tinvalid = parsedDate == null;\n\n\t\t\t// update date to reflect the input change\n\t\t\tif (!invalid) {\n\t\t\t\tthis.selectedDate = parsedDate;\n\t\t\t\tthis.updateVariables();\n\t\t\t} else {\n\t\t\t\terror = this.i18n.l('Invalid Date.');\n\t\t\t}\n\t\t}\n\n\t\tlet hasSelectedDate = typeof this.selectedDate === 'object' || this.selectedDate.trim() !== '';\n\t\tif(emptyDate && hasSelectedDate) {\n\t\t\tthis.dateFormatted = '';\n\t\t\tthis.selectedDate = null;\n\t\t}\n\n\t\tthis.invalidInput = invalid;\n\t\tthis.fire('field-change-validated', {error: error});\n\n\t\tthis.fire('sb-date-blur');\n\t}\n\n\tnavigate(e) {\n\t\tif (e.keyCode === 9) { // tab key\n\t\t\tthis.hideCalendar();// hide the calendar\n\t\t\treturn; // allow default behavior\n\t\t}\n\n\t\tswitch(e.keyCode) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tif (this.isActive) // changes made using calendar popout\n\t\t\t\t\tthis.selectDay(e);\n\t\t\t\telse // manual edits to the input text\n\t\t\t\t\tthis.validateInput();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif (this.isActive) this.hideCalendar();\n\t\t\t\telse {\n\t\t\t\t\tthis.escaped = true;\n\t\t\t\t\tthis.fire('sb-date-esc', {keyCode: 27});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 37: // left arrow\n\t\t\t\tthis.updateDate(-1);\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\t\tthis.updateDate(-7);\n\t\t\t\tbreak;\n\t\t\tcase 39: // right arrow\n\t\t\t\tthis.updateDate(+1);\n\t\t\t\tbreak;\n\t\t\tcase 40: // down arrow\n\t\t\t\tif(!this.isActive) this.showCalendar();\n\t\t\t\telse this.updateDate(+7);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetLocaleDate() {\n\t\ttry {\n\t\t\treturn  this.date.toLocaleDateString(this.user.locale);\n\t\t} catch (e) {\n\t\t\treturn this.date.toLocaleDateString(); // Catch error as FF does not accept parameter\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.highlight();\n\t\tthis.$.dateInput.focus();\n\t}\n\n\thighlight() {\n\t\tif(this.dateFormatted)\n\t\t\tthis.$.dateInput.setSelectionRange(0, this.dateFormatted.length);\n\t}\n\n\tpreventBlur() {\n\t\tthis.noblur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noblur = false;\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\n\nPolymer( Datepicker );\n","import {NumberParser} from 'common/forms/NumberParser.js';\nimport {getUnitAndDisplayValue, setDiscountValue, convertDiscountValue} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\n\nexport class Discount {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount';\n\t\tthis.properties = {\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged',\n\t\t\t},\n\t\t\tproperty: String,\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tunitChanged: Object,\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tformatter: Object,\n\t\t\tdisplayValue: String,\n\t\t\toriginal: Object,\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ '_runConverter(model, property)', ];\n\t}\n\n\tready() {\n\t\tlet input = this.$.discount.querySelector('.myinput');\n\t\tinput.addEventListener('change', this.checkThenSetDiscountValue.bind(this));\n\t\tinput.addEventListener('focus', this.focused.bind(this));\n\t\tinput.addEventListener('blur', this.deferBlur.bind(this));\n\t\tinput.addEventListener('keydown', this.tabBlur.bind(this, true));\n\n\t\tlet select = this.$.discountUnits.querySelector('.myselect');\n\t\tselect.addEventListener('change', this.convertDiscountValueThenUpdate.bind(this));\n\t\tselect.addEventListener('focus', this.focused.bind(this));\n\t\tselect.addEventListener('blur', this.deferBlur.bind(this));\n\t\tselect.addEventListener('keydown', this.tabBlur.bind(this, false));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.discount.focus();\n\t}\n\n\tfocused() {\n\t\tif(this.blurred)\n\t\t\tclearTimeout(this.blurred);\n\t}\n\n\tdeferBlur() {\n\t\tif(this.tabBlurred)\n\t\t\tthis.tabBlurred = false;\n\t\telse {\n\t\t\tthis.blurred = setTimeout(function () {\n\t\t\t\tthis.blurDiscount(true);\n\t\t\t}.bind(this), 1);\n\t\t}\n\t}\n\n\ttabBlur(isInput, e) {\n\t\tif (e.keyCode === 27 && this.renderReadOnly) { // esc key\n\t\t\tthis.resetToOriginal();\n\t\t\treturn;\n\t\t}\n\n\t\tif(e.keyCode !== 9) // bail if not tab key\n\t\t\treturn;\n\n\t\tthis.tabBlurred = true;\n\n\t\t// blur direction is shift+tab from input or normal tab from select\n\t\tlet blurDirection = (isInput && e.shiftKey) || (!isInput && !e.shiftKey);\n\t\tif(blurDirection)\n\t\t\tthis.blurDiscount(false, e);\n\t}\n\n\tblurDiscount(directBlur, tabBlurEvent) {\n\t\tif(directBlur)\n\t\t\tthis._blur(tabBlurEvent);\n\t\telse {\n\t\t\tsetTimeout(function () {\n\t\t\t\tthis._blur(tabBlurEvent);\n\t\t\t}.bind(this), 10);\n\t\t}\n\t}\n\n\t_blur(tabBlurEvent) {\n\t\tlet value = this.$.discount.value !== '' ? this.numberParser.parse(this.$.discount.value) : null;\n\t\tsetDiscountValue(this.model, this.property, value);\n\t\tthis.fire('sb-discount-blur');\n\t\tif(tabBlurEvent) this.fire('sb-discount-keydown', {keyCode: 9, shiftKey: tabBlurEvent.shiftKey} );\n\t}\n\n\tcheckThenSetDiscountValue(e) {\n\t\tconst { displayValue: oldValue } = getUnitAndDisplayValue(this.model, this.property);\n\t\t// If value is empty string set to null to avoid NaN returning from NumberParser.js parse method\n\t\tlet value = e.target.value !== '' ? this.numberParser.parse(e.target.value) : null;\n\t\tif ( oldValue != value ) {\n\t\t\tsetDiscountValue(this.model, this.property, value);\n\t\t\tthis.fire('sb-discount-change', { value });\n\t\t}\n\t}\n\n\tconvertDiscountValueThenUpdate(e) {\n\t\tconvertDiscountValue(this.model, this.property, e.target.value);\n\t\tthis.displayValue = undefined;\n\t\tthis.displayValue = this.formatter.format(getUnitAndDisplayValue(this.model, this.property).displayValue);\n\t}\n\n\tresetToOriginal() {\n\t\t// need to call each API twice during escape sequence (this is not a mistake)\n\t\tthis.checkThenSetDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValueThenUpdate({target: {value: this.original.unitValue}});\n\t\tthis.checkThenSetDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValueThenUpdate({target: {value: this.original.unitValue}});\n\t\tthis.selectUnit(getUnitAndDisplayValue(this.model, this.property).unit);\n\t}\n\n\tselectUnit(value) {\n\t\tlet select = this.$.discountUnits.querySelector('.myselect');\n\t\tlet options = select.options;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif(options[i].value === value) {\n\t\t\t\tselect.selectedIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_runConverter(model, property) {\n\t\tconst {units, unit} = getUnitAndDisplayValue(model, property);\n\t\tthis.$.discountUnits.value = unit; // This must be set before options are set\n\t\tthis.$.discountUnits.options = units;\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this);\n\t}\n}\nPolymer(Discount);","export class DualListBox {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dual-list-box';\n\t\tthis.properties = {\n\t\t\toptions: Array,\n\t\t\tavailableTitle: String,\n\t\t\tchosenTitle: String,\n\t\t\tvalue: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_buildOptions(options)'];\n\t}\n\n\t_buildOptions() {\n\t\tthis.value = [];\n\t\tthis.chosenOptions = [];\n\t\tlet availableOptions = [];\n\t\tthis._clearSelected();\n\t\tthis.options.forEach( function(option) {\n\t\t\toption.available = true;\n\t\t\tavailableOptions.push(option);\n\t\t}.bind(this));\n\t\tthis.availableOptions = availableOptions;\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.$.available.addEventListener('change', function (e) {\n\t\t\t\tthis.availableOptionsSelected = e.detail.value;\n\t\t\t}.bind(this));\n\t\t\tthis.$.chosen.addEventListener('change', function (e) {\n\t\t\t\tthis.chosenOptionsSelected = e.detail.value;\n\t\t\t}.bind(this));\n\t\t});\n\t}\n\n\t_updateOptions(e) {\n\t\tlet direction = e.currentTarget.getAttribute('data-index');\n\t\t// Create a set of values that represent selected options depending on the chosen direction\n\t\tlet valueSet = new Set(direction === 'right' ? this.availableOptionsSelected.split(';') : this.chosenOptionsSelected.split(';'));\n\t\tthis.availableOptionsSelected = '';\n\t\tthis.chosenOptionsSelected = '';\n\t\tlet availableOptions = [];\n\t\tlet chosenOptions = [];\n\t\tthis.options.forEach( function(option) {\n\t\t\tif (direction === 'right') {\n\t\t\t\t// Gathers values that are selected in the available column or are already in the chosen list\n\t\t\t\tif (valueSet.has(option.value.toString()) || !option.available) {\n\t\t\t\t\toption.available = false;\n\t\t\t\t\tchosenOptions.push(option);\n\t\t\t\t} else {\n\t\t\t\t\tavailableOptions.push(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Gathers values that are selected in the chosen list or are already in the available list\n\t\t\t\tif (valueSet.has(option.value.toString()) || option.available) {\n\t\t\t\t\toption.available = true;\n\t\t\t\t\tavailableOptions.push(option);\n\t\t\t\t} else {\n\t\t\t\t\tchosenOptions.push(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._clearSelected();\n\t\tthis.availableOptions = availableOptions;\n\t\tthis.chosenOptions = chosenOptions;\n\t\tthis.value = this.chosenOptions;\n\t}\n\n\t/**\n\t * Used to clear the value of the sb-select components in order to remove the gray highlights\n\t * @private\n\t */\n\t_clearSelected() {\n\t\tthis.$.available.value = null;\n\t\tthis.$.chosen.value = null;\n\t}\n}\nPolymer( DualListBox );","import {AppContext} from 'common/core/AppContext.js';\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {fieldFactory} from 'common/forms/sb-field/factory/FieldFactory.js';\nimport {DependentPicklistBuilder} from 'common/forms/DependentPicklistBuilder.js';\nimport {Html} from 'common/layout/sb-html/Html.js';\n\nlet KEY_READ_ONLY = 'keyReadOnly',\n\tKEY_DOWN_READ_ONLY = 'keyDownReadOnly',\n\tBLUR_READ_ONLY = 'blurReadOnly',\n\tCHANGE = 'change',\n\tHIDE_FIELD = 'hideField',\n\tREF_DISPLAY = 'refDisplay',\n\tAPPLY_FOCUS = 'applyFocus';\n\nexport class Field extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: Object,\n\t\t\t/** Required but only if you are not passing in a value */\n\t\t\tproperty: String,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\t//adapt product metadata to return map object instead of array\n\t\t\t/** Object with structure of:\n\t\t\t {\n\t\t\t\ttype: STRING | REFERENCE | DOUBLE | CURRENCY | PICKLIST | DATE | DATETIME | CHECKBOX | BOOLEAN | RADIO\n\t\t\t\tname: <object field API name>\n\t\t\t\tlabel: <object field label>\n\t\t\t\tscale: integer\n\t\t\t\tpicklistValues: [ { label: <label>, value: <value> }]\n\t\t\t\treferenceTable: <name of editable reference lookup table>\n\t\t\t\tlink: boolean\n\t\t\t }\n\t\t\t */\n\t\t\tmd: Object,\n\t\t\ttype: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getType(md)'\n\t\t\t},\n\t\t\t/** Metadata for all referenced objects in same structure as md */\n\t\t\trefObjects: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tediting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\t_wasEverEditable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setWasEverEditable(editing)'\n\t\t\t},\n\t\t\tdisabled: { // optional boolean if field is disabled\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t\thidden: { // optional field if hidden, this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible} (only supports checkbox and radio fields)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'hiddenChanged'\n\t\t\t},\n\t\t\tlink: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\tvalue: {\n\t\t\t\tobserver: '_valueChanged'\n\t\t\t},\n\t\t\trefDisplay: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tobjAndRefObjects: Object, // use if obj and refObjects on same object\n\t\t\tobjKey: String, // if objAndRefObjects is set, this string is the key to the obj sub property\n\t\t\trefObjectsKey: String, // if objAndRefObjects is set, this string is the key to the refObjects sub property,\n\t\t\trefTable: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'computeRefTable(md)'\n\t\t\t},\n\t\t\treadOnly: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\trenderReadOnly: { // set to true if field should be initially rendered as read-only\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tformattedValue: Object, // set to the formatted value of this field for direct binding if renderReadOnly is true\n\t\t\toriginalFormattedValue: String,\n\t\t\thideFormattedValue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'applyFocus'\n\t\t\t},\n\t\t\tindex: Number, // index of this field in the context of a group of fields (e.g. table row)\n\t\t\trecordId: { // the record id of this field\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'recordIdChanged'\n\t\t\t},\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tpreventNumericAlignment: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tsignaler: Object,\n\t\t\trecord: Object,\n\t\t\ttabIndex: Number,\n\t\t\tfactoryData: Object,\n\t\t\thtml: Object,\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['render(model, obj, property, md, refObjects, editing, renderReadOnly, html)',\n\t\t\t'setObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey)',\n\t\t\t'_setOriginalFormattedValue(model, originalValue, md)',\n\t\t\t'addControlledSelectListener(md)',\n\t\t\t'recordChanged(record.*)',\n\t\t\t'valueChanged(model, obj, md, property, html, value)',\n\t\t\t'disabledChanged(model, obj, md, html, disabled)',\n\t\t\t'_createObj(value, property)'];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-row-focus-signal', this.handleRowFocusSignal.bind(this));\n\t\tthis.addEventListener('sb-field-edit', this.handleFieldEditSignal.bind(this));\n\t\tthis.html = new Html(this);\n\t}\n\n\t// have a value and property but no object, so create object with the value\n\t// if other required properties are already set, then will trigger the render via the observer\n\t_createObj(value, property) {\n\t\tif (this.obj && !this.isInternalObject) {\n\t\t\treturn;\n\t\t}\n\t\tthis.isInternalObject = true;\n\t\tconst obj = this.obj ? this.obj : { };\n\t\tobj[property] = value;\n\t\tthis.obj = obj;\n\t}\n\n\tsetObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey) {\n\t\tthis.obj = undefined;\n\t\tthis.refObjects = undefined;\n\t\tthis.refObjects = objAndRefObjects[refObjectsKey];\n\t\tif (typeof this.refObjects === 'undefined')\n\t\t\tthis.refObjects = {};\n\t\tif (objKey !== '')\n\t\t\tthis.obj = objAndRefObjects[objKey];\n\t\telse\n\t\t\tthis.obj = objAndRefObjects;\n\t}\n\n\trender(model, obj, property, md, refObjects, editing, renderReadOnly, html) {\n\t\tthis.rendered = true;\n\t\tif (this.isReadOnly()) {\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t\treturn;\n\t\t}\n\t\tthis._render(model, obj, md, html);\n\t}\n\n\t_render(model, obj, md, html) {\n\t\tif(this.template)\n\t\t\treturn;\n\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tlet ff = this.updateTemplateData(model, obj, md, html);\n\t\tthis.createBaseElement(ff.html);\n\n\t\t// callback to handle general events on fields\n\t\tthis.template[CHANGE] = this.onChange.bind(this);\n\t\tthis.template[KEY_READ_ONLY] = (e) => this.onKeyupReadOnly(this.model, this.obj, this.md, this.html, e);\n\t\tthis.template[KEY_DOWN_READ_ONLY] = this.onKeyDownReadOnly.bind(this);\n\t\tthis.template[BLUR_READ_ONLY] = (keepNewValue) => this.onBlurReadOnly(this.model, this.obj, this.md, this.html, keepNewValue);\n\n\t\tif(!this.isReadOnly())\n\t\t\tthis.hideFormattedValue = true;\n\n\t\t// stamp the template into the DOM\n\t\tPolymer.dom(this.$.f).appendChild(this.template);\n\t}\n\n\t_setOriginalFormattedValue(model, originalValue, md) {\n\t\tlet formField = this.getFormField(model, originalValue, md);\n\t\tthis.originalFormattedValue = this.getFormattedValue(formField, originalValue);\n\t}\n\n\tonChange(e) {\n\t\tthis._onChange(e);\n\t\tlet suppressImmediateCalcuation = e.detail ? e.detail.suppressImmediateCalcuation : false;\n\t\tthis.fire('sb-field-on-change-field', {suppressImmediateCalcuation});\n\t}\n\n\t_onChange(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tlet target = this.getEventTarget(e);\n\t\tlet val = target.value !== undefined ? target.value : (e.detail ? e.detail.value : null);\n\t\tthis.refDisplay = target[REF_DISPLAY] !== undefined ? target[REF_DISPLAY] :\n\t\t\t(e.detail && e.detail[REF_DISPLAY] !== undefined ? e.detail[REF_DISPLAY] : this.refDisplay);\n\n\n\t\tif (this.isNumericType()) {\n\t\t\t// If val is truthy, or 0 we need to parse a number from it. 0 is included so we don't accidentally convert\n\t\t\t// it to null.\n\t\t\tif (val && val !== 0) {\n\t\t\t\tval = this.numberParser.parse(val, false, this.md.scale);\n\t\t\t} else {\n\t\t\t\t// Any falsy, non-zero values must be converted to null to avoid deserialization problems. For example,\n\t\t\t\t// an empty string deserializes to 0 on SF, which is a problem.\n\t\t\t\tval = null;\n\t\t\t}\n\t\t} else if (this.type === 'date' && val instanceof Date) {\n\t\t\tlet month = (val.getMonth() + 1);\n\t\t\tmonth = (month < 10) ? ('0' + month) : month;\n\t\t\tlet date = val.getDate();\n\t\t\tdate = (date < 10) ? ('0' + date) : date;\n\t\t\tval = val.getFullYear() + '-' + month + '-' + date;\n\t\t} else if (val instanceof Date) {\n\t\t\tval = val.toISOString();\n\t\t}\n\n\t\tthis.internal = true;\n\t\tthis.obj[this.property] = val;\n\t\tthis.domHost.value = val;\n\t\tthis.internal = false;\n\t\tthis.fireCustomChangeEvents(e);\n\t}\n\n\tfireCustomChangeEvents(e) {\n\t\t// must have e.detail check for FireFox as caller method is fired twice when we only want this to be fired once\n\t\t// however, the caller method is only called once with an event object that contains detail\n\t\tif (this.md && (!e || e.detail))\n\t\t\tthis.fireControllingSelectChangeEvent();\n\t}\n\n\tfireControllingSelectChangeEvent() {\n\t\tvar data = {tableName: this.md.tableName, fieldName: this.md.name, record: this.record};\n\t\tvar signal = new CustomEvent('sb-controlling-select-changed', {bubbles: false, detail: data});\n\t\tdocument.dispatchEvent(signal);\n\t}\n\n\tonKeyDownReadOnly(e) {\n\t\tif(!this.signaler || !this.isRenderReadOnly())\n\t\t\treturn;\n\n\t\tlet keyCode = e.keyCode || e.detail.keyCode;\n\t\tif (keyCode !== 9) // bail if not tab key\n\t\t\treturn;\n\n\t\tlet shiftKey = e.shiftKey || e.detail.shiftKey;\n\t\tthis.signaler.signalNextPreviousEditableTarget(this, !shiftKey);\n\t}\n\n\tonKeyupReadOnly(model, obj, md, html, e) {\n\t\tlet keyCode = e.keyCode || e.detail.keyCode;\n\t\tif(keyCode !== 27) // bail if not escape key\n\t\t\treturn;\n\n\t\tthis.onBlurReadOnly(model, obj, md, html, false);\n\t}\n\n\tonBlurReadOnly(model, obj, md, html, keepNewValue) {\n\t\tif(!this.isReadOnly())\n\t\t\treturn;\n\n\t\tif(this.template[HIDE_FIELD])\n\t\t\treturn;\n\n\t\tif(keepNewValue) {\n\t\t\tthis.setPreviouslyFormattedValue();\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t} else {\n\t\t\tlet data = { target: { value: this.previouslyFormatted ? (this.previouslyFormatted.value) : this.formattedValue.value } };\n\t\t\tif(this.isLookup())\n\t\t\t\tdata.target[REF_DISPLAY] = this.previouslyFormatted ? this.previouslyFormatted.label : this.formattedValue.label;\n\t\t\tthis._onChange(data);\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t\t}\n\n\t\tthis.template[HIDE_FIELD] = true;\n\t\tthis.hideFormattedValue = false;\n\n\t\tif(this.isRenderReadOnly())\n\t\t\tthis.enableSignals();\n\t}\n\n\tupdateTemplateData(model, obj, md, html) {\n\t\tlet value = obj[this.property];\n\t\tlet formField = this.getFormField(model, value, md);\n\n\t\tif(formField.defaultValue && this.template) // default value only used if a template\n\t\t\tthis._onChange( { target: { value: formField.defaultValue} } );\n\n\t\tthis.formattedValue = this.getFormattedValue(formField, value);\n\t\tthis.originalFormattedValue = this.originalFormattedValue || this.formattedValue;\n\t\tthis.addFormattedValueClasses(formField.numeric);\n\n\t\tif(this.isReadOnly())\n\t\t\tthis.setFormattedDetails(html);\n\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tformField.attachTo(this.template, KEY_READ_ONLY, KEY_DOWN_READ_ONLY, BLUR_READ_ONLY, CHANGE, HIDE_FIELD, this.isRenderReadOnly());\n\t\treturn formField;\n\t}\n\n\tgetFormField(model, value, md) {\n\t\tlet editable = this.isEditable(true);\n\t\tlet selectOptions = this.getSelectOptions(md);\n\t\tlet referenceDetails = { refDisplay: this.refDisplay, refDisplayName: REF_DISPLAY, refTable: this.refTable, refObjects: this.refObjects, property: this.property, obj: this.obj, record: this.record };\n\t\treturn fieldFactory(this.type, model, value, editable, this.disabled, this.hidden, this.index, this.md, this.i18n, this.isRenderReadOnly(), selectOptions, referenceDetails, this.tabIndex, this.factoryData);\n\t}\n\n\tgetFormattedValue(formField, value) {\n\t\treturn formField.formattedValue || { value: value, label: value };\n\t}\n\n\taddFormattedValueClasses(numeric) {\n\t\tlet editable = this.isEditable();\n\t\tthis.toggleClass('editable', editable, this.$.formatted);\n\t\tthis.toggleClass('numericField', this.segmentedAlignment || (!this.preventNumericAlignment && numeric), this.$.formatted);\n\t\tthis.toggleClass('firstField', this.index == 0, this.$.formatted);\n\t\tthis.toggleClass('readOnly', this.readOnly, this.$.formatted);\n\n\t\tthis.isDirty = editable && this.formattedValue.value !== this.originalFormattedValue.value && !(this.isNil(this.formattedValue.value) && this.isNil(this.originalFormattedValue.value));\n\t\tthis.toggleClass('dirty', this.isDirty, this.$.formatted);\n\n\t\tlet isBool = this.isBoolean();\n\t\tlet isEmpty = !isBool && (this.formattedValue.value === false || (this.isNil(this.formattedValue.label) && this.formattedValue.value !== true));\n\t\tthis.toggleClass('empty', isEmpty, this.$.formatted);\n\t\tthis.toggleClass('empty', isEmpty, this.$.me);\n\n\t\tthis.toggleClass('link', this.link, this.$.formatted);\n\t\tthis.toggleClass('link', this.link, this.$.me);\n\n\t\tthis.toggleClass('boolean', isBool, this.$.formatted);\n\t}\n\n\tsignalRowFocus() {\n\t\tif(this.signaler) {\n\t\t\tthis.signaler.fireSignal('sb-row-focus-signal', true);\n\t\t\tsetTimeout(function() {\n\t\t\t\t// disable the signaler's internal focus events in timeout as some blur events\n\t\t\t\t// may enable it on a delay such as the discount field\n\t\t\t\tthis.signaler.disable();\n\t\t\t}.bind(this), 20);\n\t\t}\n\t}\n\n\tenableSignals() {\n\t\tif(this.signaler)\n\t\t\tthis.signaler.enable(); // enable the signalers internal focus events\n\t}\n\n\thandleRowFocusSignal(signal) {\n\t\tif(!this.signaler)\n\t\t\treturn;\n\n\t\tthis.signaler.toggleRowFocus(signal);\n\t\tif(this.isEditable())\n\t\t\tthis.toggleClass('show', signal.detail.focused, this.$.formatted);\n\t}\n\n\thandleFieldEditSignal(signal) {\n\t\tif (this.md.extraTypeInfo === 'richtextarea') {\n\t\t\tthis.signaler.signalNextPreviousEditableTarget(this, signal.detail.next);\n\t\t} else {\n\t\t\tthis.ironList = this.signaler.ironList;\n\t\t\tif (this.ironList && (this.ironList.lastVisibleIndex == this.ironList.items.length - 1)) {\n\t\t\t\tthis.ironList.toggleScrollListener(false);\n\t\t\t\tthis.scrollListenerDetached = true;\n\t\t\t}\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (this.scrollListenerDetached) {\n\t\t\t\t\tthis.ironList.toggleScrollListener(true);\n\t\t\t\t\tthis.scrollListenerDetached = false;\n\t\t\t\t}\n\t\t\t\tthis.edit();\n\t\t\t}.bind(this), 0);\n\t\t}\n\t}\n\n\tcreateBaseElement( html ) {\n\t\tvar d = this.template.content.ownerDocument.createElement('div');\n\t\td.innerHTML = html;\n\t\tlet el = Polymer.dom(d).firstChild;\n\t\tPolymer.dom(this.template.content).appendChild(el);\n\t}\n\n\tisNumericType() {\n\t\tswitch(this.type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetType(md) {\n\t\treturn md && md.type ? md.type.toLowerCase() : '';\n\t}\n\n\t/**\n\t * Single property observer to make sure the template is updated when value changes to undefined\n\t * @private\n\t */\n\t_valueChanged() {\n\t\tif(!this.rendered)\n\t\t\treturn;\n\t\t// We need to call the valueChanged method manually here because Polymer does not call multi-property observers\n\t\t// when the new value of the path is undefined (ie. field is empty for a record)\n\t\tif (this.value === undefined)\n\t\t\tthis.valueChanged(this.model, this.obj, this.md, this.property, this.html, this.value);\n\t}\n\n\tvalueChanged(model, obj, md, property, html, value) {\n\t\tif(value === undefined && this.isBoolean())\n\t\t\treturn;\n\n\t\tif(this.internal && this.template)\n\t\t\tthis.template.value = value;\n\t\telse\n\t\t\tthis.obj[property] = value;\n\n\t\tthis.setPreviouslyFormattedValue();\n\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\tsetPreviouslyFormattedValue() {\n\t\tthis.previouslyFormatted = this.formattedValue === undefined ? null : JSON.parse(JSON.stringify(this.formattedValue));\n\t}\n\n\tdisabledChanged(model, obj, md, html, disabled) {\n\t\tthis.toggleClass('disabled', disabled, this.$.formatted);\n\t\tif(this.template)\n\t\t\tthis.template.disabled = disabled;\n\n\t\tif(this.isRenderReadOnly() && this.editing)\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\thiddenChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.hide = this.hidden;\n\t}\n\n\trecordIdChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.recordId = this.recordId;\n\t}\n\n\trecordChanged(e) {\n\t\tif(!this.template || !e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tcomputeRefTable(md) {\n\t\tif(md === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tif(md.referenceTable)\n\t\t\treturn md.referenceTable;\n\t\t// if no referenceTable property on md, check the referenceTo array property which is same property on field metadata from sb-describe\n\t\treturn md.referenceTo && md.referenceTo.length > 0 ? md.referenceTo[0] : null;\n\t}\n\n\tlinkOrEdit() {\n\t\tif(this.link)\n\t\t\tthis.fire('sb-link-tapped', { value: this.value, Id: this.recordId } ) ;\n\t\telse\n\t\t\tthis.edit(true);\n\t}\n\n\tedit(clickEdit) {\n\t\tif(!this.isEditable())\n\t\t\treturn;\n\n\t\tthis._render(this.model, this.obj, this.md, this.html);\n\t\tthis.hideFormattedValue = true; // hide the formattedValue text\n\t\tthis.template[HIDE_FIELD] = false; // show the editable field\n\n\t\t// apply focus to the editable field\n\t\tif(this.template._nodes && this.template._nodes[0].focus)\n\t\t\tthis.template._nodes[0].focus(); // necessary for Firefox\n\n\t\tif(clickEdit)\n\t\t\tthis.invertValueIfInlineBoolean();\n\n\t\tif(this.isRenderReadOnly())\n\t\t\tthis.signalRowFocus();\n\t}\n\n\tgetEventTarget(e) {\n\t\ttry {\n\t\t\treturn Polymer.dom(e).localTarget || e.target;\n\t\t} catch(ex) {\n\t\t\treturn  e.target;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || (typeof value === 'number' && value + '' === 'NaN');\n\t}\n\n\tapplyFocus() {\n\t\tif(this.template)\n\t\t\tthis.template[APPLY_FOCUS] = this.focus;\n\t}\n\n\tisEditable(returnTrueIfEverEditable) {\n\t\tif(returnTrueIfEverEditable && this._wasEverEditable)\n\t\t\treturn true;\n\n\t\treturn (this.readOnly || (this.isRenderReadOnly() && this.disabled)) ? false : this.editing;\n\t}\n\n\tisReadOnly() {\n\t\treturn this.readOnly || this.isRenderReadOnly() || this.isFormulaHtml();\n\t}\n\n\tisRenderReadOnly() {\n\t\treturn this.renderReadOnly || this.isRichText() /* always render read only for rte */;\n\t}\n\n\tisFormulaHtml() {\n\t\treturn this.md.htmlFormatted && this.md.calculated; /* checks for formula text fields that resolve to html such as hyperlinks */\n\t}\n\n\tsetFormattedDetails(html) {\n\t\thtml.isDirty = this.isDirty;\n\t\thtml.link = !!this.link;\n\t\thtml.type = this.type;\n\t\thtml.booleanValue = this.isBoolean() ? this.obj[this.property] : null;\n\t\thtml.value = this.formattedValue.label;\n\t\tif(this.formattedValue.unit) {\n\t\t\thtml.value += ' ' + this.formattedValue.unit\n\t\t}\n\t\thtml.sanitizeAndSetInnerHTML();\n\t}\n\n\tisBoolean() {\n\t\treturn this.type === 'boolean' || this.type === 'checkbox';\n\t}\n\n\tisLookup() {\n\t\treturn this.type === 'id' || this.type === 'reference';\n\t}\n\n\tisRichText() {\n\t\treturn this.type === 'textarea' && this.md.extraTypeInfo === 'richtextarea';\n\t}\n\n\taddControlledSelectListener(md) {\n\t\tif (md && md.controllerName)\n\t\t\tdocument.addEventListener('sb-controlling-select-changed', (e) => this.controllerSelectHandler(this.model, this.obj, this.md, this.html, e));\n\t}\n\n\tcontrollerSelectHandler(model, obj, md, html, e) {\n\t\tlet tableName = e.detail.tableName;\n\t\tlet fieldName = e.detail.fieldName;\n\t\tlet record = e.detail.record;\n\n\t\tlet sameRecord = typeof this.record.equals === 'function' && record ? this.record.equals(record) : this.record === record;\n\t\tif (tableName !== md.tableName || md.controllerName !== fieldName || !sameRecord)\n\t\t\treturn; // not a child of the controlling field that has changed, so we bail\n\n\t\t// build the select options for the controlled field and clear the current value if invalid\n\t\tlet valueCleared = this.buildSelectOptions(md, true);\n\n\t\t// if the current value was not cleared because it was still valid, then need to update explicitly\n\t\t// otherwise the changing value to null would invoke valueChange observer which would do the update for us\n\t\tif (!valueCleared)\n\t\t\tthis.updateTemplateData(model, obj, md, html);\n\t}\n\n\tgetSelectOptions(md) {\n\t\tif(this._selectOptions)\n\t\t\treturn this._selectOptions;\n\n\t\tthis.buildSelectOptions(md);\n\t\treturn this._selectOptions;\n\t}\n\n\tbuildSelectOptions(md, clearInvalidValue) {\n\t\tif(!md.controllerName || !this.record) {\n\t\t\tthis._selectOptions = md.picklistValues;\n\t\t\treturn false;\n\t\t}\n\n\t\tlet value = typeof this.record.getValue === 'function' ? this.record.getValue(md.controllerName) : this.record[md.controllerName];\n\t\tthis._selectOptions = new DependentPicklistBuilder(md, value).build();\n\t\tif(clearInvalidValue)\n\t\t\treturn this.clearValueIfNotAnOption(this._selectOptions);\n\n\t\treturn false;\n\t}\n\n\tclearValueIfNotAnOption(options) {\n\t\tif(this.value === null)\n\t\t\treturn false;\n\n\t\tlet clearValue = true;\n\t\toptions.forEach( function(option) {\n\t\t\tif (option.value == this.value) {\n\t\t\t\tclearValue = false;\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif(!clearValue)\n\t\t\treturn false;\n\n\t\tif(typeof this.record.setValue === 'function')\n\t\t\tthis.record.setValue(this.property, null);\n\t\telse\n\t\t\tthis.record[this.property] = null;\n\n\t\t// set value to null by simulating an onChange with a null value\n\t\tthis.onChange( { target: { value: null } } );\n\t\treturn true;\n\t}\n\n\tinvertValueIfInlineBoolean() {\n\t\tif(this.isRenderReadOnly() && this.isBoolean()) {\n\t\t\tthis.value = undefined;\n\t\t\tthis.value = !this.obj[this.property];\n\t\t\tthis.internal = true;\n\t\t\tthis.domHost.value = this.value;\n\t\t\tthis.internal = false;\n\t\t\tthis.fireCustomChangeEvents();\n\t\t\tthis.fire('sb-field-on-change-field');\n\t\t}\n\t}\n\n\t_setWasEverEditable() {\n\t\treturn this._wasEverEditable || this.editing;\n\t}\n}\n\nPolymer( Field );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Input {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-input';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed'\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tinputType: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'text'\n\t\t\t},\n\t\t\trenderReadOnly: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowClear: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showClear(viewport, inputType, disabled)'\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocused: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['hideClearIfEmpty(value, showClear, focused)']\n\t}\n\n\thideClearIfEmpty() {\n\t\tif(!this.showClear)\n\t\t\treturn;\n\t\tif(!this.$$('#clear')) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis._hideClearIfEmpty();\n\t\t\t}.bind(this));\n\t\t} else\n\t\t\tthis._hideClearIfEmpty();\n\t}\n\n\t_hideClearIfEmpty() {\n\t\tthis.toggleClass('hide', this.focused || this.value == null || this.value === '' , this.$$('#clear'));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.querySelector('.myinput').focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t\tthis.focused = false;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t\tthis.querySelector(\".myinput\").blur();\n\t}\n\n\thighlight() {\n\t\tthis.focused = true;\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.querySelector('.myinput').setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.querySelector('.myinput').value = this.value;\n\n\t\tthis.fire('sb-input-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_showClear() {\n\t\treturn this.viewport && this.viewport.isMobile() && !this.disabled && this.inputType !== 'date' && this.inputType !== 'datetime';\n\t}\n}\nPolymer(Input);","import {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\n\nexport class Lookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'initTableLabel'\n\t\t\t},\n\t\t\tlimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 5\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabelName: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'label'\n\t\t\t},\n\t\t\tselectedLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSelectedLabel(tableName)'\n\t\t\t},\n\t\t\tmenuItemLabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlookupCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this.lookupResultsCallback.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\thideInputAndShowPill: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tinDialog: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttableLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: 'getLabels(selectedLabel, menuItemLabels)'\n\t\t\t},\n\t\t\tsearchText: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSearchText(placeholder, tableLabel, i18n)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'showSearch(viewport, inDialog)'\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed:'isMobile(viewport)'\n\t\t\t},\n\t\t\tfieldFullName: String,\n\t\t\thasFilter: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcontrollingFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tcurrentRecordFilters: Object,\n\t\t\trecord: Object,\n\t\t\tdialogMetadata: Object\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setSelectedItem(value, selectedLabel)',\n\t\t\t\t'setLabel(label)',\n\t\t\t\t'setCallback(customCallback)',\n\t\t\t\t'handleMobileEvents(viewport, inDialog)',\n\t\t\t\t'setForceSuggest(record.*)',\n\t\t\t\t'initCurrentRecordFilters(hasFilter, controllingFields, fieldFullName)'];\n\t}\n\n\tready() {\n\t\tthis.$.object.addEventListener('describe-changed', this.setTableLabel.bind(this));\n\t\tthis.$.typeahead.addEventListener('enter-without-selection',this.handleEnterPressed.bind(this));\n\t\tthis.$.fields.addEventListener('md-changed', this.setCurrentRecordFilters.bind(this));\n\t}\n\n\tinitTableLabel() {\n\t\tif(this.tableName)\n\t\t\tthis.$.object.objects = [this.tableName];\n\t}\n\n\tsetTableLabel(e) {\n\t\tthis.tableLabel = e.detail.value.md[this.tableName].labelPlural;\n\t}\n\n\tsetCallback() {\n\t\tthis.lookupCallback = this.customCallback.bind(this);\n\t}\n\n\tlookupResultsCallback(searchValue) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif(!this.tableName) {\n\t\t\t\tresolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.queryLookupResults(searchValue, resolve, reject);\n\t\t}.bind(this));\n\t}\n\n\tqueryLookupResults(searchValue, resolve, reject) {\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, this.limit, this.currentRecordFilters, this.record, true, this.dialogMetadata);\n\t\tlet soql = queryBuilder.build(searchValue, false, this.inDialog);\n\t\tthis.$.q.query({ soql: soql, version: AppContext.apiVersionString }).then(function(response) {\n\t\t\tlet records = response.records;\n\t\t\tlet searchText = searchValue == null ? '' : searchValue;\n\t\t\tlet search = { Id: '', __md__: {class: 'search', searchValue: searchText, clearAfterSelection: !this.inDialog, noFocusAfterSelection: this.inDialog } };\n\t\t\tlet tableLabel = this.tableLabel;\n\t\t\tif(!tableLabel) {\n\t\t\t\t// if table label not yet set from sb-lookup-dialog, then do our best to create a readable table label from the tableName\n\t\t\t\tlet tableParts = this.tableName.split('__');\n\t\t\t\tlet tableLabelPartIndex = tableParts.length > 1 ? tableParts.length - 2 : 0;\n\t\t\t\ttableLabel = tableParts[tableLabelPartIndex];\n\t\t\t}\n\n\t\t\tif(this.isMobile()) {\n\t\t\t\tsearch[this.selectedLabel] = searchText ? this.i18n.l('\"{0}\"', [searchText]) : '';\n\t\t\t\trecords.push(search);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet searchLabel = searchText ? '\"{0}\" in {1}' : ' in {1}';\n\t\t\t\tsearch[this.selectedLabel] = this.i18n.l(searchLabel, [searchText, tableLabel]);\n\t\t\t\trecords = [search].concat(records);\n\t\t\t}\n\t\t\tif(this.inDialog && this.isMobile())\n\t\t\t\tthis.domHost.handleSearchResults(this.limit, {records: records, totalSize: response.totalSize});\n\t\t\telse\n\t\t\t\tresolve(records);\n\t\t}.bind(this), function(error) {\n\t\t\tlet errorMessage = 'SOQL Execution Error: ' + soql + ' (' + (error && error.message ? error.message : error) + ')';\n\t\t\treject(errorMessage);\n\t\t}.bind(this));\n\t}\n\n\tsetLabel() {\n\t\tthis._setLabel();\n\t\tif(this.value != null && this.selectedLabel != null)\n\t\t\tthis.setSelectedItem();\n\t}\n\n\tsetSelectedItem() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tif(this.label == null)\n\t\t\treturn;\n\n\t\tlet label = this.getLabel();\n\t\tlet selectedItem = { Id: this.value };\n\t\tselectedItem[this.selectedLabel] = label;\n\t\tthis.$.typeahead.items = this.$.typeahead.items || [ selectedItem ];\n\t\tthis.$.typeahead.selectedItem = selectedItem;\n\t\tthis.setHideInputAndShowPill(this.value);\n\n\t\tthis.focus();\n\n\t\tif(!this._handleSelectedItemChanged) {\n\t\t\tthis._handleSelectedItemChanged = this.handleSelectedItemChanged.bind(this);\n\t\t\tthis.$.typeahead.addEventListener('selected-item-changed', this._handleSelectedItemChanged);\n\t\t}\n\t}\n\n\thandleSelectedItemChanged(e) {\n\t\tif (e.detail.path || e.detail.value == '')\n\t\t\treturn;\n\n\t\tlet md = e.detail.value.__md__;\n\t\tlet searchValue = md && md.searchValue !== undefined ? md.searchValue : undefined;\n\t\tif(searchValue !== undefined) {\n\t\t\tthis.applySearchValue(searchValue);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setHideInputAndShowPill(e.detail.value.Id);\n\t\tthis.focus();\n\n\t\tthis.internal = true;\n\t\tthis.value = e.detail.value.Id || null;\n\t\tthis.label = e.detail.value[this.selectedLabel] || '';\n\t\tthis.internal = false;\n\n\t\tthis._setLabel();\n\t\tthis.fireLookupValueChanged(this.value, this.label, e.detail.value);\n\t}\n\n\tapplySearchValue(searchValue) {\n\t\tif(searchValue && searchValue.detail)\n\t\t\tsearchValue = searchValue.detail.value;\n\n\t\tif(this.inDialog) {// tell host dialog component that the search value has changed\n\t\t\tthis.domHost.searchValue = searchValue;\n\t\t\tthis.domHost.querySearchResults();\n\t\t}\n\t\telse // open the dialog\n\t\t\tthis.fire('iron-signal', {name: 'sb-open-lookup-dialog', data: {\n\t\t\t\tlookup: this,\n\t\t\t\tsearchValue: searchValue\n\t\t}});\n\t}\n\n\thandleEnterPressed(e) {\n\t\tif(this.currentRecordFilters)\n\t\t\tthis.applySearchValue(e.detail.value);\n\t}\n\n\tfireLookupValueChanged(value, label, obj) {\n\t\tlet data = {\n\t\t\tvalue: value,\n\t\t\tobj: obj,\n\t\t\titem: this.record ? this.record.item : null\n\t\t};\n\t\tdata[this.labelName] = label;\n\t\tthis.fire( 'lookup-value-changed', data );\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.isMobile())\n\t\t\treturn;\n\t\tif(!this.hideInputAndShowPill) {\n\t\t\tthis.$.typeahead.focus(forceSuggest || this.forceSuggest);\n\t\t\tthis.forceSuggest = false;\n\t\t}\n\t\telse if(!this.focusDisabled)\n\t\t\tthis.$.container.focus();\n\t}\n\n\tgetLabel() {\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tlet val = this._getLabelValueKey();\n\t\tlet label = this.labelsByValue[val];\n\t\tif(this.value && !label) {\n\t\t\tthis.labelsByValue[val] = this.label;\n\t\t\tlabel = this.label;\n\t\t}\n\t\treturn label;\n\t}\n\n\t_setLabel() {\n\t\tlet val = this._getLabelValueKey();\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tthis.labelsByValue[val] = this.label;\n\t}\n\n\t_getLabelValueKey() {\n\t\treturn this.value && typeof this.value === 'string' ?  this.value.substring(0,15) : this.value;\n\t}\n\n\tsetHideInputAndShowPill(value) {\n\t\tthis.hideInputAndShowPill = !this.isMobile() && !this.isNil(value) && !(this.clearAfterSelection);\n\t}\n\n\tblurContainer() {\n\t\tif(this.hideInputAndShowPill && !this.blurDisabled)\n\t\t\tthis.blur();\n\t}\n\n\tblur() {\n\t\tthis.$.typeahead.setOriginalSelected();\n\t\tthis.fire('sb-type-blur');\n\t}\n\n\tpropagateEscOrHandleDelete(e) {\n\t\tif(e.keyCode === 27) // esc key\n\t\t\tthis.$.typeahead.suggest(e);\n\t\telse if(e.keyCode === 8) {// delete key\n\t\t\tthis.deletePill(); // only works in FF if its about:config > browser:backspace_action is set to 2 - https://support.mozilla.org/en-US/questions/924490\n\t\t\tthis.blurDisabled = !!(this.previousBlurDisabled);\n\t\t}\n\t}\n\n\tpreventBlurOnDelete(e) {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tif(e.keyCode === 8) // delete key\n\t\t\tthis.blurDisabled = true;\n\t}\n\n\tpreventBlur() {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tthis.blurDisabled = true;\n\t}\n\n\tdeletePill() {\n\t\tif(!this.disabled)\n\t\t\tthis.$.typeahead.clear();\n\t\tthis.blurDisabled = this.previousBlurDisabled;\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '';\n\t}\n\n\tdialogOpened() {\n\t\tthis.blurDisabled = true;\n\t\tthis.focusDisabled = true;\n\t}\n\n\tdialogClosed() {\n\t\tthis.blurDisabled = false;\n\t\tthis.focusDisabled = false;\n\t\tthis.focus(true);\n\t\tthis.fire('iron-signal', {name: 'sb-lookup-dialog-closed', data: {\n\t\t\tlookup: this\n\t\t}});\n\t}\n\n\tgetSelectedLabel() {\n\t\treturn new LookupNameMapper(this.tableName).getNameField();\n\t}\n\n\tgetLabels() {\n\t\treturn this.menuItemLabels || [this.selectedLabel];\n\t}\n\n\tgetSearchText() {\n\t\treturn this.placeholder || this.buildSearchText();\n\t}\n\n\tbuildSearchText() {\n\t\tif(this.i18n && typeof this.i18n.l === 'function')\n\t\t\treturn this.i18n.l('Search {0}', [this.tableLabel]);\n\t\treturn `Search ${this.tableLabel}`;\n\t}\n\n\thandleMobileEvents() {\n\t\tif(!this.isMobile())\n\t\t\treturn;\n\n\t\tif(this.inDialog) {\n\t\t\tthis._clearAndSave = this._clearAndSave || (this.domHost.clearAndSave ? this.domHost.clearAndSave.bind(this.domHost) : null);\n\t\t\tif (this._clearAndSave) {\n\t\t\t\tthis.$.typeahead.removeEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t\tthis.$.typeahead.addEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._applySearchValue = this._applySearchValue || this.applySearchValue.bind(this);\n\t\t\tthis.$.typeahead.removeEventListener('sb-type-focus', this._applySearchValue);\n\t\t\tthis.$.typeahead.addEventListener('sb-type-focus', this._applySearchValue);\n\t\t}\n\t}\n\n\tshowSearch() {\n\t\treturn this.isMobile() && !this.inDialog;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tinitCurrentRecordFilters() {\n\t\tif (this.controllingFields.length === 0) {\n\t\t\tthis.currentRecordFilters = {};\n\t\t\treturn;\n\t\t}\n\n\t\t// concatenate source object name with the field name(s) for the field describe call\n\t\tlet lookupFieldTable = this.fieldFullName.split('.')[0];\n\t\tlet fields = [];\n\t\tfor (let f of this.controllingFields) {\n\t\t\tfields.push(lookupFieldTable + '.' + f);\n\t\t}\n\n\t\tthis.$.fields.fields = fields;\n\t}\n\n\tsetCurrentRecordFilters(e) {\n\t\tlet currentRecordFilters = {};\n\t\tfor(let field of e.detail.value.fields)\n\t\t\tcurrentRecordFilters[field.name] = field.type;\n\t\tthis.currentRecordFilters = currentRecordFilters;\n\t}\n\n\tsetForceSuggest(e) {\n\t\tif(this.forceSuggest)\n\t\t\treturn;\n\n\t\tif(!e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tif(!this.hasFilter)\n\t\t\treturn;\n\n\t\tlet currentRecordFiltersKeys = this.currentRecordFilters ? Object.keys(this.currentRecordFilters) : [];\n\t\tif(currentRecordFiltersKeys.length === 0)\n\t\t\treturn;\n\n\t\tlet parts = e.path.split('.');\n\t\tlet property = parts[parts.length-1];\n\t\tif(currentRecordFiltersKeys.indexOf(property) === -1)\n\t\t\treturn;\n\n\t\tthis.forceSuggest = true;\n\t}\n}\n\nPolymer( Lookup );\n","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\n\nconst LAYOUT_FIELD_SET = 'CPQ_Lookup';\nconst SEARCH_FIELD_SET = 'CPQ_Lookup_Search';\n\nconst DEFAULT_SEARCH_TYPES = ['string','picklist','multipicklist'];\nconst ALLOWED_SEARCH_TYPES = DEFAULT_SEARCH_TYPES.concat(['textarea', 'date', 'datetime', 'int', 'number', 'currency', 'percent', 'double', 'reference']);\n\nexport class LookupDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: String,\n\t\t\ttableName: String,\n\t\t\ttableLabel: String,\n\t\t\tfieldLabel: String,\n\t\t\tlabelName: String,\n\t\t\tselectedLabel: String,\n\t\t\tsearchValue: String,\n\t\t\tmetadata: Object,\n\t\t\tnumResults: Number,\n\t\t\tresults: Object,\n\t\t\tinvoker: { // the sb-lookup component that invoked this dialog\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'initialize'\n\t\t\t},\n\t\t\tisOAuth: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org ? AppContext.org.isOAuth : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\topenSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trecordSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isMobile(viewport)'\n\t\t\t},\n\t\t\thideCancel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_hideCancel(isMobile, openSpinner, recordSpinner)'\n\t\t\t},\n\t\t\tlayoutFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tsearchFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tlookupSearchTypes: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn DEFAULT_SEARCH_TYPES.concat(AppContext.org ? AppContext.org.additionalLookupSearchTypes : []);\n\t\t\t\t}\n\t\t\t},\n\t\t\tmaxSearchFields: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org ? AppContext.org.maxLookupSearchFields : 1;\n\t\t\t\t}\n\t\t\t},\n\t\t\tfieldSetPrefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'getMetadata(tableName, viewport)',\n\t\t\t'processCPQLayoutFields(fieldSets, i18n)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.cancel.bind(this));\n\t\tthis.addEventListener('lookup-value-changed', this.setValues.bind(this));\n\t\tthis.$.field.addEventListener('md-changed', this.processListFields.bind(this));\n\t\tthis.addEventListener('sb-link-tapped', this.updateLookup.bind(this));\n\t\tthis.setResultsHeightHandler = this.setResultsHeight.bind(this);\n\t\twindow.addEventListener('resize', this.setResultsHeightHandler);\n\t\t// this removes iron-list resize handler as we will use our own\n\t\tthis.$$('#list').assignParentResizable({\n\t\t\tstopResizeNotificationsFor: function() {\n\t\t\t\twindow.removeEventListener('resize', this.setResultsHeightHandler);\n\t\t\t}.bind(this)\n\t\t});\n\t}\n\n\tinitialize() {\n\t\tif(!this.invoker)\n\t\t\treturn;\n\n\t\tthis.labelName = this.invoker.labelName;\n\t\tthis.label = this.invoker.label;\n\t\tthis.selectedLabel = this.invoker.selectedLabel;\n\t\tthis.tableName = this.invoker.tableName;\n\t\tthis.fieldLabel = this.invoker.fieldLabel;\n\t\tthis.currentRecordFilters = this.invoker.currentRecordFilters;\n\t\tthis.controllingFields= this.invoker.controllingFields;\n\t\tthis.record = this.invoker.record;\n\t\tthis.hasFilter = this.currentRecordFilters && Object.keys(this.currentRecordFilters).length > 0 && AppContext.apiVersion < 39 ? false : this.invoker.hasFilter;\n\t\tthis.fieldFullName = this.invoker.fieldFullName;\n\t}\n\n\topen(searchValue) {\n\t\tthis.$.dialog.toggle();\n\t\tthis.invoker.dialogOpened();\n\t\tthis.$.lookup.$.typeahead.blurred = true;\n\t\tthis.$.lookup.$.typeahead.hasList = false;\n\t\tthis.$.lookup.$.typeahead.labelValue = searchValue;\n\t\tthis.invoker.$.typeahead.$.itemLabel.blur();\n\t\tthis.searchValue = searchValue;\n\t}\n\n\tcancel() {\n\t\tthis.close();\n\t}\n\n\tsaveAndDeferredClose() {\n\t\tthis.syncSelection();\n\t\tthis.deferredClose();\n\t}\n\n\tsave() {\n\t\tthis.syncSelection();\n\t\tthis.close();\n\t}\n\n\tsyncSelection() {\n\t\tthis.invoker.value = undefined;\n\t\tthis.invoker.label = this.label;\n\t\tthis.invoker.value = this.value;\n\t}\n\n\tclearAndSave() {\n\t\tthis.label = ''; // set to empty string instead of null to ensure clear in mobile works due to a typeahead null check on label\n\t\tthis.value = null;\n\t\tthis.save();\n\t}\n\n\tclose() {\n\t\tthis.$.dialog.toggle();\n\t\tthis.$.lookup.$.typeahead.suggest({});\n\t\tthis.invoker.dialogClosed();\n\t\tthis.reset();\n\t\tthis.clearSelected();\n\t}\n\n\n\tdeferredClose() {\n\t\t// defer the closing of the dialog to prevent applying focus in mobile to any input field\n\t\t// directly behind where the dialog was tapped that initiated the close\n\t\t// 350ms seems to be the least amount of time we can delay to ensure the focus does not seep through\n\t\tsetTimeout(function () {\n\t\t\tthis.close();\n\t\t}.bind(this), 350);\n\t}\n\n\treset() {\n\t\tthis.value = null;\n\t\tthis.label = null;\n\t\tthis.results = null;\n\t\tthis.tableLabel = null;\n\t\tthis.fieldLabel = null;\n\t\tthis.fieldFullName = undefined;\n\t\tthis.hasFilter = false;\n\t\tthis.currentRecordFilters = null;\n\t\tthis.controllingFields = null;\n\t\tthis.record = null;\n\t\tthis.tableName = null;\n\t\tthis.numResults = 0;\n\t\tthis.metadata = undefined;\n\t\tthis.layoutFields = [];\n\t\tthis.searchFields = [];\n\t\tthis.$.header.cols = undefined;\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tthis.$.fs.response = null;\n\t\tthis.$.fs.context = undefined;\n\t\tthis.invoker = null;\n\t\tthis.errors = null;\n\t}\n\n\tsetValues(e) {\n\t\tthis.value = e.detail.value;\n\t\tthis.label = e.detail[this.labelName];\n\t}\n\n\tupdateLookup(e) {\n\t\tthis.label = undefined;\n\t\tthis.value = e.detail.Id;\n\t\tthis.label = this.getSelectedLabelValueById(e.detail.Id);\n\t}\n\n\tgetSelectedLabelValueById(id) {\n\t\tfor(let result of this.results) {\n\t\t\tif(result.Id === id)\n\t\t\t\treturn result[this.selectedLabel];\n\t\t}\n\t}\n\n\tgetMetadata() {\n\t\tif(!this.tableName)\n\t\t\treturn;\n\n\t\tthis.openSpinner = true;\n\t\tthis.$.fs.context = {fieldSets: [{tableName: this.tableName, name: LAYOUT_FIELD_SET}, {tableName: this.tableName, name: SEARCH_FIELD_SET}]};\n\t}\n\n\tinitSearchFieldsAndReturnOnesNotInLayout(fieldSets, layoutFields) {\n\t\tlet searchFieldsNotInLayout = [];\n\t\tlet searchFields = this.getCpqLookupSearchFields(fieldSets);\n\t\tif(!searchFields)\n\t\t\treturn searchFieldsNotInLayout;\n\n\t\tthis.searchFields = searchFields.names;\n\t\tlet fields = searchFields.fields;\n\t\tfor(let field of fields) {\n\t\t\tif(field === (this.tableName + '.' + this.selectedLabel))\n\t\t\t\tcontinue;\n\n\t\t\tif(layoutFields.indexOf(field) !== -1)\n\t\t\t\tcontinue;\n\n\t\t\tsearchFieldsNotInLayout.push(field);\n\t\t}\n\t\treturn searchFieldsNotInLayout;\n\t}\n\n\tprocessCPQLayoutFields(fieldSets) {\n\t\tif(!fieldSets)\n\t\t\treturn;\n\n\t\tthis.tableLabel = fieldSets[0].tableLabel;\n\t\tif(this.isMobile) {\n\t\t\tthis.initMobileMetadata();\n\t\t\treturn;\n\t\t}\n\n\t\tlet layoutFields = this.getCpqLookupLayoutFields(fieldSets);\n\t\tif(!layoutFields) {\n\t\t\tlayoutFields = {fields: [], names: []};\n\t\t\tthis.warnUserAboutCPQLayoutFieldSet();\n\t\t}\n\n\t\tlet omittedNameField = this.getNameFieldIfOmittedFrom(layoutFields.fields);\n\t\tif(omittedNameField) {\n\t\t\tlayoutFields.fields = [omittedNameField.field].concat(layoutFields.fields);\n\t\t\tlayoutFields.names.push(omittedNameField.name);\n\t\t}\n\n\t\tthis.layoutFields = layoutFields.names;\n\t\tlet searchFieldsNotInLayout = this.initSearchFieldsAndReturnOnesNotInLayout(fieldSets, layoutFields.fields);\n\t\tlet fields = layoutFields.fields.concat(searchFieldsNotInLayout);\n\t\tthis.$.field.fields = fields;\n\t}\n\n\tprocessListFields(e) {\n\t\tlet fields = e.detail.value.fields;\n\t\tlet fieldNames =[];\n\t\tlet fieldLabels =[];\n\t\tlet fieldTypeByName = {};\n\t\tlet fieldTypeObjByName = {};\n\t\tlet fieldTypeByLabel = {};\n\t\tlet fieldsOfTypeLookup = [];\n\t\tfor(let i = 0, l = fields.length; i < l; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tlet type = { type: field.type, link: i === 0 };\n\t\t\tif(this.layoutFields.indexOf(field.name) !== -1) {\n\t\t\t\tfieldNames.push(field.name);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t}\n\t\t\tfieldTypeByName[field.name] = field.type;\n\t\t\tfieldTypeObjByName[field.name] = type;\n\t\t\tfieldTypeByLabel[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\tif(field.type === 'reference' || field.type === 'id')\n\t\t\t\tfieldsOfTypeLookup.push({name: field.name, table: field.referenceTo[0]});\n\t\t}\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(fieldTypeByLabel), 'Th', fieldTypeByLabel).build();\n\t\tthis.rowClassMap = new TableClassBuilder(fieldNames, 'Td', fieldTypeByName).build();\n\t\tlet additionalSearchFields = this.sanitizeAdditionalSearchFields(fieldTypeObjByName);\n\t\tthis.metadata = { fieldNames: fieldNames, fieldLabels: fieldLabels, fieldTypeObjByName: fieldTypeObjByName, fieldsOfTypeLookup: fieldsOfTypeLookup, additionalSearchFields: additionalSearchFields };\n\t\tthis.querySearchResults();\n\t}\n\n\tsanitizeAdditionalSearchFields(fieldTypeObjByName) {\n\t\tlet index = 0;\n\t\tlet offset = 0;\n\t\tlet sanitizedAdditionalSearchFields = [];\n\n\t\tfor(let searchField of this.searchFields) {\n\t\t\tif (searchField === this.selectedLabel) {\n\t\t\t\toffset = 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet type = fieldTypeObjByName[searchField].type;\n\n\t\t\t// ensure the field type is one that we support, else continue\n\t\t\tif(this.lookupSearchTypes.indexOf(type) === -1 || ALLOWED_SEARCH_TYPES.indexOf(type) === -1)\n\t\t\t\tcontinue;\n\n\t\t\tsanitizedAdditionalSearchFields.push(searchField);\n\t\t\tif(++index === this.maxSearchFields)\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(sanitizedAdditionalSearchFields.length < (this.searchFields.length - offset))\n\t\t\tthis.warnUserAboutSanitizedCPQSearchFieldSet(sanitizedAdditionalSearchFields);\n\n\t\treturn sanitizedAdditionalSearchFields;\n\t}\n\n\tquerySearchResults() {\n\t\tthis.recordSpinner = !this.openSpinner;\n\t\tlet limit = 100;\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, limit + 1, this.currentRecordFilters, this.record, false, this.metadata);\n\t\tlet soql = queryBuilder.build(this.searchValue, true, true);\n\t\tthis.$.query.query({ soql: soql }).then(this.handleSearchResults.bind(this, limit));\n\t}\n\n\thandleSearchResults(limit, response) {\n\t\tthis.clearSelected();\n\t\tlet plus = response.totalSize > limit ? '+' : '';\n\t\tlet totalSize = Math.min(limit, response.totalSize);\n\t\tthis.numResults = totalSize + plus;\n\t\tthis.results = this.getResults(response, limit);\n\t\tthis.recordSpinner = false;\n\t\tthis.openSpinner = false;\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = null; // iOS mobile has quirk where the overflow style must be cleared and reset\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.setResultsHeight();\n\t\t}.bind(this));\n\t}\n\n\tgetResults(response, limit) {\n\t\tlet results = response.records;\n\t\tlet numResults = response.totalSize;\n\t\tlet isMobileWithSpotlight = this.isMobile && results.length > numResults;\n\t\tlet mobileSpotlight = isMobileWithSpotlight ? results.pop() : null;\n\t\t// ensure number of results matches the limit\n\t\twhile(numResults > limit) {\n\t\t\tresults.pop();\n\t\t\tnumResults--;\n\t\t}\n\t\t// add back the mobile spotlight\n\t\tif(mobileSpotlight)\n\t\t\tresults.push(mobileSpotlight);\n\t\t// add mobile decorated mobile spotlight result for display purposes\n\t\tif(isMobileWithSpotlight)\n\t\t\tresults[numResults][this.selectedLabel] = `<div class=\"sb-html ${results[numResults]['__md__'].class}\">${results[numResults][this.selectedLabel]}</div>`;\n\t\treturn results;\n\t}\n\n\tsetResultsHeight() {\n\t\tlet offsetBottom = !this.isMobile ? this.$.dialog.$$('#footer').offsetTop : document.documentElement.clientHeight;\n\t\tlet offset = offsetBottom - this.$.tbody.offsetTop;\n\t\tlet scrollHeight = this.$.tbody.scrollHeight;\n\t\tlet height = offset < scrollHeight ? (offset + 'px') : null;\n\t\tthis.$.tbody.style.height = height;\n\t\tlet dataTableHeight = offsetBottom - this.$.datatable.offsetTop + 'px';\n\t\tthis.$.datatable.style.height = dataTableHeight;\n\t\tlet mask = this.$.spinner.$$('#mask');\n\t\tmask.style.height = offset + 'px';\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = 'auto'; // set overflow in mobile in this render cycle to handle iOS quirk\n\t\telse\n\t\t\tmask.style.marginLeft = '-24px';\n\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tlet list = this.$$('#list');\n\t\t\tlist.notifyResize();\n\t\t}.bind(this));\n\t}\n\n\tgetCpqLookupLayoutFields(fieldSets) {\n\t\treturn this.getCpqLookupFields(fieldSets, false);\n\t}\n\n\tgetCpqLookupSearchFields(fieldSets) {\n\t\treturn this.getCpqLookupFields(fieldSets, true);\n\t}\n\n\tgetCpqLookupFields(fieldSets, forSearch) {\n\t\tlet fields = [];\n\t\tlet names = [];\n\t\tfor(let fieldSet of fieldSets) {\n\t\t\tif(!this.validCPQFieldSet(fieldSet, forSearch))\n\t\t\t\tcontinue;\n\n\t\t\tlet df = fieldSet.displayedFields;\n\t\t\tlet displayedFields = !df ? [] : (df.constructor === Array ? df: [df]);\n\t\t\tfor(let displayedField of displayedFields) {\n\t\t\t\tlet field = displayedField.field || displayedField;\n\t\t\t\tif(field.split('.').length === 1) { // only support fields directly on table\n\t\t\t\t\tnames.push(field);\n\t\t\t\t\tfields.push(this.tableName + '.' + field);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// return the field array (even if empty) to indicate the field set does exist\n\t\t\treturn {fields: fields, names: names};\n\t\t}\n\t\t// return null to indicate the field set does not exist\n\t\treturn null;\n\t}\n\n\tvalidCPQFieldSet(fieldSet, forSearch) {\n\t\tif(!forSearch && (fieldSet.label === LAYOUT_FIELD_SET || fieldSet.fullName === (this.fieldSetPrefix + LAYOUT_FIELD_SET)))\n\t\t\treturn true;\n\n\t\tif(forSearch && (fieldSet.label === SEARCH_FIELD_SET || fieldSet.fullName === (this.fieldSetPrefix + SEARCH_FIELD_SET)))\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\tgetNameFieldIfOmittedFrom(fields) {\n\t\tif(fields.indexOf(this.tableName + '.' + this.selectedLabel) === -1)\n\t\t\treturn {field: (this.tableName + '.' + this.selectedLabel), name: this.selectedLabel};\n\t}\n\n\twarnUserAboutCPQLayoutFieldSet() {\n\t\tthis.errors = [this.i18n.l(\"FieldSetWarning\", [this.tableLabel])];\n\t}\n\n\twarnUserAboutSanitizedCPQSearchFieldSet(sanitizedSearchFields) {\n\t\tconsole.warn(`The ${this.tableLabel}.${this.fieldSetPrefix}${SEARCH_FIELD_SET} field set either contains fields of unsupported types or the field set size exceeds the max size (${this.maxSearchFields}).\\nActual: ${sanitizedSearchFields.join(',')}\\nExpect: ${this.searchFields.join(',')}`);\n\t}\n\n\tinitMobileMetadata() {\n\t\tlet rowClassMap = {};\n\t\trowClassMap[this.selectedLabel] = 'lookupItemTd';\n\t\tthis.rowClassMap = rowClassMap;\n\t\tthis.metadata = { fieldNames: [this.selectedLabel], fieldLabels: [], fieldTypeObjByName: {}, fieldsOfTypeLookup: [], additionalSearchFields: [] };\n\t\tthis.$.lookup.lookupResultsCallback(this.searchValue);\n\t}\n\n\tmobileSelection(e) {\n\t\tif(!this.isMobile)\n\t\t\treturn;\n\n\t\tlet row = Polymer.dom(e).localTarget;\n\t\tthis.setSelected(row);\n\t\tif(row.hasAttribute('data-search')) {\n\t\t\tthis.searchValue = row.getAttribute('data-search');\n\t\t\tthis.querySearchResults();\n\t\t} else {\n\t\t\tthis.value = row.getAttribute('data-id');\n\t\t\tthis.label = row.getAttribute('data-name');\n\t\t\tthis.saveAndDeferredClose();\n\t\t}\n\t}\n\n\tgetSearchValue(row) {\n\t\tif(row && !row.Id)\n\t\t\treturn row['__md__'].searchValue;\n\t}\n\n\tgetNameValue(row) {\n\t\treturn row[this.selectedLabel];\n\t}\n\n\tsetSelected(row) {\n\t\tthis.selected = row.$.row.$$('sb-table-cell');\n\t\tthis.toggleClass('selectedLookupItem', true, this.selected);\n\t}\n\n\tclearSelected() {\n\t\tif(this.selected)\n\t\t\tthis.toggleClass('selectedLookupItem', false, this.selected);\n\t}\n\n\t_hideCancel() {\n\t\treturn !this.isMobile || this.openSpinner || this.recordSpinner;\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n\nPolymer(LookupDialog);\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class MultiLookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-multi-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: String,\n\t\t\tobjectName: String,\n\t\t\thideCancel: Boolean,\n\t\t\ticonName: String,\n\t\t\ticonMap: Object,\n\t\t\tresults: Array,\n\t\t\tselectedItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tselectedIdsByItems: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcustomCallBack: Function,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: Boolean\n\t\t};\n\t}\n\n\tupdateTable(results) {\n\t\tthis.results = results;\n\t}\n\n\tready() {\n\t\t// eventlistener on lookup (lookup changed)\n\t\tthis.$.lookup.addEventListener('lookup-value-changed', function (e) {\n\t\t\tlet selectedItem = e.detail.obj;\n\t\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\t\tthis._addItem(selectedItem);\n\t\t\t} else {\n\t\t\t\tthis._animateDuplicate(selectedItem);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis._appendMobileClasses();\n\t}\n\n\t_addItem(item) {\n\t\tthis.selectedIdsByItems[item.Id] = item;\n\t\tthis.unshift('selectedItems', item);\n\t\tPolymer.dom.flush();\n\t\tif (this.iconName && this.iconMap)\n\t\t\tthis.toggleClass(this.iconMap[item[this.iconName]], true, this.$$(`.pill-icon`));\n\t}\n\n\t_animateDuplicate(item) {\n\t\tlet pills = Polymer.dom(this.$.selectedContainer).querySelectorAll('.pill');\n\t\tfor (let i=0; i<pills.length;i++) {\n\t\t\tif (pills[i].dataValue == item.Id) {\n\t\t\t\tpills[i].addEventListener('webkitAnimationEnd', function() {\n\t\t\t\t\tthis.toggleClass('invalid-selection', false, pills[i]);\n\t\t\t\t}.bind(this), false);\n\t\t\t\tthis.toggleClass('invalid-selection', true, pills[i]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t_appendMobileClasses() {\n\t\tthis.isMobile = true;\n\t\tthis.toggleClass('mobile', true, this.$.multilookup);\n\t\tthis.toggleClass('mobile', true, this.$.selectedContainer);\n\t\tthis.toggleClass('mobile', true, this.$.lookupContainer);\n\t\tthis.toggleClass('mobile', true, this.$.resultsTable);\n\t}\n\n\tremoveItem(e) {\n\t\tthis.splice('selectedItems', Polymer.dom(e.target).parentNode.dataIndex, 1);\n\t\tdelete this.selectedIdsByItems[Polymer.dom(e.target).parentNode.dataValue];\n\t}\n\n\tselectRow(e) {\n\t\tlet selectedItem = this.results[e.currentTarget.index];\n\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\tthis._addItem(selectedItem);\n\t\t} else {\n\t\t\tthis._animateDuplicate(selectedItem);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.selectedItems = [];\n\t\tthis.selectedIdsByItems = {};\n\t}\n\n}\n\nPolymer( MultiLookup );","export class Pagination {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pagination';\n\t\tthis.properties = {\n\t\t\tpageIndex: { // the current page the pagination widget is on\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tpageSize: Number, // the number of items per page\n\t\t\tnumItems: Number // the number of total items\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['setNumberOfPages(pageSize, numItems)', 'setPageWindow(pageIndex, pageSize, numItems)', 'setNextDisabled(pageIndex, numPages)', 'setPreviousDisabled(pageIndex)', 'setPageNum(pageIndex)']\n\t}\n\n\tnext() {\n\t\tthis.pageIndex++;\n\t\tthis.firePageEvent('next');\n\t}\n\n\tprevious() {\n\t\tthis.pageIndex--;\n\t\tthis.firePageEvent('previous');\n\t}\n\n\tsetNumberOfPages() {\n\t\tthis.numPages = Math.ceil(this.numItems / this.pageSize);\n\t}\n\n\tsetPageWindow() {\n\t\tlet start = this.pageIndex * this.pageSize;\n\t\tlet end = start + this.pageSize;\n\t\tif(end >= this.numItems)\n\t\t\tend = this.numItems;\n\t\tthis.pageWindow = [start, end];\n\t}\n\n\tsetNextDisabled() {\n\t\tthis.nextDisabled = this.pageIndex === (this.numPages - 1);\n\t}\n\n\tsetPreviousDisabled() {\n\t\tthis.previousDisabled = this.pageIndex === 0;\n\t}\n\n\tsetPageNum() {\n\t\tthis.pageNum = this.pageIndex + 1;\n\t}\n\n\tfirePageEvent(direction) {\n\t\tthis.fire('pagination-changed', {direction: direction, page: this.pageNum, index: this.pageIndex, window: this.pageWindow});\n\t}\n}\n\nPolymer(Pagination);","import {AppContext} from 'common/core/AppContext.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {Page} from 'common/core/Page.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\n\n/**\n * SearchBar is a component providing an input element.\n * Uses are:\n *        When 2+ characters are entered products will be searched and shown below the input element\n *        When a product in that list is selected an event is fired with that product from the searchModel\n *            Event:    sb-search-item-selected\n *        When enter is pressed or the search button is clicked a search is performed and en event with the searchModel results are fired\n *            Event:    sb-search-invoked\n */\nexport class SearchBar {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-bar';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlimit: { //the limit to apply on search\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 5\n\t\t\t},\n\t\t\tvalue: { //the value in the search bar\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tnotify: true //notify is true so that callers of this can bind in values\n\t\t\t},\n\t\t\tsearchedValue: { //the value last searched\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabel: { //what value(s) to show in the list of results\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tquote: Object, //the quote is needed for search so that we can at minimum get the Pricebook on the backend\n\t\t\tsearchService: String, //backend API to call on search,\n\t\t\tactionId: String, // the id of the action/button clicked.  used on the server\n\t\t\tsearchResultCallback: Function, //callback for handling the typeahead results\n\t\t\tshowResetButton: { //show/hide the reset button\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPlaceholder(i18n)'\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsearcher: Object\n\t\t}, Page.properties);\n\t}\n\n\t/**\n\t * Observers:\n\t *        valueChanged: expected to run when the value in the input is changed\n\t */\n\tget observers() {\n\t\treturn [\n\t\t\t'valueChanged(value)',\n\t\t\t'realign(reposition, isMobile)'\n\t\t];\n\t}\n\n\t/**\n\t * Component is ready so we can add event listeners\n\t */\n\tready() {\n\t\tthis.$.typeahead.addEventListener('enter-without-selection', this.search.bind(this));\n\t\tthis.$.typeahead.addEventListener('selected-item-changed', this.handleItemSelected.bind(this));\n\t\tthis.$.typeahead.showAllResults = true; //we want to show all results, not just ones containing the search text\n\t\tthis.$.typeahead.itemsCallback = this.typeAheadCallback.bind(this);\n\t\tthis.localizer = new LocalizeFields(this.fieldPrefix); //provides the ability to localize a SearchModel\n\t}\n\n\t/**\n\t * Value changed observer\n\t */\n\tvalueChanged() {\n\t\tif(this.value === undefined || this.value === '') //special case for when nil or undefined, turn the button on\n\t\t{\n\t\t\tthis.fire('sb-type-clear');\n\t\t\tthis.toggleClass('disabled', false, this.$.search); //enable\n\t\t}\n\t\telse\n\t\t\tthis.toggleClass('disabled', this.isSearchValid() === false, this.$.search); //enabled/disabled search button\n\t}\n\n\trealign() {\n\t\tif (this.isMobile)\n\t\t\tthis.toggleClass('shiftRight', true, this.$.buttons);\n\t}\n\n\t/**\n\t * Fire search event with the selected item and the value\n\t * @param e\n\t */\n\thandleItemSelected(e) {\n\t\tthis.value = e.detail.value.Name;\n\t\tif (this.value === undefined) //when the cancel icon is clicked, this is triggered and the value is undefined\n\t\t\treturn;\n\t\tthis.fire('sb-search-item-selected', {\n\t\t\titem: this.getSearchResultRow(e.detail.value.Id),\n\t\t\tsearchValue: this.value\n\t\t});\n\t}\n\n\t/**\n\t * @param enabled - enables/disabled the reset button\n\t */\n\ttoggleResetButton(enabled) {\n\t\tif (this.showResetButton === true)\n\t\t\tthis.toggleClass('disabled', enabled === false, this.$$('#reset')); //enabled/disabled reset button\n\t}\n\n\t/**\n\t * Fires an event when the reset button is clicked\n\t */\n\treset() {\n\t\tthis.fire('sb-search-reset-clicked');\n\t}\n\n\t/**\n\t * Handle enter keypress or search button pressed\n\t * Performs a search with no LIMIT\n\t * Fires an event with the searchModel for that search\n\t */\n\tsearch() {\n\t\tif (this.isSearchValid() === false) {\n\t\t\tif (this.value === '' || this.value === undefined) //fire an event when search is run and there is a nil value\n\t\t\t\tthis.fire('sb-search-nil-search-invoked');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.spinner = true;\n\t\tthis.blur(); //don't need to show the typeAhead results\n\t\tthis.searchedValue = this.value; //store the value that was searched\n\t\tthis.serviceCallout(null).then(function (result) {\n\t\t\tthis.fire('sb-search-invoked', {\n\t\t\t\tsearchModel: result,\n\t\t\t\tsearchValue: this.value\n\t\t\t});\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t *\n\t * @param productId to search for\n\t * searches for the result within the searchModel and returns it\n\t * @returns {Object}\n\t */\n\tgetSearchResultRow(productId) {\n\t\tlet searchModel = Object.assign({}, this.mostRecentResults);\n\t\tfor (let result of searchModel.results)\n\t\t\tif (result.record.Product2Id === productId)\n\t\t\t\treturn result;\n\t}\n\n\t/**\n\t * This will call the server with a search and parse the results into an array\n\t * @returns {Promise}\n\t */\n\ttypeAheadCallback() {\n\t\treturn new Promise(function (resolve) {\n\t\t\tif (this.searchService === undefined || this.quote === undefined || this.isSearchValid() === false)\n\t\t\t\treturn;\n\n\t\t\tthis.serviceCallout(this.limit).then(function (result) {\n\t\t\t\tthis.mostRecentResults = result;\n\t\t\t\tif (typeof this.searchResultCallback === 'function')\n\t\t\t\t\treturn this.searchResultCallback(this.parseResults(result));\n\n\t\t\t\tresolve(this.parseResults(result));\n\t\t\t}.bind(this));\n\t\t}.bind(this))\n\t}\n\n\t/**\n\t * Returns the filter context from the searcher object\n\t * @returns {Object} filterContext\n\t */\n\tgetFilterContextFromSearcher() {\n\t\treturn this.searcher ? this.searcher.getFilterContext() : {};\n\t}\n\n\t/**\n\t * Returns a DataBuilder object that provides context for the server callback\n\t * @returns {Object} DataBuilder\n\t */\n\tbuildContext(limit) {\n\t\treturn new DataBuilder()\n\t\t\t.addObject('filterContext', this.getFilterContextFromSearcher(), undefined, undefined, true)\n\t\t\t.add('searchContext', this.getSearchContext())\n\t\t\t.add('resultLimit', limit)\n\t\t\t.add('pageNumber', null)\n\t\t\t.add('actionId', this.actionId)\n\t\t\t.addObject('quote', this.quote.record)\n\t\t\t.build();\n\t}\n\n\t/**\n\t * This calls out to the server searching using SOSL returning a searchModel\n\t * @param limit to apply to the SOSL query\n\t * @returns {Promise}\n\t */\n\tserviceCallout(limit) {\n\t\treturn new Promise(function (resolve) {\n\t\t\tthis.$.service.client.load(\n\t\t\t\tthis.prefix,\n\t\t\t\tthis.searchService,\n\t\t\t\tnull,\n\t\t\t\tthis.buildContext(limit)\n\t\t\t).then(function (result) {\n\t\t\t\tresolve(this.localizer.localizeSearchModel(result)); //resolve a localized SearchModel\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Parses a searchModel and extracts the results.  Then formats them for display\n\t * @param searchModel\n\t * @returns {Array}\n\t */\n\tparseResults(searchModel) {\n\t\tlet results = [],\n\t\t\tsearchValue = this.getSearchContext();\n\t\tif (searchValue === null) //if a user were to type in a search, but clear it out before the server returned, this would throw an error\n\t\t\treturn results;\n\t\tfor (let result of searchModel.results) {\n\t\t\tlet productRecord = result.record.Product2;\n\t\t\t//if the text in the search bar matches part of the product name we make that part of the name bold\n\t\t\tlet reg = new RegExp(searchValue, 'i');\n\t\t\tlet match = productRecord.Name.match(reg);\n\t\t\tif (match) {\n\t\t\t\tlet first = productRecord.Name.substring(0, match.index);\n\t\t\t\tlet inner = productRecord.Name.substring(match.index, match.index + searchValue.length);\n\t\t\t\tlet second = productRecord.Name.substring(match.index + searchValue.length);\n\t\t\t\tproductRecord.DisplayName = first + '<b>' + inner + '</b>' + second;\n\t\t\t}\n\t\t\telse\n\t\t\t\tproductRecord.DisplayName = productRecord.Name;\n\n\t\t\tresults.push(productRecord);\n\t\t}\n\t\treturn results;\n\t}\n\n\t/**\n\t * @returns {String}\n\t */\n\tget prefix() {\n\t\treturn this.app.org.prefix;\n\t}\n\n\t/**\n\t * @returns {String}\n\t */\n\tget fieldPrefix() {\n\t\treturn this.app.org.prefix === undefined ? '' : this.app.org.prefix + '__';\n\t}\n\n\t/**\n\t * Returns the string to search on\n\t * @returns {Object}\n\t */\n\tgetSearchContext() {\n\t\treturn this.isSearchValid() === true ? this.value : null;\n\t}\n\n\t/**\n\t * SOSL requires a minimum of 2 characters to search\n\t * *, ?, (, ), and \" \" are not valid search characters\n\t * @returns {boolean}\n\t */\n\tisSearchValid() {\n\t\tif (this.value === undefined)\n\t\t\treturn false;\n\t\tlet value = this.value\n\t\t\t.replace(/ /g, \"\")\n\t\t\t.replace(/\\*/g, \"\")\n\t\t\t.replace(/\\?/g, \"\")\n\t\t\t.replace(/\\(/g, \"\")\n\t\t\t.replace(/\\)/g, \"\");\n\t\treturn value.length > 1;\n\t}\n\n\tgetPlaceholder() {\n\t\tif(this.i18n && typeof this.i18n.l === 'function')\n\t\t\treturn this.i18n.l('Search Products');\n\t\treturn 'Search Products';\n\t}\n}\n\nPolymer(SearchBar);","/**\n * A RichTextEditor component class.\n */\nexport class RichTextEditor {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-rte';\n\t\tthis.properties = {\n\t\t\t/** The rich text value, i.e. a string of HTML */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t};\n\t}\n\n\tattached() {\n\t\tif (this.renderReadOnly) {\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\tfocus() {\n\t\tthis.fire('iron-signal', {name : 'sb-open-rte-dialog', data : {rte: this, value: this.value}});\n\t}\n\n}\n\nPolymer( RichTextEditor );\n","export class SearchBarDialog {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-bar-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: String,\n\t\t\tcols: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\tcolsDisplay: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: ['DisplayName']\n\t\t\t},\n\t\t\tresults: Array\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.attachSearchProperties();\n\t\tthis.attachSearchEvents();\n\t}\n\n\tattachSearchProperties() {\n\t\tthis.$.search.searchResultCallback = this.handleSearchResults.bind(this);\n\t}\n\n\tattachSearchEvents() {\n\t\tthis.$.search.addEventListener('sb-search-invoked', this.toggle.bind(this));\n\t\tthis.$.search.addEventListener('sb-search-nil-search-invoked', this.updateSearchResults.bind(this));\n\n\t}\n\n\topen() {\n\t\tthis.$.search.value = this.value; //if search has been cleared on selection screen, reflect that here\n\t\tif (this.value === '')\n\t\t\tthis.results = [];\n\t\tthis.toggle();\n\t\tthis.$.search.$.typeahead.focus();\n\t}\n\n\tclose() {\n\t\tthis.blur();\n\t\tthis.toggle();\n\t}\n\n\ttoggle() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\thandleSearchResults(results) {\n\t\tthis.results = results;\n\t}\n\n\tupdateSearchResults() {\n\t\tlet displayResults = [];\n\t\tfor (let result of this.results) {\n\t\t\tif (result.Name === this.$.search.value)\n\t\t\t\tdisplayResults.push(result);\n\t\t}\n\t\tthis.results = displayResults;\n\t}\n\n\tmobileSelection(e) {\n\t\tlet row = Polymer.dom(e).localTarget,\n\t\t\tsearchValue = row.getAttribute('data-name');\n\t\tthis.$.search.value = searchValue;\n\t\tlet rowId = row.getAttribute('data-id');\n\t\tthis.fire('sb-search-item-selected', {\n\t\t\titem: this.$.search.getSearchResultRow(rowId),\n\t\t\tsearchValue: searchValue\n\t\t});\n\n\t\tsetTimeout(function () {\n\t\t\tthis.toggle();\n\t\t}.bind(this), 350);\n\t\tthis.updateSearchResults();\n\t}\n\n\tclearSearchResults() {\n\t\tthis.results = [];\n\t}\n}\n\nPolymer(SearchBarDialog);","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Select {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-select';\n\t\tthis.properties = {\n\t\t\tvalue: { // the value of the selected option\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\toptions: Array, // array of objects with the keys 'value' and 'label'\n\t\t\tisRequired: { // true if this is a required field\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tnoneLabel: { // if not required, value of the first option that represents no selection\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tmultiSelect: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_multiSelectChanged'\n\t\t\t},\n\t\t\tsize: Number,\n\t\t\t_multiple: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setMultiple(multiSelect)'\n\t\t\t},\n\t\t\t_options: Array\n\t\t};\n\t}\n\n\t_multiSelectChanged(newVal, oldVal) {\n\t\tif (oldVal === undefined && newVal) {\n\t\t\tthis.buildOptions();\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['buildOptions(options, isRequired)', 'setSelected(value, _options)']\n\t}\n\n\tbuildOptions() {\n\t\tif (!this.options) {\n\t\t\treturn;\n\t\t}\n\t\tlet noneSelected = true;\n\t\tlet options = [];\n\t\tlet values = this._getValues();\n\t\tfor (let i = 0, l = this.options.length; i < l; i++) {\n\t\t\tlet option = this.options[i];\n\t\t\tlet selected = values.indexOf(option.value.toString()) !== -1;\n\t\t\tnoneSelected = noneSelected && !selected;\n\t\t\toptions.push( { value: option.value, label: option.label, selected: selected } );\n\t\t}\n\n\t\tif (noneSelected && values.length > 0) {\n\t\t\tfor(let val of values)\n\t\t\t\toptions.push({ value: val, label: val, selected: true });\n\t\t\tnoneSelected = false;\n\t\t}\n\n\t\tif ((noneSelected && !this.multiSelect) || !this.isRequired)\n\t\t\toptions = [ { value: '', label: this.noneLabel, selected: noneSelected } ].concat(options);\n\n\t\tif (AppContext.isIE()) {\n\t\t\tlet select = Polymer.dom(this.querySelector('.myselect'));\n\t\t\tlet childNodes = select.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tselect.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tfor (let j = 0, len = options.length; j < len; j++) {\n\t\t\t\tthis._createOptionElements(this.querySelector('.myselect'), options[j]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._options = options;\n\t\t}\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option.label;\n\t\toptionEl.value = option.value;\n\t\toptionEl.selected = option.selected;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\tsetSelected() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tlet values = this._getValues();\n\t\tfor(let i = 0, l = this._options.length; i < l; i++) {\n\t\t\tthis._options[i].selected = values.indexOf(this._options[i].value.toString()) !== -1;\n\t\t\tif(this.querySelector('.myselect').options[i])\n\t\t\t\tthis.querySelector('.myselect').options[i].selected = values.indexOf(this.querySelector('.myselect').options[i].value.toString()) !== -1;\n\t\t}\n\t}\n\n\tchange() {\n\t\tlet options = this.querySelector('.myselect').options;\n\t\tlet value = null;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (!AppContext.isIE())\n\t\t\t\tthis._options[i].selected = options[i].selected;\n\n\t\t\tif (!options[i].selected)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.multiSelect && value != null)\n\t\t\t\tvalue += (';' + options[i].value);\n\t\t\telse\n\t\t\t\tvalue = options[i].value;\n\t\t}\n\t\tthis.internal = true;\n\t\tthis.value = value;\n\t\tthis.internal = false;\n\n\t\tthis.fire('change', { value: this.value } );\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.querySelector('.myselect').focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_setMultiple() {\n\t\treturn this.multiSelect ? true : undefined;\n\t}\n\n\t_getValues() {\n\t\treturn Select.getValues(this.value, this.multiSelect);\n\t}\n\n\tstatic getValues(value, multiSelect) {\n\t\tif(value != null && value !== '')\n\t\t\treturn multiSelect ? value.split(';') : [value.toString()];\n\t\treturn [];\n\t}\n}\n\nPolymer(Select);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Textarea {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-textarea';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed'\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.textarea.focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t}\n\n\thighlight() {\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.$.textarea.setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.$.textarea.value = this.value;\n\n\t\tthis.fire('sb-textarea-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Textarea);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst wildCards = new RegExp('[*_%]+', 'g');\nlet resultLimit = 10; // first 10 matching items\nimport {Html} from 'common/layout/sb-html/Html.js';\n\n\nexport class Typeahead {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-typeahead';\n\n\t\tthis.properties = {\n\t\t\t// users can give items as input or provide a callback that sets items. An optional debounce parameter with\n\t\t\t// callback ensures that the callback is called only after some delay in millis. Default value for debounce is 1s.\n\t\t\titems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\titemsCallback: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdebounceDelay: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 300\n\t\t\t},\n\t\t\tselectedItem:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titemsList: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserver: 'itemsListChanged',\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('labels') || ['label'];\n\t\t\t\t}\n\t\t\t},\n\t\t\tlabelValue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tdelimiter: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('delimiter') || '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tsavedLabelValue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tinvalidLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasList: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_calculateListPosition'\n\t\t\t},\n\t\t\thasLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toptionIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tclearAfterSelection: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trevertOnEscape: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcalculateListPosition: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListNoSuggestion: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideInput: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowLeftSearchIcon: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tnoSearchItem: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tdisjointLabel: Boolean,\n\t\t\tshowAllResults: { //determines if items not containing the value should be shown\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\n\t\tthis.observers = ['itemsChanged(items, labels)', 'selectedItemChanged(selectedItem, value)', 'setStyles(showLeftSearchIcon, hideCancelIcon)'];\n\t}\n\n\tready() {\n\t\tthis.$.itemLabel.addEventListener('focus', this._directInputFocus.bind(this));\n\t\tthis.$.itemLabel.addEventListener('blur', this._directInputBlur.bind(this));\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tsetStyles() {\n\t\tif (this.showLeftSearchIcon)\n\t\t\tthis.toggleClass('leftSearch', true, this.$.itemLabel)\n\t\tif (!this.hideCancelIcon)\n\t\t\tthis.toggleClass('cancelIcon', true, this.$.itemLabel)\n\t}\n\n\titemsChanged() {\n\t\tif(this.items.length)\n\t\t\tthis.itemsList = this.updateItemsList();\n\t}\n\n\tselectedItemChanged() {\n\t\tif (this.selectedItem) {\n\t\t\tlet md = this.selectedItem.__md__;\n\t\t\tlet clearAfterSelection = md ? md.clearAfterSelection : false;\n\n\t\t\tthis.valueAttr = this.value ? this.value : 'value';\n\t\t\tthis.labelValue = this.selectedItem[this.valueAttr];\n\n\t\t\tif (this.clearAfterSelection || clearAfterSelection) {\n\t\t\t\tthis.selectedItem = '';\n\t\t\t\tthis.items = this.itemsList = [];\n\t\t\t}\n\t\t\tif(!this.originalSelected)\n\t\t\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem));\n\t\t}\n\t}\n\n\titemsListChanged() {\n\t\tPolymer.dom.flush(); // need to update DOM before updating innerHTML of the new elements on the list\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tif(!options) return;\n\t\tlet numOfOptions = options.length;\n\t\tlet numOfLabels = this.labels.length;\n\t\tif ( numOfOptions > 0 ) {\n\t\t\tthis.optionIndex = -1; // highlights the characters\n\t\t\tfor ( let i = 0; i < numOfOptions; i++ ) { // highlight matching characters in the label\n\t\t\t\tlet item = this.itemsList[i],\n\t\t\t\t\thtml = '';\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet label = this.labels[j],\n\t\t\t\t\t\tdelimiter = ( j===0 ) ? '' : this.delimiter,\n\t\t\t\t\t\tlabelValue = item[label];\n\t\t\t\t\thtml += delimiter + labelValue;\n\t\t\t\t}\n\t\t\t\toptions[i].innerHTML = Html.sanitizeHtmlText(html);\n\t\t\t\tPolymer.dom(options[i]).setAttribute('data-label', html)\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedItemValue() {\n\t\treturn this.selectedItem ? this.selectedItem[this.valueAttr] : '';\n\t}\n\n\tclear() {\n\t\tthis.hide();\n\t\tthis.updateItem({}, true);\n\t\tthis.fire('sb-type-clear');\n\t}\n\n\thide() {\n\t\tthis.hideList();\n\t\tthis.invalidLabel = false;\n\t\tthis.optionIndex = -1;\n\t}\n\n\tcloneItem(item) {\n\t\tlet clone = {},\n\t\t\tkeys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tfor ( let i = 0; i < len; i++ ) {\n\t\t\tlet key = keys[i];\n\t\t\tclone[key] = item[key];\n\t\t}\n\t\treturn clone;\n\t}\n\n\tupdateItem(item, forceSuggestOnFocus) {\n\t\t//update selectedItem\n\t\tlet keys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tlet selectedItem = {};\n\t\tfor ( let i=0; i < len; i++) {\n\t\t\tlet key = keys[i];\n\t\t\tselectedItem[key] = item[key] !== undefined ? item[key] : '';\n\t\t}\n\t\tthis.selectedItem = selectedItem;\n\t\t//update value in the input box\n\t\tlet labelValue = '',\n\t\t\tnumOfLabels = this.labels.length;\n\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\tlet delimiter = ( j===0 ) ? '' : this.delimiter;\n\t\t\tlet selectedLabel = this.selectedItem[this.labels[j]];\n\t\t\tif(selectedLabel)\n\t\t\t\tlabelValue += delimiter + selectedLabel;\n\t\t}\n\n\t\tlet md = this.selectedItem.__md__;\n\t\tif (!this.disjointLabel) //If the displayed data is different from the backend data, don't replace displayed data\n\t\t\tthis.labelValue = md && !md.clearAfterSelection && md.searchValue !== undefined ? md.searchValue : labelValue;\n\n\t\tthis.clearSelection();\n\t\tthis.focusOrBlurAfterSelection(this.selectedItem, forceSuggestOnFocus);\n\t}\n\n\tsubmitItem(e) {\n\t\tlet item = e.model.item;\n\t\tthis.updateItem(item);\n\t\tthis.hide();\n\t\tthis.focusOrBlurAfterSelection(item)\n\t}\n\n\tfocusOrBlurAfterSelection(item, forceSuggestOnFocus) {\n\t\tif(!item || !item.__md__ || !item.__md__.noFocusAfterSelection)\n\t\t\tthis.focus(forceSuggestOnFocus);\n\t\telse\n\t\t\tthis.$.itemLabel.blur();\n\t}\n\n\tselectAdjacentItem(keyCode) {\n\t\t// keycode 40 => arrow-down, 38 arrow-up\n\t\tif(!this.itemsList)\n\t\t\treturn;\n\t\tlet len = this.itemsList.length;\n\t\tif ( this.optionIndex >= 0 && this.optionIndex < len ) {\n\t\t\tthis.$.selector.children[this.optionIndex].removeAttribute( 'selected' );\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === 0 ? len - 1 : this.optionIndex - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === len - 1 ? 0 : this.optionIndex + 1;\n\t\t\t}\n\t\t} else if (this.optionIndex === -1) {\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = len - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = 0;\n\t\t\t}\n\t\t}\n\t\tthis.$.selector.children[this.optionIndex].setAttribute( 'selected', '' );\n\t}\n\n\tupdateItemsList() {\n\t\tif (!this.searchLabels)\n\t\t\tthis.searchLabels = this.labels;\n\t\tif(this.showAllResults === true) //don't parse through items, just show them all\n\t\t\treturn this.items;\n\t\tlet result = [],\n\t\t\thighlighted = false;\n\t\tif (this.showListNoSuggestion || this.labelValue) {\n\t\t\tlet labelValue = this.labelValue || '';\n\t\t\tlet searchLabel = labelValue.replace(/\\+/g, '\\\\+').replace(/\\\\/g, '\\\\\\\\').replace( wildCards, '.+'), //capture wild card characters (1 or more)\n\t\t\t\tsearchText = new RegExp( searchLabel, 'i' );\n\n\t\t\tlet numOfItems = this.items.length,\n\t\t\t\tnumOfLabels = this.searchLabels.length;\n\t\t\tfor ( let i = 0; i < numOfItems; i++ ) {\n\t\t\t\tlet item = this.items[i],\n\t\t\t\t\tclone = this.cloneItem(item); // clone item to preserve original object\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet itemLabel = item[this.searchLabels[j]];\n\t\t\t\t\tif ( itemLabel && (this.showListNoSuggestion || searchText.test(itemLabel)) ) {\n\t\t\t\t\t\tlet label = '_' + this.searchLabels[j]; // create a new label for internally storing the highlighted html text\n\t\t\t\t\t\t\tclone[label] = itemLabel.replace( searchText, '<span style=\"font-weight:bold;\">$&</span>' );\n\t\t\t\t\t\thighlighted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( highlighted ) {\n\t\t\t\t\tlet showItem = true;\n\t\t\t\t\tfor (let displayLabel of this.labels) {\n\t\t\t\t\t\tif (!clone[displayLabel])\n\t\t\t\t\t\t\tshowItem = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (showItem)\n\t\t\t\t\t\tresult.push(clone);\n\t\t\t\t\thighlighted = false;\n\t\t\t\t}\n\t\t\t\tif ( result.length >= resultLimit ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tsuggest(e) {\n\t\tif(!this.isAttached)\n\t\t\treturn;\n\n\t\tswitch( e.keyCode ) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tthis.$.itemLabel.blur();\n\t\t\t\tif(this.hasList) {\n\t\t\t\t\tif (this.optionIndex === -1){\n\t\t\t\t\t\tif (this.noSearchItem) {\n\t\t\t\t\t\t\tthis.fire('enter-without-selection', {value: this.labelValue});\n\t\t\t\t\t\t\tthis.hideList();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.optionIndex = 0;\n\t\t\t\t\t}\n\t\t\t\t\tthis.updateItem(this.itemsList[this.optionIndex]);\n\t\t\t\t\tthis.noBlur = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.fire('enter-without-selection', {value: this.labelValue});\n\t\t\t\tthis.hide();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif(this.revertOnEscape) {\n\t\t\t\t\tthis.updateItem(this.originalSelected);\n\t\t\t\t\tthis.items = undefined;\n\t\t\t\t\tthis.hideList();\n\t\t\t\t\tthis.clearSelection();\n\t\t\t\t\tthis.fire('sb-type-blur');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\tcase 40: // down arrow - move trough matching list items\n\t\t\t\tthis.selectAdjacentItem( e.keyCode );\n\t\t\t\tbreak;\n\t\t\tcase 9: // tab key\n\t\t\tcase 16: // shift key\n\t\t\t\tbreak;\n\t\t\tdefault: // re-build itemsList\n\t\t\t\tthis.invalidLabel = false;\n\t\t\t\tif(this.itemsCallback) {\n\t\t\t\t\tthis.debounce('itemsCallback', function () {\n\t\t\t\t\t\tlet promise = this.itemsCallback(this.labelValue);\n\t\t\t\t\t\tpromise.then(\n\t\t\t\t\t\t\t(function (items) {\n\t\t\t\t\t\t\t\tif(items && items.length > 0)\n\t\t\t\t\t\t\t\t\tthis.showList();\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tthis.hideList();\n\t\t\t\t\t\t\t\tthis.items = items;\n\t\t\t\t\t\t\t}).bind(this),\n\t\t\t\t\t\t\t(function (error) {\n\t\t\t\t\t\t\t\tconsole.error(error && error.message ? error.message : error);\n\t\t\t\t\t\t\t\tthis.items = []\n\t\t\t\t\t\t\t}).bind(this));\n\t\t\t\t\t}, this.debounceDelay);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.showList();\n\t\t\t\t\tthis.itemsList = this.updateItemsList();\n\t\t\t\t\tif ( this.itemsList.length === 0 ) {\n\t\t\t\t\t\tif ( this.labelValue ) {\n\t\t\t\t\t\t\tthis.invalidLabel = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.hasLabel = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.hasList = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tshowList() {\n\t\tif(this.blurred) {\n\t\t\tthis.hideList();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.showListNoSuggestion || (this.labelValue != null && this.labelValue !== '')) {\n\t\t\tthis.hasList = true;\n\t\t\tthis.hasLabel = true;\n\t\t}\n\t}\n\n\thideList() {\n\t\tthis.hasList = false;\n\t\tthis.hasLabel = false;\n\t}\n\n\tclearSelection() {\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tfor(let option of options)\n\t\t\tthis.toggleAttribute('selected', false, option);\n\t}\n\n\ttabBlur(e) {\n\t\tif(e.keyCode === 9 ) // tab key\n\t\t\tthis.hasList = false;\n\t\tif(e.keyCode === 38) // up arrow\n\t\t\te.preventDefault(); // prevents the movement of the cursor in the text input to the beginning\n\t\tif(e.keyCode === 13 && this.hasList) // enter key\n\t\t\tthis.preventBlur();\n\t\tif(e.keyCode === 27 && !this.revertOnEscape) {\n\t\t\t// FF specific fix to prevent the esc from reverting back last selected value\n\t\t\tsetTimeout(function(labelValue) {\n\t\t\t\tthis.labelValue = labelValue;\n\t\t\t}.bind(this, this.labelValue), 0)\n\t\t}\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.focusDisabled)\n\t\t\treturn;\n\n\t\tthis.focusing = true;\n\t\tthis.$.itemLabel.focus();\n\t\tthis._showListOnFocus(forceSuggest);\n\t\tthis.focusing = false;\n\t}\n\n\tblur(e, force) {\n\t\tif(!force && (this.hasList || this.blurDisabled))\n\t\t\treturn;\n\n\t\tthis.hideList();\n\t\tthis.fire('sb-type-blur');\n\t\tthis.setOriginalSelected();\n\t}\n\n\tsetOriginalSelected() {\n\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem || {}));\n\t}\n\n\tpreventBlur() {\n\t\tthis.noBlur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noBlur = false;\n\t}\n\n\tfocused() {\n\t\tthis.fire('sb-type-focus', { value: this.labelValue } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_calculateListPosition() {\n\t\tif(this.calculateListPosition && this.hasList) {\n\t\t\tlet leftOffset = PageContainer.getContainer().getBoundingClientRect().left;\n\t\t\tlet left = this.$.itemLabel.getBoundingClientRect().left;\n\t\t\tthis.$.selector.style.left = (left - leftOffset) + 'px';\n\t\t}\n\t}\n\n\t_showListOnFocus(forceSuggest) {\n\t\tif(!this.showListOnFocus || this.hideInput || this.hasList)\n\t\t\treturn;\n\n\t\tif(forceSuggest || !this.items || this.items.length === 0)\n\t\t\tthis.suggest({});\n\t\telse\n\t\t\tthis.showList();\n\t}\n\n\t_directInputFocus() {\n\t\tthis.blurred = false;\n\t\tif(!this.focusing)\n\t\t\tthis._showListOnFocus();\n\t}\n\n\t_directInputBlur() {\n\t\tthis.blurred = true;\n\t\tthis.blur(null, !this.noBlur);\n\t}\n}\n\nPolymer( Typeahead );\n","const NOT_GROUPED_NAME = 'Other';\n\nexport class RecordGrouper {\n\n\t/**\n\t * @param groupField the name of the field on the item's record used to group the items by\n\t * @param groupedRecordFields the name (or names) of the field(s) to assign the group value for the dummy item's grouper object (optional)\n\t * @param recordPath if the items to be grouped contain the record, then this is the path from the item to the record (optional)\n\t * @param itemProperties map of item properties to be added to all items when being grouped (optional)\n\t * @param itemPropertiesByGroup map of item properties by group to be added to matching items when being grouped (optional)\n\t * @param groupProperties map of group properties to be added to dummy item group object (optional)\n\t * @param groupCountPath if non nil contains the path in the dummy item group object where the grouped count should be stored (optional)\n\t */\n\tconstructor(groupField, groupedRecordFields, recordPath, itemProperties, itemPropertiesByGroup, groupProperties, groupCountPath, groupFieldType, groupFieldTypePath) {\n\t\tthis.groupField = groupField;\n\t\tif(groupedRecordFields)\n\t\t\tthis.groupedRecordFields = groupedRecordFields.constructor !== Array ? [groupedRecordFields] : groupedRecordFields;\n\t\tthis.recordPath = recordPath;\n\t\tthis.itemProperties = itemProperties;\n\t\tthis.itemPropertiesByGroup = itemPropertiesByGroup;\n\t\tthis.groupProperties = groupProperties;\n\t\tthis.groupCountPath = groupCountPath;\n\t\tthis.groupFieldType = groupFieldType;\n\t\tthis.groupFieldTypePath = groupFieldTypePath;\n\t}\n\n\t/**\n\t * Returns the provided items ordered by groups with an optional item object before each set of grouped items that contains the group details.\n\t *\n\t * @param items the list of objects that needs to be grouped assuming each item is, or contains, the record that contains the group value\n\t */\n\tgroup(items) {\n\t\tlet orderdGroups = [];\n\t\tlet itemsByGroup = {};\n\n\t\t// initialize ordered groups array and group map\n\t\tfor(let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i];\n\n\t\t\t// get the record within the item via its record path, if recordPath is nil then the item is the record\n\t\t\tlet record = this._get(item, this.recordPath);\n\n\t\t\t// determine the group name based on the record's value by that key\n\t\t\tlet group = record[this.groupField];\n\n\t\t\t// treat the record as not grouped if the group value is nil\n\t\t\tlet notGrouped = group === undefined || group === null || group === '';\n\n\t\t\t// ensure the group is a valid string even if not grouped\n\t\t\tgroup = notGrouped ? NOT_GROUPED_NAME : (group + '');\n\n\t\t\t// grab the existing items already organized by the current group\n\t\t\tlet groupedItems = itemsByGroup[group];\n\n\t\t\t// add the group to the groups list the first time the group is encountered\n\t\t\tif(!groupedItems && !notGrouped)\n\t\t\t\torderdGroups.push(group);\n\n\t\t\t// ensure we have a defined groupItems array in case first item in this group\n\t\t\tgroupedItems = groupedItems || [];\n\n\t\t\t// this item is now a groupie to this group, so lets indicate as much\n\t\t\titem.groupie = group;\n\t\t\titem.grouper = null;\n\t\t\tgroupedItems.push(item);\n\t\t\titemsByGroup[group] = groupedItems;\n\n\t\t\tthis._setProperties(item, this.itemProperties);\n\t\t\tthis._setProperties(item, this.itemPropertiesByGroup, group);\n\t\t}\n\n\t\t// if group map contains the non grouped name, then add the non grouped name at the end of the ordered list\n\t\tif(itemsByGroup[NOT_GROUPED_NAME])\n\t\t\torderdGroups.push(NOT_GROUPED_NAME);\n\n\t\treturn this._sortItemsByGroup(orderdGroups, itemsByGroup);\n\t}\n\n\t/**\n\t * Returns an ordered array of items by group with an optional grouper item before each group.\n\t *\n\t * @param orderedGroups the ordered grouped values\n\t * @param itemsByGroup the map that has ordered items by group value\n\t * @private\n\t */\n\t_sortItemsByGroup(orderedGroups, itemsByGroup) {\n\t\tlet response = [];\n\t\tfor(let i = 0, l = orderedGroups.length; i < l; i++) {\n\t\t\tlet group = orderedGroups[i];\n\t\t\tlet items = itemsByGroup[group];\n\t\t\tlet numItems = items.length;\n\t\t\tif(this.groupedRecordFields) {\n\t\t\t\tlet groupItem = { grouper : group, groupie: null };\n\t\t\t\tlet groupRecord = this._get(groupItem, this.recordPath);\n\t\t\t\tfor(let j = 0, ll = this.groupedRecordFields.length; j < ll; j++)\n\t\t\t\t\tgroupRecord[this.groupedRecordFields[j]] = group;\n\t\t\t\tif(this.groupCountPath) {\n\t\t\t\t\tlet groupCount = this._get(groupItem, this.groupCountPath.path);\n\t\t\t\t\tgroupCount[this.groupCountPath.property] = '(' + numItems + ')';\n\t\t\t\t}\n\t\t\t\tif(this.groupFieldType && this.groupFieldTypePath) {\n\t\t\t\t\tlet groupFieldMd = this._get(groupItem, this.groupFieldTypePath.path);\n\t\t\t\t\tgroupFieldMd[this.groupFieldTypePath.property] = group !== NOT_GROUPED_NAME ? this.groupFieldType : 'string';\n\t\t\t\t}\n\t\t\t\tthis._setProperties(groupItem, this.groupProperties);\n\t\t\t\tresponse.push(groupItem);\n\t\t\t}\n\t\t\tresponse = response.concat(items);\n\t\t}\n\t\treturn response;\n\t}\n\n\t_get(obj, path) {\n\t\tif (!path)\n\t\t\treturn obj;\n\n\t\tlet parts = path.split('.');\n\t\tfor (let i = 0, l = parts.length; i < l; i++) {\n\t\t\tif(!obj[parts[i]])\n\t\t\t\tobj[parts[i]] = {};\n\t\t\tobj = obj[parts[i]];\n\t\t}\n\t\treturn obj;\n\t}\n\n\t_setProperties(item, properties, propertiesKey) {\n\t\tif(!properties)\n\t\t\treturn;\n\n\t\tif(propertiesKey) {\n\t\t\tif (!properties[propertiesKey])\n\t\t\t\treturn;\n\t\t\tproperties = properties[propertiesKey];\n\t\t}\n\n\t\tfor(let key in properties)\n\t\t\titem[key] = properties[key];\n\t}\n}","export class FieldHider {\n\n\tconstructor(hidden, toggle) {\n\t\tthis.toggle = toggle;\n\t\tif(typeof hidden === 'boolean')\n\t\t\tthis.hide = { hidden: hidden, type: 'hide' };\n\t\telse if(typeof hidden === 'object')\n\t\t\tthis.hide = { hidden: !!(hidden.hidden), type: hidden.type || 'hide'};\n\t\telse\n\t\t\tthis.hide = { hidden: false, type: 'hide' };\n\t}\n\n\tget hidden() {\n\t\treturn this.hide.hidden;\n\t}\n\n\tget type() {\n\t\treturn this.hide.type;\n\t}\n\n\tapplyTo(field) {\n\t\tlet types = [this.hide];\n\t\tif(this.type === 'hide')\n\t\t\ttypes.push( { hidden: false, type: 'invisible' } );\n\t\telse\n\t\t\ttypes.push( { hidden: false, type: 'hide' } );\n\n\t\tfor(let type of types)\n\t\t\tthis.toggle.toggleClass(type.type, type.hidden, field);\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetHandler {\n\n\tconstructor(fieldSets, desktop, tablet, phone) {\n\t\tthis.fieldSets = fieldSets;\n\t\tthis.desktopFields = {name: desktop};\n\t\tif(tablet)\n\t\t\tthis.tabletFields = {name: tablet};\n\t\tif(phone)\n\t\t\tthis.phoneFields = {name: phone};\n\t}\n\n\tgetByViewport(viewport) {\n\t\tif(viewport && viewport.isPhone())\n\t\t\treturn this._getPhoneFieldSet();\n\n\t\tif(viewport && viewport.isTablet())\n\t\t\treturn this._getTabletFieldSet();\n\n\t\treturn this._getDesktopFieldSet();\n\t}\n\n\t_getPhoneFieldSet() {\n\t\tlet fieldSet = this.phoneFields ? this.fieldSets[this.phoneFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getTabletFieldSet();\n\n\t\tthis.phoneFields.fields = fieldSet;\n\t\treturn this.phoneFields;\n\t}\n\n\t_getTabletFieldSet() {\n\t\tlet fieldSet = this.tabletFields ? this.fieldSets[this.tabletFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getDesktopFieldSet();\n\n\t\tthis.tabletFields.fields = fieldSet;\n\t\treturn this.tabletFields;\n\t}\n\n\t_getDesktopFieldSet() {\n\t\tthis.desktopFields.fields = this.fieldSets[this.desktopFields.name];\n\t\treturn this.desktopFields;\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Actions {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-actions';\n\t\tthis.properties = {\n\t\t\trowActions: Array,\n\t\t\t/** position - determine the component's position */\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'left'\n\t\t\t},\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** viewport - to determine what viewport it is */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'disableActions(data.disabledData.disabled)'\n\t\t];\n\t}\n\n\t/**\n\t * To initialize some values in the component\n\t *\n\t */\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tshouldDisable(index) {\n\t\t// Sorting table rows causes this to reevaluate and throw an error if the length of rowActions are unequal\n\t\tif (!this.data || !this.rowActions || !this.rowActions[index])\n\t\t\treturn;\n\t\treturn this.rowActions[index].title == 'Delete' && ((this.data.required && !this.data.addedManually) || (!!this.data.disabledData && this.data.disabledData.disabled));\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To attach the tapEvent which is defined from the caller\n\t *\n\t * @param e\n\t */\n\ttapEvent(e) {\n\t\tif (this.rowActions[e.currentTarget.dataIndex].onTapFunction && !this.shouldDisable(e.currentTarget.dataIndex)) {\n\t\t\tthis.rowActions[e.currentTarget.dataIndex].onTapFunction.bind(this)();\n\t\t}\n\t}\n\n\t_isVisible(invisible) {\n\t\treturn invisible ? 'visibilityHidden' : '';\n\t}\n\n\tdisplayTitle(action, index) {\n\t\treturn this.shouldDisable(index) ? 'Disabled' : this.i18n.l(action.title);\n\t}\n\n\t_isDisabled(index) {\n\t\treturn this.shouldDisable(index) ? 'disabled' : '';\n\t}\n\n\tdisableActions() {\n\t\tif (!this.$$('.sb-action-icon') || !this.rowActions)\n\t\t\treturn;\n\t\tfor (let i = 0; i < this.rowActions.length; i++) {\n\t\t\tthis.toggleClass('disabled', this.shouldDisable(i), this.$$('#_' + i));\n\t\t}\n\t}\n\n\t_configurationRequired(iconTitle) {\n\t\tif(!this.isMobile || !!this.data.configured) {\n\t\t\treturn '';\n\t\t}\n\n\t\tfor(let i = 0; i < this.rowActions.length; i++) {\n\t\t\tif(iconTitle === 'Configure' && this.rowActions[i].configurationRequired) {\n\t\t\t\treturn 'configurationRequired';\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Actions );","export class Badge {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-badge';\n\n\t\tthis.properties = {\n\t\t\tfor: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: '_changedFor'\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: '_changedLabel'\n\t\t\t}\n\t\t}\n\t}\n\n\tget target() {\n\t\tvar ownerRoot = this.parentNode;\n\t\tvar target;\n\n\t\tif (this.for) {\n\t\t\ttarget = Polymer.dom(ownerRoot).querySelector('#' + this.for);\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tattached() {\n\t\tthis._updateTarget();\n\t\tthis._setVisibility();\n\t}\n\n\t_setVisibility() {\n\t\tif (!this.label && !this.getAttribute(\"hidden\")) {\n\t\t\tthis.setAttribute(\"hidden\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"hidden\");\n\t\t}\n\t}\n\n\t_updateTarget() {\n\t\tthis._target = this.target;\n\t\tthis.updatePosition();\n\t}\n\n\tattributeChanged(name) {\n\t\tif (name === 'hidden') {\n\n\t\t}\n\t}\n\n\t_changedFor() {\n\t\tif (!this.isAttached) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateTarget();\n\t}\n\n\t_changedLabel() {\n\t\tthis.setAttribute('aria-label', this.label);\n\t\tthis._setVisibility();\n\t}\n\n\tupdatePosition() {\n\t\tvar targetRect, thisRect;\n\n\t\tif (!this._target) {\n\t\t\treturn;\n\t\t}\n\n\t\ttargetRect = this._target.getBoundingClientRect();\n\t\tthisRect   = this.getBoundingClientRect();\n\n\t\tvar top = thisRect.top - targetRect.top;\n\t\tthis.style.top = 0 - (top + targetRect.height / 2) + \"px\";\n\n\t\tvar left = (targetRect.right - thisRect.left) + 1;\n\t\tthis.style.left = left + \"px\";\n\t}\n}\n\nPolymer(Badge);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class Dialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dialog';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmodal: {\n\t\t\t\t// when set to true, it will add a mask when dialog is toggled on\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_hideHeader'\n\t\t\t},\n\t\t\tappendedClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tcancelText: {\n\t\t\t\tType: String,\n\t\t\t\tvalue: 'Cancel'\n\t\t\t},\n\t\t\tcloseDialog: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-dialog'\n\t\t\t},\n\t\t\thideCloseIcon: { //controls if the X close icon should show on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelButton: { //controls the Cancel button on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif (PageContainer.getViewport())\n\t\t\t\t\t\treturn PageContainer.getViewport().isMobile() ? true : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tmobileDropDown: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttapDialog: String, // Event fired when dialog is tapped (optional)\n\t\t\tignoreMaskTap: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\tready() {\n\t\tif (this.appendedClass)\n\t\t\tthis.$$('.sbDialog').classList.add(this.appendedClass);\n\t\tif (this.mobile) {\n\t\t\tthis._appendMobileClasses();\n\t\t\tPolymer.dom(this).observeNodes(function() {\n\t\t\t\tlet buttons = Polymer.dom(this).querySelectorAll('paper-button');\n\t\t\t\tlet title = this.$$('#title');\n\t\t\t\tif (buttons.length === 0) {\n\t\t\t\t\tlet title = this.$$('#title');\n\t\t\t\t\tthis.toggleClass('no-buttons', true, title);\n\t\t\t\t} else {\n\t\t\t\t\tthis.mobileDropDown = buttons.length > 1 ? true : false;\n\t\t\t\t\tlet mobileButtons = this.$$('#mobileButtons');\n\t\t\t\t\tlet dropDownButton = this.$$('#drop-down-button');\n\t\t\t\t\tthis.toggleClass('no-buttons', false, title);\n\t\t\t\t\tthis.toggleClass('drop-down-menu', this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('single-button', !this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('hidden', !this.mobileDropDown, dropDownButton);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.toggleClass('is-ie', AppContext.isIE(), this.$.footer);\n\t}\n\n\t_appendMobileClasses() {\n\t\t// adds class mobile to style the component if the format is mobile\n\t\tthis.toggleClass('mobile', true, this.$$('.sbDialog'));\n\t\tlet children = Polymer.dom(this).children,\n\t\t\tnumChildren = children.length;\n\t\tfor (let i=0; i < numChildren; i++) {\n\t\t\tthis.toggleClass('mobile', true, children[i]);\n\t\t}\n\t}\n\n\ttoggle() {\n\t\tthis.show = !this.show;\n\t\tif (this.show) {\n\t\t\tthis.fire('sb-open-dialog');\n\t\t}\n\t}\n\n\topen() {\n\t\tthis.show = true;\n\t}\n\n\tclose() {\n\t\tthis.show = false;\n\t}\n\n\ttoggleMenu() {\n\t\tlet dropDownMenu = this.$$('.drop-down-menu');\n\t\tif (dropDownMenu && dropDownMenu.classList.contains('open'))\n\t\t\tthis.toggleClass('open', false, dropDownMenu);\n\t\telse\n\t\t\tthis.toggleClass('open', true, dropDownMenu);\n\t}\n\n\tonCloseDialog() {\n\t\tthis.fire( 'iron-signal', { name: 'sb-panel-closed' });\n\t\t// pass in the event name with attr 'close-dialog' for the message you want to fire to close the dialog\n\t\tthis.fire(this.closeDialog);\n\t}\n\n\tmaskTapped() {\n\t\tif (!this.ignoreMaskTap)\n\t\t\tthis.onCloseDialog();\n\t}\n\n\ttapEvent() {\n\t\tif (this.tapDialog) {\n\t\t\tthis.fire(this.tapDialog);\n\t\t}\n\t}\n\n\t/***\n\t *\n\t * Adjust the date picker so that it can display under the date picker input box\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer;\n\t\tlet datepicker = e.detail.datepicker;\n\t\tlet content = this.$.content;\n\n\t\tdatepicker.style.position = 'fixed';\n\t\tlet dateContainerBoundingClientRect = dateContainer.getBoundingClientRect();\n\t\tlet contentBoundingClientRect = content.getBoundingClientRect();\n\n\t\tif (AppContext.isIE()) {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left - contentBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height - this.$.header.getBoundingClientRect().top + 1 + 'px';\n\t\t}\n\t}\n\n\t_hideHeader() {\n\t\tthis.$.header.setAttribute('hidden', 'true');\n\t}\n}\n\nPolymer( Dialog );","import {AppContext} from '../../core/AppContext.js';\n\nexport class Div {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-div';\n\t\tthis.properties = {\n\t\t\tvalue: String,\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_setLabel(value)'\n\t\t\t}\n\t\t}\n\t}\n\n\t// Refer to work record W-3821512\n\t// Polymer binding cannot dereference Japanese unicode characters e.g. {{data.商品コード}}, so manually clean it up here\n\t// Track polymer issue here: https://github.com/Polymer/polymer/issues/4723\n\t_setLabel() {\n\t\tlet label = this.value;\n\t\tif (AppContext.user.lang === 'ja' && label)\n\t\t\tlabel = label.replace('{{data.','').replace('}}','');\n\t\treturn label;\n\t}\n}\n\nPolymer(Div);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class FieldItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldData(item, model)', '_dataChanged(data, item)'];\n\t}\n\n\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tthis.md = this.model[this.item];\n\t\tthis.label = this.md.label;\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\tthis.$.field.editing = this.md.updateable;\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_dataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(FieldItem);\n","export class FieldTable {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-table';\n\t\tthis.properties = {\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: String,\n\t\t\tmd: Object,\n\t\t\tdisabled: Boolean\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['generateColumns(md, fieldNames)'];\n\t}\n\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tlet numFields = this.fieldNames.length;\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(this.fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(this.fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(this.fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n}\n\nPolymer(FieldTable);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class FilterItem {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\thidden: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\t\t\tdisplay: String,\n\t\t\tfactoryData: Object\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleKeyPress();\n\t\tthis.addEventListener('lookup-value-changed', this.handleLabelChange);\n\t}\n\n\thandleLabelChange(e) {\n\t\tlet data = {\n\t\t\titem: this.item.split('.')[0],\n\t\t\tvalue: e.detail.refDisplay\n\t\t};\n\t\tthis.fire('filter-item-value-changed', data);\n\t}\n\n\thandleKeyPress() {\n\t\tthis.addEventListener('keypress', function (e) {\n\t\t\tlet item = this.item.split('.')[0];\n\t\t\tthis.fire('filter-item-field-keypress', {keyCode: e.keyCode, item: item, itemType: this.model[item].model.type})\n\t\t}.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setMd(item, model)',\n\t\t\t'setHidden(data.*)',\n\t\t\t'dataChanged(data, item)',\n\t\t\t'_displayChanged(value, display, item, data, md)'\n\t\t];\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n\n\tsetMd() {\n\t\tlet prefix = AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\tlet item = this.item.split('.')[0];\n\t\tthis.md = this.model[item].model;\n\t\tthis.factoryData = {range: this.model[item].record[prefix + 'Operator__c'] === 'between'};\n\t\tthis.label = this.model[item].label ? this.model[item].label : this.model[item].record.Name;\n\n\t\t//if this is filtering on a boolean field, the default value needs to be of type boolean\n\t\tif (this.md.type && this.md.type === 'boolean' && typeof this.value === 'string')\n\t\t\tthis.setValue(this.item, this.value === 'true');\n\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = this.md;\n\t}\n\n\tsetHidden() {\n\t\tlet item = this.item;\n\t\tif (!this.data[item])\n\t\t\titem = this.item.split('.')[0];\n\n\t\tif (this.data[item]) {\n\t\t\tthis.hidden = this.data[item].hidden;\n\t\t}\n\t}\n\n\tdataChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tthis.display = this.data[id].label;\n\n\t\t// set the sb-field record property to this to enable dependent pick list functionality\n\t\t// this class satisfies the contract of a sb-field record property because it implements the following functions: getValue, setValue, and equals\n\t\tthis.$.field.record = this;\n\t}\n\n\t_displayChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tlet rfm = new RelationshipFieldManager(id, this.data);\n\t\tlet relationship = rfm.buildRelationship(this.value, this.display, this.md.referenceTo[0]);\n\t\tif(relationship)\n\t\t\tthis.data[id].label = relationship.value.Name;\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tif (this.data[name])\n\t\t\treturn this.data[name].value;\n\t\telse\n\t\t\tfor (let process in this.data) {\n\t\t\t\tif (this.data[process].field === name)\n\t\t\t\t\treturn this.data[process].value;\n\t\t\t}\n\n\t\treturn null;\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(filterItem) {\n\t\treturn this.data === filterItem.data;\n\t}\n}\n\nPolymer(FilterItem);\n","import {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FilterLayout extends Page {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilterPath: { //path in the search model for the search filters\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'searchFilters'\n\t\t\t},\n\t\t\tfilterKey: String,\n\t\t\tfilterDelegator: Object, //logic handler (suggester, searcher, filterer)\n\t\t\tsearchFilterData: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchFilterModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true //this is required for Safari to sync values between modal and panel\n\t\t\t},\n\t\t\tserviceLoader: String,\n\t\t\tquote: Object,\n\t\t\tenterCallback: Object,\n\t\t\ttranslationCallback: Object,\n\t\t\tserviceCallback: Object,\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tresultLimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 2000\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsearchContext: String\n\t\t}, Page.properties)\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelReady(searchModel, filterDelegator)'\n\t\t]\n\t}\n\n\tready() {\n\t\tthis.mdResponse(); //handle the field metadata response\n\t\tthis.handleEnterKeyPressed();\n\t}\n\n\thandleEnterKeyPressed() {\n\t\tthis.addEventListener('filter-item-field-keypress', function (e) {\n\t\t\t//if key is not enter, the callback is not a function, or if the item type is a reference, return; don't run filter\n\t\t\tif (e.detail.keyCode !== 13 || typeof this.enterCallback !== 'function' || e.detail.itemType === 'reference')\n\t\t\t\treturn;\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.enterCallback();\n\t\t\t}.bind(this),0)\n\t\t}.bind(this));\n\t}\n\n\tsearchModelReady() {\n\t\t//only need to run this once\n\t\tif (this.searchModelInitialized === true)\n\t\t\treturn;\n\t\tthis.searchModelInitialized = true;\n\t\tif (this.filterKey === undefined)\n\t\t\tthis.filterKey = this.searchModel.hasCustomSearchFilters ? 'Id' : 'Name';\n\t\tlet properties = this.filterPath.split('.');\n\t\tthis.path = 'this.searchModel';\n\t\tfor (let property of properties) {\n\t\t\tthis.path += '.' + property;\n\t\t}\n\n\t\tlet searchFilters = eval(this.path),\n\t\t\tfields = [],\n\t\t\tsearchFilterModel = {};\n\t\tif (Array.isArray(searchFilters) === false)\n\t\t\treturn;\n\n\t\tfor (let filter of searchFilters) {\n\t\t\tfields.push(this.getSearchTable() + '.' + filter.targetFieldName);\n\t\t\t//Fixes a bug where dynamic filters would always be hidden\n\t\t\t//Now shows the filter if any instance of that filter is not hidden\n\t\t\tlet duplicateHidden = searchFilterModel[this.filterDelegator.getGroupKey(filter)];\n\t\t\tsearchFilterModel[this.filterDelegator.getGroupKey(filter)] = filter;\n\t\t\tif (duplicateHidden)\n\t\t\t\tsearchFilterModel[this.filterDelegator.getGroupKey(filter)].hidden = duplicateHidden;\n\t\t}\n\t\tthis.fields = this.filterDelegator.buildFields(fields);\n\t\tthis.searchFilterModel = searchFilterModel;\n\t}\n\n\tmdResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet mdResponse = e.detail.value;\n\t\t\tif (mdResponse === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.setFilterValueMap(mdResponse);\n\t\t}.bind(this));\n\t}\n\n\tsetFilterValueMap(mdResponse) {\n\t\tlet groupItems = [];\n\t\tlet groupKeys = [];\n\t\tif (this.searchFilterModel === undefined)\n\t\t\treturn;\n\n\t\tfor (let i in this.searchFilterModel) {\n\t\t\tlet fieldName = this.searchFilterModel[i].targetFieldName;\n\t\t\tgroupItems.push(i + '.value');\n\t\t\tgroupKeys.push(i);\n\t\t\tthis.searchFilterModel[i].model = mdResponse.fieldsByObject[this.getSearchTable()][fieldName];\n\t\t}\n\t\t//groupItems notifies up and will set off a chain reaction of rebuilding a group when it doesn't have to\n\t\t//simple safe check to see if the groupItems are the same and only set if they are not\n\t\tif(JSON.stringify(this.groupItems) !== JSON.stringify(groupItems))\n\t\t\tthis.groupItems = groupItems;\n\t\tif (this.filterDelegator.skipDefaults && this.searchFilterData)\n\t\t\treturn;\n\t\tthis.filterDelegator.setDefaultFilterValues(groupKeys, this.searchFilterModel).then(function(searchFilterData) {\n\t\t\t//Don't reset property if it already exists to avoid firing observers on child fields\n\t\t\tif (!this.searchFilterData)\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\tthis.filterDelegator.searchFilterModel = this.searchFilterModel;\n\t\t\tthis.filterDelegator.groupItems = this.groupItems;\n\t\t}.bind(this));\n\t}\n\n\tgetSearchTable() {\n\t\tif (this.searchModel === undefined)\n\t\t\treturn;\n\n\t\treturn this.filterDelegator.getSearchTable();\n\t}\n\n\tfocusFirstField() {\n\t\tif(!this.isMobile())\n\t\t\tthis.$.panel.applyFocusToItem(0);\n\t}\n\n\trunService() {\n\t\tif (this.serviceLoader === undefined || this.quote === undefined)\n\t\t\treturn;\n\n\t\tif (!this.noSpinner)\n\t\t\tthis.spinner = true;\n\n\t\tlet builderModel = new DataBuilder()\n\t\t\t.addObject('filterContext', this.filterDelegator.getFilterContext(), undefined, undefined, true)\n\t\t\t.add('searchContext', this.getSearchContext())\n\t\t\t.add('additional', this.filterDelegator.getAdditionalProperties())\n\t\t\t.add('actionId',  this.actionId)\n\t\t\t.add('resultLimit',  this.resultLimit);\n\t\tif (this.sendQuoteRecord) {\n\t\t\tbuilderModel.addObject('quote', this.quote.record);\n\t\t} else {\n\t\t\tbuilderModel.addQuote('quote', this.quote);\n\t\t}\n\n\t\tlet context = builderModel.build();\n\n\t\tthis.$.service.client.load(\n\t\t\tthis.prefix,\n\t\t\tthis.serviceLoader,\n\t\t\tnull,\n\t\t\tcontext\n\t\t).then(function (result) {\n\t\t\tthis.spinner = false;\n\t\t\tif (typeof this.serviceCallback === 'function')\n\t\t\t\tthis.serviceCallback(result);\n\t\t\telse\n\t\t\t\tthis.searchModel = this.localizer ? this.localizer.localizeSearchModel(result) : result;\n\t\t}.bind(this));\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * SOSL requires a minimum of 2 characters to search\n\t * @returns {Object}\n\t */\n\tgetSearchContext() {\n\t\tif(this.searchContext === undefined)\n\t\t\treturn null;\n\t\treturn this.searchContext.length > 1 ? this.searchContext : null;\n\t}\n}\n\nPolymer(FilterLayout);","import {AppContext} from 'common/core/AppContext.js';\n\nconst quiet = typeof Visualforce !== 'undefined';\n\nexport class Group {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group';\n\t\tthis.properties = {\n\t\t\titem: String, // name of the component that represents an item in the group\n\t\t\tgroup: Array, // array of strings that represents the group\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each group item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupClass: String, // class string to be added the div that wraps the group items\n\t\t\titemClass: String, // class string to be added to each group item\n\t\t\tgroupDisplay: Object, // map whose keys match the group array and value is used for display purposes\n\t\t\tprimaryItems: { // if defined these named items are added to the front of the group only if they exist in the group\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tnumPrimary: { // used to determine the number of initial group items have the 'primary' class even if primaryItems is not yet defined\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tincludePrimaryInSecondary: { // if true will repeat the primary items in the secondary item set\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // used to tell each item in group it is a \"selected\" group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateSelected'\n\t\t\t},\n\t\t\tdisabled: { // used to tell each item in group it is a disabled group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateDisabled'\n\t\t\t},\n\t\t\t//when an items value is not a property on data, but a deep property like data.record.value,\n\t\t\t//you can set this to record. as the path prefix so the item is updated when the host data changes\n\t\t\t//specifically it's used when looping through the elements to find the item\n\t\t\tpathPrefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusIndex: { // index of group item you want to apply \"focus\"\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: 'updateFocusIndex'\n\t\t\t},\n\t\t\titemClassMap: { // map of attributes to classNames (used for adding classes only to the item that have the attributes)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\titemEditableMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'toggleEditable'\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tsignaler: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'updateSignaler'\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildGroup(model, item, group, data, primaryItems, itemClassMap, columnWidths)',\n\t\t\t'handlePrimaryEvents(template, _primaryItems)',\n\t\t\t'propagateFromParentToChild(data.*)',\n\t\t\t'toggleItemClass(itemClassMap.*)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\t/**\n\t * Compare existing itemClassMap in the template against the current one\n\t * @returns {boolean} True if itemClassMap has changed, false otherwise. For performance reason, item class map is considered different only when the number of keys has differed.\n\t * @private\n\t */\n\t_itemClassMapChanged() {\n\t\tif (!this.template) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.template.itemClassMap !== null && this.itemClassMap === null) ||\n\t\t\t(this.template.itemClassMap === null && this.itemClassMap !== null) ||\n\t\t\t(Object.keys(this.template.itemClassMap).length !== Object.keys(this.itemClassMap).length);\n\t}\n\n\t/**\n\t * Update the class of existing item when itemClassMap indicates that the style has changed\n\t * @private\n\t */\n\t_updateItemClasses() {\n\t\tif (!this.template || !this.itemClassMap) {\n\t\t\treturn;\n\t\t}\n\t\tconst oldMap = this.template.itemClassMap;\n\t\tconst newMap = this.itemClassMap;\n\t\tconst fields = new Set(Object.keys(oldMap).concat(Object.keys(newMap)));\n\t\tfields.forEach((field) => {\n\t\t\tif (oldMap[field] !== this.itemClassMap[field]) {\n\t\t\t\tlet item = Polymer.dom(this.$.g).querySelector(`${this.item}[item='${field}']`);\n\t\t\t\tif (item) {\n\t\t\t\t\tif (oldMap && oldMap[field]) {\n\t\t\t\t\t\tlet classList = oldMap[field].class || oldMap[field];\n\t\t\t\t\t\tif (classList && typeof classList === 'string') {\n\t\t\t\t\t\t\titem.classList.remove(...classList.split(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (newMap && newMap[field]) {\n\t\t\t\t\t\tlet classList = newMap[field].class || newMap[field];\n\t\t\t\t\t\tif (classList && typeof classList === 'string') {\n\t\t\t\t\t\t\titem.classList.add(...classList.split(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.template.itemClassMap = newMap;\n\t}\n\n\tbuildGroup(model, item, group, data, primaryItems, itemClassMap, columnWidths) {\n\t\tthis.initInternalGroupAndPrimaryItems();\n\t\tif (this.template) {\n\t\t\t// If the group is unchanged, we need to only reset the data and the model\n\t\t\tif (this.template.group === this._group) {\n\t\t\t\tthis.template.selected = this.selected;\n\t\t\t\tthis.template.disabled = this.disabled;\n\t\t\t\tthis.template.data = data;\n\t\t\t\tthis.template.model = model;\n\t\t\t\tif (columnWidths && (this.template.columnWidths != columnWidths)) {\n\t\t\t\t\tthis._updateColumnWidths();\n\t\t\t\t}\n\t\t\t\tif (this._itemClassMapChanged()) {\n\t\t\t\t\tthis._updateItemClasses();\n\t\t\t\t}\n\n\t\t\t} else if(!quiet)\n\t\t\t\tconsole.error(`Rebuilding a group is no longer supported. Called by ${this.domHost.tagName.toLowerCase()}: old group [${this.template.group}], new group [${this._group}]`);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.expanded = false;\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis.template.group = this._group;\n\t\tthis.template.selected = this.selected;\n\t\tthis.template.disabled = this.disabled;\n\t\tthis.template.signaler = this.signaler;\n\t\tthis.template.model = model;\n\t\tthis.template.data = data;\n\t\tthis.template.columnWidths = columnWidths;\n\t\tthis.template.tabIndex = this.tabIndex;\n\t\tthis.template.itemClassMap = this.itemClassMap;\n\t\tthis.buildItems(this.template);\n\t\tPolymer.dom(this.$.g).appendChild(this.template);\n\t\t// observe for when the child elements are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.g).observeNodes(function (info) {\n\t\t\tif (info.addedNodes[0])\n\t\t\t\tthis.bindElementEvents(Polymer.dom(info.addedNodes[0]).childNodes);\n\t\t}.bind(this));\n\t}\n\n\tdestroyGroup() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis.elements = null;\n\t\t\tPolymer.dom(this.$.g).removeChild(this.template);\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.group = undefined;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_updateColumnWidths() {\n\t\tif(!this.columnWidths)\n\t\t\treturn;\n\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t// In Safari and FF, items are not yet rendered sometimes. Wait for rendering to complete, if that's the case.\n\t\tif (!items || items && items.length == 0) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t\t\tthis._setColumnWidths(items);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._setColumnWidths(items);\n\t\t}\n\n\t}\n\n\t_setColumnWidths(items) {\n\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i],\n\t\t\t\tfieldName = item.getAttribute('item');\n\t\t\tlet columnWidth = this.columnWidths[fieldName];\n\t\t\tif (columnWidth == null)\n\t\t\t\tcontinue;\n\n\t\t\tlet width = columnWidth.width || columnWidth;\n\t\t\tif(width == null)\n\t\t\t\tcontinue;\n\n\t\t\t// by default set min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\t\tlet props = columnWidth.properties || ['minWidth', 'maxWidth'];\n\t\t\tlet unit = columnWidth.unit || 'px';\n\t\t\tfor(let prop of props)\n\t\t\t\titem.style[prop] = width + unit;\n\t\t}\n\t}\n\n\t_createColumnWidthStyleHtml(columnWidth) {\n\t\tlet html = ' style' + '=\"';\n\t\tlet width = columnWidth.width || columnWidth;\n\t\t// Setting min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\tlet properties = columnWidth.properties || ['min-width', 'max-width'];\n\t\tlet unit = columnWidth.unit || 'px';\n\t\tfor(let property of properties)\n\t\t\thtml += property + ':' + width + unit + ';';\n\t\treturn html;\n\n\t}\n\n\tupdateSelected() {\n\t\tif (this.template)\n\t\t\tthis.template.selected = this.selected;\n\t}\n\n\tupdateDisabled() {\n\t\tif (this.template)\n\t\t\tthis.template.disabled = this.disabled;\n\t}\n\n\tupdateSignaler() {\n\t\tif (this.template)\n\t\t\tthis.template.signaler = this.signaler;\n\t}\n\n\tapplyFocusToItem(focusIndex) {\n\t\tthis.focusIndex = undefined;\n\t\tthis.focusIndex = focusIndex;\n\t}\n\n\tupdateFocusIndex() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tif(!this.elements)\n\t\t\treturn;\n\n\t\tif(this.focusIndex === undefined || this.focusIndex < 0)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.template.group.length; i < l; i++) {\n\t\t\tthis.template[`focus_${i}`] = false;\n\t\t\tif(this.focusIndex === i)\n\t\t\t\tthis.template[`focus_${i}`] = true;\n\t\t}\n\t}\n\n\tinitInternalGroupAndPrimaryItems() {\n\t\t// the internal group property is the provided group with any applicable primary items concatenated to the front of the group\n\t\tthis._group = this.group;\n\n\t\t// the internal primaryItems property is the provided primary items normalized against the group itself\n\t\tthis._primaryItems = undefined;\n\n\t\t// if primary items is not defined or an empty array then we are done\n\t\tif (!this.primaryItems || this.primaryItems.length === 0)\n\t\t\treturn;\n\n\t\tlet primaryItems = [].concat(this.primaryItems);\n\n\t\t// if first primary item is not on group, then use the first item in group instead\n\t\tif(this.group.indexOf(primaryItems[0]) === -1)\n\t\t\tprimaryItems[0] = this.group[0];\n\n\t\t// if second primary item is not on group, then just simply remove\n\t\t// we do not support more then 2 primary items\n\t\tif(primaryItems.length > 1) {\n\t\t\tif(this.group.indexOf(primaryItems[1]) === -1)\n\t\t\t\tprimaryItems = [primaryItems[0]];\n\t\t\telse\n\t\t\t\tprimaryItems = [primaryItems[0], primaryItems[1]];\n\t\t}\n\n\t\t// at least one provided primary item was in the group, so lets ensure the primary items are in the front of the group\n\t\tthis._primaryItems = primaryItems;\n\t\tif(this.includePrimaryInSecondary) {\n\t\t\t// if include primary in secondary, then simply append the primary to the group and we are done\n\t\t\tthis._group = primaryItems.concat(this.group);\n\t\t\tthis._normalizeWithTemplateGroup();\n\t\t\treturn;\n\t\t}\n\n\t\t// we do not want to repeat primary, so lets create secondary list from group by filtering out primaryItems\n\t\tlet secondary = this.group.filter(function (item) {\n\t\t\treturn primaryItems.indexOf(item) === -1;\n\t\t});\n\n\t\t// simply append primary with secondary and call it a day\n\t\tthis._group = primaryItems.concat(secondary);\n\t\tthis._normalizeWithTemplateGroup();\n\t}\n\n\tbuildItems(template) {\n\t\tvar doc = template.content.ownerDocument;\n\t\tvar root = doc.createElement('div');\n\t\tif (this.groupClass)\n\t\t\tPolymer.dom(root).setAttribute('class', this.groupClass);\n\n\t\tlet numPrimary = this.numPrimary > 0 ? this.numPrimary : (this._primaryItems ? this._primaryItems.length : 0);\n\t\tthis._group.forEach(function (item, index) {\n\t\t\tlet html = '<' + this.item + ' ' + 'item=\"' + item + '\" value=\"{{data.' + item + '}}\" model=\"[[model]]\" data=\"[[data]]\" disabled=\"[[disabled]]\" selected=\"[[selected]]\" focus=\"[[focus_' + index + ']]\" index=\"' + index + '\"';\n\n\t\t\tlet isPrimary = index < numPrimary;\n\n\t\t\tif (!isPrimary && this.groupDisplay && this.groupDisplay[item]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item] + '\"';\n\t\t\t} else if (!isPrimary && this.groupDisplay && this.groupDisplay[item.split(\".\")[1]]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item.split(\".\")[1]] + '\"';\n\t\t\t}\n\n\n\t\t\tlet classes = '';\n\t\t\tif (this.itemClass)\n\t\t\t\tclasses += this.itemClass + ' ';\n\n\t\t\tif (isPrimary) {\n\t\t\t\tclasses += index === 0 ? 'primary first' : 'primary multi';\n\t\t\t\tclasses += this.selected ? ' selected' : '';\n\t\t\t} else if (numPrimary > 0) {\n\t\t\t\tclasses += 'secondary';\n\t\t\t}\n\n\t\t\tif (this.itemClassMap && this.itemClassMap[item]) {\n\t\t\t\tclasses += ' ' + (this.itemClassMap[item].class || this.itemClassMap[item]);\n\t\t\t\tif(this.itemClassMap[item].style)\n\t\t\t\t\thtml += ` style=\"${this.itemClassMap[item].style}\"`;\n\t\t\t}\n\n\t\t\tif (classes)\n\t\t\t\thtml += ' class' + '=' + '\"' + classes + '\"';\n\n\t\t\tlet columnWidth = this.columnWidths ? this.columnWidths[item] : null;\n\t\t\tif (columnWidth != null)\n\t\t\t\thtml += this._createColumnWidthStyleHtml(columnWidth);\n\n\t\t\tif(this.tabIndex != null)\n\t\t\t\thtml += ' tab-index=\"[[tabIndex]]\"';\n\n\t\t\thtml += ' signaler=\"[[signaler]]\"></' + this.item + '>';\n\t\t\tlet div = doc.createElement('div');\n\n\t\t\tdiv.innerHTML = html;\n\n\t\t\tPolymer.dom(root).appendChild(Polymer.dom(div).firstChild);\n\t\t}.bind(this));\n\t\tPolymer.dom(template.content).appendChild(root);\n\t}\n\n\tbindElementEvents(elements) {\n\t\t//this is needed for Safari and FireFox to have a handle of this in the callbacks\n\t\tthis.elements = elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tthis.updateFocusIndex();\n\n\t\tthis.propagateValueToParent = this.propagateValueToParent || function (e) {\n\t\t\t\t//the internal property will protect against the parent observer if it has a parent property called data\n\t\t\t\tthis.internal = true;\n\t\t\t\tthis.set('data.' + e.target.item, e.detail.value);\n\t\t\t\tif(this.childToParentExtension)\n\t\t\t\t\tthis.childToParentExtension( { path: 'data.' + e.target.item, value: e.detail.value } );\n\t\t\t\tthis.internal = false;\n\t\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\telements[i].removeEventListener('value-changed', this.propagateValueToParent);\n\t\t\telements[i].addEventListener('value-changed', this.propagateValueToParent);\n\t\t}\n\t}\n\n\tpropagateFromParentToChild(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tif (e.path === 'data')\n\t\t\treturn;\n\n\t\tif(this.propagateFromParentToChildOverride) {\n\t\t\tthis.propagateFromParentToChildOverride(e);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._propagateFromParentToChild(e);\n\t}\n\n\t_propagateFromParentToChild(e) {\n\t\t//Chrome and FireFox do not have access to element or numElements outside this callback\n\t\tvar elements = this.elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\t//looking for the item in the elements to apply the value to\n\t\tvar parts = e.path.split('.');\n\t\tvar item = this.pathPrefix + parts[parts.length - 1];\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\tif (elements[i].item === item) {\n\t\t\t\telements[i].value = e.value;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePrimaryEvents() {\n\t\tif (this.primaryEventsResistered)\n\t\t\treturn;\n\n\t\tthis.addEventListener('group-selected', function (e) {\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item + '.primary');\n\t\t\tfor (var i = 0, l = items.length; i < l; i++)\n\t\t\t\tthis.toggleClass('selected', e.detail.selected, items[i]);\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('group-expanded', function (e) {\n\t\t\tlet primary = e.detail.path.filter(function (node) {\n\t\t\t\tlet el = Polymer.dom(node);\n\t\t\t\tlet tagName = el.node.tagName ? el.node.tagName.toLowerCase() : '';\n\t\t\t\treturn tagName === this.item && el.classList.contains('primary');\n\t\t\t}.bind(this));\n\n\t\t\tif (!primary || primary.length === 0)\n\t\t\t\treturn;\n\n\t\t\tthis.toggleClass('initial', false, primary[0]);\n\t\t\tthis.expanded = !this.expanded;\n\t\t\t// toggle the expanded property on the host in case it needs it\n\n\t\t\tif (this.domHost) {\n\t\t\t\tthis.domHost.expanded = !this.domHost.expanded;\n\t\t\t}\n\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item);\n\t\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\t\tlet itemField = items[i].$$('sb-field');\n\t\t\t\tif(itemField) itemField.renderReadOnly = false;\n\t\t\t\tthis.toggleClass('expanded', this.expanded, items[i]);\n\t\t\t}\n\t\t\t// Caught in swipe-container\n\t\t\tthis.fire('expanded-changed', {expanded: this.expanded});\n\t\t}.bind(this));\n\t\tthis.primaryEventsResistered = true;\n\t}\n\n\tnavigationChanged() {\n\t\tthis.fire('group-selected', {selected: false}, {bubbles: false});\n\t}\n\n\toverridePropagateFromParentToChild(propagateFromParentToChildOverride) {\n\t\tif (typeof propagateFromParentToChildOverride !== 'function')\n\t\t\treturn;\n\n\t\tthis.propagateFromParentToChildOverride = propagateFromParentToChildOverride;\n\t}\n\n\tsetFromChildToParentExtension(childToParentExtension) {\n\t\tif (typeof childToParentExtension !== 'function')\n\t\t\treturn;\n\n\t\tthis.childToParentExtension = childToParentExtension;\n\t}\n\n\t/**\n\t * \tObserve changes to this.itemClassMap.*\n\t * \te.value should be an array of objects with the properties \"class\" and \"value\"\n\t */\n\ttoggleItemClass(e) {\n\t\tlet parts = e.path.split('.');\n\t\tif(parts.length === 1)\n\t\t\treturn; // Don't care about changes to itemClassMap itself, just its members\n\n\t\tlet path = parts[1];\n\t\tfor(let element of this.elements) {\n\t\t\t\tif (element.item === path) {\n\t\t\t\t\tfor(let i = 0, l = e.value.length; i < l; i++)\n\t\t\t\t\t\telement.toggleClass(e.value[i].class, e.value[i].value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\t/**\n\t * Observe changes to this.itemEditableMap.* which is just a map of field name to an 'editable' flag\n\t */\n\ttoggleEditable() {\n\t\tif(!this.itemEditableMap)\n\t\t\treturn; // Don't care about changes to itemEditableMap itself, just its members\n\n\t\tfor (let element of this.elements) {\n\t\t\t\tlet editable = this.itemEditableMap[element.item];\n\t\t\t\tif (editable != null)\n\t\t\t\t\telement.editable = editable;\n\t\t\t}\n\t\t}\n\n\t_normalizeWithTemplateGroup() {\n\t\tif(!this.template || !this.template.group)\n\t\t\treturn; // template.group not defined so bail\n\n\t\tif(this.template.group.length !== this._group.length)\n\t\t\treturn; // template.group not same length as _group so bail\n\n\t\tfor(var i = 0, l = this._group.length; i < l; i++) {\n\t\t\tif(this.template.group[i] !== this._group[i])\n\t\t\t\treturn; // we found an element that is not the same, so bail\n\t\t}\n\t\t// template.group is same as _group, so lets assign it as such\n\t\tthis._group = this.template.group;\n\t}\n\n\t/**\n\t * Readjust the date picker position while opening\n\t *\n\t * @param e\n\t * @private\n\t */\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker;\n\n\t\t// This line is required because datepicker is someone receiving an inline style position of fixed\n\t\tdatepicker.style.position = 'absolute';\n\t\tlet dateRow = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\n\t\t// If there isn't enough space to display the right-side of the calendar, we align it to the right\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\t}\n}\n\nPolymer(Group);\n","import {DEFAULT_WIDTH} from 'common/layout/tables/ImageCellSizer.js';\nimport {DEFAULT_HEIGHT} from 'common/layout/tables/ImageCellSizer.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst CHECKBOX = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC';\nconst CHECKBOX_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==';\n\nexport class Html {\n\n\tconstructor(component) {\n\t\tif(component) {\n\t\t\tthis.$ = component.$;\n\t\t\tthis.$$ = Polymer.dom(component.root).querySelector.bind(Polymer.dom(component));\n\t\t\tthis.viewport = PageContainer.getViewport();\n\t\t}\n\t}\n\n\tsanitizeAndSetInnerHTML() {\n\t\tif(this.isNil()) {\n\t\t\t// adding styles inline on image tag itself because in FF it did now work when added as CSS\n\t\t\tlet blankImage = '<img id=\"blank\" src=\"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" style=\"width:50%; height:17px\"/>';\n\t\t\tlet useImage = !this.link && !this.isMobile();\n\t\t\t// use blank image in desktop for editable empty cells to allow the empty cell to be clicked on for editing\n\t\t\tthis.$.me.innerHTML = useImage ? blankImage : '';\n\t\t\treturn;\n\t\t}\n\n\t\t// add checkbox image based on the boolean value if non null\n\t\tif(this.booleanValue != null) {\n\t\t\tlet checkboxBase64 = this.booleanValue ? CHECKBOX_CHECKED : CHECKBOX;\n\t\t\tif(this.isDirty)\n\t\t\t\tcheckboxBase64 = this.booleanValue ? CHECKBOX_CHECKED_DIRTY : CHECKBOX_DIRTY;\n\t\t\tthis.$.me.innerHTML = '<img id=\"checkbox\" src=\"data:image/png;base64,' + checkboxBase64 +'\"/>';\n\t\t\treturn;\n\t\t}\n\n\t\tif ((this.type === 'string' || this.type === 'textarea') && Html.containsMarkup(this.value) ) {\n\t\t\t// innerHTML is raw, we need to sanitize it ourselves\n\t\t\tthis.$.formatted.style.padding = \"2px 0\";\n\t\t\tthis.$.me.innerHTML = Html.sanitizeHtmlText((this.value + '').trim());\n\t\t} else {\n\t\t\t// textContent is sanitized by the browser\n\t\t\tthis.$.formatted.style.padding = \"2px 0\";\n\t\t\tthis.$.me.textContent = (this.value + '').trim();\n\t\t}\n\t\tthis.handleDefaultSizeIfImage();\n\t}\n\n\tstatic containsMarkup(value) {\n\t\treturn /(<[a-z][\\s\\S]*>)|(&[^\\s]*;)/.test(value);\n\t}\n\n\thandleDefaultSizeIfImage() {\n\t\t// width could either be on the image's style attribute or its width attribute\n\t\t// only if its not on either will we set the default width\n\t\tlet imageNoWidth = this.$$('#me img:not([style*=width])');\n\t\tif(imageNoWidth)  // width not on style attribute, so to be sure check if not on width attribute\n\t\t\timageNoWidth = this.$$('#me img:not([width])');\n\n\t\tif(imageNoWidth)\n\t\t\tPolymer.dom(imageNoWidth).setAttribute('width', DEFAULT_WIDTH);\n\n\t\t// height could either be on the image's style attribute or its height attribute\n\t\t// only if its not on either will we set the default height\n\t\tlet imageNoHeight = this.$$('#me img:not([style*=height])');\n\t\tif(imageNoHeight)  // height not on style attribute, so to be sure check if not on height attribute\n\t\t\timageNoHeight = this.$$('#me img:not([height])');\n\n\t\tif(imageNoHeight)\n\t\t\tPolymer.dom(imageNoHeight).setAttribute('height', DEFAULT_HEIGHT);\n\t}\n\n\tisNil() {\n\t\treturn (this.value == null || (this.value + '').trim() === '') && this.booleanValue == null;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tclearTabIndex() {\n\t\tthis._tabindex = this.tabindex;\n\t\tthis.tabindex = undefined;\n\t}\n\n\trestoreTabIndex() {\n\t\tthis.tabindex = this._tabindex;\n\t}\n\n\t/**\n\t * Sanitizes the innerHTML.\n\t * It only allows the Tags stated in allowedTags and attributes stated in allowedAttributes. Some tags and attributes\n\t * are allowed by default and they can be found in the HtmlSanitizer.js\n\t *\n\t * @param v\n\t * @return {String}\n\t */\n\tstatic sanitizeHtmlText(v) {\n\t\tif(!v) {\n\t\t\treturn v;\n\t\t}\n\t\treturn sanitizeHtml(v, {\n\t\t\tallowedTags: sanitizeHtml.defaults.allowedTags.concat(['div', 'img', 'span', 'sub', 'sup']),\n\t\t\tallowedAttributes: {\n\t\t\t\tdiv:['style', 'class'],\n\t\t\t\timg:['src', 'height', 'width', 'alt', 'border', 'align', 'style'],\n\t\t\t\ta:['href', 'name', 'target', 'title'],\n\t\t\t\tspan:['style']\n\t\t\t},\n\t\t\tparser: {decodeEntities: false}\n\t\t});\n\t}\n}\n","import {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Component for creating a list from a SearchModel.\n *\n */\n\nconst MAX_NUM_RESULTS_TO_SELECT_ALL = 100;\n\nexport class LookupLayout {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior, Polymer.IronScrollTargetBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-layout';\n\t\tthis.properties = {\n\t\t\tselectedRows: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchModel: Object,\n\t\t\ttotalCount: { //let the host know the total count of rows\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasTotalCount: { //let the host know if there is a count because polymer can't evaluate expressions in bindings\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmaxSelectAll: Number,\n\t\t\tselectionIdDataPath: String, //the path passed to row for where the record ID is\n\t\t\tparentAttributesPath: String,\n\t\t\tadditionalFields: Array, //additional fields to show on list not in the SearchModel,\n\t\t\tfieldPrefix: { // TODO: add good comment\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tgroupByField: String, //results can be grouped by this field\n\t\t\tgroupByFieldType: String, //type of field that results are being grouped by\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tprimaryMobileCols: Array,\n\t\t\t_primaryMobileColumns: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_getPrimaryMobileCols(primaryMobileCols, fieldSet)'\n\t\t\t},\n\t\t\trowsByGrouper: Object,\n\t\t\tgroups: Array,\n\t\t\tviewResultsIndexById: Object,\n\t\t\tviewResultsIds: Object,\n\t\t\theaderSelectionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isDisableHeaderSelection(viewResults)'\n\t\t\t},\n\t\t\theaderSelectionTooltip: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_getHeaderSelectionTooltip(headerSelectionDisabled)'\n\t\t\t},\n\t\t\tmobileRowDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tkeyPressed:  {\n\t\t\t\tType: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlastClickedIndex: {\n\t\t\t\tType: Number\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setViewResults(searchModel, fieldSet, groupByFieldType)',\n\t\t\t'initFieldMetadata(searchModel)',\n\t\t\t'updateTotalCount(searchModel.totalCount)',\n\t\t\t'setDisplayResults(viewResults)',\n\t\t\t'indexViewResults(viewResults)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis._setupKeyPressListeners();\n\t\tthis.handleAllRowsSelected();\n\t\tthis.handleOneRowSelected();\n\t\tthis.handleMetaDataResponse();\n\t\tthis.hiddenByGroup = {};\n\t\tthis.addEventListener('sb-mobile-row-expanded', this.expandMobileRow.bind(this));\n\t\tthis.addEventListener('sb-mobile-row-selected', this.selectMobileRow.bind(this));\n\t\tthis.addEventListener('sb-row-group-tapped', this.expandRow.bind(this));\n\t\t// mixed in IronScrollTargetBehavior will now delegate to _scrollHandler function when the element assigned to the below scrollTarget property is scrolled\n\t\tthis.scrollTarget = this.$.tbody;\n\t}\n\n\t_setupKeyPressListeners() {\n\t\t//check other browsers, try keyCode\n\t\twindow.addEventListener('keydown', function(e) {\n\t\t\tthis.keyPressed[e.keyCode] = true;\n\t\t}.bind(this));\n\n\t\twindow.addEventListener('keyup', function(e) {\n\t\t\tdelete this.keyPressed[e.keyCode];\n\t\t}.bind(this));\n\t}\n\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.initRecordKeysFieldLabelsAndTypeMap(e.detail.value.fields);\n\t\t}.bind(this));\n\t}\n\n\tinitFieldMetadata() {\n\t\tthis.deSelectAll();\n\t\tif(this.fieldMetadataInitialized)\n\t\t\treturn;\n\t\tthis.$.md.object = this.searchModel.targetObjectName;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.searchModel, 'resultFieldNames', 'resultFieldNamesTablet', 'resultFieldNamesPhone');\n\t\tthis.setFieldMetadata();\n\t\tthis.fieldMetadataInitialized = true;\n\t}\n\n\tsetFieldMetadata() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.$.md.name === this.fieldSet.name)\n\t\t\treturn false;\n\n\t\tthis.$.md.fields = undefined;\n\t\tthis.$.md.name = this.fieldSet.name;\n\n\t\tlet metadataFields = this.fieldSet.fields;\n\n\t\t//caller provides fields from field set\n\t\tif (Array.isArray(this.additionalFields))\n\t\t\tmetadataFields = this.fieldSet.fields.concat(this.additionalFields);\n\n\t\tif(this.groupByField && metadataFields.indexOf(this.groupByField) === -1) {\n\t\t\t//adds the field to group by into the field set to get its metadata\n\t\t\tmetadataFields = [this.groupByField].concat(metadataFields);\n\t\t}\n\n\t\tthis.$.md.fields = metadataFields;\n\t}\n\n\tinitRecordKeysFieldLabelsAndTypeMap(fields) {\n\t\tlet recordKeys = [],\n\t\t\tfieldLabels = [],\n\t\t\tfieldLabelMap = {},\n\t\t\ttypeMap = {},\n\t\t\tlabelTypeMap = {},\n\t\t\titemTypeMap = {},\n\t\t\tcolumnWidths = {},\n\t\t\tlabelWidths = {};\n\n\t\tfields.forEach(function (field) {\n\t\t\tif(this.groupByField === field.name) {\n\t\t\t\tthis.groupByFieldType = field.type;\n\t\t\t\t//ignores the field to group by from the field set if it wasn't originally included\n\t\t\t\tif(this.fieldSet.fields.indexOf(field.name) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//TODO: this unit price thing isn't going to work...\n\t\t\tlet key = field.name === 'UnitPrice' ? field.name : (this.fieldPrefix + field.name);\n\t\t\trecordKeys.push(key);\n\t\t\tfieldLabels.push(field.label);\n\t\t\tfieldLabelMap[key] = field.label;\n\t\t\ttypeMap[key] = {type: field.type};\n\t\t\tif (field.type.toLowerCase() === 'currency')\n\t\t\t\ttypeMap[key].CurrencyIsoCode = this.currencyIsoCode;\n\n\t\t\tlet type = field.type;\n\t\t\tif (!this.isMobileViewport()) {\n\t\t\t\t// returns undefined if cell is not an image\n\t\t\t\tlet imageWidth = new ImageCellSizer(field).getImageWidth(20);\n\t\t\t\tif (imageWidth) {\n\t\t\t\t\tlet width = { width: imageWidth, properties: ['width'] };\n\t\t\t\t\tcolumnWidths[key] = width;\n\t\t\t\t\tlabelWidths[field.label.replace(/\\W/g, '')] = width;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = type;\n\t\t\titemTypeMap[key] = type;\n\t\t}.bind(this));\n\n\t\tif(this.groupByFieldType === undefined) {\n\t\t\t//must define value to kick off setViewResults observer method\n\t\t\tthis.groupByFieldType = null;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.columnWidths = columnWidths;\n\t\tthis.labelWidths = labelWidths;\n\t\tthis.typeMap = typeMap;\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\thandleAllRowsSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function (e) {\n\t\t\tthis.selectAllClicked = true;\n\t\t\tlet selected = e.detail.selected;\n\t\t\tthis.toggleRowSelections(selected);\n\t\t\tthis.selectAllClicked = false;\n\t\t}.bind(this));\n\t}\n\n\ttoggleRowSelections(selected, group, range) {\n\t\tlet processed = [];\n\n\t\t// toggle through all the rows stamped into the DOM and select them\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\t// lets record here that we have processed this record via its stamped in row in the DOM\n\t\t\t\tlet recordId = row.get('rowData.' + this.selectionIdDataPath);\n\t\t\t\tprocessed.push(recordId);\n\n\t\t\t\t//skip row is outside of multi-select range\n\t\t\t\tif (range && (row.index < range.start || row.index > range.end))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if toggling selections of a specific group, make sure this row is a groupie of the selected group\n\t\t\t\tif (group != null && (row.grouper || (row.groupie && row.groupie !== group)))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// filtered out rows are still in dom (even though not visible)\n\t\t\t\t// so need to make sure this row's record id matches a valid view result\n\t\t\t\tif(!this._isValidViewResultId(recordId))\n\t\t\t\t\tcontinue;\n\n\t\t\t\trow.selected = selected;\n\t\t\t}\n\t\t}\n\n\t\t// since some viewResults may not be stamped into the DOM as rows because of iron-list,\n\t\t// lets iterate over the applicable unprocessed viewResults and select them\n\t\tlet viewResults = group != null ? this.rowsByGrouper[group] : this.viewResults;\n\t\tif(viewResults == null)\n\t\t\treturn;\n\n\t\tif (!range)\n\t\t\trange = {start: 0, end: viewResults.length - 1};\n\n\t\tfor(let i = range.start; i <= range.end; i++) {\n\t\t\tlet viewResult = viewResults[i];\n\t\t\tlet recordId = this.get('record.' + this.selectionIdDataPath, viewResult);\n\n\t\t\t// first check if we already processed this record, if so continue\n\t\t\tif(processed.indexOf(recordId) !== -1)\n\t\t\t\tcontinue;\n\n\t\t\t// lets select this record manually\n\t\t\tlet attributes = this.parentAttributesPath === undefined ? undefined : this.get('record.' + this.parentAttributesPath, viewResult);\n\t\t\tthis.selectOneRow(selected, recordId, viewResult.record, attributes, viewResult.grouper);\n\t\t}\n\t}\n\n\thandleOneRowSelected() {\n\t\t// listen for selection changes to the list\n\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\t//removes text highlighting that happens when shift clicking in a document\n\t\t\tdocument.getSelection().removeAllRanges();\n\t\t\tif (!this.selectAllClicked)\n\t\t\t\tthis.handleRangeSelection(e);\n\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\t\t\tlet recordId = e.detail.Id; // the id of the record that was just selected or unselected\n\t\t\tlet group = e.detail.group;\n\t\t\tlet autoSelectGroupRows = e.detail.autoSelectGroupRows;\n\t\t\tthis.selectOneRow(selected, recordId, e.detail.rowData, e.detail.attributes, group);\n\t\t\tif (group != null && autoSelectGroupRows) // if grouped row was selected then select all of its expanded groupies\n\t\t\t\tthis.toggleRowSelections(selected, group);\n\t\t}.bind(this));\n\t}\n\n\thandleRangeSelection(e) {\n\t\t// Shift KeyCode is 16\n\t\tif (this.keyPressed[16] && this.lastClickedIndex != undefined && !this.internal && !this.groupByFieldType) {\n\t\t\tthis.internal = true;\n\t\t\tlet start = Math.min(this.lastClickedIndex, e.detail.index);\n\t\t\tlet end = Math.max(this.lastClickedIndex, e.detail.index);\n\t\t\tthis.toggleRowSelections(e.detail.selected, null, {start: start, end: end});\n\t\t\tthis.internal = false;\n\t\t}\n\t\tif (!Polymer.dom(e).rootTarget._selectedChangeByParent)\n\t\t\tthis.lastClickedIndex = e.detail.index;\n\t}\n\n\tselectOneRow(selected, recordId, rowData, attributes, group) {\n\t\tif (selected) {\n\t\t\tif (this.selectedRows === null)\n\t\t\t\tthis.selectedRows = {};\n\t\t\tthis.selectedRows[recordId] = {\n\t\t\t\trecord: {Id: recordId, attributes: attributes, UnitPrice: rowData.UnitPrice},\n\t\t\t\tindex: this.viewResultsIndexById[recordId],\n\t\t\t\tinvalid: (group != null)\n\t\t\t};\n\t\t}\n\t\tif (!selected && this.selectedRows)\n\t\t\tdelete this.selectedRows[recordId];\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.header.selected = undefined; //if the header checkbox already is false, this is required so that all the rows get updated.\n\t\tthis.$.header.selected = false;\n\t}\n\n\tsetViewResults() {\n\t\tthis.selectedRows = {};\n\t\tthis.viewResultsIds = null;\n\t\tthis.viewResultsIndexById = null;\n\t\tlet viewResults = this.getViewResults(this.searchModel.results);\n\t\tthis.hasGroupedField = !!(this.groupByField);\n\t\tif(this.isMobileViewport())\n\t\t\tthis._resetMobileDetails();\n\n\t\t// no group field, then the view results are the search model results\n\t\tif (!this.hasGroupedField) {\n\t\t\tthis.viewResults = viewResults;\n\t\t\treturn;\n\t\t}\n\n\t\t// if viewResult already exists, clone the entire searchModel.results object so the dom-repeat will behave properly\n\t\tif (this.viewResults)\n\t\t\tviewResults = JSON.parse(JSON.stringify(this.getViewResults(this.searchModel.results)));\n\n\t\t// again if in mobile then the view results are simply the search model results\n\t\tif (this.isMobileViewport()) {\n\t\t\t// since no grouping in mobile, ensure all items have the hidden property to false\n\t\t\tthis.expandAll(viewResults);\n\t\t\tthis.viewResults = viewResults;\n\t\t\tthis.setGroupExpandedHandler(false);\n\t\t\treturn;\n\t\t}\n\n\t\t// we have a group by field and we are not in mobile, so lets apply the grouping\n\t\tlet groupFieldNames = [this.fieldSet.fields[0], 'Id']; // used to create grouper viewResult item in front of each set of grouped viewResults\n\t\tlet recordPath = 'record.' + this.searchModel.targetObjectName; // path from the searchModel.result item to the record object that contains the group\n\t\tlet groupCountPath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] , property: 'suffix' };\n\t\tlet groupFieldTypePath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] + '.md', property: 'type' };\n\n\t\t// initialize the grouper instance and group the viewResults\n\t\tlet grouper = new RecordGrouper(this.groupByField, groupFieldNames, recordPath, {hidden: true}, this.hiddenByGroup, {hidden: false}, groupCountPath, this.groupByFieldType, groupFieldTypePath);\n\t\tviewResults = grouper.group(viewResults);\n\n\t\tthis.rowsByGrouper = {};\n\t\tthis.groups = [];\n\t\tthis.viewResultsIds = [];\n\t\tthis.viewResultsIndexById = {};\n\t\tlet viewResultIndex = 0;\n\t\tfor (let viewResult of viewResults) {\n\t\t\tthis._indexViewResult(viewResult, viewResultIndex++);\n\t\t\tif (viewResult.grouper) {\n\t\t\t\tthis.rowsByGrouper[viewResult.grouper] = [];\n\t\t\t\tthis.groups.push(viewResult);\n\t\t\t}\n\t\t\telse if (this.rowsByGrouper[viewResult.groupie])\n\t\t\t\tthis.rowsByGrouper[viewResult.groupie].push(viewResult);\n\t\t}\n\n\t\tthis.viewResults = viewResults;\n\n\t\tthis.setGroupExpandedHandler(true);\n\n\t\t//if only one group then expand it by default\n\t\tif (this.viewResults.length === this.searchModel.results.length + 1) {\n\t\t\tthis.expandAll(this.viewResults);\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet groupRow = this.$$('sb-table-row'); // which must be the first row as only group\n\t\t\t\tgroupRow.grouperExpanded = true;\n\t\t\t\tthis.hiddenByGroup[groupRow.grouper] = {hidden: false};\n\t\t\t\tthis.expandRow({\n\t\t\t\t\tpath: [ groupRow ],\n\t\t\t\t\tdetail: { expanded: true, group: groupRow.grouper }\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\t// ensure all our rendered grouper rows are rendered as collapsed\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet expandedRows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row.expanded');\n\t\t\t\tfor (let expandedRow of expandedRows)\n\t\t\t\t\texpandedRow.setGrouperClasses(false);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetViewResults(products) {\n\t\tlet prefix = this.org.prefix ? this.org.prefix + '__' : '';\n\t\tlet results = [];\n\t\tfor (let product of products || []) {\n\t\t\tlet result = {record: {}};\n\t\t\tfor (let field in product.record) {\n\t\t\t\tif (field === 'UnitPrice' && product.record.Product2 && product.record.Product2[prefix + 'HidePriceInSearchResults__c']) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tresult.record[field] = product.record[field];\n\t\t\t}\n\t\t\tresults.push(result);\n\t\t}\n\t\treturn(results);\n\t}\n\n\tsetDisplayResults() {\n\t\tif (this.isMobileViewport() || !this.groupByField)\n\t\t\tthis._viewResults = this.viewResults;\n\t\telse {\n\t\t\tthis._viewResults = this.groups;\n\t\t}\n\t}\n\n\texpandAll(viewResults) {\n\t\tfor (let i = 0, l = viewResults.length; i < l; i++)\n\t\t\tviewResults[i].hidden = false;\n\t}\n\n\tisSelected(row) {\n\t\tif (!this.selectedRows)\n\t\t\treturn false;\n\t\tlet id = this.get(this.selectionIdDataPath, row);\n\t\treturn !!(this.selectedRows[id]);\n\t}\n\n\tisExpanded(group) {\n\t\treturn !!(this.hiddenByGroup[group] && this.hiddenByGroup[group].hidden === false);\n\t}\n\n\tsetGroupExpandedHandler(isGrouped) {\n\t\tthis.groupExpandedHandler = this.groupExpandedHandler || function (e) {\n\t\t\t\tthis.expandGroupedViewResults(e.detail.group, e.detail.expanded);\n\t\t\t}.bind(this);\n\t\tthis.removeEventListener('sb-row-group-tapped', this.groupExpandedHandler);\n\t\tif (isGrouped) this.addEventListener('sb-row-group-tapped', this.groupExpandedHandler);\n\t}\n\n\texpandGroupedViewResults(group, expanded) {\n\t\tfor (let i = 0, l = this.viewResults.length; i < l; i++) {\n\t\t\tif (group === this.viewResults[i].groupie)\n\t\t\t\tthis.set('viewResults.' + i + '.hidden', !expanded);\n\t\t}\n\t\tthis.hiddenByGroup[group] = {hidden: !expanded};\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t//when the searchModel.totalCount was 0, Polymer was not automatically updating the value through 2 way binding W-013313\n\t//additionally, we want the count to hide when it is 0 so we also update hasTotalCount\n\tupdateTotalCount() {\n\t\tif (this.searchModel.totalCount !== null)\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\tthis.hasTotalCount = this.totalCount > 0;\n\t}\n\n\t_getPrimaryMobileCols() {\n\t\tlet primaryMobileCols = [].concat(this.primaryMobileCols);\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone')) {\n\t\t\tlet parts = primaryMobileCols[0].split('.');\n\t\t\tlet prefix = parts.length > 1 ? (parts[0] + '.') : '';\n\t\t\tprimaryMobileCols[0] = prefix + this.fieldSet.fields[0];\n\t\t}\n\n\t\treturn primaryMobileCols;\n\t}\n\n\texpandMobileRow(e) {\n\t\tlet list = this.$$('#list');\n\t\tthis._setMobileExpandDetails(list, e.detail);\n\t\tlist.notifyResize();\n\t}\n\n\tselectMobileRow(e) {\n\t\tlet list = this.$$('#list');\n\t\tthis._setMobileSelectedDetails(list, e.detail);\n\t}\n\n\t_setMobileExpandDetails(list, expandDetails) {\n\t\tlet index = expandDetails.index;\n\t\tlet id = expandDetails.id;\n\t\tlet expanded = expandDetails.expanded;\n\t\tlet path = expandDetails.path;\n\t\tthis._setMobileDetails(list, index, id, 'expanded', expanded, path);\n\t}\n\n\t_setMobileSelectedDetails(list, selectedDetails) {\n\t\tlet index = selectedDetails.index;\n\t\tlet id = selectedDetails.id;\n\t\tlet selected = selectedDetails.selected;\n\t\tthis._setMobileDetails(list, index, id, 'selected', selected);\n\t}\n\n\t_setMobileDetails(list, index,id,  key, value, path) {\n\t\tlet virtualIndex = list._computeVidx(index) % list._physicalCount;\n\t\tif(!this.mobileRowDetails[virtualIndex])\n\t\t\tthis.mobileRowDetails[virtualIndex] = {};\n\t\tlet details = this.mobileRowDetails[virtualIndex];\n\t\tif(path)\n\t\t\tdetails.path = path;\n\t\tif(!details.ids)\n\t\t\tdetails.ids = {};\n\t\tif(!details.ids[id])\n\t\t\tdetails.ids[id] = {};\n\t\tdetails.ids[id][key] = value;\n\t}\n\n\texpandRow(e) {\n\t\tlet list = this.$$('#list');\n\t\tif (list && e.detail.expanded !== undefined) {\n\t\t\tlet scrollToIndex = null;\n\t\t\tlet eventPath = e.path || Polymer.dom(e).path;\n\t\t\tlet groupStart = eventPath[0].index + 1;\n\t\t\tif (e.detail.expanded) {\n\t\t\t\tlet args = [groupStart, 0].concat(this.rowsByGrouper[e.detail.group]);\n\t\t\t\t// using the array's native splice function here, so will need to do an explicy notify below\n\t\t\t\tthis._viewResults.splice.apply(this._viewResults, args);\n\t\t\t\t// this notify will invoke iron-list._itemsChanges observer function which will in turn call its _render function.\n\t\t\t\tthis._notifySplice(this._viewResults, '_viewResults', groupStart, args.length - 1, []);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// round scroll position up so that the firstVisibleIndex calculation is done properly\n\t\t\t\tlist._scrollPosition = Math.ceil(list._scrollPosition);\n\t\t\t\t// we will scroll to this index after we removed collapsed rows to ensure collapsed group remains in same place post collapse as it did pre collapse\n\t\t\t\tscrollToIndex = list.firstVisibleIndex;\n\t\t\t\t// using polymer's splice function here will invoke iron-list._itemsChanges observer function which will in turn call its _render function.\n\t\t\t\tthis.splice('_viewResults', groupStart, this.rowsByGrouper[e.detail.group].length);\n\t\t\t}\n\n\t\t\t// force update scroller size after next render to handle iron-list bug\n\t\t\t// or if scrollToIndex is non null (like in the collapsed use case) simply scroll to that index which will implicitly update the scroller size\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this._adjustScrollAfterExpandRow.bind(this, list, scrollToIndex));\n\t\t}\n\t}\n\n\t_adjustScrollAfterExpandRow(list, scrollToIndex) {\n\t\tif(scrollToIndex != null)\n\t\t\tlist.scrollToIndex(scrollToIndex);\n\t\telse\n\t\t\tlist._updateScrollerSize(true);\n\t}\n\n\tindexViewResults() {\n\t\tif(this.viewResultsIds != null)\n\t\t\treturn;\n\n\t\tthis.viewResultsIds = [];\n\t\tthis.viewResultsIndexById = {};\n\n\t\tlet index = 0;\n\t\tfor(let viewResult of this.viewResults)\n\t\t\tthis._indexViewResult(viewResult, index++);\n\n\t}\n\n\t_indexViewResult(viewResult, index) {\n\t\tlet id = this.get('record.' + this.selectionIdDataPath, viewResult);\n\t\tthis.viewResultsIds.push(id);\n\t\tthis.viewResultsIndexById[id] = index;\n\t}\n\n\t_isValidViewResultId(id) {\n\t\treturn this.viewResultsIds.indexOf(id) !== -1\n\t}\n\n\t_getMaxResultsToSelectAll() {\n\t\treturn this.maxSelectAll || MAX_NUM_RESULTS_TO_SELECT_ALL;\n\t}\n\n\t_isDisableHeaderSelection() {\n\t\treturn this.viewResults.length > this._getMaxResultsToSelectAll();\n\t}\n\n\t_getHeaderSelectionTooltip() {\n\t\tif(this.headerSelectionDisabled)\n\t\t\treturn this.i18n.l(`Reduce search results to fewer than {0} to enable select all`, [this._getMaxResultsToSelectAll()]);\n\t}\n\n\t_getExpandedDetails(row, index) {\n\t\treturn this._getMobileDetails(row, index, 'expanded', true);\n\t}\n\n\t_getSelectedDetails(row, index) {\n\t\treturn this._getMobileDetails(row, index, 'selected');\n\t}\n\n\t_getMobileDetails(row, index, key, includePath) {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn null;\n\n\t\tlet list = this.$$('#list');\n\t\tlet virtualIndex = list._computeVidx(index) % list._physicalCount;\n\t\tlet details = this.mobileRowDetails[virtualIndex] || null;\n\t\tif(!details)\n\t\t\treturn null;\n\n\t\tlet id = this.get(this.selectionIdDataPath, row);\n\t\tlet value = !!(details.ids[id] && details.ids[id][key]);\n\n\t\tlet response = {};\n\t\tresponse[key] = value;\n\n\t\tif(includePath)\n\t\t\tresponse.path = details.path;\n\t\treturn response;\n\t}\n\n\t_resetMobileDetails() {\n\t\tfor(let index in this.mobileRowDetails) {\n\t\t\tlet details = this.mobileRowDetails[index];\n\t\t\tfor(let id in details.ids)\n\t\t\t\tdetails.ids[id] = {};\n\t\t}\n\t}\n\n\t_scrollHandler() {\n\t\tif (!this.isMobileViewport())\n\t\t\treturn;\n\n\t\t// disabled expand while scrolling\n\t\tthis.expandDisabled = true;\n\t\tif(this._enabledExpand)\n\t\t\tclearTimeout(this._enabledExpand);\n\n\t\t// queue a timeout to enable expand when scrolling has stopped\n\t\tthis._enabledExpand = setTimeout(function() {\n\t\t\tthis.expandDisabled = false;\n\t\t}.bind(this), 200);\n\t}\n\n\t// used by web automation test harness, so do not remove\n\n\ttest_scrollToTarget(target) {\n\t\tif(!target)\n\t\t\treturn;\n\n\t\tlet index = target.index;\n\t\tif(index == null)\n\t\t\tindex = this._findRowIndex(target);\n\n\t\tif(index < 0)\n\t\t\treturn;\n\n\t\tthis.$$('#list').scrollToIndex(index);\n\t}\n\n\t_findRowIndex(target) {\n\t\tif(!target)\n\t\t\treturn -1;\n\n\t\tlet keys = Object.keys(target);\n\t\tlet numKeys = keys.length;\n\t\tif(numKeys === 0)\n\t\t\treturn -1;\n\n\t\tfor(let i = 0, l = this.viewResults.length; i < l; i++) {\n\t\t\tlet record = this.viewResults[i].record;\n\t\t\tlet match = true;\n\t\t\tfor(let j = 0; j < numKeys; j++)\n\t\t\t\tmatch = match && record[keys[j]] === target[keys[j]];\n\n\t\t\tif(match)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn -1;\n\t}\n}\n\nPolymer(LookupLayout);\n","export class Popup {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-popup';\n\t\tthis.properties = {\n\t\t\turl: String,\n\t\t\tmessenger: Object,\n\t\t\tchannel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sbQQ'\n\t\t\t},\n\t\t\tresponseMessage: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclosePopup: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-popup'\n\t\t\t},\n\t\t\tautoLaunched: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tbackOnCancelOrClose: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_appendLargeClass'\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.close.bind(this));\n\t}\n\n\topen() {\n\t\tthis._initRpc();\n\t\tthis._sendMessage();\n\t\tthis._handleAutoLaunch();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tclose() {\n\t\tthis._close(this._getRedirectDetails(false));\n\t}\n\n\t_close(redirectDetails) {\n\t\tif(this.rpc) this.rpc.destroy();\n\t\tthis.$.dialog.toggle();\n\t\tlet frame = this.$.dialog.$$('#content').querySelector(`#easyXDM_${this.channel}_provider`);\n\t\tlet detail = { redirect: redirectDetails };\n\t\tif(frame) frame.remove();\n\t\tif(this.responseMessage) { // if iframe is closed, no response message is sent\n\t\t\tdetail.featureOptionIds = this.responseMessage.featureOptionIds;\n\t\t\tdetail.dynamicOptions = this.responseMessage.dynamicOptions;\n\t\t}\n\t\tthis.fire('iron-signal', { name: 'sb-navigation-changed' } ); // closes the action menu\n\t\tthis.fire(this.closePopup, detail);\n\t}\n\n\t_initRpc() {\n\t\tif(!this.url)\n\t\t\treturn;\n\n\t\tthis.rpc = new easyXDM.Rpc(\n\t\t\t{ remote: this.url, container: this.$.dialog.$$('#content'), channel: this.channel },\n\t\t\t{ remote: { postMessage: {} }, local: { postMessage: this._receiveMessage.bind(this) }\n\t\t});\n\t}\n\n\t_sendMessage() {\n\t\tlet outgoing = {};\n\t\tif(this.messenger && typeof this.messenger.getRequest === 'function')\n\t\t\toutgoing = this.messenger.getRequest();\n\n\t\toutgoing.redirect = this._getRedirectDetails(this.autoLaunched);\n\t\tthis.rpc.postMessage(JSON.stringify(outgoing));\n\t}\n\n\t_handleAutoLaunch() {\n\t\tif(this.autoLaunched)\n\t\t\tthis.fire('iron-signal', { name: 'sb-auto-launch-popup' } );\n\t}\n\n\t_receiveMessage(incoming) {\n\t\tthis.debounce('_receiveMessage', function () {\n\t\t\tif(!this.messenger || typeof this.messenger.getResponse !== 'function') {\n\t\t\t\tthis.close();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet received = JSON.parse(incoming);\n\t\t\tthis._logReceivedMessage(received);\n\t\t\tthis.responseMessage = this.messenger.getResponse(received);\n\t\t\tlet redirectDetails = received.redirect ? received.redirect : this._getRedirectDetails(this.autoLaunched);\n\t\t\tif(redirectDetails.back === undefined) redirectDetails.back = !redirectDetails.save && this.backOnCancelOrClose;\n\t\t\tthis._close(redirectDetails);\n\t\t}.bind(this), 100);\n\t}\n\n\t_logReceivedMessage(received) {\n\t\tconsole.log('RPC Received Message:');\n\t\tconsole.log(received);\n\t}\n\n\t_getRedirectDetails(redirect) {\n\t\t// redirect.back should always be driven from property, unless it is defined by user in 'receiveMessage'\n\t\treturn { auto: !!(redirect), save: !!(redirect), back: this.backOnCancelOrClose };\n\t}\n\n\t_appendLargeClass() {\n\t\tthis.toggleClass(\n\t\t\t'largeView',\n\t\t\tthis.backOnCancelOrClose,\n\t\t\tPolymer.dom(this.$$('sb-dialog').root).querySelector('.sbDialog')\n\t\t);\n\t}\n}\nPolymer(Popup);","import {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class RowDrawer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-row-drawer';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thighlightOnFocus: {\n\t\t\t\ttype:Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_highlightOnFocus'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ 'generateColumns(fieldNames, model, richTextFields)' ];\n\t}\n\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [],\n\t\t\tnumFields = this.fieldNames.length,\n\t\t\tfields = this.fieldNames.slice(0);\n\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif (this.richTextFields.indexOf(fields[i]) !== -1)\n\t\t\t\tcontinue;\n\t\t\telse if ( i % 3 == 0)\n\t\t\t\tcolumn1Group.push(fields[i]);\n\t\t\telse if ( i % 3 == 1)\n\t\t\t\tcolumn2Group.push(fields[i]);\n\t\t\telse\n\t\t\t\tcolumn3Group.push(fields[i]);\n\t\t}\n\n\t\t// set columnWidth so that width styling is applied to each column\n\t\tthis.columnWidth = 'drawer';\n\n\t\tlet columnGroups = [this.richTextFields, column1Group, column2Group, column3Group];\n\t\tthis.setColumns(columnGroups);\n\t}\n\n\tsetColumns(columnGroups) {\n\t\tlet columns = [this.$.rteColumn, this.$.firstColumn, this.$.secondColumn, this.$.thirdColumn];\n\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\tif (columnGroups[i].length > 0) {\n\t\t\t\tcolumns[i].destroyGroup();\n\t\t\t\tcolumns[i].model = this.model;\n\t\t\t\tcolumns[i].itemClass = 'drawerCell';\n\t\t\t\tcolumns[i].group = columnGroups[i];\n\t\t\t}\n\t\t}\n\t}\n\n\t_highlightOnFocus() {\n\t\tthis.signaler = new RowFocusSignaler(this, ['rteColumn', 'firstColumn', 'secondColumn', 'thirdColumn'], this.item);\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightOnFocus);\n\t}\n\n}\n\nPolymer(RowDrawer);","export class SidePanel{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-side-panel';\n\t\tthis.properties = {\n\t\t\trenderHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ticon: String,\n\t\t\tarrows: String,\n\t\t\t/**\n\t\t\t * Label for the side panel\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tsideText: String,\n\t\t\t/**\n\t\t\t * Boolean that hides and shows the panel slideout button\n\t\t\t * @type {Boolean}\n\t\t\t */\n\t\t\trightSideButton: Boolean\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setIcon(isOpen)']\n\t}\n\n\tcloseDrawer() {\n\t\tthis.fire('x-clicked');\n\t}\n\n\tkeyCheck(event) {\n\t\tif (event.keyCode == 13) {\n\t\t\tthis.fire('enter-keypress');\n\t\t}\n\t}\n\n\ttoggleDrawer() {\n\t\tthis.fire('side-toggle-clicked');\n\t}\n\n\tsetIcon() {\n\t\tif (this.isOpen === \"open\") {\n\t\t\tthis.icon = 'sf-icon-left';\n\t\t}\n\t\telse {\n\t\t\tthis.icon = 'sf-icon-right';\n\t\t\tthis.arrows = 'closedArrows';\n\t\t}\n\t}\n}\n\nPolymer( SidePanel );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from \"../../core/AppContext.js\";\n\nexport class SwipeContainer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-swipe-container';\n\n\t\tthis.listeners = {\n\t\t\t'expanded-changed': 'onGroupExpanded'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpreventSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisRequiredRowNotSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tgroupExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_expansionChanged'\n\t\t\t},\n\t\t\tswipeHeader: Object,\n\t\t\tswipeMenu: Object,\n\t\t\tswipeItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tswipeItemWidth: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 58\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tvariant: String,\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_preventSwipe(isRequiredRowNotSelected)'\n\t\t];\n\t}\n\n\t_preventSwipe() {\n\t\tthis.preventSwipe = this.isRequiredRowNotSelected || this.groupExpanded;\n\t}\n\n\tonGroupExpanded(e) {\n\t\tthis.groupExpanded = e.detail.expanded;\n\t\tthis._preventSwipe();\n\t}\n\n\tattached() {\n\t\tlet isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tif (!isMobile || this.disableSwipe) {\n\t\t\tthis.style.minWidth = \"100%\";\n\t\t\tthis.style.position = \"static\";\n\t\t\treturn;\n\t\t}\n\n\t\tPolymer.dom(this.$.content).observeNodes(\n\t\t\tfunction(mutations) {\n\t\t\t\tfor (var i = 0; i < mutations.addedNodes.length; i++) {\n\t\t\t\t\tthis._findSwipeHeaderAndMenu(mutations.addedNodes[i]);\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\t}\n\n\t_expansionChanged(groupExpanded) {\n\t\tif(this.variant === \"ui3qle\") {\n\t\t\t//this will toggle the prevent swipe flag\n\t\t\tthis._preventSwipe();\n\t\t}\n\t}\n\n\t_findSwipeHeaderAndMenu(node) {\n\t\tif (node.nodeType === Node.TEXT_NODE || node.nodeType === Node.COMMENT_NODE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.id === 'swipe-header') {\n\t\t\tthis._initSwipeHeader(node);\n\t\t\treturn;\n\t\t}\n\t}\n\n\n\t_initSwipeHeader(node) {\n\t\tvar swipeHeader = this.swipeHeader = node;\n\t\tvar swipeHeaderStyle = swipeHeader.style;\n\n\t\t// this.viewport is a necessary operand to pass a test in table-row that requires a viewport\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tswipeHeaderStyle.maxWidth = '100%';\n\t\t\tswipeHeaderStyle.display = 'table';\n\n\t\t\treturn;\n\t\t}\n\n\t\t if(this.variant !== \"ui3qle\"){\n\t\t\tswipeHeaderStyle.maxWidth = '50%';\n\t\t\tswipeHeaderStyle.position = 'relative';\n\t\t}\n\n\t\tthis.listen(node, 'track', '_onTrack');\n\t\tthis.setScrollDirection('y', node);\n\t}\n\n\t_closeMenuWhenTapped(swipeMenu, swipeContainer) {\n\t\tswipeMenu.addEventListener('tap', function() {\n\t\t\tswipeContainer._animate(100, 1, swipeContainer.swipeHeader);\n\t\t});\n\t}\n\t_initSwipeMenu(node) {\n\t\tnode.style.maxWidth = '50%';\n\t\tthis._closeMenuWhenTapped(node, this);\n\n\t\tif (this.swipeItems && this.swipeItems.length) {\n\t\t\tfor (var k = 0; k < this.swipeItems.length; k++) {\n\t\t\t\tvar swipeItem = this.swipeItems[k];\n\t\t\t\tswipeItem.style.position = '';\n\t\t\t\tswipeItem.style.width = '0px';\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeMenu = node;\n\t\tvar allNodesOfSwipeMenu = [],\n\t\t\tswipeMenuItems = [];\n\n\t\t// if the browser supports shadowRoot (Chrome)\n\t\tif (node.children[0].shadowRoot) {\n\t\t\tPolymer.dom(node.children[0].shadowRoot).flush();\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS') {\n\t\t\t\tPolymer.dom(node.children[0].shadowRoot).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].shadowRoot.children;\n\t\t\t} else if (node.children[0].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t// else the browser doesn't support shadowRoot (Safari, Firefox)\n\t\t} else {\n\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS' || node.children[0].nodeName === 'SF-LINE-ACTIONS') {\n\t\t\t\t// Necessary for when one action is displayed\n\t\t\t\tPolymer.dom(node.children[0]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].children;\n\t\t\t} else if (node.children[1].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tPolymer.dom(node.children[1]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (var i = 0, len = allNodesOfSwipeMenu.length; i < len; i++) {\n\t\t\tvar currentNode = allNodesOfSwipeMenu[i];\n\n\t\t\tif (this._isValidSwipeMenuItem(currentNode)) {\n\t\t\t\tswipeMenuItems.push(currentNode);\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeItems = swipeMenuItems;\n\n\t\tvar width = this.swipeItemWidth * this.swipeItems.length;\n\n\t\tnode.style.width = width + 'px';\n\n\t\tfor (var j = 0, swipeItemsLen = this.swipeItems.length; j < swipeItemsLen; j++) {\n\t\t\tlet swipeItem  = this.swipeItems[j];\n\n\t\t\tthis.toggleClass('swipe-menu-item', true, swipeItem);\n\n\t\t\tvar speed = ((200 - ((swipeItemsLen - 1) * 20)) * swipeItemsLen);\n\n\t\t\tthis.style.transition  = 'transform ' + speed + 'ms ease-out';\n\t\t\tthis._setSwipeItemStyles(swipeItem.style, speed, width);\n\t\t}\n\t}\n\n\t_setSwipeItemStyles(swipeItemStyle, speed, width) {\n\t\tswipeItemStyle.transition               = 'transform ' + speed + 'ms ease-out';\n\t\tswipeItemStyle.webkitBackfaceVisibility = 'hidden';\n\t\tswipeItemStyle.borderRadius             = 0;\n\t\tswipeItemStyle.position                 = 'absolute';\n\t\tswipeItemStyle.left                     = 0;\n\t\tswipeItemStyle.height                   = '100%';\n\t\tswipeItemStyle.width                    = '57px';\n\t}\n\n\t_onTrack(event) {\n\t\tif(!this.swipeMenu) {\n\t\t\tvar node = this.querySelector('#swipe-menu');\n\t\t\tif(node) {\n\t\t\t\tthis._initSwipeMenu(node);\n\t\t\t}\n\t\t}\n\n\t\tif (this.preventSwipe || !this.swipeItems.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar target = event.currentTarget,\n\t\t\ttrack = event.detail;\n\n\t\tif (track.state === 'track') {\n\t\t\tthis._trackMove(track, target);\n\t\t}\n\t}\n\n\t_trackMove(event, target) {\n\t\tthis._animate(event.dx, event.dy, target);\n\t}\n\n\t_animate(dx, dy, blah) {\n\t\tvar direction = dx > 0 ? 1 : -1;\n\n\t\tif (direction === -1 && Math.abs(dy) < 20 && dx < -60) {\n\t\t\tthis.fire('row-swiped', {'isOpen': true });\n\n\t\t\tvar cho = parseFloat(getComputedStyle(this.swipeItems[0]).width);\n\t\t\tvar nag = cho.toPrecision(5) * this.swipeItems.length;\n\n\t\t\tvar distance = nag * direction;\n\t\t\tthis.style.transform = 'translate3d(' + (distance) + 'px, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\n\t\t\tfor (var i = this.swipeItems.length - 1; i >= 0; i--) {\n\t\t\t\tvar dist = i * cho.toPrecision(5);\n\t\t\t\tthis.swipeItems[i].style.width = cho.toPrecision(5) + 'px';\n\t\t\t\tthis.swipeItems[i].style.transform = 'translate3d(' + dist + 'px, 0, 0)';\n\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (direction === 1 && Math.abs(dy) < 20 && dx > 25) {\n\t\t\tthis.fire('row-swiped', {'isOpen': false });\n\n\t\t\tvar originalPosition  = 0;\n\t\t\tthis.style.transform = 'translate3d(' + originalPosition + '%, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\t\t\tfor (var i = 0; i < this.swipeItems.length; i++) {\n\t\t\t\tvar trans = 'translate3d(' + originalPosition + '%, 0, 0)';\n\n\t\t\t\tthis.swipeItems[i].style.transform = trans;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_isValidSwipeMenuItem(currentNode) {\n\t\tif (this.variant === \"ui3qle\") {\n\t\t\treturn currentNode.nodeName.toLowerCase() === 'button';\n\t\t} else {\n\t\t\tif ((currentNode.nodeName.toLowerCase() === 'span' || (currentNode.$$ && currentNode.$$('span'))) && !currentNode.classList.contains('ignore-in-mobile')) {\n\t\t\t\tif (currentNode.$$ && currentNode.$$('span')) {\n\t\t\t\t\tvar fav = currentNode.$$('span');\n\n\t\t\t\t\tif ((fav.id === 'removeFromFavBtn' || fav.id === 'addToFavBtn') && (fav.style.display === 'none')) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!currentNode.classList.contains('visibilityHidden')) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tcurrentNode.style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nPolymer(SwipeContainer);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thide: Object, // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, value, model, data)',\n\t\t\t'setDisabled(data.disabled)',\n\t\t\t'setRecordId(data.Id)',\n\t\t\t'overrideWidth(data.fullWidthItem)',\n\t\t\t'dataChanged(data, item)'\n\t\t];\n\t}\n\n\tbuildCell() {\n\t\tthis.setDisabled();\n\t\tthis.setHidden();\n\t\tthis.setRecordId();\n\t\tthis.setSuffix();\n\n\t\tif (this.model && this.model[this.item] && this.model[this.item].type) {\n\t\t\tthis.setFieldMetadataFromModel();\n\t\t\treturn;\n\t\t}\n\t\t// if no model then infer the type based on the item name\n\t\tlet type = 'string';\n\t\tthis.md = this.md || {type: type};\n\t}\n\n\tsetDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\tsetHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tthis.hide = new FieldHider(hidden).hide;\n\t}\n\n\tsetRecordId() {\n\t\tthis.recordId = this.data ? this.data.Id : null;\n\t}\n\n\tsetSuffix() {\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'suffix']) != null)\n\t\t\tthis.suffix = this.get(['data', '_transient_', this.item, 'suffix']);\n\t\telse\n\t\t\tthis.suffix = undefined;\n\t}\n\n\toverrideWidth() {\n\t\tif (this.data && this.data.fullWidthItem && this.classList.contains(this.data.fullWidthItem)) this.style.width = '100%';\n\t\telse if (this.style.width == '100%') this.style.width = null;\n\t}\n\n\tsetFieldMetadataFromModel() {\n\t\tlet md = this.model[this.item];\n\t\t// lets check if the data has an override metadata property for this particular item, if so lets use it\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'md']) != null)\n\t\t\tmd = this.get(['data', '_transient_', this.item, 'md']);\n\t\t// set this programmatically before assigning md to ensure they are set in FF before the render function\n\t\tthis.$.field.link = !!(md.link);\n\t\tthis.$.field.readOnly = true;\n\t\t// now we set the metadata to trigger the sb-field processing\n\t\tthis.md = md;\n\t}\n\n\tdataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(TableCell);","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCellSelect {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell-select';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tisRadio: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isRadio(item)'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'init'\n\t\t\t}\n\t\t}\n\t}\n\n\tinit() {\n\t\tif(this._attached) {\n\t\t\tthis._setDisabled();\n\t\t\tthis._setHidden();\n\t\t\treturn;\n\t\t}\n\t\tPolymer.dom(this.$.s).observeNodes(function () {\n\t\t\tthis._setDisabled();\n\t\t\tthis._setHidden();\n\t\t\tthis._attached = true;\n\t\t}.bind(this));\n\t}\n\n\t_isRadio() {\n\t\treturn this.item === 'radio';\n\t}\n\n\t_setDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\t_setHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tlet hider = new FieldHider(hidden, Polymer.Base);\n\t\thider.applyTo(this.$$('#' + this.item));\n\t}\n}\n\nPolymer(TableCellSelect);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-header';\n\t\tthis.properties = {\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tselectable: Boolean, // true if the row's left most column selectable\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectionTooltip: String,\n\t\t\theaderClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\theaderActions: Array,\n\t\t\thideHiddenSelectable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tget observers() {\n\t\treturn [ 'buildLabels(cols, headerClassMap, columnWidths)',\n\t\t\t'setSelectable(selectable, selectionType)',\n\t\t\t'setSelected(selected, selectable, selectionType)'];\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tbuildLabels() {\n\t\tvar data = {};\n\t\tvar group = [];\n\t\tthis.cols.forEach(function (col) {\n\t\t\tif (!col)\n\t\t\t\treturn;\n\n\t\t\t// don't replace Japanese characters\n\t\t\tvar item = col.replace(/(?![\\u3000-\\u303F]|[\\u3040-\\u309F]|[\\u30A0-\\u30FF]|[\\uFF00-\\uFFEF]|[\\u4E00-\\u9FAF]|[\\u2605-\\u2606]|[\\u2190-\\u2195]|\\u203B)\\W/g, '');\n\t\t\tgroup.push(item);\n\t\t\tdata[item] = col;\n\t\t});\n\n\t\tthis.$.header.data = undefined;\n\t\tthis.$.header.itemClassMap = this.headerClassMap;\n\t\tthis.$.header.columnWidths = this.columnWidths;\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = group;\n\t\tthis.$.header.data = data;\n\t}\n\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tif(this.registeredDataChangedHandler)\n\t\t\treturn;\n\n\t\tthis.registeredDataChangedHandler = true;\n\t\tPolymer.RenderStatus.afterNextRender(this, this.registerSelectionChangedHandler.bind(this));\n\t}\n\n\tregisterSelectionChangedHandler() {\n\t\tthis.$.selection.addEventListener('data-changed', this.selectionChangedHandler.bind(this));\n\t}\n\n\tselectionChangedHandler(e) {\n\t\t// in Chrome this is event is fired twice, so return early for the root target we don't care about\n\t\tif(Polymer.dom(e).rootTarget.nodeName.toLowerCase() === 'template')\n\t\t\treturn;\n\n\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\tthis.internal = false;\n\t\tthis.fire('header-selection-changed', {selected: this.selected});\n\t}\n\n\tsetSelected() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tlet key = this.selectionType === 'radio' ? 'radio' : 'checkbox';\n\t\tif(!this.$.selection.group)\n\t\t\tthis.$.selection.group = [key];\n\t\tlet selectionData = { disabled: this.selectionDisabled };\n\n\t\tlet value = this.selected;\n\t\tselectionData[key] = value;\n\t\tlet hidden = new FieldHider(!this.selectable).hide;\n\t\thidden.type = 'invisible';\n\t\tselectionData.hidden = hidden;\n\t\tthis.$.selection.data = selectionData;\n\n\t\tlet hideSelection = this.hideHiddenSelectable ? !this.selectable : false;\n\t\tthis.toggleClass('hidden', hideSelection, this.$.selection);\n\t}\n\n\t_showHeaderActions(position) {\n\t\tif (!this.headerActions || this.headerActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.headerActions.length; i < l; i++) {\n\t\t\tif (this.headerActions[i].position == position && !this.headerActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\nPolymer(TableHeader);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class TableRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tcell: String, // name of the component that represents an table cell in the row\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tcolsDisplay: Object,// map whose keys match the cols array items and value is used for display purposes\n\t\t\trowActions: Array, // array of strings that represents actions for the options\n\t\t\trouteSource: String,\n\t\t\trowData: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each cell item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trequiresModel: { // set to true if model in your use case is not optional and you do not want to build rows until model is not null\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectable: {// true if the row's left most column is selectable\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tdisabledData: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\t'disabled': false,\n\t\t\t\t\t'constrained': false\n\t\t\t\t}\n\t\t\t},\n\t\t\tselectionIdDataPath: { // path on the data object that contains the selection id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Id'\n\t\t\t},\n\t\t\tparentIdDataPath: { // path on the data object that contains the parent's id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Parent'\n\t\t\t},\n\t\t\tparentAttributesPath: String, // if on selection you want the data attribute property, specify the path\n\t\t\tprimaryMobileCols: { // columns whose value will be primary display for this row when in the mobile viewport\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\trepeatPrimaryMobileCols: { // if true then the primary columns should be repeated in the mobile drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: 'setIsMobile(viewport)'\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setActionId(isMobile)'\n\t\t\t},\n\t\t\tgrouper: String, // if non nil then this row represents a group and can show/hide its groupie rows.\n\t\t\tgrouperExpanded: Boolean, // if true then the grouper row should default in the expanded state\n\t\t\tgroupie: String, // if non nil indicates what group this row is a groupie of and therefore can be shown or hidden by its grouper row\n\t\t\tignoreViewportChange: Boolean,\n\t\t\trowClassMap: {\n\t\t\t\ttype: Object, // map of field to its type\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\teditFirstWhenSelected: { // enables editing to the provided child element of the first cell when the row is selected\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tindex: {\n\t\t\t\ttype: Number, // the index of the row in the context of its table container\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_broadcastMobileExpanded'\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trowSwiped: {\n\t\t\t\ttype:Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideSelection: { // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tselectionClass: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tleftClass: { // class to adjust red line on required configurations for selection method of not add\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tcomputed: 'setLeftClass(routeSource, rowData, selected)'\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t},\n\t\t\tdeferGrouping: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectionOnLoad: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tforceColumnWidths: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobileExpandedDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'expandMobileRow'\n\t\t\t},\n\t\t\tmobileSelectedDetails: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'selectMobileRow'\n\t\t\t},\n\t\t\tdisableSelectionTabFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasTogglePlaceholder: Boolean,\n\t\t\thasToggle: Boolean,\n\t\t\ttogglePlaceholder: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_hasTogglePlaceholder(hasTogglePlaceholder, hasToggle)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildRow(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths)',\n\t\t\t'setSelectable(selectable, selectionOnLoad)',\n\t\t\t'setSelected(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass)',\n\t\t\t'setGrouper(rowData, grouper)',\n\t\t\t'setGrouperClasses(grouperExpanded, grouper)'\n\t\t];\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.rowSwiped = e.detail.isOpen;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tsetActionId(isMobile) {\n\t\treturn isMobile ? 'swipe-menu' : '';\n\t}\n\n\tbuildRow() {\n\t\tif(this.requiresModel && !this.model)\n\t\t\treturn; // bail if requires model and model is not yet non nil\n\n\t\tthis.$.row.item = undefined;\n\t\tthis.$.row.groupDisplay = undefined;\n\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t\tthis.setFullWidthIfGroupRow();\n\t\tthis.$.row.columnWidths = this.forceColumnWidths ? this._cloneColumnWidths() : this.columnWidths;\n\t\tthis.$.row.itemClassMap = this.rowClassMap;\n\t\tthis.$.row.groupDisplay = this.colsDisplay;\n\t\tif(!this.$.row.group)\n\t\t\tthis.$.row.group = this.cols;\n\t\tthis.$.row.item = this.cell;\n\t}\n\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tif(this.registeredDataChangedHandler)\n\t\t\treturn;\n\n\t\tthis.registeredDataChangedHandler = true;\n\n\t\tif(this.selectionOnLoad)\n\t\t\tthis.registerSelectionChangedHandler();\n\t\telse\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this.registerSelectionChangedHandler.bind(this));\n\t}\n\n\tregisterSelectionChangedHandler() {\n\t\tthis.$.selection.addEventListener('data-changed', this.selectionChangedHandler.bind(this));\n\t}\n\n\tselectionChangedHandler(e) {\n\t\t// in Chrome this is event is fired twice, so return early for the root target we don't care about\n\t\tif(Polymer.dom(e).rootTarget && Polymer.dom(e).rootTarget.nodeName.toLowerCase() === 'template')\n\t\t\treturn;\n\n\t\tlet selected = this.selected;\n\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\tthis.$.row.selected = this.selected;\n\t\tthis.internal = false;\n\n\t\tlet changed = selected !== this.selected;\n\t\tlet path = e.detail.path === 'data.checkbox' || e.detail.path == 'data.radio';\n\t\tif(this.editFirstWhenSelected && this.selected && changed)\n\t\t\tthis.editFirst();\n\n\t\tif(this.selectionOnLoad && this._selectedChangeByParent)\n\t\t\t// afterNextRender ensures row is built out before firing the selection event\n\t\t\t//// product rules should only fire when path originates from selection group.\n\t\t\t//// check is made in ProductConfig handleChangeEvents\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this.fireSetSelectionEvent.bind(this, changed, path));\n\t\telse\n\t\t\tthis.fireSetSelectionEvent(changed, path);\n\t}\n\n\teditFirst() {\n\t\tlet itemToEdit = this.$.row.$$(this.cell).$$(this.editFirstWhenSelected);\n\t\tif(itemToEdit && typeof itemToEdit.edit === 'function')\n\t\t\titemToEdit.edit()\n\t}\n\n\tfireSetSelectionEvent(changed, path) {\n\t\tthis.fire('selection-changed', {\n\t\t\tselected: this.selected,\n\t\t\tselectionType: this.selectionType,\n\t\t\tId: this.get('rowData.' + this.selectionIdDataPath),\n\t\t\tbundleId: this.get('rowData.' + this.parentIdDataPath),\n\t\t\tattributes: this.parentAttributesPath === undefined ? undefined : this.get('rowData.' + this.parentAttributesPath),\n\t\t\tgroup: this.grouper,\n\t\t\tchanged: changed,\n\t\t\tpath: path,\n\t\t\tindex: this.index,\n\t\t\trowData: this.rowData,\n\t\t\tautoSelectGroupRows: !this._selectedChangeByParent\n\t\t});\n\t}\n\n\tsetSelected() {\n\t\tif (!this.selectable || this.internal)\n\t\t\treturn;\n\n\t\t// flag that we are changing the selection state because bound properties were changed by this component's parent\n\t\t// in this case we will not set the group when firing the selection-changed event as a group's groupies (i.e. child rows)\n\t\t// should only be auto selected if the grouper row selection was triggered by the user (clicking the checkbox) and not by the parent component\n\t\tthis._selectedChangeByParent = true;\n\t\tthis._setSelected(this.selected);\n\t\tthis._selectedChangeByParent = false;\n\t}\n\n\t_setSelected(selected) {\n\t\tif (this.disabledData.constrained && selected === true) {\n\t\t\tthis.internal = true;\n\t\t\tthis.$.row.fire('group-selected', {selected: false});\n\t\t\tselected = false;\n\t\t\tthis.internal = false;\n\t\t}\n\n\t\tlet defaultHidden = new FieldHider(this.routeSource === 'Configurator' && this.hasDeleteAction()).hide;\n\t\tif(this.hideSelection != null) {\n\t\t\tlet hidden = new FieldHider(this.hideSelection).hide;\n\t\t\tPolymer.Base.extend(defaultHidden, hidden); // union this components hideSelection with the default\n\t\t}\n\n\t\tif(this.disableSelectionTabFocus)\n\t\t\tthis.$.selection.tabIndex = \"-1\";\n\n\t\tthis.selectionData = { hidden: defaultHidden };\n\t\tthis.selectionData[this.selectionType] = selected;\n\t\tthis.selectionData.disabled = this.disabledData.disabled || this.disabledData.constrained;\n\t\tthis.$.selection.data = this.selectionData;\n\t\t//W-013831: select all was taking 1-2 seconds because we were rebuilding the group every time\n\t\t//there is no known use case at this time for rebuilding the group so adding this if check\n\t\tif(this.$.selection.group === undefined)\n\t\t\tthis.$.selection.group = [this.selectionType];\n\t\tthis.toggleClass('td', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selectionContainer);\n\t\tthis.toggleClass('innerTd', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tthis.toggleClass('selection', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tif(this.selectionClass)\n\t\t\tthis.toggleClass(this.selectionClass, true, this.$.selection);\n\t}\n\n\tselect(e) {\n\t\tif(this.selectionData !== undefined && this.selectionData.disabled === true)\n\t\t\treturn;\n\t\tlet rootTarget = Polymer.dom(e).rootTarget;\n\t\tlet tagName = rootTarget && rootTarget.tagName ? rootTarget.tagName.toLowerCase() : '';\n\t\tif(tagName === 'sb-group')\n\t\t\tthis._setSelected(!this.selected);\n\n\t\tthis._broadcastGroupSelected(this.selected);\n\t\tthis._broadcastMobileSelected();\n\t}\n\n\t_broadcastGroupSelected(selected) {\n\t\tthis._groupSelected = selected;\n\t\tthis.$.row.fire('group-selected', {\n\t\t\tselected: selected,\n\t\t\tselectionDisabled: this.selectionDisabled,\n\t\t\ttableRow: this\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tif(this.expandDisabled || this.rowSwiped) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expandPath = e.detail && e.detail.preventer ? Polymer.dom(e.detail.preventer).path : Polymer.dom(e).path;\n\t\tthis.$.row.fire('group-expanded', {path: this.expandPath});\n\t}\n\n\tsetPrimaryMobileColumnsIfMobileViewport() {\n\t\tthis.$.row.numPrimary = this.primaryMobileCols.length;\n\t\tthis.$.row.primaryItems = this.isMobileViewport() ? this.primaryMobileCols : null;\n\t\tthis.$.row.includePrimaryInSecondary = this.isMobileViewport() ? this.repeatPrimaryMobileCols :false;\n\t}\n\n\texpandMobileRow() {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn;\n\n\t\tif(!this.mobileExpandedDetails)\n\t\t\treturn;\n\n\t\tif(this.mobileExpandedDetails.expanded === this.expanded)\n\t\t\treturn;\n\n\t\tthis.internalExpand = true;\n\t\tthis.$.row.fire('group-expanded', { path: this.mobileExpandedDetails.path });\n\t\tthis.internalExpand = false;\n\t}\n\n\tselectMobileRow() {\n\t\tif(!this.isMobileViewport())\n\t\t\treturn;\n\n\t\tif(!this.mobileSelectedDetails)\n\t\t\treturn;\n\n\t\tlet mobileSelected = this.mobileSelectedDetails.selected;\n\t\tif(mobileSelected !== this.selected || mobileSelected !== this._groupSelected)\n\t\t\tthis._broadcastGroupSelected(mobileSelected);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tif (this.ignoreViewportChange)\n\t\t\treturn;\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t}\n\n\tsetGrouper() {\n\t\tlet isGrouper = !this.isMobileViewport() && !!(this.grouper);\n\t\tthis.toggleClass('groupTr', isGrouper, this);\n\t\tthis.toggleClass('groupTd', isGrouper, this.$.row);\n\t\tthis.toggleClass('groupExpandTd', isGrouper, this.$.rowDiv);\n\t\tthis.setGrouperToggle(isGrouper);\n\t}\n\n\tsetGrouperToggle(isGrouper) {\n\t\tthis._toggleGroupHandler = this._toggleGroupHandler || this.toggleGroupHandler.bind(this);\n\t\tthis.$.rowDiv.removeEventListener('tap', this._toggleGroupHandler);\n\t\tif (isGrouper) this.$.rowDiv.addEventListener('tap', this._toggleGroupHandler);\n\t}\n\n\ttoggleGroupHandler(e) {\n\t\tlet expected = e.detail && e.detail.expand;\n\t\tlet eventTarget = Polymer.dom(e).localTarget;\n\t\tlet isExpanded = Polymer.dom(eventTarget).classList.contains('expanded');\n\t\tisExpanded = isExpanded || !!(Polymer.dom(eventTarget).querySelector('.expanded'));\n\t\tif (expected === isExpanded)\n\t\t\treturn; // we are done since we are already in the expected expanded state\n\n\t\tthis.setGrouperClasses(!isExpanded);\n\t\tthis.fire('sb-row-group-tapped', {expanded: !isExpanded, group: this.grouper});\n\t}\n\n\tsetGrouperClasses(expanded) {\n\t\tthis.toggleClass('expanded', expanded, this.$.row);\n\t\tthis.toggleClass('expanded', expanded, this);\n\t}\n\n\ttoggleRowDrawer() {\n\t\tthis.set('rowData._transient_.optionDrawerExpanded', !this.rowData._transient_.optionDrawerExpanded);\n\t\tthis.set('rowData._transient_.drawerIconClass',\n\t\t\tthis.rowData._transient_.optionDrawerExpanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright');\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tdisplayRowActions(position) {\n\t\tif (!position) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!this.rowActions || this.rowActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.rowActions.length; i < l; i++) {\n\t\t\tif (this.rowActions[i].position == position && !this.rowActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\thasDeleteAction() { // TODO: move logic outside of tablerow\n\t\tfor (let action of this.rowActions) {\n\t\t\tif (action.title === 'Delete')\n\t\t\t\treturn true;\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetFullWidthIfGroupRow() {\n\t\t// only set if grouper row, assuming if grouper row then rowData does not represent an SObject record\n\t\t// as adding fullWidthItem to an SObject record will result in a serialization error when the data is shipped up to the server\n\t\tif(this._isGrouperRow())\n\t\t\tthis.rowData.fullWidthItem = 'firstInnerTd';\n\t}\n\n\t_configurationRequired() {\n\t\tif(this.routeSource !== 'Configurator' || !this.rowData.configurationRequired || !this.selected || !!this.rowData.configured) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetLeftClass() {\n\t\tif(this._configurationRequired()) {\n\t\t\tif(!this.rowData.added) {\n\t\t\t\treturn 'left';\n\t\t\t}\n\t\t}\n\t}\n\n\t_hasTogglePlaceholder() {\n\t\treturn this.hasTogglePlaceholder && !this.hasToggle;\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', this.cell, 'swipe-header');\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n\n\t_isGrouperRow() {\n\t\treturn !this.isMobileViewport() && !!(this.grouper);\n\t}\n\n\t_cloneColumnWidths() {\n\t\tif(!this.columnWidths)\n\t\t\treturn null;\n\n\t\tif(!this._isGrouperRow())\n\t\t\treturn JSON.parse(JSON.stringify(this.columnWidths));\n\n\t\t// if grouper row we override the first column's width (if specified) with 100%\n\t\tif(this.columnWidths[this.cols[0]] != null) {\n\t\t\tlet columnWidths = JSON.parse(JSON.stringify(this.columnWidths));\n\t\t\tlet firstColumnWidth = columnWidths[this.cols[0]];\n\t\t\tfirstColumnWidth.width = 100;\n\t\t\tfirstColumnWidth.unit = '%';\n\t\t\treturn columnWidths;\n\t\t}\n\t\treturn null;\n\t}\n\n\t_broadcastMobileExpanded() {\n\t\tif(!this.internalExpand && this.domHost && this.isMobileViewport() && this.expandPath)\n\t\t\tthis.domHost.fire('sb-mobile-row-expanded', {\n\t\t\t\texpanded: this.expanded,\n\t\t\t\tpath: [].concat(this.expandPath),\n\t\t\t\tindex: this.index,\n\t\t\t\tid: this.get('rowData.' + this.selectionIdDataPath)\n\t\t\t});\n\t}\n\n\t_broadcastMobileSelected() {\n\t\tif(this.domHost && this.isMobileViewport())\n\t\t\tthis.domHost.fire('sb-mobile-row-selected', {\n\t\t\t\tselected: this.selected,\n\t\t\t\tindex: this.index,\n\t\t\t\tid: this.get('rowData.' + this.selectionIdDataPath)\n\t\t\t});\n\t}\n\n\tnotify(paths) { // called by option table to notify changes to added rows from an external configuration\n\t\tif (!this.rowData)\n\t\t\treturn;\n\t\tfor(let path of paths) {\n\t\t\tlet value = this.get('rowData.' + path);\n\t\t\t// call notifyPath with value and 'fromAbove' defined to prevent change from notifying back up\n\t\t\tthis.notifyPath(`rowData.${path}`, value, true);\n\t\t}\n\t}\n}\nPolymer(TableRow);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Tabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-tabs';\n\t\tthis.properties = {\n\t\t\t// array of tab objects with the following properties\n\t\t\t// \t\tname: String - name of the tab\n\t\t\t// \t\tlabel: String - display label of the tab\n\t\t\t// \t\tpageComponent: String - page component of the tab, if undefined use sb-tabs.pageComponent\n\t\t\t// \t\tbind: Array - list of sb-tabs properties to be bound to this tab's pageComponent, if undefined use sb-tabs.bind\n\t\t\t//      iconId: icon Id\n\t\t\t//      iconClass: name of clickable icon next to the tab\n\t\t\t//      iconEvent: event name when icon is ontap\n\t\t\ttabs: Array,\n\t\t\tpageComponent: { // name of dynamic page component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tpageData: { // object with keys that match the tab.name so each page can get page specific data\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcommonData: { // object that will be passed through to all pages\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tselectedTabIndex: { // the index of the current selected tab\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tselectedPageIndex: { // the index of the current selected page\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\ttabsClass: { // class value of the paper-tabs sub component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tusePagination: { // if true use pagination widget to navigate through tabs\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpaginationClass: { // class value of the div wrapper of sb-pagination if usePagination is true\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttabLimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\trendered: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toverflowTab: Object,\n\t\t\toverflowTabClass: String,\n\t\t\toverflowTabMenuClass: String,\n\t\t\tmenuMaskClass: String,\n\t\t\tbindingData: { // object of key value pairs that represent 2-way bound data between page components and this host component\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tbind: { // array of sb-tabs bound properties that should be bound to each page component, unless overridden for a given page via the tab object in the sb-tabs.tabs array\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tattributes: { // array of objects in which each object has an name and value property that represents static attributes to bind to the page component\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\thideTabs: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcontentContainerClass: String,\n\t\t\ttabContainerClass: String,\n\t\t\tpageElements: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\toverflowTabMenuDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toverflowTabMenuLabelDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'render(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes)',\n\t\t\t'setPaginationListener(usePagination)',\n\t\t\t'updateData(pageData.*)',\n\t\t\t'updateData(commonData.*)',\n\t\t\t'_handleSelectedChanged(selectedPageIndex, pageElements)'\n\t\t];\n\t}\n\n\trender() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis._buildTabs();\n\t\tPolymer.dom(this.$.paperTabs).observeNodes(function () {\n\t\t\tthis.rendered = true;\n\t\t\tif (!this.tabs || this.tabs.length <= 0) return;\n\t\t\tthis._viewportChanged();\n\t\t}.bind(this));\n\t}\n\n\tdestroyTabs() {\n\t\tif (!this.template)\n\t\t\treturn;\n\t\t// the tabs have change, so we must remove the previous tabs set and rebuild the tabs\n\t\ttry {\n\t\t\tlet pages = Polymer.dom(this.$.pages);\n\t\t\tlet childNodes = pages.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tpages.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.selectedTabIndex = 0;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_enforceValidTabSelected() {\n\t\tif (isNaN(this.selectedPageIndex) || this.tabs && this.tabs.length <= this.selectedPageIndex || this.selectedPageIndex < 0 || this.selectedPageIndex % 1 !== 0) {\n\t\t\tthis.selectedPageIndex = 0;\n\t\t}\n\t}\n\n\t_buildTabs() {\n\t\tif(this.template) {\n\t\t\tthis._initTemplateData(this.template);\n\t\t\treturn;\n\t\t}\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis._buildPages(this.template);\n\t\tthis._initTemplateData(this.template);\n\t\tPolymer.dom(this.$.pages).appendChild(this.template);\n\t\t// Run a dom flush to update page after appending child\n\t\tPolymer.dom.flush();\n\t\t// observe for when the page components are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.pages).observeNodes(function (info) {\n\t\t\tfor (let i = 0, l = info.addedNodes.length; i < l; i++)\n\t\t\t\tthis.pageElements = this.pageElements.concat(Polymer.dom(info.addedNodes[i]).childNodes)\n\n\t\t\tthis.bindElementEvents(this.pageElements);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @param elements - the page elements\n\t */\n\tsetPageElements(elements) {\n\t\tfor(let element of elements || [])\n\t\t\tthis.pageElements.push(element)\n\t}\n\n\t_initTemplateData(template) {\n\t\ttemplate.pageData = this.pageData;\n\t\ttemplate.commonData = this.commonData;\n\t\tfor (let key in this.bindingData)\n\t\t\ttemplate[key] = this.bindingData[key];\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tthis.templateBindData(template);\n\t}\n\n\t_buildPages(template) {\n\t\tlet doc = template.content.ownerDocument;\n\t\tthis._bind = [];\n\t\tthis.tabs.forEach(function (tab, index) {\n\t\t\tlet page = tab.pageComponent || this.pageComponent;\n\t\t\tif(!page) return;\n\t\t\tlet d = doc.createElement('div');\n\t\t\tlet elem = doc.createElement(page);\n\t\t\tPolymer.dom(elem).setAttribute('name', tab.name);\n\t\t\tPolymer.dom(elem).setAttribute('label', tab.label);\n\t\t\tPolymer.dom(elem).setAttribute('tabs', true); //lets a component know it was stamped in from a tab\n\t\t\tPolymer.dom(elem).setAttribute('key', tab.key);\n\t\t\tPolymer.dom(elem).setAttribute('page-data', '[[pageData.' + tab.name + ']]');\n\t\t\tPolymer.dom(elem).setAttribute('common-data', '[[commonData]]');\n\t\t\tfor(let key in this.bindingData)\n\t\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\n\t\t\t// set any static attributes provided\n\t\t\tlet attributes = tab.attributes || this.attributes || {};\n\t\t\tfor(let attr of attributes)\n\t\t\t\tPolymer.dom(elem).setAttribute(attr.name, attr.value);\n\n\t\t\t// force set disabled to true if usePagination\n\t\t\tif(this.usePagination)\n\t\t\t\tthis.set('tabs.' + index + '.disabled', true);\n\n\t\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\t\tthis.appendBindData(tab, elem);\n\t\t\tPolymer.dom(d).appendChild(elem);\n\t\t\tPolymer.dom(template.content).appendChild(d);\n\t\t}.bind(this));\n\t}\n\n\tappendBindData(tab, elem) {\n\t\tlet bind = tab.bind || this.bind;\n\t\tif(!bind) return;\n\n\t\tthis._bind = this._bind.concat(bind.filter(function (item) {\n\t\t\treturn this._bind.indexOf(item) < 0;\n\t\t}.bind(this)));\n\n\t\tfor(let key of bind) {\n\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\t\t\t// this forces direct assignments of bound data to delegate through _propertyChanged because the property now has an effector\n\t\t\tthis._addComplexObserverEffect(`updateData(${key})`);\n\t\t}\n\t}\n\n\ttemplateBindData(template) {\n\t\tthis.requiresTemplateBindData = this._bind && this._bind.length > 0;\n\t\tfor(let bind of this._bind) {\n\t\t\tif(this.__data__[bind] && (this.__data__[bind] !== this[bind]) || this[bind] === undefined) {\n\t\t\t\t// calling _addComplexObserverEffect in top level tabs requires this trick in lower level tabs for same binding\n\t\t\t\tthis[bind] = this.__data__[bind];\n\t\t\t}\n\n\t\t\tif(this[bind] !== undefined) {\n\t\t\t\tthis.requiresTemplateBindData = false;\n\t\t\t\ttemplate[bind] = this[bind];\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayPage(selectedTabIndex) {\n\t\tlet selectedTab = Polymer.dom(this.$.paperTabs).querySelectorAll('paper-tab')[selectedTabIndex];\n\n\t\tif (selectedTab != null) {\n\t\t\tif (selectedTab.id === 'overflowTab' && selectedTabIndex != 0) {\n\t\t\t\treturn this.selectedPageIndex;\n\t\t\t}\n\t\t}\n\t\tthis.selectedPageIndex = +selectedTabIndex;\n\t\treturn selectedTabIndex;\n\t}\n\n\tsetPaginationListener() {\n\t\tif (this.usePagination)\n\t\t\tthis.addEventListener('pagination-changed', this.changeTab.bind(this));\n\t}\n\n\tchangeTab(e) {\n\t\tthis._changeTab(e.detail.index);\n\t}\n\n\t_changeTab(pageIndex) {\n\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\tlet tabLimit = this.tabLimit;\n\t\tlet tabLength = this.tabs.length;\n\n\t\tthis.selectedTabIndex = pageIndex;\n\n\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\n\t\t// ensure the appropriate overflow selection is marked as selected\n\t\tthis._ensureOverflowSelection();\n\n\t\t//If an overflowed tab is selected when there is overflow\n\t\tif (this.selectedTabIndex >= tabLimit && tabLength - 1 > tabLimit) {\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[this.selectedTabIndex].label);\n\t\t\t// Fixed this to use the getElementsByTagName so that it can add additional elements inside the paper tabs so that it will grab element correctly.\n\t\t\tpaperTabs.selected = paperTabs.getElementsByTagName('paper-tab').length - 1;\n\t\t\tif(this.usePagination) {\n\t\t\t\tthis.$$('#pagination').pageIndex = pageIndex;\n\t\t\t\t// if we are using pagination and an overflow tab page is selected, then the single overflow tab menu (and its label) must not be disabled\n\t\t\t\tthis.overflowTabMenuDisabled = false;\n\t\t\t\tthis.overflowTabMenuLabelDisabled = false;\n\t\t\t}\n\t\t\t//if there is overflow and a non-overflowed tab is selected\n\t\t} else if (tabLength - 2 > tabLimit) {\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t}\n\t}\n\n\t_ensureOverflowTabMenuDisabled(overflowTabMenu) {\n\t\t// first see if the overflow tab menu itself is disabled which is true only if all of its overflow tab pages are disabled\n\t\tlet overflowTabMenuDisabled = true;\n\t\tfor(let i = this.tabLimit, l = this.tabs.length; i < l; i++) {\n\t\t\tif(!this.tabs[i].disabled) {\n\t\t\t\toverflowTabMenuDisabled = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.overflowTabMenuDisabled = overflowTabMenuDisabled;\n\n\t\t// if the entire overflow tab menu is disabled, then the tab menu label is definitely disabled\n\t\tif(this.overflowTabMenuDisabled) {\n\t\t\tthis.overflowTabMenuLabelDisabled = true;\n\t\t\treturn;\n\t\t}\n\n\t\t// since at least one overflow tab page that is NOT disabled,\n\t\t// lets see if the overflow tab menu label itself represents a disabled tab page\n\t\t// if so we want it to appear disabled even though the overflow tab menu itself is enabled so the enabled overflow tab pages can be selected\n\t\tlet overflowTabMenuLabel = Polymer.dom(overflowTabMenu).firstChild.textContent;\n\t\tlet overflowTabIndex = this._getTabIndexByLabel(overflowTabMenuLabel);\n\t\tif(overflowTabIndex >= 0)\n\t\t\tthis.overflowTabMenuLabelDisabled = this.tabs[overflowTabIndex].disabled;\n\t}\n\n\t_ensureOverflowSelection() {\n\t\tlet overflowMenuItems = Polymer.dom(this.root).querySelectorAll('li');\n\t\tfor(let i = 0, l = overflowMenuItems.length; i < l; i++) {\n\t\t\tlet selected = this.selectedPageIndex === i && overflowMenuItems[i].classList.contains('overflow');\n\t\t\tlet classes = this.tabs[i].className.replace(' selected', '');\n\t\t\tif(selected) classes += ' selected';\n\t\t\tthis.set('tabs.' + i + '.className', classes);\n\t\t}\n\t}\n\n\tcloseMenu(isMenuItemSelected) {\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tthis.overflowTabMenuClass = '';\n\t\tthis.menuMaskClass = '';\n\n\t\t//If a tab in the overflowTabMenu is not selected and the currently selected page is not from an overflow tab\n\t\tif (isMenuItemSelected !== true && selectedPage < this.tabLimit) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t}\n\t}\n\n\tupdateData(e) {\n\t\tif (this.template && e && e.path)\n\t\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tselectTab(e) {\n\t\tlet index = parseInt(e.currentTarget.id);\n\t\tif(Number.isInteger(index) && this.tabs[index].disabled)\n\t\t\treturn;\n\n\t\tlet overflowTab = Polymer.dom(this.$.paperTabs.querySelector('#overflowTab')).node;\n\t\tlet tabLimit = this.tabLimit;\n\n\t\t//If a tab in the overflowTabMenu is selected\n\t\tif (Number.isInteger(index)) {\n\t\t\tthis.selectedPageIndex = index;\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tPolymer.dom(this.$.pages).node.selected = index;\n\t\t\tthis.set('tabs.' + index + '.className', 'overflow selected');\n\t\t\tthis.overflowTab = this.tabs[index];\n\t\t\tif ( this.tabs[index].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[index].iconId + '-overflow');\n\t\t\t\tthis.toggleClass('hideIconClass', false, iconSpan);\n\t\t\t}\n\n\t\t\tthis._displayOverflowTabName(overflowTab, e.currentTarget.textContent);\n\t\t\tthis.overflowTabClass = 'overflowTab';\n\t\t\tthis.closeMenu(true);\n\t\t} else if (this.tabs.length - 1 > tabLimit) {\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\t\t}\n\t}\n\n\t/**\n\t * Handle the icon is being clicked on the tab\n\t * Fire an event\n\t *\n\t * @param e - event details with the dialog and tab id info\n\t * @event event_name + '-tapped'. Event is fired with the dialog and tab id info\n\t *\n\t * @private\n\t */\n\t_handleEvent(e) {\n\t\tlet event = e.currentTarget.getAttribute('data-tap-event');\n\t\tlet id = e.currentTarget.getAttribute('id');\n\t\tlet firedEventName = (event != null) ? event : ('tab-' + Polymer.CaseMap.camelToDashCase(id));\n\t\tthis.fire ( firedEventName +'-tapped', {\n\t\t\tevent: event,\n\t\t\tId: id\n\t\t});\n\t}\n\n\tshowMenu() {\n\t\tthis.overflowTabMenuClass = 'showOverflowTabMenu';\n\t\tthis.menuMaskClass = 'showMenuMask';\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_displayOverflowTabName(overflowTab, tabToDisplay) {\n\t\tPolymer.dom(overflowTab).firstChild.textContent = tabToDisplay;\n\t\tthis.overflowTabClass = 'overflowTab';\n\t}\n\n\t_handleOverFlow() {\n\t\t//todo: Handle hiding filtered overflow tabs\n\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\tlet pagination = Polymer.dom(this.$$('#pagination')).node;\n\t\tlet tabLimit = this.tabLimit;\n\t\tlet tabLength = this.tabs.length;\n\t\tlet tabClassName, tabIndex;\n\n\t\tthis.overflowTabClass = '';\n\n\t\tfor (let i = 0; i < tabLength; i++) {\n\t\t\ttabClassName = 'noOverflow';\n\t\t\ttabIndex = tabLimit;\n\n\t\t\tif (i >= tabLimit) {\n\t\t\t\t//if there is overflow\n\t\t\t\tif (tabLength - 1 > tabLimit) {\n\t\t\t\t\t// If at last tab (the last tab is the overflow tab - a place holder tab for the tabMenu)\n\t\t\t\t\tif (i === tabLength - 1) {\n\t\t\t\t\t\tif (selectedPage >= tabLimit) {\n\t\t\t\t\t\t\ttabIndex = selectedPage;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.overflowTab = this.tabs[tabIndex];\n\t\t\t\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabIndex].label);\n\t\t\t\t\t}\n\t\t\t\t\ttabClassName = 'overflow';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Icon should be shown in the following scenario:\n\t\t\t// 1. Not at overflow tab\n\t\t\t// 2. On overflow tab and the first one on the list\n\t\t\tif (this.tabs[i].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[i].iconId);\n\t\t\t\tlet hideIcon =  (!(tabClassName == 'noOverflow' || (tabClassName == 'overflow' && i >= tabLimit && i != tabLength - 1)));\n\t\t\t\tthis.toggleClass('hideIconClass', hideIcon, iconSpan);\n\n\t\t\t\tif (tabClassName == 'overflow' && i === selectedPage) {\n\t\t\t\t\tlet overflowIconSpan = this.$$('#' + this.tabs[i].iconId + '-overflow');\n\t\t\t\t\tthis.toggleClass('hideIconClass', false, overflowIconSpan);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(this.tabs[i].disabled)\n\t\t\t\ttabClassName += ' disabled';\n\t\t\tthis.set('tabs.' + i + '.className', i === selectedPage ? tabClassName + ' iron-selected' : tabClassName);\n\t\t}\n\n\t\t// If there is overflow and a non overflowed tab is selected or if ther e is no overflow and the last tab is selected\n\t\tif (selectedPage < tabLimit || (tabLength - 1 === tabLimit && selectedPage === tabLimit)) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t\tthis.set('tabs.' + selectedPage + '.className', this.tabs[selectedPage].className.replace(' selected', ''));\n\t\t\t// If there is overflow and a overflowed tab is selected\n\t\t} else if (selectedPage >= tabLimit) {\n\t\t\tpaperTabs.selected = tabLength;\n\t\t\tthis.overflowTabClass = 'overflowTab';\n\t\t\tthis.set('tabs.' + selectedPage + '.className', 'overflow selected');\n\t\t}\n\n\t\tif (this.usePagination) {\n\t\t\tif (pagination != null) {\n\t\t\t\tpagination.pageIndex = selectedPage;\n\t\t\t}\n\t\t}\n\t\t// ensure the single overflow tab menu is disabled or enabled based on the disable state of its overflow tab pages\n\t\t// only if all overflow tab pages are disabled then should the single overflow tab menu itself be disabled\n\t\tthis._ensureOverflowTabMenuDisabled(overflowTab);\n\t}\n\n\t_handleSelectedChanged() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis.fire('selected-page-changed', this.selectedPageIndex);\n\t\tthis.fireTabSelected();\n\t}\n\n\tfireTabSelected() {\n\t\t//if there is a page for the selected tab, fire an event that the tab has been clicked\n\t\tif(this.pageElements.length > this.selectedPageIndex)\n\t\t\tthis.pageElements[this.selectedPageIndex].fire('sb-tab-selected');\n\t}\n\n\t_deselectPreviouslySelectedTab() {\n\t\tlet tabIndex = parseInt(Polymer.dom(this.$.overflowTabMenu.querySelector('.selected')).node.id);\n\n\t\tif (Number.isInteger(tabIndex)) {\n\t\t\tthis.set('tabs.' + tabIndex + '.className', this.tabs[tabIndex].className.replace(' selected', ''));\n\t\t}\n\t}\n\n\t_viewportChanged() {\n\t\tif (this.rendered) {\n\t\t\tif (this.viewport && this.viewport.XL.up) {\n\t\t\t\tthis.tabLimit = 7;\n\t\t\t} else if (this.viewport && this.viewport.L.up) {\n\t\t\t\tthis.tabLimit = 5;\n\t\t\t} else if (this.viewport && this.viewport.M.up) {\n\t\t\t\tthis.tabLimit = 4;\n\t\t\t} else if (this.viewport && this.viewport.S.up) {\n\t\t\t\tthis.tabLimit = 3;\n\t\t\t} else if (this.viewport && this.viewport.XS.up) {\n\t\t\t\tthis.tabLimit = 2;\n\t\t\t}\n\t\t\tthis._handleOverFlow();\n\t\t}\n\t}\n\n\tbindElementEvents(elements) {\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tif (numElements == 0)\n\t\t\treturn;\n\n\t\tthis.fireTabSelected();\n\t\tfor (let key in this.bindingData) {\n\t\t\tlet dashKey = Polymer.CaseMap.camelToDashCase(key);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components (if notify: true) up to parent component\n\t\t\t\telements[i].addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\t// propagates value changes from parent component down to each page component\n\t\t\tthis.domHost.addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\tif (!e.detail.path)\n\t\t\t\t\treturn;\n\t\t\t\tfor (let i = 0; i < numElements; i++)\n\t\t\t\t\telements[i].set(e.detail.path, e.detail.value);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tfor (let bind of this._bind) {\n\t\t\tlet dashBind = Polymer.CaseMap.camelToDashCase(bind);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components to the parent of this sb-tabs component\n\t\t\t\t// only works if the bound data of the page component and parent component are associated to the same name\n\t\t\t\telements[i].addEventListener(dashBind + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\n\t\t// In FF do this here to ensure each page has all of its dynamic bindings applied\n\t\tif(this.requiresTemplateBindData)\n\t\t\tthis.templateBindData(this.template);\n\t}\n\n\t// listens to changes from the sb-tabs parent and propagates them to the sb-tabs page component(s)\n\t_propertyChanged(property, value) {\n\t\tif(this.template && this._bind.indexOf(property.split('.')[0]) !== -1)\n\t\t\tthis.template.set(property, value);\n\t}\n\n\t// pages of this tabs component should call this function to indicate the content of the page has been filtered\n\t// if the filter applied has no visible content, then the tab matching the provided label will be disabled\n\t// if the filter applied has visible content, then the tab matching the provided label will be enabled\n\t// finally, force navigate to the \"next\" tab that has visible content to prevent being on a \"disabled\" tab\n\tcontentFilteredHandler(label, hasVisibleContent) {\n\t\tif(label == null)\n\t\t\treturn; // we need a label to move on\n\n\t\t// find the index and internal disabled state of the tab with the provided label\n\t\tlet tabIndex = this._getTabIndexByLabel(label);\n\t\tif(tabIndex < 0)\n\t\t\treturn; // we are done if the we cannot find a valid tabIndex for the provided label\n\n\t\t// update the tab's disabled state bound to the UI...so if usePagination is true its always disabled\n\t\tthis.set('tabs.' + tabIndex + '.disabled', !hasVisibleContent || this.usePagination);\n\n\t\t// update the tabs internal disabled flag (which is not bound to UI) and does not care if usePagination is true\n\t\t// the tab in this use case is disabled if its content is hidden\n\t\tthis.tabs[tabIndex]._disabled = !hasVisibleContent;\n\n\t\t// clear previously queued change to next enabled tab if called in same event loop\n\t\tif(this._changeToNextEnabledTabQueued)\n\t\t\tclearTimeout(this._changeToNextEnabledTabQueued);\n\n\t\t// Change to the next enabled tab in next event loop to ensure only called once\n\t\tthis._changeToNextEnabledTabQueued = setTimeout(this._changeToNextEnabledTab.bind(this), 1);\n\t}\n\n\t_getTabIndexByLabel(label) {\n\t\tfor (let i = 0, l = this.tabs.length; i < l; i++) {\n\t\t\tif (this.tabs[i].label === label)\n\t\t\t\treturn i\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_changeToNextEnabledTab() {\n\t\tlet nextEnabledPageIndex = this._getNextEnabledPageIndex();\n\t\tthis._changeTab(nextEnabledPageIndex);\n\t}\n\n\t_getNextEnabledPageIndex() {\n\t\t// find the next tab that is enabled\n\t\tfor(let i = this.selectedPageIndex , l = this.tabs.length; i < l; i++) {\n\t\t\tif(!this.tabs[i]._disabled)\n\t\t\t\treturn i;\n\t\t}\n\n\t\t// no next enabled tab was found, so cycle back to front of tab list to find a previous enabled tab\n\t\tfor(let ii = 0, ll = this.selectedPageIndex; ii < ll; ii++) {\n\t\t\tif(!this.tabs[ii]._disabled)\n\t\t\t\treturn ii;\n\t\t}\n\n\t\t// no tab is enabled, so stay on the current page\n\t\treturn this.selectedPageIndex\n\t}\n}\n\nPolymer(Tabs);","import {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\n\nexport class TableLayoutBuilder {\n\n\tconstructor(parentElWidth, columns, md, actionsOnTheLeft, hasSelection, hasStandardDrawer) {\n\t\tthis.parentElWidth = parentElWidth;\n\t\tthis.md = md;\n\t\tthis.columns = columns;\n\t\tthis.actionsOnTheLeft = actionsOnTheLeft;\n\t\tthis.hasSelection = hasSelection;\n\t\tthis.hasStandardDrawer = hasStandardDrawer;\n\t}\n\n\t/**\n\t * Builds an object that stores width by field name\n\t * @returns {object}\n\t */\n\tbuild() {\n\t\tthis.layout = {};\n\t\tthis.availableWidth = this._getAvailableWidth();\n\n\t\tlet totalWidth = 0,\n\t\t\tminWidth = 150,\n\t\t\tnumOfCols = this.columns.length,\n\t\t\twidthPerCol = this.availableWidth / numOfCols,\n\t\t\timageCols = [];\n\n\t\t// first pass - assign column widths and calculate the total width\n\t\tfor (let i = 0; i < numOfCols; i++) {\n\t\t\tlet col = this.columns[i],\n\t\t\t\tcolWidth = minWidth; // ensure the smallest column is 150px wide\n\n\t\t\t// if an image column, then size the column with to the image width + 25 if that total size is greater the the minimum width\n\t\t\tlet imageWidth = new ImageCellSizer(this.md[col], 0).getImageWidth(25);\n\t\t\tif(imageWidth > minWidth) {\n\t\t\t\tcolWidth = imageWidth;\n\t\t\t\timageCols.push(col);\n\t\t\t}\n\t\t\t// use weighted widths only when widthPerCol is greater than min width\n\t\t\t// this means there is enough space to use weighted widths.\n\t\t\telse if (widthPerCol > minWidth) {\n\t\t\t\tcolWidth = Math.ceil(widthPerCol * this._getMultiplier(col));\n\t\t\t}\n\t\t\tthis.layout[col] = colWidth;\n\t\t\ttotalWidth += colWidth;\n\t\t}\n\n\t\tthis.totalColsWidth = totalWidth;\n\n\t\t// second-pass: if widthPerCol is greater than minWidth, total weighted width is greater then available width.\n\t\t// To make sure we don't scroll in large screens, subtract the difference equally from each column\n\t\t// and make sure that each column is still at least 150px wide.\n\t\tif (widthPerCol > minWidth) {\n\t\t\tlet diff = totalWidth - this.availableWidth,\n\t\t\t\tnumberOfColsDivisor = numOfCols - imageCols.length, // do not adjust image column widths so subtract them from total\n\t\t\t\ttotalAdjustedWidth = 0;\n\t\t\tthis.totalColsWidth = 0;\n\t\t\tfor (let j = 0; j < numOfCols; j++) {\n\t\t\t\tlet col = this.columns[j];\n\t\t\t\tlet isImageColumn = imageCols.indexOf(col) !== -1;\n\t\t\t\t// adjust width if not an image column, otherwise use the image width determined in first pass\n\t\t\t\tlet adjustedWidth = !isImageColumn ? Math.ceil(this.layout[col] - (diff/numberOfColsDivisor)) : this.layout[col];\n\t\t\t\ttotalAdjustedWidth += adjustedWidth;\n\t\t\t\t// adjust last column for the rounding differences\n\t\t\t\tif (j == numOfCols - 1) {\n\t\t\t\t\tadjustedWidth -= totalAdjustedWidth - this.availableWidth;\n\t\t\t\t}\n\t\t\t\tthis.layout[col] = adjustedWidth;\n\t\t\t\tthis.totalColsWidth += adjustedWidth;\n\t\t\t}\n\t\t}\n\t\treturn this.layout;\n\t}\n\n\t/**\n\t * Calculates available width within the parent element by adjusting for static columns\n\t * @returns {Number}\n\t * @private\n\t */\n\t_getAvailableWidth() {\n\t\t// take out total width for static columns and td padding for the group\n\t\treturn this.parentElWidth - this._getStaticColsWidth() - 12;\n\t}\n\n\tgetTotalWidth() {\n\t\t// td padding minus borders for the group\n\t\treturn this.totalColsWidth + this._getStaticColsWidth() + 10;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns - row number, actions, multi-select\n\t * @returns {number}\n\t * @private\n\t */\n\t_getStaticColsWidth() {\n\t\t// start with the width of the number col and the actions col\n\t\tlet width = 40 + 95;\n\t\tif (this.hasSelection) {\n\t\t\twidth += 30;\n\t\t}\n\t\tif (this.hasStandardDrawer) {\n\t\t\twidth += 40;\n\t\t}\n\t\treturn width;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns on the left\n\t * It can be different depending on the settings\n\t * @returns {number}\n\t */\n\tgetLeftOffset() {\n\t\t// start with the width of the number col\n\t\tlet offset = 40;\n\t\tif(this.actionsOnTheLeft) {\n\t\t\toffset += 95;\n\t\t}\n\t\tif (this.hasSelection) {\n\t\t\toffset += 30;\n\t\t}\n\t\treturn offset;\n\t}\n\n\t/**\n\t * Returns multiplier by field type\n\t * @param col - field name\n\t * @returns {number}\n\t * @private\n\t */\n\t_getMultiplier(col) {\n\t\t// if column is not in the metadata file, use the net total field as segments are net total columns\n\t\tlet type = this.md[col] ? this.md[col].type : 'currency';\n\n\t\tswitch(type.toUpperCase()) {\n\t\t\tcase 'STRING':\n\t\t\t\treturn 1.5;\n\t\t\t\tbreak;\n\t\t\tcase 'BOOLEAN':\n\t\t\t\treturn 1;\n\t\t\t\tbreak;\n\t\t\tcase 'DATE':\n\t\t\t\treturn 1.3;\n\t\t\t\tbreak;\n\t\t\tcase 'DOUBLE':\n\t\t\tcase 'CURRENCY':\n\t\t\tcase 'PERCENT':\n\t\t\tcase 'NUMBER':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'PICKLIST':\n\t\t\tcase 'MULTIPICKLIST':\n\t\t\t\treturn 1.4;\n\t\t\t\tbreak;\n\t\t\tcase 'REFERENCE':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'TEXTAREA':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t}\n\t}\n}","export const DEFAULT_WIDTH = 60;\nexport const DEFAULT_HEIGHT = 60;\n\nexport class ImageCellSizer {\n\n\tconstructor(metadata, labelMultiplier) {\n\t\tthis.metadata = metadata;\n\t\tthis.labelMultiplier = labelMultiplier != null ? labelMultiplier : 9;\n\t}\n\n\tgetImageWidth(padding) {\n\t\t// get the width of the first IMAGE() function in the calculatedFormula\n\t\tlet imageWidth = this._getImageWidth(padding, 0);\n\t\tif(imageWidth == null)\n\t\t\treturn; // not a formula field or does not contain any IMAGE() functions, then we are done\n\n\t\t// we found at least one IMAGE() function in the formula,\n\t\t// so lets look for other IMAGE() functions and use the max width between them\n\t\tlet width = -1;\n\t\tdo {\n\t\t\twidth = Math.max(width, imageWidth.width);\n\t\t\timageWidth = this._getImageWidth(padding, imageWidth.end);\n\t\t} while(imageWidth != null);\n\n\t\t// if while parsing the IMAGE() function(s) we found at least one width parameter that was not a hardcoded number,\n\t\t// then log a warning as without a hardcoded width for a given IMAGE() function, the default width was used instead which may not be right\n\t\tif(this.hasInvalidWidth)\n\t\t\tthis._warnInvalidWidthParameter();\n\n\t\t// returns the max width across all the IMAGE() function(s) in the formula\n\t\treturn width;\n\t}\n\n\t_getImageWidth(padding, start) {\n\t\tif(!this.metadata)\n\t\t\treturn;\n\n\t\tlet imageFunctionStartIndex = this._getImageFunctionStart(start);\n\t\t// return early if no formula or the formula does not contain the IMAGE() function\n\t\tif(imageFunctionStartIndex === -1)\n\t\t\treturn;\n\n\t\t// we have an IMAGE() function start index, so use it to get the index of its closing parenthesis\n\t\tlet imageFunctionEndIndex = this._getImageFunctionEnd(imageFunctionStartIndex);\n\n\t\t// get the IMAGE() function from the formula\n\t\tlet imageFunction = this.metadata.calculatedFormula.substring(imageFunctionStartIndex, imageFunctionEndIndex);\n\n\t\t// get the arguments passed into the IMAGE() function\n\t\tlet args = imageFunction.split(',');\n\n\t\t// width is either the a hardcoded number in the 4th argument of the IMAGE() function,\n\t\t// or DEFAULT_WIDTH will be returned if the width argument is omitted or its an non number input like a field reference\n\t\tlet imageWidth = this._getWidthFromImageFunctionArgs(args);\n\n\t\t// return the max between the image width or the width of the image's table header plus padding\n\t\tpadding = padding != null ? padding : 0;\n\t\tlet headerWidth = this.metadata.label.length * this.labelMultiplier;\n\n\t\t// return the width of the IMAGE() from its function, and return the end index to find the next IMAGE() function if applicable\n\t\treturn { width:  Math.max(imageWidth, headerWidth) + padding, end: imageFunctionEndIndex };\n\t}\n\n\t_getImageFunctionStart(start) {\n\t\treturn this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase().indexOf('image(', start) : -1\n\t}\n\n\t_getImageFunctionEnd(start) {\n\t\tlet formula = this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase() : null;\n\t\tif(!formula)\n\t\t\treturn -1;\n\n\t\t// loop through each character of the IMAGE() function and return when at least one open parenthesis,\n\t\t// and the number of open parenthesis equal the number of closed parenthesis\n\t\tlet numOpenParenthesis = 0;\n\t\tlet numClosedParenthesis = 0;\n\t\tfor(let i = start, l = formula.length; i < l; i++) {\n\t\t\tif (formula.substring(i, i + 1) === '(')\n\t\t\t\tnumOpenParenthesis++;\n\t\t\telse if (formula.substring(i, i + 1) === ')')\n\t\t\t\tnumClosedParenthesis++;\n\n\t\t\tif (numOpenParenthesis > 0 && numOpenParenthesis === numClosedParenthesis)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_getWidthFromImageFunctionArgs(args) {\n\t\t// the image width is the 4th argument in the IMAGE() function, so if not 4 arguments return the default width\n\t\tif(args.length <= 3)\n\t\t\treturn DEFAULT_WIDTH;\n\n\t\tlet width;\n\t\ttry {\n\t\t\twidth = parseInt(args[3].trim())\n\t\t} catch (e) {\n\t\t\t// cannot parse the 4th argument as an integer then mark as invalid and return the default width\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// if parsed width is not a number, then mark as invalid and return the default width\n\t\tif(isNaN(width)) {\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// return the valid numeric width provided in the 4th argument of the IMAGE() function\n\t\treturn width;\n\t}\n\n\t_warnInvalidWidthParameter() {\n\t\tconsole.warn('May not have properly sized the column to fit the image specified by this formula: \"' + this.metadata.calculatedFormula + '\"\\n' +\n\t\t\t'REASON: At least one of the formula\\'s IMAGE function(s) has its width parameter (4th argument) defined from a field.\\n' +\n\t\t\t'SOLUTION: All of the formula\\'s IMAGE function(s) should have its width parameter either omitted or hardcoded to a number.');\n\t}\n}","export class RowFieldSelector {\n\n\tconstructor(row, fields, rowIndex, rowIndexAttribute) {\n\t\tthis.row = row;\n\t\tthis.fields = fields;\n\t\tthis.rowIndex = rowIndex;\n\t\tthis.rowIndexAttribute = rowIndexAttribute || 'index';\n\t}\n\n\tselectFirstEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectNextEditableField(editable, 0);\n\t}\n\n\tselectLastEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectPreviousEditableField(editable, editable.length - 1);\n\t}\n\n\tselectNextEditableField(field) {\n\t\tlet editable = this._selectEditableFields();\n\t\tlet currentIndex = editable.indexOf(field);\n\t\tlet targetIndex = currentIndex >=0 ? currentIndex + 1 : -1;\n\t\treturn this._selectNextEditableField(editable, targetIndex);\n\t}\n\n\tselectPreviousEditableField(field) {\n\t\tlet editable = this._selectEditableFields();\n\t\tlet currentIndex = editable.indexOf(field);\n\t\tlet targetIndex = currentIndex >=0 ? currentIndex - 1 : -1;\n\t\treturn this._selectPreviousEditableField(editable, targetIndex);\n\t}\n\n\t_selectEditableFields() {\n\t\tlet editable = this.fields.filter(function(field) {\n\t\t\treturn field.isEditable();\n\t\t});\n\t\treturn editable || [];\n\t}\n\n\t_selectNextEditableField(editable, targetIndex) {\n\t\tif(targetIndex >= 0 && targetIndex < editable.length)\n\t\t\treturn editable[targetIndex];\n\n\t\treturn this._selectFirstEditableNextRow();\n\t}\n\n\t_selectPreviousEditableField(editable, targetIndex) {\n\t\tif(targetIndex >= 0 && targetIndex < editable.length)\n\t\t\treturn editable[targetIndex];\n\n\t\treturn this._selectLastEditablePreviousRow();\n\t}\n\n\t_selectFirstEditableNextRow() {\n\t\tlet nextRow = this._selectRowByIndex(this.rowIndex + 1);\n\t\tlet nextRowSelector = nextRow ? nextRow.selector : null;\n\t\tif(nextRowSelector)\n\t\t\treturn nextRowSelector.selectFirstEditableField();\n\t}\n\n\t_selectLastEditablePreviousRow() {\n\t\tlet previousRow = this._selectRowByIndex(this.rowIndex - 1);\n\t\tlet previousRowSelector = previousRow ? previousRow.selector : null;\n\t\tif(previousRowSelector)\n\t\t\treturn previousRowSelector.selectLastEditableField();\n\t}\n\n\tselectFirstEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectNextEditableField(editable, 0);\n\t}\n\n\tselectLastEditableField() {\n\t\tlet editable = this._selectEditableFields();\n\t\treturn this._selectPreviousEditableField(editable, editable.length - 1);\n\t}\n\n\t_selectRowByIndex(index) {\n\t\treturn RowFieldSelector._selectTableRowByIndex(this.row.domHost, this.row.tagName.toLowerCase(), this.rowIndexAttribute, index);\n\t}\n\n\tstatic selectFirstEditableFieldInFirstRow(table, rowName, rowIndexAttribute) {\n\t\tlet firstRow = RowFieldSelector._selectTableRowByIndex(table, rowName, rowIndexAttribute, 0);\n\t\tlet selector = firstRow ? firstRow.selector : null;\n\t\tif(selector)\n\t\t\treturn selector.selectFirstEditableField();\n\t}\n\n\tstatic selectLastEditableFieldInLastRow(table, rowName, rowNum, rowIndexAttribute) {\n\t\tlet lastRow = RowFieldSelector._selectTableRowByIndex(table, rowName, rowIndexAttribute, rowNum - 1);\n\t\tlet selector = lastRow ? lastRow.selector : null;\n\t\tif(selector)\n\t\t\treturn selector.selectLastEditableField();\n\t}\n\n\tstatic _selectTableRowByIndex(table, rowName, rowIndexAttribute, index) {\n\t\treturn table.$$(`${rowName}[${rowIndexAttribute}=\"${index}\"]`);\n\t}\n}","export class TableClassBuilder {\n\n\tconstructor(columns, firstLastClassSuffix, typeByColumnMap, allColumnClasses) {\n\t\tthis.columns = columns;\n\t\tthis.firstLastClassSuffix = firstLastClassSuffix;\n\t\tthis.typeByColumnMap = typeByColumnMap;\n\t\tthis.allColumnClasses = allColumnClasses || [];\n\t}\n\n\tbuild() {\n\t\tlet classMap = {};\n\t\tthis._appendTypeClass(classMap);\n\t\tthis._appendFirstAndLastColumnClasses(classMap);\n\t\tthis._appendAllColumnClasses(classMap);\n\t\tthis._addWidthStyles(classMap);\n\t\treturn classMap;\n\t}\n\n\t_appendTypeClass(classMap) {\n\t\tif(!this.typeByColumnMap)\n\t\t\treturn;\n\n\t\tlet prevNumeric = false;\n\t\tfor (let col of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[col];\n\t\t\tlet isNumeric = this._isNumericType(type);\n\t\t\tlet isBoolean = this._isBooleanType(type);\n\n\t\t\tif(isNumeric)\n\t\t\t\tthis._appendClass(classMap, col, 'numericCell');\n\t\t\telse if(isBoolean)\n\t\t\t\tthis._appendClass(classMap, col, 'checkboxCell');\n\t\t\telse if(prevNumeric)\n\t\t\t\tthis._appendClass(classMap, col, 'afterNumericCell');\n\n\t\t\tprevNumeric = isNumeric;\n\t\t}\n\t}\n\n\t_appendFirstAndLastColumnClasses(classMap) {\n\t\tlet firstInnerClass = 'firstInner' + this.firstLastClassSuffix;\n\t\tlet lastInnerClass = 'lastInner' + this.firstLastClassSuffix;\n\t\tlet secondInnerClass = 'secondInner' + this.firstLastClassSuffix;\n\n\t\tthis._appendClass(classMap, this.columns[0], firstInnerClass);\n\t\tthis._appendClass(classMap, this.columns[this.columns.length-1], lastInnerClass);\n\t\tif(this.columns.length > 1)\n\t\t\tthis._appendClass(classMap, this.columns[1], secondInnerClass);\n\t}\n\n\t_appendAllColumnClasses(classMap) {\n\t\tfor(let column of this.columns) {\n\t\t\tfor(let columnClass of this.allColumnClasses)\n\t\t\t\tthis._appendClass(classMap, column, columnClass);\n\t\t}\n\t}\n\n\t_addWidthStyles(classMap) {\n\t\tfor(let column of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[column];\n\t\t\tlet typeAndWidth = type.split(':'); // check to see if the type is in the format type:width\n\t\t\tif(typeAndWidth.length === 2)\n\t\t\t\tthis._setWidthStyle(classMap, column, typeAndWidth[1]);\n\t\t}\n\t}\n\n\t_isNumericType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'double' || type === 'number' || type === 'currency' || type === 'percent';\n\t}\n\n\t_isBooleanType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'boolean' || type === 'checkbox'\n\t}\n\n\t_appendClass(classMap, key, classToAppend) {\n\t\tif(!classMap[key])\n\t\t\tclassMap[key] = {};\n\n\t\tlet existingClass = classMap[key].class;\n\t\tclassMap[key].class = existingClass ? (existingClass + ' ' + classToAppend) : classToAppend;\n\t}\n\n\t_setWidthStyle(classMap, key, width) {\n\t\tif(!classMap[key])\n\t\t\tclassMap[key] = {};\n\t\tclassMap[key].style = `width:${width}px`;\n\t}\n }","export class OpContains {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tvar fStr = String(fieldValue).toLowerCase();\n\t\tvar tStr = String(testValue).toLowerCase();\n\t\treturn fStr.indexOf(tStr) !== -1;\n\t}\n}","export class OpEndsWith {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif (fieldValue == null || testValue == null) {\n\t\t\treturn false;\n\t\t}\n\t\tvar fStr = String(fieldValue).toLowerCase();\n\t\tvar tStr = String(testValue).toLowerCase();\n\t\treturn fStr.indexOf(tStr, fStr.length - tStr.length) !== -1;\n\t}\n}","export class OpEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.testValueCache = {};\n\t\tthis.fieldValueCache = {};\n\t}\n\n\n\tevaluate(fieldValue, testValue) {\n\t\t// if either is null, check if both are null\n\t\tif (fieldValue == null || testValue == null) {\n\t\t\treturn fieldValue == testValue;\n\t\t}\n\t\tif (fieldValue instanceof Date) {\n\t\t\t// TODO: YOU MIGHT NEED TO IMPLEMENT SOMETHING FOR DATETIME!\n\t\t\t// if the field value is a date, the testValue, which is a string, needs to be converted to a date\n\t\t\treturn fieldValue.getTime() === (new Date(testValue)).getTime();\n\t\t} else if (typeof fieldValue === \"boolean\") {\n\t\t\t// Likewise, if fv is a boolean, tv needs to be one as well\n\t\t\treturn fieldValue === (String(testValue).toLowerCase() === \"true\");\n\t\t} else if (typeof fieldValue === \"string\" && typeof testValue === \"string\") {\n\t\t\t// This value needs to be stored in the testvalue cache so comma-separated values can be handled\n\t\t\tvar lowerCaseTest = testValue.toLowerCase();\n\t\t\tvar lowerCaseField = fieldValue.toLowerCase();\n\t\t\tif (this.testValueCache[lowerCaseTest] == null) {\n\t\t\t\tthis.testValueCache[lowerCaseTest] = this.valueFor(lowerCaseTest);\n\t\t\t}\n\t\t\t// Same as above\n\t\t\tif (this.fieldValueCache[lowerCaseField] == null) {\n\t\t\t\tthis.fieldValueCache[lowerCaseField] = this.valueFor(lowerCaseField);\n\t\t\t}\n\t\t\treturn this.testValueCache[lowerCaseTest].equals(this.fieldValueCache[lowerCaseField]);\n\t\t} else if (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() == testValue;\n\t\t}\n\t\t// If it's none of those types, return false\n\t\treturn false;\n\t}\n\n\n\tvalueFor(value) {\n\t\tif ((value.indexOf(',') > -1) && (value.indexOf('\"') != 0) && (value.lastIndexOf('\"') != value.length - 1)) {\n\t\t\t// Return a MultipleValue object\n\t\t\treturn {\n\t\t\t\tvalueType: 'Multi',\n\t\t\t\tvalueSet: value.split(',').map(function(v) {return v.trim()}),\n\t\t\t\tequals: function(otherValue) {\n\t\t\t\t\tif (otherValue.valueType === 'Multi') {\n\t\t\t\t\t\tvar otherVals = otherValue.valueSet;\n\t\t\t\t\t\treturn otherVals.some(function(v) {return this.valueSet.indexOf(v) != -1}, this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.valueSet.indexOf(otherValue.value) != -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Return a Value object\n\t\t\treturn {\n\t\t\t\tvalueType: 'Single',\n\t\t\t\tvalue: value,\n\t\t\t\tequals: function(otherValue) {\n\t\t\t\t\treturn this.value === otherValue.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}","export class OpGreaterThan {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() > testValue;\n\t\t} else if (fieldValue instanceof Date) {\n\t\t\treturn fieldValue > new Date(testValue);\n\t\t} else if (typeof fieldValue == 'string') {\n\t\t\tvar fieldTime = Date.parse(fieldValue);\n\t\t\tvar testTime = Date.parse(testValue);\n\t\t\tif ((fieldTime === fieldTime) && (testTime === testTime)) {\n\t\t\t\t// If they're both numbers...\n\t\t\t\treturn fieldTime > testTime;\n\t\t\t}\n\t\t\treturn fieldValue.toLowerCase() > testValue.toLowerCase();\n\t\t}\n\t\treturn false;\n\t}\n}","export class OpGreaterThanEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof fieldValue === \"number\" || fieldValue instanceof Number) {\n\t\t\treturn fieldValue.valueOf() >= testValue;\n\t\t} else if (fieldValue instanceof Date) {\n\t\t\treturn fieldValue >= new Date(testValue);\n\t\t} else if (typeof fieldValue == 'string') {\n\t\t\tvar fieldTime = Date.parse(fieldValue);\n\t\t\tvar testTime = Date.parse(testValue);\n\t\t\tif ((fieldTime === fieldTime) && (testTime === testTime)) {\n\t\t\t\t// If they're both numbers...\n\t\t\t\treturn fieldTime >= testTime;\n\t\t\t}\n\t\t\treturn fieldValue >= testValue;\n\t\t}\n\t\treturn false;\n\t}\n}","import {OpGreaterThanEquals} from 'common/rules/operators/OpGreaterThanEquals.js';\n\nexport class OpLessThan {\n\t// If fieldValue is not greater than or equal to testValue, it's less than.\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.gte = new OpGreaterThanEquals();\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null) || (typeof fieldValue !== \"number\" && typeof fieldValue !== 'string' && !(fieldValue instanceof Date || fieldValue instanceof Number))) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.gte.evaluate(fieldValue, testValue);\n\t}\n}","import {OpGreaterThan} from 'common/rules/operators/OpGreaterThan.js';\n\nexport class OpLessThanEquals {\n\t// If fieldValue is not greater than testValue, it's less than or equal\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.gt = new OpGreaterThan();\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null) || (typeof fieldValue !== \"number\" && typeof fieldValue !== 'string' && !(fieldValue instanceof Date || fieldValue instanceof Number))) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.gt.evaluate(fieldValue, testValue);\n\t}\n}","import {OpEquals} from 'common/rules/operators/OpEquals.js';\n\nexport class OpNotEquals {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t\tthis.equals = new OpEquals();\n\t}\n\n\n\tevaluate(fieldValue, testValue) {\n\t\treturn !this.equals.evaluate(fieldValue, testValue);\n\t}\n}","export class OpStartsWith {\n\n\tconstructor(key) {\n\t\tthis.opType = key;\n\t}\n\n\tevaluate(fieldValue, testValue) {\n\t\tif ((fieldValue == null) || (testValue == null)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn (String(fieldValue).toLowerCase()).indexOf(String(testValue).toLowerCase()) === 0;\n\t}\n}","/**\n * PORTED OVER FORM COMMON/CALC FOR USE IN RULES ENGINE\n */\nimport {OpEquals} from 'common/rules/operators/OpEquals.js';\nimport {OpNotEquals} from 'common/rules/operators/OpNotEquals.js';\nimport {OpLessThan} from 'common/rules/operators/OpLessThan.js';\nimport {OpLessThanEquals} from 'common/rules/operators/OpLessThanEquals.js';\nimport {OpGreaterThan} from 'common/rules/operators/OpGreaterThan.js';\nimport {OpGreaterThanEquals} from 'common/rules/operators/OpGreaterThanEquals.js';\nimport {OpStartsWith} from 'common/rules/operators/OpStartsWith.js';\nimport {OpEndsWith} from 'common/rules/operators/OpEndsWith.js';\nimport {OpContains} from 'common/rules/operators/OpContains.js';\n\nexport class OperatorsUtils {\n\t/**\n\t * Creates an OperatorsUtils instance to return the appropriate subclass\n\t * @param {String} key The operation desired\n\t */\n\n\tconstructor(key) {\n\t\tthis.key = key;\n\t\tthis.OP_EQ = \"equals\";\n\t\tthis.OP_NEQ = \"not equals\";\n\t\tthis.OP_LT = \"less than\";\n\t\tthis.OP_LTE = \"less or equals\";\n\t\tthis.OP_GT = \"greater than\";\n\t\tthis.OP_GTE = \"greater or equals\";\n\t\tthis.OP_SW = \"starts with\";\n\t\tthis.OP_EW = \"ends with\";\n\t\tthis.OP_CONT = \"contains\";\n\t}\n\n\t/**\n\t * Returns an object that can perform the desired comparison between two values\n\t * @returns {Object} An object that is guaranteed to have a method \"evaluate(a, b)\"\n\t */\n\tgetInstance() {\n\t\tswitch (this.key) {\n\t\t\tcase this.OP_EQ:\n\t\t\t\treturn new OpEquals(this.key);\n\t\t\tcase this.OP_NEQ:\n\t\t\t\treturn new OpNotEquals(this.key);\n\t\t\tcase this.OP_LT:\n\t\t\t\treturn new OpLessThan(this.key);\n\t\t\tcase this.OP_LTE:\n\t\t\t\treturn new OpLessThanEquals(this.key);\n\t\t\tcase this.OP_GT:\n\t\t\t\treturn new OpGreaterThan(this.key);\n\t\t\tcase this.OP_GTE:\n\t\t\t\treturn new OpGreaterThanEquals(this.key);\n\t\t\tcase this.OP_SW:\n\t\t\t\treturn new OpStartsWith(this.key);\n\t\t\tcase this.OP_EW:\n\t\t\t\treturn new OpEndsWith(this.key);\n\t\t\tcase this.OP_CONT:\n\t\t\t\treturn new OpContains(this.key);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Returns an object that can perform the inverse of the desired comparison between two values.\n\t * i.e. The operator that returns the same result when the order of the arguments is reversed.\n\t * @returns {Object} An object that is guaranteed to have a method \"evaluate(a, b)\"}\n\t */\n\n\tgetInverseInstance() {\n\t\tswitch (this.key) {\n\t\t\tcase this.OP_EQ:\n\t\t\t\treturn new OpEquals(this.key);\n\t\t\tcase this.OP_NEQ:\n\t\t\t\treturn new OpNotEquals(this.key);\n\t\t\tcase this.OP_LT:\n\t\t\t\treturn new OpGreaterThan(this.key);\n\t\t\tcase this.OP_LTE:\n\t\t\t\treturn new OpGreaterThanEquals(this.key);\n\t\t\tcase this.OP_GT:\n\t\t\t\treturn new OpLessThan(this.key);\n\t\t\tcase this.OP_GTE:\n\t\t\t\treturn new OpLessThanEquals(this.key);\n\t\t\tcase this.OP_SW:\n\t\t\t\treturn new OpStartsWith(this.key);\n\t\t\tcase this.OP_EW:\n\t\t\t\treturn new OpEndsWith(this.key);\n\t\t\tcase this.OP_CONT:\n\t\t\t\treturn new OpContains(this.key);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldMetadata {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-md';\n\t\tthis.properties = {\n\t\t\tfields: Array,\n\t\t\tobject: String,\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdoNotFixObjectName : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['initFieldSetDescribe(fields, prefix)']\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function (e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldNames = e.detail.value.fields,\n\t\t\t\tfields = [],\n\t\t\t\tfieldsByObject = {};\n\t\t\tfor (let i = 0, l = fieldNames.length; i < l; i++) {\n\t\t\t\tif (!md[fieldNames[i]])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet object = fieldNames[i].split('.')[0],\n\t\t\t\t\tfield = fieldNames[i].split('.')[1];\n\t\t\t\tif(!fieldsByObject[object])\n\t\t\t\t\tfieldsByObject[object] = {};\n\n\t\t\t\tfields.push(md[fieldNames[i]]);\n\t\t\t\tfieldsByObject[object][field] = md[fieldNames[i]];\n\t\t\t}\n\t\t\t//Array or map of maps for object{fields allowing the caller to pick and choose\n\t\t\tthis.md = {fields: fields, fieldsByObject: fieldsByObject};\n\t\t}.bind(this));\n\t\tthis.$.describe.addEventListener('error-changed', function (e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this))\n\t}\n\n\tinitFieldSetDescribe() {\n\t\tlet fields = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tlet fieldSplit = field.split('.');\n\t\t\tif(fieldSplit.length === 2)\n\t\t\t\tfields.push(this.buildFieldList(fieldSplit[0], fieldSplit[1]));\n\t\t\telse\n\t\t\t\tfields.push(this.buildFieldList(this.object, field));\n\t\t}.bind(this));\n\t\tthis.$.describe.fields = fields;\n\t}\n\n\tbuildFieldList(target, field) {\n\t\t//Adding the prefix programmatically so that callers don't need to figure this out\n\t\t//Should the caller add it, we won't add it again\n\t\tif (!this.doNotFixObjectName && target.endsWith('__c') && !target.startsWith(this.prefix))\n\t\t\treturn this.prefix + target + '.' + field;\n\n\t\treturn target + '.' + field;\n\t}\n}\n\nPolymer(FieldMetadata);","// Constant status which are used for checking if it's failed or completed\nconst COMPLETED  = 'Completed';\nconst FAILED = 'Failed';\nconst ABORTED = 'Aborted';\n\n/**\n *  <sb-job-checker> To send out the asynchronize call back to the server using <sb-service>\n *\n *  Features:\n *      - Minimum requirement to call this component to set the data property correctly. Format is included in the property.\n *      - Return the following result:\n *          - Status - Job Status from the server.\n *          - Result - Final result from the server\n *      - Loading Spinner:\n *          If you do not need to use it, you can set the useSpinner as false when you call this component. By default, it's true\n *\n **/\nexport class JobChecker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-job-checker';\n\t\tthis.properties = {\n\n\t\t\t/** This property is enabled to ensure that spinner is loaded when the component is ready */\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * This property is to allow the caller to determine whether we should the spinner or not.\n\t\t\t * If the caller prefers to disable the spinner, it can set it as false to disable the spinner\n\t\t\t * */\n\t\t\tuseSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * [Required] To use to pass information to server (Format: {recordId: recordId_num, jobId: jobId_num, jobType: QuoteCalculator})\n\t\t\t */\n\t\t\tdata: Object,\n\n\t\t\t/** [Result] Status from server */\n\t\t\tstatus: String,\n\n\t\t\t/** [Result] Final result from the server */\n\t\t\tresult: {\n\t\t\t\ttype: Object\n\t\t\t},\n\n\t\t\t/** [Result] Error from the server */\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\n\t\t\t/** A handle list which is used for cancelSync once the task is completed */\n\t\t\tasyncNumList: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\n\t\t\t/** First time when the component is being used from the caller */\n\t\t\tfirstStatusTime: Number,\n\n\t\t\t/** latest time when the component is being used from the caller. Mainly from the asych */\n\t\t\tlastStatusTime: Number\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_ping(data)'];\n\n\t}\n\n\t/**\n\t *\n\t * @private:        To determine whether the loading spinner should be shown or not.\n\t *\n\t * @returns {boolean|*|JobChecker.properties.useSpinner|{type, value}}\n\t */\n\t_useSpinner(){\n\t\treturn this.spinner && this.useSpinner;\n\t}\n\n\tready() {\n\t\tthis.firstStatusTime = Date.now();\n\t\tthis.lastStatusTime = Date.now();\n\t\tthis._setLoadingSpinner(false);\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis._checkStatus(e);\n\t\t}.bind(this));\n\n\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t\t// Turn off the spinner if there's error occurred\n\t\t\tthis._setLoadingSpinner(false);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @private         To control whether we should use the loading spinner in this component\n\t *\n\t * @param {Boolean} value\n\t */\n\t_setLoadingSpinner(value) {\n\t\tthis.spinner = value;\n\t\tthis.$.loadingSpinner.show = this._useSpinner();\n\t}\n\n\t/**\n\t *\n\t * @private: To ping the server via sb-service to get the response\n\t *\n\t * @param data\n\t */\n\t_ping(data) {\n\t\tthis._setLoadingSpinner(true);\n\t\t// Turn off the sb-service loading spinner. Use the sb-job-checker's one\n\t\tthis.$.service.background = true;\n\t\tthis.$.service.model = undefined;\n\t\tthis.$.service.model = data;\n\t}\n\n\t/**\n\t * @private:    To check the status from the Queueable checker class in Apex. This will deteremine whether the job is completed or not.\n\t *              To the check the status of the job\n\t *              - Send out the job asynch via sb-service component\n\t *              - Get the latest status received time.\n\t *              - Store the return result from the server to the component\n\t *              - Console log the status on the brower for developer to debug ( This can be removed in the future\n\t *              - Fire an event job-completed when the status is finished\n\t *\n\t * @param e     event detail coming from the response\n\t * @event job-completed\n\t */\n\t_checkStatus(e) {\n\t\tlet result = e.detail.value;\n\t\tif ( result != null) {\n\t\t\tlet jobId = result.job.Id;\n\t\t\tthis.status = result.job.Status;\n\t\t\tif (!this._isFinished()) {\n\t\t\t\tthis.lastStatusTime = Date.now();\n\t\t\t\tthis.data.jobId = jobId;\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tlet asyncNum = this.async(function () {\n\t\t\t\t\tthis._ping(this.data);\n\t\t\t\t}.bind(this), 1000);\n\t\t\t\tthis.asyncNumList.push(asyncNum);\n\t\t\t} else { // COMPLETED\n\n\t\t\t\t// The first time which the job is completed, it will get the result from the payload\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.result = result;\n\t\t\t\t\tfor (let i = 0; i < this.asyncNumList.length; i++) {\n\t\t\t\t\t\tthis.cancelAsync(this.asyncNumList[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tthis._setLoadingSpinner(false);\n\t\t\t\t// To fire an event that the job completed so that the caller knows and they can execute other operations that they need\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.fire('job-completed');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private:    This status message can be removed in the future\n\t */\n\t_getStatusMessages() {\n\t\tlet waitTime = Date.now() - this.lastStatusTime;\n\t\t// Display this status message in the console log so that we know what job is running in the background\n\t\tconsole.log('Record Id: ' + this.data.recordId + ' Job Type: ' + this.data.jobType + ' [Job Id: ' + this.data.jobId + ' - Status:' + this.status + '] Time : ' + (this.lastStatusTime - this.firstStatusTime) + ' [Wait Time: ' + waitTime + ']');\n\t}\n\n\n\t/**\n\t *\n\t * @private         To determine if the status from the status is failure status\n\t * @return {Boolean}\n\t * */\n\t_isFailure() {\n\t\treturn this.status  && (this.status == ABORTED || this.status == FAILED);\n\t}\n\n\t/**\n\t * @private     To determine if the status from the status is completed or not. It can be succesful or failed.\n\t * @return  {Boolean}\n\t * */\n\t_isFinished() {\n\t\treturn (this.status && (this.status == COMPLETED || this._isFailure()));\n\t}\n}\n\nPolymer( JobChecker );\n\n\n\n\n\n","export class LineEditorCacheSaver {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor-cache-save';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['save(quote)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail;\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\t\n\tsave() {\n\t\tthis.$.service.transient = true;\n\t\tthis.$.service.uid = this.quote.record.Id;\n\t\tthis.$.service.model = this.quote;\n\t\tthis.$.service.saver = null;\n\t}\n}\nPolymer(LineEditorCacheSaver);\n","import {Cache} from 'common/data/cache/Cache.js';\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class LineEditorReader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor-read';\n\t\tthis.properties = {\n\t\t\tquoteId: String,\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlineEditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix : '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['read(quoteId, background, prefix)'];\n\t}\n\n\tready() {\n\t\tthis.firstStatusTime = Date.now();\n\t}\n\n\t/**\n\t * Send a read service call to the server. Need to reset the uid, response to avoid caching if multiple ping to server is needed.\n\t *\n\t * @param quoteId\n\t */\n\tread() {\n\t\tthis.$.loadingSpinner.show = true;\n\t\tthis.quoteuid = this.quoteId.substring(0, 15);\n\t\tlet cachedLineEditor = Cache.get('LineEditor', this.quoteuid);\n\t\tif (cachedLineEditor) {\n\t\t\t// This value was being set before product lookup had a chance to set up event listener\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.lineEditorModel = cachedLineEditor;\n\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t}.bind(this), 0);\n\t\t\treturn;\n\t\t}\n\t\tif (window.SB && window.SB.QuoteDAO) {\n\t\t\tlet connClient = new ConnectionClient(this.prefix);\n\t\t\tconnClient.getConnection().then(function(connection) {\n\t\t\t\tlet quoteDAO = new window.SB.QuoteDAO(this.prefix, connection);\n\t\t\t\tlet promise = quoteDAO.loadEditorModel(this.quoteuid, true);\n\n\t\t\t\tpromise.then(function(value) {\n\t\t\t\t\tthis._checkStatus(value);\n\t\t\t\t}.bind(this));\n\n\t\t\t\tpromise.catch(function(err) {\n\t\t\t\t\tthis.error = [err.message || err];\n\t\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t\t}.bind(this));\n\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\n\t/***\n\t * To check the status of the quote which is from the server. If the quote is still under processing of the calculation, it will keep sending the server call until it's finished.\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_checkStatus(value) {\n\t\tif (value) {\n\t\t\tthis.lastStatusTime = Date.now();\n\t\t\t// if value means that it's waiting for the background job is completed. For jsqc, it submits the calculation request to the queueable job\n\t\t\tif (value == 'Incomplete') {\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tthis.async(function () {\n\t\t\t\t\tthis.read();\n\t\t\t\t}.bind(this), 1000);\n\t\t\t} else {\n\t\t\t\tthis.addToCache(this.quoteuid, value);\n\t\t\t\tthis.lineEditorModel = value;\n\t\t\t\tthis._setIsLastReadQuoteUnopened();\n\t\t\t\tthis.$.loadingSpinner.show = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tclearFromCache() {\n\t\tCache.remove('LineEditor', this.quoteuid, 'value');\n\t}\n\n\taddToCache(quoteId, lineEditor) {\n\t\tCache.add('LineEditor', quoteId.substring(0,15), lineEditor, 'value', this);\n\t}\n\n\t_setIsLastReadQuoteUnopened() {\n\t\tthis.isLastReadQuoteUnopened = this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix + 'Unopened__c'];\n\t\tthis.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix + 'Unopened__c'] = false;\n\t}\n\n\t/**\n\t * @private:    This status message can be removed in the future\n\t */\n\t_getStatusMessages() {\n\t\tlet waitTime = Date.now() - this.lastStatusTime;\n\t\t// Display this status message in the console log so that we know what job is running in the background\n\t\tconsole.log('Reading: Quote Id: ' + this.quoteId + ' Time : ' + (this.lastStatusTime - this.firstStatusTime) + ' [Wait Time: ' + waitTime + ']');\n\t}\n}\n\nPolymer(LineEditorReader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteMinimizer} from 'common/data/minimize/QuoteMinimizer.js';\nimport {QuoteAggregator} from 'common/aggregate/quote-aggregator/QuoteAggregator.js';\n\nexport class ProductRulesQuoteLineAdder {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-rules-quote-line-adder';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproductIds: Array,\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlinesAddedByRules: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ 'addLines(quote, productIds)' ];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.linesAddedByRules = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\taddLines() {\n\t\tlet builder = new DataBuilder();\n\t\tbuilder.add('productIds', this.productIds);\n\t\tif (this.quote.targetGroupKey != null && this.quote.targetGroupKey >= 0)\n\t\t\tbuilder.add('groupKey', this.quote.targetGroupKey);\n\n\t\tlet min = new QuoteMinimizer(this.quote, this.productIds, this.quote.targetGroupKey);\n\t\tthis.quote = min.reduceQuote(false);\n\n\t\tbuilder.addQuote('quote', this.quote);\n\t\tthis.$.service.model = builder.build();\n\t\t// Now that we've sent the quote, we should remove all of the temporary attributes we added to it.\n\t\tthis.quote = min.revertQuote();\n\t}\n}\nPolymer(ProductRulesQuoteLineAdder);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class SearchModelLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-load';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlineAggregationMethod: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tprocessId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilters: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'load(quote, processId, actionId)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tthis.$.service.uid = null;\n\t\tvar dataModel = new DataBuilder()\n\t\t\t.add('processId', this.processId)\n\t\t\t.add('actionId', this.actionId)\n\t\t\t.add('filters', this.filters)\n\t\t\t.add('fieldSet', this.fieldSet);\n\t\tif (this.sendQuoteRecord) {\n\t\t\tdataModel.addObject('quote', this.quote.record);\n\t\t} else {\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t}\n\t\t// If there's a method specified by which we should aggregate line data, make sure that the aggregation method actually\n\t\t// exists, and then use it to aggregate the data over all the quote lines. If any data is returned, attach\n\t\t// it to the data model.\n\t\tif (this.lineAggregationMethod) {\n\t\t\tlet aggregator = new QuoteLineAggregator(this.quote);\n\t\t\tif (aggregator[this.lineAggregationMethod]) {\n\t\t\t\tlet aggregatedData = aggregator[this.lineAggregationMethod]();\n\t\t\t\tif (aggregatedData) {\n\t\t\t\t\tdataModel.addObject('aggregateLineData', aggregatedData, undefined, undefined, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.$.service.context = dataModel.build();\n\t}\n\n}\nPolymer(SearchModelLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class SearchModelSelector {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-select';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tsendQuoteRecord: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tstripQuoteLines: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedProductList: Array,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresult: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ttargetGroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquoteProcess: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsaver: String,\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tuseCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tusesClientCalculator: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'invokeSaver(selectedProducts, quote)',\n\t\t\t'_invokeSaver(selectedProductList)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.result = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tinvokeSaver() {\n\t\tlet selectionArray = [];\n\t\tfor (let val in this.selectedProducts)\n\t\t\tselectionArray.push(this.selectedProducts[val]);\n\t\tthis.selectedProductList = selectionArray;\n\t}\n\n\t_invokeSaver() {\n\t\tif(this.useCache === true) //we almost always want to cache this response, but not always\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tlet lines = this.quote.lineItems;\n\t\tvar dataModel = new DataBuilder()\n\t\t\t.addObject('products', this.selectedProductList)\n\t\t\t.add('targetGroupKey', this.targetGroupKey)\n\t\t\t.addObject('quoteProcess', this.quoteProcess);\n\t\tif (this.sendQuoteRecord) {\n\t\t\tdataModel.addObject('quoteRecord', this.quote.record);\n\t\t}\n\t\t// If using JSQC, send the Quote without its lines to maximize scalability\n\t\telse if (this.stripQuoteLines && this.usesClientCalculator) {\n\t\t\tthis.quote.lineItems = [];\n\t\t\tthis.quote.partialVO = lines.length != 0;\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t} else{\n\t\t\tdataModel.addQuote('quote', this.quote);\n\t\t}\n\t\tthis.$.service.model = dataModel.build();\n\t\t// Add the Quote Lines back to the Quote\n\t\tthis.quote.lineItems = lines;\n\t\tthis.quote.partialVO = false;\n\t}\n}\nPolymer(SearchModelSelector);","import {ProductViewModel} from 'products/config/viewmodel/ProductViewModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class ProductMessenger {\n\n\tconstructor(quote, product, prefix, currencyIsoCode, extender) {\n\t\tthis.quote = quote;\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.extender = extender;\n\t\tthis.currencyIsoCode = currencyIsoCode;\n\t\tthis.dynamicOptions = [];\n\t\tthis.featureOptionIds = [];\n\t\tif(this.product && !this.product.initialized)\n\t\t\tthis._initializeProduct(this.product);\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.product.optionFieldSets, 'OptionConfiguration',\n\t\t\t'OptionConfigurationTablet', 'OptionConfigurationPhone');\n\t\tthis.defaultOptionPaths = ['selected', `record.${this.prefix}Quantity__c`];\n\t\tthis.additionalOptionPaths = [];\n\t}\n\n\tgetRequest() {\n\t\tlet message = {quote: this.quote.record};\n\n\t\tif(!this.product)\n\t\t\treturn message;\n\n\t\tmessage.product = {\n\t\t\tconfiguredProductId: this.product.configuration.configuredProductId,\n\t\t\tlineItemId: this.product.configuration.lineItemId,\n\t\t\tlineKey: this.product.configuration.lineItemKey,\n\t\t\tconfigurationAttributes: this._createConfigAttributesMap(),\n\t\t\toptionConfigurations: this._createFeatureOptionsMap(),\n\t\t\tconfigurationData: {} // Empty object which ultimately maps to externalConfigurationData\n\t\t};\n\t\tmessage.products = [];\n\n\t\tthis._appendReadOnlyProperties(message, this.product.configuration);\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif(!message)\n\t\t\treturn;\n\n\t\tlet clones = [];\n\t\t// reset properties that track what dynamic options to add\n\t\tthis.dynamicOptions = [];\n\t\tthis.featureOptionIds = [];\n\t\tif(message.products) {\n\t\t\t// create the appropriate number of clones from the base product before merging changes into the base product\n\t\t\tfor(let i = 0, l = message.products.length; i < l; i++)\n\t\t\t\tclones.push(this._cloneProduct(i));\n\t\t}\n\n\t\tthis._extendResponseQuote(message.quote);\n\t\tthis._extendResponseProduct(this.product, message.product);\n\t\tlet response = {\n\t\t\tquote: this.quote,\n\t\t\tproduct: this.product,\n\t\t\tproducts: this._extendResponseProducts(message.products, clones),\n\t\t\toptionNotifications: this._getResponseOptionPaths()\n\t\t};\n\n\t\tif (this.dynamicOptions.length > 0 && this.featureOptionIds.length > 0) {\n\t\t\tresponse.dynamicOptions = this.dynamicOptions;\n\t\t\tresponse.featureOptionIds = this.featureOptionIds;\n\t\t}\n\n\t\treturn response;\n\t}\n\n\t/** getRequest helper methods **/\n\n\t_appendReadOnlyProperties(obj, config) {\n\t\tobj.readOnly = {};\n\t\tlet line = this._getMatchingQuoteLine(config);\n\t\tif(line) obj.readOnly.line = line.record;\n\t}\n\n\t_getMatchingQuoteLine(config) {\n\t\tif(config == null || config.lineItemKey == null)\n\t\t\treturn null;\n\n\t\tlet lines = this.quote.lineItems.filter(function(line) {\n\t\t\treturn line.key === config.lineItemKey;\n\t\t}.bind(this));\n\n\t\treturn lines.length === 1 ? lines[0] : null;\n\t}\n\n\t_createConfigAttributesMap() {\n\t\tvar map = {};\n\t\tfor (let i = 0, l = this.product.configurationAttributes.length; i < l; i++)\n\t\t\tmap[this.product.configurationAttributes[i].targetFieldName] = null;\n\n\t\tthis.extender.extend(map, this.product.configuration.configurationData);\n\t\treturn map;\n\t}\n\n\t// This doesn't support nested bundles\n\t_createFeatureOptionsMap() {\n\t\tlet featuresMap = {};\n\t\tlet features = this.product.features;\n\t\tfor (let i = 0, l= features.length; i < l; i++) {\n\t\t\tvar featureName = features[i].record.Name;\n\t\t\tfeaturesMap[featureName] = [];\n\t\t\tlet optionConfigurations = features[i]._transient_.optionConfigurations;\n\t\t\tdelete features[i]._transient_.changedExternally;\n\t\t\tif (features[i].optionSelectionMethod === 'Add')\n\t\t\t\tthis._mixInUnselectedOptionsToAdd(featuresMap[featureName], features[i].record.Id, optionConfigurations);\n\t\t\telse if (optionConfigurations)\n\t\t\t\tthis._pushOptionConfigurations(featuresMap[featureName], optionConfigurations, features[i].optionSelectionMethod === 'Click');\n\t\t}\n\t\treturn featuresMap;\n\t}\n\n\t_pushOptionConfigurations(featureOptions, optionConfigurations, isClick) {\n\t\tfor (let i = 0, l = optionConfigurations.length; i < l; i++) {\n\t\t\tlet index = isClick ? undefined : optionConfigurations[i].index;\n\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(optionConfigurations[i], index));\n\t\t}\n\t\tif (!isClick)\n\t\t\tfeatureOptions.push({\n\t\t\t\t'productId': null,\n\t\t\t\t'Quantity': 1,\n\t\t\t\t'configurationData': {}\n\t\t\t});\n\t}\n\n\t_createPseudoOptionConfiguration(optionConfiguration, index) {\n\t\tlet pseudoOptionConfig =  {\n\t\t\toptionId: optionConfiguration.record.Id,\n\t\t\tselected: optionConfiguration.selected,\n\t\t\tProductCode: optionConfiguration.record[this.prefix + 'ProductCode__c'],\n\t\t\tProductName: optionConfiguration.record[this.prefix + 'ProductName__c'],\n\t\t\tQuantity: optionConfiguration.record[this.prefix + 'Quantity__c'],\n\t\t\tconfigurationData: {}\n\t\t};\n\t\tif (index !== undefined) // this is set on selection method Add/Dynamic features only\n\t\t\tpseudoOptionConfig.index = index;\n\t\tthis._appendReadOnlyProperties(pseudoOptionConfig, optionConfiguration);\n\t\treturn pseudoOptionConfig;\n\t}\n\n\t_mixInUnselectedOptionsToAdd(featureOptions, featureId, optionConfigurations) {\n\t\tthis.product.options.forEach( option => {\n\t\t\tlet optionFeature = option.record[this.prefix + 'Feature__c'] || \"Other\";\n\t\t\tif (optionFeature !== featureId)\n\t\t\t\treturn;\n\n\t\t\tlet addedOptions = optionConfigurations.filter( addedOption => { return addedOption.record.Id === option.record.Id; });\n\t\t\tif (addedOptions.length) { // if options has been added, include it in the option configs array\n\t\t\t\tfor (let i = 0; i < addedOptions.length; i++)\n\t\t\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(addedOptions[i], addedOptions[i].index || i));\n\t\t\t} else {  // if option has not been added, include it in the options configs array\n\t\t\t\toption.selected = false;\n\t\t\t\tfeatureOptions.push(this._createPseudoOptionConfiguration(option, 0));\n\t\t\t}\n\t\t});\n\t}\n\n\t/** getResponse helper methods **/\n\n\t_extendResponseQuote(responseQuote) {\n\t\tif(responseQuote != null)\n\t\t\tthis.extender.extend(this.quote.record, this._sanitizeObject(responseQuote));\n\t}\n\n\t_extendResponseProduct(product, responseProduct, productKey) {\n\t\tif(!responseProduct)\n\t\t\treturn;\n\n\t\tthis._extendResponseConfigurationData(product, responseProduct.configurationData);\n\t\tthis._extendResponseConfigurationAttributes(product, responseProduct.configurationAttributes);\n\t\tthis._extendResponseOptionConfigurations(product, responseProduct.optionConfigurations, productKey);\n\t}\n\n\t_extendResponseConfigurationData(product, responseConfigurationData) {\n\t\tif(responseConfigurationData != null)\n\t\t\tthis.extender.extend(product.configuration.externalConfigurationData, this._sanitizeObject(responseConfigurationData));\n\t}\n\n\t_extendResponseConfigurationAttributes(product, responseConfigurationAttributes) {\n\t\tif(responseConfigurationAttributes != null)\n\t\t\tthis.extender.extend(product.configuration.configurationData, this._sanitizeObject(responseConfigurationAttributes));\n\t}\n\n\t_extendResponseOptionConfigurations(product, responseOptionConfigurations, parentProductKey) {\n\t\tlet fieldSetFields;\n\t\t// first build map by option Id of the response options\n\t\tlet responseOptionConfigurationsByOptionId = {};\n\t\tfor(let feature in responseOptionConfigurations) {\n\t\t\tlet featureOptionConfigurations = responseOptionConfigurations[feature];\n\t\t\tfor(let optionConfiguration of featureOptionConfigurations) {\n\t\t\t\tlet optionId = optionConfiguration.optionId;\n\t\t\t\tif(optionId) { // if optionId exists, map over to product option\n\t\t\t\t\tresponseOptionConfigurationsByOptionId[optionId] = responseOptionConfigurationsByOptionId[optionId] || [];\n\t\t\t\t\tresponseOptionConfigurationsByOptionId[optionId].push(optionConfiguration);\n\t\t\t\t} else if (optionConfiguration.productId) { // if productId exists, create data to dynamically create product options\n\t\t\t\t\tthis._createDynamicOption(optionConfiguration, feature);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// now loop over the product options and update quantity, selected, and external config data from the response options\n\t\tlet options = product.options;\n\t\tfor(let option of options) {\n\t\t\tlet sourceOptions = responseOptionConfigurationsByOptionId[option.record.Id];\n\t\t\tif(!sourceOptions)\n\t\t\t\tcontinue;\n\n\t\t\tsourceOptions.forEach(sourceOption => {\n\t\t\t\t// first option with configurationData, let's get the fields in the field set\n\t\t\t\tif(!fieldSetFields && sourceOption.configurationData != null)\n\t\t\t\t\tfieldSetFields = this.fieldSetHandler.getByViewport(PageContainer.getViewport()).fields;\n\t\t\t\tthis._extendResponseOptionConfiguration(product, option, sourceOption, fieldSetFields, parentProductKey);\n\t\t\t})\n\t\t}\n\t}\n\n\t_createDynamicOption(sourceData, featureName) {\n\t\t// create dynamicOption and featureOptionIds data based on customer response\n\t\t// this will be used for creating the dynamicOptions in the productConfigurator\n\t\tlet feature = this.product.features.find( feature => { return feature.record.Name === featureName; });\n\t\tthis.featureOptionIds.push(feature.record.Id + ':' + sourceData.productId);\n\t\tthis.dynamicOptions.push({\n\t\t\t'productId': sourceData.productId,\n\t\t\t'featureId': feature.record.Id,\n\t\t\t'Quantity': isNaN(sourceData.Quantity) ? 1 : sourceData.Quantity,\n\t\t\t'configurationData' : sourceData.configurationData\n\t\t});\n\t}\n\n\t_extendResponseOptionConfiguration(product, option, sourceOption, fieldSetFields, parentProductKey) {\n\t\tif(parentProductKey)\n\t\t\toption.parentProductKey = parentProductKey;\n\n\t\tlet optionFeature = option.record[this.prefix + 'Feature__c'] || \"Other\";\n\t\tlet feature = product.features.find( feature => { return feature.record.Id === optionFeature });\n\t\tif (feature.optionSelectionMethod === 'Click')\n\t\t\tthis._setOptionDataForClickFeature(option, sourceOption, fieldSetFields);\n\t\telse\n\t\t\tthis._setOptionDataForNonClickFeature(option, sourceOption, fieldSetFields, feature);\n\t}\n\n\t_setOptionDataForClickFeature(option, sourceOption, fieldSetFields) {\n\t\tif (sourceOption.selected != null)\n\t\t\toption.selected = sourceOption.selected;\n\n\t\tthis._extendQuantityAndConfigurationDataToOption(option, sourceOption, fieldSetFields);\n\t}\n\n\t_setOptionDataForNonClickFeature(option, sourceOption, fieldSetFields, feature) {\n\t\t// check to see if option is already added to feature\n\t\tlet optionConfiguration = feature._transient_.optionConfigurations.find( opt => { return opt.record.Id === sourceOption.optionId && opt.index === sourceOption.index; });\n\t\tif (sourceOption.selected) {\n\t\t\tif (!optionConfiguration) { // previously un-added option should create a new option configuration\n\t\t\t\t// clone the original option to create option configuration and new option row\n\t\t\t\tlet clone = this._createOptionConfigurationFromOption(option, sourceOption.index);\n\t\t\t\t// add data to configuration and add configuration to optionConfigurations array\n\t\t\t\tthis._extendQuantityAndConfigurationDataToOption(clone, sourceOption, fieldSetFields);\n\t\t\t\tfeature._transient_.optionConfigurations.push(clone);\n\t\t\t\t// notify feature that it has changed externally to render changes\n\t\t\t\tfeature._transient_.changedExternally = true;\n\t\t\t} else { // previously added option should update its data\n\t\t\t\tthis._extendQuantityAndConfigurationDataToOption(optionConfiguration, sourceOption, fieldSetFields);\n\t\t\t}\n\t\t} else if (!sourceOption.selected && optionConfiguration) { // previously added and un-selected option should be removed\n\t\t\toptionConfiguration.selected = false; // un-select option\n\t\t\tfeature._transient_.changedExternally = true; // notify feature that it has changed externally to render changes\n\t\t}\n\t}\n\n\t_createOptionConfigurationFromOption(option, index) {\n\t\tlet clone = JSON.parse(JSON.stringify(option));\n\t\t// set properties required for added options\n\t\tclone.index = index;\n\t\tclone.addedManually = true;\n\t\tclone.selected = true;\n\t\tclone.configured = false;\n\t\treturn clone;\n\t}\n\n\t_extendQuantityAndConfigurationDataToOption(option, sourceOption, fieldSetFields) {\n\t\tif (sourceOption.Quantity != null && option.selected)\n\t\t\toption.record[this.prefix + 'Quantity__c'] = sourceOption.Quantity;\n\n\t\tif (sourceOption.configurationData != null)\n\t\t\tthis._extendConfigurationDataToOption(option, sourceOption, fieldSetFields);\n\t}\n\n\t_extendConfigurationDataToOption(option, sourceOption, fieldSetFields) {\n\t\t// get the sanitized configurationData from the source option\n\t\tlet configurationData = this._sanitizeObject(sourceOption.configurationData);\n\n\t\t// if the field exists in the field set, map that configurationData value to the option record\n\t\t// however, if the field is not in the field set, map the configurationData value to the externalConfigurationData object\n\t\tlet externalConfigurationData = {};\n\t\tfor (let key in configurationData) {\n\t\t\tlet value = configurationData[key];\n\t\t\tif (fieldSetFields.indexOf(key) === -1) {\n\t\t\t\texternalConfigurationData[key] = value;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\toption.record[key] = value;\n\t\t\tlet additionalOptionPath = `record.${key}`;\n\t\t\tif (this.additionalOptionPaths.indexOf(additionalOptionPath) === -1)\n\t\t\t\tthis.additionalOptionPaths.push(additionalOptionPath);\n\t\t}\n\t\t// merge in the new externalConfigurationData to the option\n\t\toption.externalConfigurationData = option.externalConfigurationData || {};\n\t\tthis.extender.extend(option.externalConfigurationData, externalConfigurationData);\n\t}\n\n\t_extendResponseProducts(responseProducts, clones) {\n\t\tif(!responseProducts || responseProducts.length === 0)\n\t\t\treturn [];\n\n\t\tlet products = [];\n\t\tfor(let i = 0, l = responseProducts.length; i < l; i++) {\n\t\t\tlet product = clones[i];\n\t\t\tthis._extendResponseProduct(product, responseProducts[i], product.productKey);\n\t\t\tthis._resetFeatureOptionConfiguration(product);\n\t\t\tproducts.push(product);\n\t\t}\n\t\treturn products;\n\t}\n\n\t_cloneProduct(index) {\n\t\tlet clone = JSON.parse(JSON.stringify(this.product)); // clones the product\n\t\t// assign the clone a unique product key to distinguish this cloned product in the configurator from its source product\n\t\t// as the source product and its clone will always have the same record Id\n\t\tclone.productKey = this._buildProductKey(this.product.record.Id, index);\n\t\tthis._enableSaveToLineEditor(clone);\n\t\treturn clone;\n\t}\n\n\t_buildProductKey(productId, index) {\n\t\tlet prefix = index < 10 ? '00' : (index < 100 ? '0' : '');\n\t\tlet suffix = prefix + index;\n\t\treturn productId.substring(0, 15) + suffix;\n\t}\n\n\t_enableSaveToLineEditor(clone) {\n\t\t// in order to save this cloned product to the line editor, we must nil out the lineItemKey and the lineItemId\n\t\tclone.configuration.lineItemKey = null; // simply null this out since its a Integer type on server\n\t\tdelete clone.configuration.lineItemId; // must delete this as its an Id type on server (so can't null it out)\n\t}\n\n\t_resetFeatureOptionConfiguration(product) {\n\t\t// first clear all feature option configurations\n\t\tlet features = product.features || [];\n\t\tfor(let feature of features)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\t// now sync the feature option configurations by simply instantiating a ProductViewModel\n\t\t// if we don't do this and this cloned product is never selected in the configurator, then the cloned product will not save properly\n\t\tthis._initializeProduct(product);\n\t}\n\n\t_initializeProduct(product) {\n\t\tlet prefix = this.prefix.endsWith('__') ? this.prefix.substring(0, this.prefix.length - 2) : this.prefix;\n\t\tnew ProductViewModel(this.quote.record.Id, product, prefix, this.quote.record.CurrencyIsoCode);\n\t}\n\n\t_getResponseOptionPaths() {\n\t\tlet responseOptionPaths = this.defaultOptionPaths.concat(this.additionalOptionPaths);\n\t\tthis.additionalOptionPaths = [];\n\t\treturn responseOptionPaths;\n\t}\n\n\t_sanitizeObject(object) {\n\t\treturn JSON.parse(JSON.stringify(object, function(key, value) {\n\t\t\tif(key.endsWith('__c') && value instanceof Object) // custom fields cannot have an object value\n\t\t\t\treturn JSON.stringify(value);\n\t\t\treturn value;\n\t\t}));\n\t}\n}\n","export class ConfiguratorSearch {\n\tconstructor(searchFilters, prefix, fieldTypes) {\n\t\tthis.searchFilters = searchFilters;\n\t\tthis.prefix = prefix;\n\t\tthis.fieldTypes = fieldTypes;\n\t}\n\n\tcontainsFeature(feature) {\n\t\tlet featureInput = this.searchFilters[this.prefix + 'Feature__c'];\n\t\tif (featureInput !== null && featureInput !== undefined)\n\t\t\treturn ((feature.record.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 )||\n\t\t\t\t\t(feature.untranslatedRecord !== undefined && feature.untranslatedRecord.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 ));\n\t\treturn true;\n\t}\n\n\thasVisibleOptions(options, showOptions) {\n\t\tif (options.length > 0) {\n\t\t\tfor (let i = 0, numOptions = options.length; i < numOptions; i++) {\n\t\t\t\tif (!options[i].hidden)\n\t\t\t\t\treturn true;\n\t\t\t\telse if(showOptions && showOptions[options[i].record.Id])\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.hasFilterValues();\n\t}\n\n\tallOptionsHiddenByRule(options) {\n\t\tfor (let option of options) {\n\t\t\tif (option.hiddenByRule === false || option.hiddenByRule == null)\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\thasRequiredConfigAttributes(feature, model) {\n\t\tlet configAttributes = model.configAttributesByFeatureId[feature.record.Id];\n\t\tif (configAttributes) {\n\t\t\tfor (let configAttr of configAttributes)\n\t\t\t\tif (configAttr.required)\n\t\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thasConfigAttributes(feature, model) {\n\t\treturn model.configAttributesByFeatureId[feature.record.Id] ? true : false;\n\t}\n\n\tsetOptionVisibility(options) {\n\t\t// some field types have value '' instead of null, so sanitize everything here\n\t\tfor (let filterKey in this.searchFilters) {\n\t\t\tif (this.searchFilters[filterKey] === '')\n\t\t\t\tthis.searchFilters[filterKey] = null;\n\t\t}\n\n\t\tlet _options = JSON.parse(JSON.stringify(options));\n\t\tfor (let i = 0, numOptions = _options.length; i < numOptions; i++) {\n\t\t\tlet filtered = false;\n\t\t\tif(_options[i].record[this.prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\t_options[i].hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(_options[i].isUpgrade) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet searchKeys = Object.keys(this.searchFilters);\n\t\t\tfor (let j = 0, numFilters = searchKeys.length; j < numFilters; j++) {\n\t\t\t\tlet filter = searchKeys[j];\n\t\t\t\tlet filterValue = this.searchFilters[filter];\n\t\t\t\tif (filter === this.prefix + 'Feature__c')\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// custom fields that don't have values are not on the option record, so we need to explicitly check if it is defined.\n\t\t\t\t// if a filter has a value, any options that don't have values for the matching field should be filtered out\n\t\t\t\tif(!_options[i].record[filter] && !filtered)\n\t\t\t\t\tfiltered = filterValue !== null;\n\n\t\t\t\tif (filterValue !== null &&\n\t\t\t\t\t(_options[i].record[filter] && _options[i].record[filter].toLowerCase().indexOf(filterValue.toLowerCase()) === -1) &&\n\t\t\t\t\t(_options[i].untranslatedRecord[filter] === undefined || _options[i].untranslatedRecord[filter].toLowerCase().indexOf(filterValue.toLowerCase()) === -1)) {\n\n\t\t\t\t\tfiltered = true;\n\t\t\t\t\tif (this.fieldTypes[filter] === 'multipicklist') {\n\t\t\t\t\t\tlet multiFilterValues = filterValue.split(';');\n\t\t\t\t\t\tlet multiRecordValues = _options[i].record[filter].split(';');\n\t\t\t\t\t\tlet multiUTLRecordValues = _options[i].untranslatedRecord[filter] ? _options[i].untranslatedRecord[filter].split(';') : [];\n\t\t\t\t\t\tfor (let fv of multiFilterValues) {\n\t\t\t\t\t\t\tfor (let rv of multiRecordValues) {\n\t\t\t\t\t\t\t\tif (rv.indexOf(fv) !== -1) {\n\t\t\t\t\t\t\t\t\tfiltered = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (let urv of multiUTLRecordValues) {\n\t\t\t\t\t\t\t\tif (urv.indexOf(fv) !== -1) {\n\t\t\t\t\t\t\t\t\tfiltered = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t_options[i].hidden = _options[i].hiddenByRule || filtered;\n\t\t}\n\t\treturn _options;\n\t}\n\n\thasFilterValues() {\n\t\tfor (let filter in this.searchFilters) {\n\t\t\tif (this.searchFilters[filter] !== null)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}","import {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class ProductViewModel {\n\tconstructor(qId, product, prefix, currencyIsoCode, fId) {\n\t\tthis.init(product, qId, prefix, currencyIsoCode, fId);\n\t}\n\n\tinit(product, qId, prefix, currencyIsoCode, fId) {\n\t\tthis.product = product || this.product;\n\t\tthis.qId = qId || this.qId; // Quote Id\n\t\tthis.prefix = prefix ? (prefix + '__') : (this.prefix || '');\n\t\tthis.currencyIsoCode = currencyIsoCode || this.currencyIsoCode;\n\t\tthis.featureLookupId =  fId || this.featureLookupId; // refers to the Feature that drives the Option Lookup Page\n\t\tthis.optionsById = {}; // Map that organizes Options by Option Id\n\t\tthis.optionIndexById = {}; // Map that organizes option-indeces by Id\n\t\tthis.optionsByFeatureId = {}; // Map that organizes Options by Feature Id\n\t\tthis.featuresWithOptionsOrConfigAttr = []; // List of Features with at least one Option or a Configuration Attribute\n\t\tthis.featureIdsWithOptionsOrConfigAttr = {};\n\t\tthis.featureIdsWithSelectionMethodAdd = {}; // List of Feature Ids for features with optionSelectionMethod 'Add'\n\t\tthis.featureIdsWithSelectionMethodClick = {}; // List of Feature Ids for features with optionSelectionMethod 'Click'\n\t\tthis.featureIdsWIthSelectionMethodDynamic = {}; // List of Feature Ids for features with optionSelectionMethod 'Dynamic'\n\t\tthis.configAttributesByFeatureId = {}; // Map that organizes Configuration Attributes by Feature Id\n\t\tthis.configurationAttributeValueMap = {}; // Map that stores configuration attributes to values\n\t\tthis.configurationAttributeModelMap = {}; //Map that organizes useful information about Configuration Attributes\n\t\tthis.configurationAttributeTargetFieldMap = {}; // Map of target fields to its list of configuration attributes ids\n\t\tthis.configurationAttributeApplyToOptionMap = {}; // Map of the configuration attributes that apply to product options for the bundle\n\t\tthis.attributeValueMap = {}; // Map of Configuration Attributes by field name so that value is shared across common fields\n\t\tthis.productRulesActions = {}; // Map of required actions generated by product rules\n\t\tthis.originalDataByOptionIds = {}; //Map of optionIds to its original price, discount amount, and discount rate\n\t\tthis.optionDataByOptionIds = {}; // Map of optionIds to its updated optionData\n\t\tthis.featureIdByOptionId = {}; //Map of optionIds to their corresponding featureIds\n\t\tthis.productOptionConfigurationsMap = {}; //Map of the product.configuration.optionConfigurations by option Id\n\t\tthis.initializeProduct();\n\t\tthis.product.initialized = true;\n\t}\n\n\tgetFeature(featureId) {\n\t\tif (featureId === undefined || featureId === 'null')\n\t\t\tfeatureId = null;\n\t\treturn this.product.features.find(feature => feature.record.Id === featureId);\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.optionsById[optionId];\n\t}\n\n\tgetOptionsByFeatureId(featureId) { // Used by the Product Option Table to display the options insides each Feature Table\n\t\tif (featureId === null || featureId === 'null')\n\t\t\tfeatureId = 'Other';\n\n\t\tif (this.isOptionLookupViewModel()) {\n\t\t\t//option lookup doesn't need to bind to the original object. this allows us to bind directly to the selected property in the configurator\n\t\t\t//if slow, strip fieldSet data & id into new object instead of cloning\n\t\t\tvar options = [];\n\t\t\tthis.optionsByFeatureId[featureId].forEach( option => {\n\t\t\t\tlet dummy = JSON.parse(JSON.stringify(option));\n\t\t\t\tdummy.selected = false;\n\t\t\t\toptions.push(dummy);\n\t\t\t});\n\t\t\treturn options;\n\t\t}\n\n\t\tlet feature = this.getFeature(featureId);\n\n\t\tfor (let option of feature._transient_.optionConfigurations) {\n\t\t\tif (!this.isClickFeature(feature))\n\t\t\t\toption.selected = true;\n\t\t}\n\n\t\treturn feature._transient_.optionConfigurations;\n\t}\n\n\tmaxOptionsMet(feature) {\n\t\tlet maxOptions = this.prefix + 'MaxOptionCount__c';\n\t\treturn feature._transient_.optionConfigurations.length >= feature.record[maxOptions];\n\t}\n\n\tsetOptionSelected(optionId, selected) {\n\t\tlet option = this.optionsById[optionId],\n\t\t\tisClick = this.featureIdsWithSelectionMethodClick[this.featureIdByOptionId[optionId]];\n\t\tif (isClick && !option.record[this.prefix + 'Required__c'] ) // This code is hacked in because TableRow fired a selection change during initialization that sets selected to false\n\t\t\toption.selected = selected;\n\t}\n\n\tsetConfigurationAttributesToOptions(option) {\n\t\tfor(let attribute in this.configurationAttributeApplyToOptionMap)\n\t\t\toption.record[attribute] = this.product.configuration.configurationData[attribute]\n\t}\n\n\tgetOptionLayout() {\n\t\tlet optionLayout = this.prefix + 'OptionLayout__c';\n\t\treturn this.product.record[optionLayout] || 'Sections';\n\t}\n\n\tgetTabFeaturesMap() {\n\t\tlet featureCategoryLabels = this.product.featureCategoryLabels;\n\n\t\tlet featuresWithoutCategory = this.featuresWithOptionsOrConfigAttr.filter(feature => {\n\t\t\treturn feature.record[this.prefix + 'Category__c'] === undefined;\n\t\t});\n\t\tlet tabFeaturesMap = {};\n\t\t//Displays features as tabs (tabs without categories).\n\t\tlet featuresLength = this.featuresWithOptionsOrConfigAttr.length;\n\n\t\tif (featuresLength === featuresWithoutCategory.length) {\n\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\ttabFeaturesMap[feature.record.Name] = [feature];\n\t\t\t});\n\t\t} else {\n\t\t\t// loop through categories to ensure we add category names as keys to the tabFeaturesMap in the correct order\n\t\t\t// ordering matters as an Object.keys call on this map upstream will return an array of keys in the same order\n\t\t\t// in which the keys were added to the object - W-3534213\n\t\t\tthis.product.featureCategories.forEach(category => {\n\t\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\t\tlet featureCategory = feature.record[this.prefix + 'Category__c'];\n\n\t\t\t\t\tif (featureCategory === undefined)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif (featureCategory === featureCategoryLabels[category])\n\t\t\t\t\t\ttabFeaturesMap[category] !== undefined ? tabFeaturesMap[category].push(feature) : tabFeaturesMap[category] = [feature];\n\t\t\t\t});\n\t\t\t});\n\t\t\tif (featuresWithoutCategory.length !== 0) {\n\t\t\t\ttabFeaturesMap[\"Other\"] = (tabFeaturesMap[\"Other\"] || []);\n\t\t\t\ttabFeaturesMap[\"Other\"] = tabFeaturesMap[\"Other\"].concat(featuresWithoutCategory);\n\t\t\t}\n\t\t}\n\t\treturn tabFeaturesMap;\n\t}\n\n\tcheckAtLeastOneFeatureHasCategory() {\n\t\treturn !!this.featuresWithOptionsOrConfigAttr.find(feature =>\n\t\t\tfeature.record[this.prefix + 'Category__c'] != null && feature.record[this.prefix + 'Category__c'] !== 'Other'\n\t\t);\n\t}\n\n\tisAppliedImmediately(optionId) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c';\n\t\treturn this.getOption(optionId).record[appliedImmediately];\n\t}\n\n\tinitializeProduct() {\n\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\tthis.product = this.localizer.localizeProduct(this.product);\n\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tselectedOptions = [];\n\n\t\tif (!this.featureLookupId) {\n\t\t\tthis.initConfigAttributesById();\n\t\t\tthis.initConfigurationAttributeMap();\n\t\t}\n\n\t\tfor (let option of this.product.options)\n\t\t\tthis.initOptionInfo(option, selectedOptions);\n\n\t\tthis.buildOptionConfigurationMap();\n\n\t\tfor (let feature of this.product.features) {\n\t\t\tfeature.optionSelectionMethod = this.getOptionSelectionMethod(feature);\n\t\t\tif (!feature._transient_)\n\t\t\t\tfeature._transient_ = {};\n\t\t\tthis.initFeatureOptionConfigurations(feature);\n\t\t\tthis.addFeaturesWithOptionsOrConfigAttr(feature);\n\t\t}\n\n\t\tfor (let option of selectedOptions) { // set added and disabledData for added options\n\t\t\tlet feature = this.getFeature(option.record[featureLabel] || 'Other'), configuredOption;\n\t\t\tif (option.selectionType === 'radio' && option.hidden && feature.visibleSelected)\n\t\t\t\t\toption.selected = false; // don't selected hidden options in radio feature if visible option selected\n\t\t\tif (this.isAddFeature(feature)) {\n\t\t\t\tconfiguredOption = feature._transient_.optionConfigurations.find(function (opt) { return opt.record.Id === option.record.Id; });\n\t\t\t\tif (!configuredOption) {\n\t\t\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\t\t} else {// On reconfigure, following data needs to be defined for duplicate added option in configurator as well as in option lookup\n\t\t\t\t\tconfiguredOption.added = true;\n\t\t\t\t\tconfiguredOption.configured = option.configured;\n\t\t\t\t\tthis.setOptionDisabledData(configuredOption);\n\t\t\t\t}\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tthis.setOptionDisabledData(option);\n\t\t}\n\t}\n\n\tinitOptionInfo(option, selectedOptions) {\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tquantityLabel = this.prefix + 'Quantity__c',\n\t\t\tminQuantityLabel = this.prefix + 'MinQuantity__c',\n\t\t\trecordSelected = this.prefix + 'Selected__c',\n\t\t\trecordRequired = this.prefix + 'Required__c',\n\t\t\tunitPrice = this.prefix + 'UnitPrice__c',\n\t\t\tproductName = this.prefix + 'ProductName__c',\n\t\t\tfeatureId = option.record[featureLabel] || 'Other';\n\n\t\t//configuration attributes can be configured so that the value in them is applied to all the options\n\t\tthis.setConfigurationAttributesToOptions(option);\n\t\toption.valueChanged = false;\n\t\toption.record[unitPrice] = option.record[unitPrice] == null ? undefined : option.record[unitPrice];\n\t\toption.hidden = (option.hiddenByRule && option.hidden) || option.record[unitPrice] === undefined;\n\t\toption.removed = option.removed || option.selected === false && option.record[recordSelected];\n\t\toption.selected = option.selected === undefined ? ( (option.record[recordSelected] && !option.removed) || option.record[recordRequired] ) : option.selected;\n\t\toption.name = option.record[productName];\n\n\t\tif (!option._transient_)\n\t\t\toption._transient_ = {};\n\n\t\tif (!option.selected)\n\t\t\tthis.setOptionDisabledData(option);\n\t\telse if (selectedOptions != null)\n\t\t\tselectedOptions.push(option); // disabledData may be derived differently for some selected options\n\n\t\tif(option.isUpgrade === true)\n\t\t\toption.hidden = true;\n\t\tif (!option.record[featureLabel] && !this.product.mappedFeaturelessOptions) {\n\t\t\tthis.product.features.push(this.createOtherOptionsFeature(this.product.virtualFeatureTitle));\n\t\t\tthis.product.mappedFeaturelessOptions = true;\n\t\t}\n\t\tif (option.record[quantityLabel] === undefined) {\n\t\t\toption.recordHasQuantity = false;\n\t\t\toption.record[quantityLabel] = option.record[minQuantityLabel] === undefined ? 1 : option.record[minQuantityLabel];\n\t\t}\n\t\tif (option.record[recordRequired])\n\t\t\toption.required = true; // do this so Actions.js can know to disable trashcan without needing the prefix\n\n\t\tif (this.product._transient_ && this.product._transient_.attributeSet && this.product._transient_.attributeSet.attributeItemIdsByOptionId[option.record.Id]) {\n\t\t\tthis.product._transient_.hasAttributeItems = true;\n\t\t\tthis.addAttributeItems(option, this.product._transient_.attributeSet);\n\t\t}\n\n\t\tthis.optionsById[option.record.Id] = option;\n\t\tthis.featureIdByOptionId[option.record.Id] = featureId;\n\t\tthis.addToOptionByFeatureId(featureId, option);\n\t\tthis.originalDataByOptionIds[option.record.Id] = {\n\t\t\tunitPrice: option.record[this.prefix+'UnitPrice__c'],\n\t\t\tdiscountAmount: option.record[this.prefix+'DiscountAmount__c'],\n\t\t\tdiscountRate: option.record[this.prefix+'Discount__c'],\n\t\t\tquantity: option.record[quantityLabel]\n\t\t};\n\t}\n\n\tcreateOtherOptionsFeature(name) {\n\t\treturn {\n\t\t\taddOptionButtonLabel: \"Add Option\",\n\t\t\taddOptionDialogTitle: \"Add Option\",\n\t\t\tinstructionsText: null,\n\t\t\trecord: {\n\t\t\t\tId: 'Other',\n\t\t\t\tName: name\n\t\t\t},\n\t\t\tsearchFilters: null\n\t\t}\n\t}\n\n\taddAttributeItems(option, attributeSet) {\n\t\toption._transient_.attributeItems = {};\n\t\tfor (let id of attributeSet.attributeItemIdsByOptionId[option.record.Id]) {\n\t\t\tlet targetFieldName = attributeSet.attributeItemById[id].targetFieldName;\n\t\t\toption._transient_.attributeItems[targetFieldName] = option.record[targetFieldName];\n\t\t}\n\t\toption._transient_.optionDrawerExpanded = false;\n\t\toption._transient_.drawerIconClass = 'sf-icon-chevronright';\n\t}\n\n\tgetOptionSelectionMethod(feature) { // change to init since you are setting it in beginning\n\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn feature.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\tif (this.product.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn this.product.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\t//Defaults to Option Selection Method 'Click' if unspecified.\n\t\treturn 'Click';\n\t}\n\n\tsetOptionDisabledData(option, duplicate) {\n\t\t//Both properties disable manual selection. 'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t//Only non-duplicate required options or system options are DISABLED\n\t\t//Only options affected by option constraints are CONSTRAINED, which is set altered after initialization\n\t\toption.disabledData = option.disabledData || {\n\t\t\t'disabled':  ((!!option.record[this.prefix + 'Required__c'] && !option.added) || !!option.record[this.prefix + 'System__c']),\n\t\t\t'constrained': false\n\t\t};\n\t\tif (duplicate) { //Needs to run on reconfigure to allow duplicates of added required options to be deleted/selected\n\t\t\tlet original = this.optionsById[option.record.Id];\n\t\t\toriginal.disabledData = {'disabled': false, 'constrained': false};\n\t\t\toption.disabledData.disabled = false;\n\t\t}\n\t}\n\n\tinitFeatureOptionConfigurations(feature) {\n\t\tif (feature._transient_.optionConfigurations == null)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\tif (this.optionsByFeatureId[feature.record.Id] == null)\n\t\t\treturn;\n\n\t\tlet displayRadio = feature.record[this.prefix + 'MaxOptionCount__c'] === 1;\n\t\tlet notInitialized = feature._transient_.optionConfigurations.length === 0;\n\t\tlet featureId = feature.record.Id || 'Other';\n\t\tlet unsortedOptionConfigs = [];\n\t\tfor (let option of this.optionsByFeatureId[featureId]) {\n\t\t\tfeature.visibleSelected = feature.visibleSelected || (!option.hidden && option.selected);\n\t\t\toption.selectionType = displayRadio ? 'radio' : 'checkbox';\n\t\t\toption.record[this.prefix + 'ConfiguredSKU__c'] = this.product.record.Id;\n\t\t\tif (this.isDynamicFeature(feature) && !feature._transient_.changedExternally) { // TODO: Look into this and see why these properties can be set in OptionLookup but not Dynamic Lookup\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tif (this.featureLookupId) {\n\t\t\t\toption._transient_.rowActions = []; // define this as we have downstream observers on this property even in option lookup\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// Create option actions for each option unless the page is in Dynamic/Option Lookup\n\t\t\tif (option._transient_.rowActions == null || option._transient_.rowActions.length === 0 || feature._transient_.changedExternally)\n\t\t\t\tthis.initOptionActions(option, !this.isClickFeature(feature));\n\t\t\tthis.initReconfiguredOption(option, feature, notInitialized, unsortedOptionConfigs);\n\t\t}\n\n\t\tif (unsortedOptionConfigs.length>0)\n\t\t\tthis.sortAndAddOptionConfigs(feature, unsortedOptionConfigs);\n\t}\n\n\tbuildOptionConfigurationMap() {\n\t\tif (!this.product.features[0] || this.product.features[0]._transient_ != null)\n\t\t\treturn;\n\t\tfor (let optionConfiguration of this.product.configuration.optionConfigurations) {\n\t\t\tlet id = optionConfiguration.optionId;\n\t\t\tthis.productOptionConfigurationsMap[id] = this.productOptionConfigurationsMap[id] || [];\n\t\t\tthis.productOptionConfigurationsMap[id].push(optionConfiguration);\n\t\t}\n\t}\n\n\tinitOptionActions(option, isNotClick) {\n\t\tlet actions = [];\n\t\tif (isNotClick)\n\t\t\tactions.push(this.createOptionAction('sf-icon-delete', 'Delete', 'left', true, false, false, 'delete-tapped'));\n\t\t// if (this.hasConfigurableOptions) // TODO: Move this back after figuring out how to properly put the actions then hiding them inside row headers (Look at POT)\n\t\tthis.addOptionConfigurationAction(option, actions);\n\n\t\toption._transient_.rowActions = actions;\n\t}\n\n\taddOptionConfigurationAction(option, actions) { //Must add an invisible action here to allocate proper spacing for each product option line\n\t\tlet required = option.configurable ? option.configurationRequired : undefined;\n\t\tactions.push(this.createOptionAction('sf-icon-custom_apps', 'Configure', 'left', false, false, false, 'configure-tapped', required));\n\t}\n\n\tcreateOptionAction(icon, title, position, mobileDisabled, hidden, invisible, fireEvent, configurationRequired) {\n\t\treturn {\n\t\t\ticon: icon, title: title, position: position, mobileDisabled: mobileDisabled, hidden: hidden, invisible: invisible, configurationRequired: configurationRequired,\n\t\t\tonTapFunction: function () { this.fire(fireEvent, { Id: this.data.record.Id, index: this.index }); }\n\t\t}\n\t}\n\n\taddToOptionByFeatureId(featureId, option) {\n\t\tthis.optionsByFeatureId[featureId] = this.optionsByFeatureId[featureId] || [];\n\t\tthis.optionsByFeatureId[featureId].push(option);\n\t}\n\n\tinitConfigAttributesById() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tif (attr[i].featureId === null) {\n\t\t\t\tif (!this.configAttributesByFeatureId.featureless)\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless.push(attr[i]);\n\t\t\t} else {\n\t\t\t\tif (!this.configAttributesByFeatureId[attr[i].featureId])\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId] = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId].push(attr[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitConfigurationAttributeMap() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tlet configData = this.product.configuration.configurationData;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tlet fieldName = attr[i].targetFieldName;\n\t\t\t//Providing a map for values since attributes for a single field need to reference the same value\n\t\t\tthis.attributeValueMap[attr[i].targetFieldName] = '';\n\t\t\tlet configurationAttributeValue =  new RelationshipFieldManager(fieldName, configData).getRelationshipName() || configData[fieldName];\n\t\t\t// never assign an undefined value here or the configuration attribute will not display\n\t\t\tthis.configurationAttributeValueMap[attr[i].myId] = configurationAttributeValue !== undefined ? configurationAttributeValue : null;\n\t\t\t// the bundleId is the product's product key if a cloned product, otherwise just the product's record Id\n\t\t\tlet bundleId = this.product.productKey || this.product.record.Id;\n\t\t\tthis.configurationAttributeModelMap[attr[i].myId] = {\n\t\t\t\ttargetFieldName: attr[i].targetFieldName,\n\t\t\t\tvalue: configurationAttributeValue,\n\t\t\t\trequired: attr[i].required,\n\t\t\t\thidden: attr[i].hidden,\n\t\t\t\tmyId: attr[i].myId,\n\t\t\t\tbundleId: bundleId,\n\t\t\t\tautoSelect: attr[i].autoSelect,\n\t\t\t\tshownValues: attr[i].shownValues,\n\t\t\t\thiddenValues: attr[i].hiddenValues\n\t\t\t};\n\t\t\tlet ids = this.configurationAttributeTargetFieldMap[attr[i].targetFieldName] || [];\n\t\t\tids.push(attr[i].myId);\n\t\t\tthis.configurationAttributeTargetFieldMap[attr[i].targetFieldName] = ids;\n\t\t\t//set a map of attributes that will be applied to options\n\t\t\tif(attr[i].applyToProductOptions === true && this.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] === undefined)\n\t\t\t\tthis.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] = true;\n\t\t}\n\t}\n\n\tinitReconfiguredOption(option, feature, notInitialized, unsortedOptionConfigs) {\n\t\tconst configsArray = this.productOptionConfigurationsMap[option.record.Id];\n\t\tif (!configsArray || option.removed) {\n\t\t\tif (notInitialized && this.isClickFeature(feature))\n\t\t\t\treturn feature._transient_.optionConfigurations.push(option);\n\t\t\treturn;\n\t\t}\n\t\t// Add options from a feature that uses option selection method add\n\t\tif (this.isAddFeature(feature)) {\n\t\t\tthis.cloneOptionAndSyncConfiguration(option, unsortedOptionConfigs);\n\t\t\treturn;\n\t\t}\n\n\t\tlet config = configsArray[0];\n\t\toption.index = 0;\n\t\tthis.syncOptionToConfigData(option);\n\t\tthis.setPropertiesWithConfig(option, config);\n\n\t\tif (notInitialized) {\n\t\t\tif (this.isClickFeature(feature))\n\t\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\telse\n\t\t\t\tunsortedOptionConfigs.push(option);\n\t\t}\n\t}\n\n\tcloneOptionAndSyncConfiguration(option, unsortedOptionConfigs) {\n\t\tlet configsArray = this.productOptionConfigurationsMap[option.record.Id],\n\t\t\trequiredOptionAdded = {};\n\n\t\tfor (let i=0;i<configsArray.length;i++) {\n\t\t\tlet config = configsArray[i],\n\t\t\t\tclonedOption = JSON.parse(JSON.stringify(option));\n\t\t\tclonedOption._transient_.rowActions = option._transient_.rowActions; //we lose the rowActions when we stringify, so adding them back\n\t\t\tif (requiredOptionAdded[clonedOption.record.Id] === true)\n\t\t\t\tclonedOption.required = false; // Actions.js uses this property to disable trashcan without needing the prefix\n\t\t\telse\n\t\t\t\trequiredOptionAdded[clonedOption.record.Id] = true;\n\n\t\t\tclonedOption.index = i;\n\t\t\tthis.syncOptionToConfigData(clonedOption);\n\t\t\tthis.setPropertiesWithConfig(clonedOption, config);\n\t\t\tunsortedOptionConfigs.push(clonedOption);\n\t\t}\n\t}\n\n\t// Dynamic Options that were saved to a quote and then loaded to reconfigure do not have option Ids. We need to treat these as a single option unlike 'Add' options.\n\t// We must create a new entry to the configurations map so subsequent dynamic options with the same optionalSKU and featureID will point to another optionConfiguration.\n\tlinkDynamicOptionToConfig(option, config, dynamicId) {\n\t\tthis.productOptionConfigurationsMap[config.optionId] = [config];\n\t\toption.record.Id = config.optionId;\n\t\tthis.productOptionConfigurationsMap[dynamicId].shift();\n\t\tif (this.productOptionConfigurationsMap[dynamicId].length === 0)\n\t\t\tdelete this.productOptionConfigurationsMap[dynamicId];\n\t\treturn this.productOptionConfigurationsMap[config.optionId][0]; //There can only be one dynamic Id with this unique Id at all times\n\t}\n\n\t//the product stores some attributes that are not available on the option\n\t//specifically for options that have already been configured additional properties exist under the product.optionConfigurations array\n\t//this does a mixin for all the properties\n\tsyncOptionToConfigData(option) {\n\t\tlet config = this.getProductOptionConfigurationData(option.record.Id, option.index);\n\t\tif (config === undefined)\n\t\t\treturn;\n\n\t\tfor (let key in config) {\n\t\t\tif (option.hasOwnProperty(key) )\n\t\t\t\tcontinue;\n\n\t\t\toption[key] = config[key];\n\t\t}\n\t}\n\n\t//the product has an array of options with data that is not available on the option itself\n\t//here we setup a map for accessing that data\n\tgetProductOptionConfigurationData(id, index) {\n\t\tif (this.productOptionConfigurationsMap[id][index] === undefined)\n\t\t\tthis.buildOptionConfigurationMap();\n\n\t\treturn this.productOptionConfigurationsMap[id][index];\n\t}\n\n\tsetPropertiesWithConfig(option, config) {\n\t\toption.selected = option.selected !== false;\n\t\tfor (let key in config.optionData) {\n\t\t\tif (key === 'attributes')\n\t\t\t\tcontinue;\n\n\t\t\toption.record[key] = config.optionData[key];\n\t\t}\n\t\toption.dynamicOptionKey = config.dynamicOptionKey;\n\t}\n\n\tgetHasUpgradeOptions(feature) {\n\t\tif(feature.record.Id === 'Other') {\n\t\t\tfor (let i = 0; i < feature._transient_.optionConfigurations.length; i++) {\n\t\t\t\tif (feature._transient_.optionConfigurations[i].isUpgrade === true) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn feature.containsUpgrades;\n\t\t}\n\t}\n\n\tsortAndAddOptionConfigs(feature, unsorted) {\n\t\tlet duplicate;\n\t\tfor (let optionConfig of unsorted) {\n\t\t\tif (!!optionConfig) {\n\t\t\t\tif (this.isAddFeature(feature)) {\n\t\t\t\t\toptionConfig.added = true;\n\t\t\t\t\tduplicate = !!feature._transient_.optionConfigurations.filter(o => {return o.record.Id === optionConfig.record.Id;});\n\t\t\t\t}\n\t\t\t\tthis.setOptionDisabledData(optionConfig, duplicate);\n\t\t\t\tfeature._transient_.optionConfigurations.push(optionConfig);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcreateConstraintsHoverMessages(constraintsByConstrained) {\n\t\tthis.optionConstraintsByConstrained = constraintsByConstrained;\n\t\tfor (let option of this.product.options) {\n\t\t\tthis.createConstraintHoverMessage(option);\n\t\t}\n\t}\n\n\tcreateConstraintHoverMessage(option) {\n\t\tif (!this.optionConstraintsByConstrained[option.record.Id])\n\t\t\treturn;\n\n\t\tlet constraint = this.optionConstraintsByConstrained[option.record.Id],\n\t\t\tmessage = {'Requires': [], 'Excludes': []},\n\t\t\tconstraintMessage = [];\n\n\t\tconstraint.ungroupedConstraints.forEach(function(ungrouped) {\n\t\t\tlet type = ungrouped.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = ungrouped.type === 'Dependency' ? 'or ' : 'and ',\n\t\t\t\tconnector = message[type].length ? operator : type + ': ',\n\t\t\t\tconstrainingOption = this.optionsById[ungrouped.option].record[this.prefix + 'ProductName__c'];\n\t\t\tmessage[type].push(connector + constrainingOption);\n\t\t}.bind(this));\n\n\t\tObject.keys(constraint.groups).forEach(function(groupName, i) {\n\t\t\tlet group = constraint.groups[groupName],\n\t\t\t\ttype = group.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = message[type].length ? (i == 0 && constraint.ungroupedConstraints[0] ? 'and ' : 'or ') : type + ': ',\n\t\t\t\tstatement = '';\n\n\t\t\tgroup.options.forEach(function(groupedOption, index) {\n\t\t\t\tlet constraining = this.optionsById[groupedOption].record[this.prefix + 'ProductName__c'];\n\t\t\t\toperator = index === 0 ? operator : ' and ';\n\t\t\t\tstatement += (operator + constraining);\n\t\t\t}.bind(this));\n\n\t\t\tmessage[type].push(statement);\n\t\t}.bind(this));\n\n\t\tif (message.Requires.length)\n\t\t\tfor (let requirement of message.Requires) { constraintMessage.push(requirement); }\n\t\tif (message.Excludes.length)\n\t\t\tfor (let exclusion of message.Excludes) { constraintMessage.push(exclusion); }\n\n\t\toption.constraintMessage = constraintMessage;\n\t}\n\n\toptionSystemOrRequired(id) {\n\t\tlet option = this.optionsById[id];\n\t\treturn option.record[this.prefix + 'System__c'] || option.record[this.prefix + 'Required__c'];\n\t}\n\n\tisOptionLookupViewModel() {\n\t\treturn !!this.featureLookupId;\n\t}\n\n\tisClickFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Click';\n\t}\n\n\tisAddFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Add';\n\t}\n\n\tisDynamicFeature(feature) {\n\t\treturn feature.optionSelectionMethod === 'Dynamic';\n\t}\n\n\taddFeaturesWithOptionsOrConfigAttr(feature) {\n\t\tif (!this.optionsByFeatureId[feature.record.Id] && !this.configAttributesByFeatureId[feature.record.Id] && !this.isDynamicFeature(feature))\n\t\t\treturn;\n\t\tthis.featuresWithOptionsOrConfigAttr.push(feature);\n\t\tthis.featureIdsWithOptionsOrConfigAttr[feature.record.Id] = feature;\n\t\tif (this.isClickFeature(feature))\n\t\t\tthis.featureIdsWithSelectionMethodClick[feature.record.Id] = true;\n\t\telse if (this.isAddFeature(feature))\n\t\t\tthis.featureIdsWithSelectionMethodAdd[feature.record.Id] = true;\n\t\telse if (this.isDynamicFeature(feature))\n\t\t\tthis.featureIdsWIthSelectionMethodDynamic[feature.record.Id] = true;\n\t}\n}\n","export class OptionConstraintsHandler {\n\tconstructor(product, prefix) {\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.messages = {};\n\t\tthis.setOptionConstraints();\n\t}\n\n\tsetOptionConstraints() {\n\t\tif (!this.product.constraints)\n\t\t\treturn null;\n\n\t\tlet constraintType = this.prefix + 'Type__c',\n\t\t\tconstrainedOption = this.prefix + 'ConstrainedOption__c',\n\t\t\tconstrainingOption = this.prefix + 'ConstrainingOption__c',\n\t\t\tconstraintGroup = this.prefix + 'OptionConstraintGroup__c',\n\t\t\tconstraints = {\n\t\t\t\tbyConstraining: {},\n\t\t\t\tbyConstrained: {},\n\t\t\t\tconstrainingByConstrained: {}\n\t\t\t};\n\n\t\tthis.product.constraints.forEach(constraint => {\n\t\t\tlet type = constraint.record[constraintType],\n\t\t\t\tconstrainedId = constraint.record[constrainedOption],\n\t\t\t\tconstrainingId = constraint.record[constrainingOption],\n\t\t\t\tgroups = constraint.record[constraintGroup] ? constraint.record[constraintGroup].split(', ') : null;\n\n\t\t\t//1- .byConstraining to reference constrained option and type on selection\n\t\t\tif (constraints.byConstraining[constrainingId]) {\n\t\t\t\tconstraints.byConstraining[constrainingId].push({\n\t\t\t\t\ttype: type,\n\t\t\t\t\toption: constrainedId\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconstraints.byConstraining[constrainingId] = [{\n\t\t\t\t\ttype: type,\n\t\t\t\t\toption: constrainedId\n\t\t\t\t}];\n\t\t\t}\n\t\t\t//2- .byConstrained to reference all constraining options on reference to constrained\n\t\t\tif (constraints.byConstrained[constrainedId]) {\n\t\t\t\tif (groups) {\n\t\t\t\t\tgroups.forEach(group => {\n\t\t\t\t\t\tif (constraints.byConstrained[constrainedId].groups[group]) {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group].options.push(constrainingId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group] = {\n\t\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\t\toptions: [constrainingId]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainedId].ungroupedConstraints.push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconstraints.byConstrained[constrainedId] = {\n\t\t\t\t\tungroupedConstraints: [],\n\t\t\t\t\tgroups: {}\n\t\t\t\t};\n\t\t\t\tif (groups) {\n\t\t\t\t\tgroups.forEach(group => {\n\t\t\t\t\t\tif (constraints.byConstrained[constrainedId].groups[group]) {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group].options.push(constrainingId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group] = {\n\t\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\t\toptions: [constrainingId]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainedId].ungroupedConstraints = [{\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t}\n\t\t\t//3- Ungrouped exclusion constraints are reflexive\n\t\t\tif (type === 'Exclusion' && !groups) {\n\t\t\t\tif (constraints.byConstraining[constrainedId]) {\n\t\t\t\t\tconstraints.byConstraining[constrainedId].push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstraining[constrainedId] = [{\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t\tif (constraints.byConstrained[constrainingId]) {\n\t\t\t\t\tconstraints.byConstrained[constrainingId].ungroupedConstraints.push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainedId\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainingId] = {\n\t\t\t\t\t\tungroupedConstraints: [{\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\toption: constrainedId\n\t\t\t\t\t\t}],\n\t\t\t\t\t\tgroups: {}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\t//4- All constraining options by constrained only\n\t\t\tlet constraining = constraints.constrainingByConstrained[constrainedId] || [];\n\t\t\tconstraining.push(this.getOption(constrainingId));\n\t\t\tconstraints.constrainingByConstrained[constrainedId] = constraining;\n\t\t});\n\n\t\tthis.optionConstraints = constraints;\n\t}\n\n\thandleOptionConstraints(changedOptionId, selected) {\n\t\tif (!this.optionConstraints || !this.optionConstraints.byConstraining[changedOptionId])\n\t\t\treturn;\n\n\t\tlet result = [],\n\t\t\taddedOrSelected = selected || this.getOption(changedOptionId).added;\n\t\t// Can't depend on option selection always firing before constraints handling\n\t\tthis.getOption(changedOptionId).selected = selected;\n\n\t\tthis.optionConstraints.byConstraining[changedOptionId].forEach(constraint => {\n\t\t\tlet disabledState = this.optionIsConstrained(constraint, changedOptionId, addedOrSelected);\n\t\t\tlet constrainedOption = this.getOption(constraint.option);\n\t\t\tlet selected = constrainedOption.selected;\n\t\t\tlet rendered = constrainedOption._transient_ && constrainedOption._transient_.rendered;\n\t\t\tresult.push({optionId: constraint.option, disabledState: disabledState, selected: selected, rendered: rendered});\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetUnrenderedConstraining(constrained) {\n\t\tlet constraining = this.optionConstraints.constrainingByConstrained[constrained] || [];\n\t\treturn constraining.filter(constraint => {\n\t\t\t// filter out options marked as rendered\n\t\t\treturn !constraint._transient_ || !constraint._transient_.rendered;\n\t\t});\n\t}\n\n\toptionIsConstrained(constraint, changedOptionId, selected) {\n\t\tlet constraintType = constraint.type,\n\t\t\tconstrainedOption = this.optionConstraints.byConstrained[constraint.option],\n\t\t\thasGroupConstraints = Object.keys(constrainedOption.groups).length > 0,\n\t\t\tconstraintObj = this.isConstrainedByUngrouped(constrainedOption);\n\n\t\tif (constraintObj.constrained)\n\t\t\treturn true;\n\n\t\tif (hasGroupConstraints)\n\t\t\treturn this.isConstrainedByGrouped(constrainedOption.groups);\n\n\t\treturn this.getUnaffectedDisabledState(changedOptionId, selected, constraintType === 'Dependency', constraintObj.requiredConditionMet);\n\t}\n\n\tisConstrainedByUngrouped(constrainedOption) {\n\t\tlet excludedConstrained = false,\n\t\t\trequiredConstrained = false,\n\t\t\trequiredConditionMet = false,\n\t\t\tungroupedConstraints = constrainedOption.ungroupedConstraints,\n\t\t\tlen = ungroupedConstraints ? ungroupedConstraints.length : -1,\n\t\t\ti = 0;\n\n\t\twhile (!excludedConstrained && i < len) {\n\t\t\tlet associatedOption = this.getOption(ungroupedConstraints[i].option),\n\t\t\t\tassociatedType = ungroupedConstraints[i].type;\n\n\t\t\tif (associatedType === 'Exclusion') {\n\t\t\t\texcludedConstrained = this.isSelected(associatedOption);\n\t\t\t} else if (associatedType === 'Dependency' && !requiredConditionMet) {\n\t\t\t\trequiredConditionMet = this.isSelected(associatedOption);\n\t\t\t\trequiredConstrained = !requiredConditionMet;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn {'constrained': excludedConstrained || requiredConstrained, 'requiredConditionMet': requiredConditionMet};\n\t}\n\n\tisConstrainedByGrouped(groups) {\n\t\tlet constrained = false,\n\t\t\tconstrainedByDependency = true,\n\t\t\tconstrainedByExclusion = false,\n\t\t\tlen = Object.keys(groups).length,\n\t\t\ti = 0;\n\n\t\twhile (i < len) {\n\t\t\tlet constrainedWithinGroup = false,\n\t\t\t\tgroup = groups[Object.keys(groups)[i]],\n\t\t\t\ttype = group.type,\n\t\t\t\toptions = group.options,\n\t\t\t\tlen2 = options.length,\n\t\t\t\tj = 0;\n\n\t\t\tif (type === 'Dependency' && constrainedByDependency && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1)\n\t\t\t\t\t\tconstrainedByDependency = false;\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByDependency;\n\t\t\t}\n\n\t\t\tif (type === 'Exclusion' && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1) {\n\t\t\t\t\t\tconstrainedByExclusion = true;\n\t\t\t\t\t}\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByExclusion;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn constrained;\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.product.options.find(option => option.record.Id === optionId);\n\t}\n\n\tisSelected(option) {\n\t\treturn (option && (option.selected || option.added || !!option.priorOptionExists));\n\t}\n\n\tgetUnaffectedDisabledState(optId, selected, isDependency, requiredConditionMet) {\n\t\tif (isDependency) {\n\t\t\treturn requiredConditionMet ? false : !(selected || !!this.getOption(optId).priorOptionExists);\n\t\t}\n\t\telse\n\t\t\treturn selected || !!this.getOption(optId).priorOptionExists;\n\t}\n\n\toptionShouldBeDisabled(optId) {\n\t\tlet constrainedOption = this.optionConstraints.byConstrained[optId],\n\t\t\thasUngroupedConstraints, hasGroupedConstraints, constrainingId, selected, constraint;\n\n\t\tif (!constrainedOption)\n\t\t\treturn false;\n\n\t\thasUngroupedConstraints = constrainedOption.ungroupedConstraints.length >= 1;\n\t\thasGroupedConstraints = Object.keys(constrainedOption.groups).length >= 1;\n\n\t\t// Just need one applicable constrainingId to examine all related constraints via optionIsConstrained()\n\t\tif (hasUngroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.ungroupedConstraints[0].option;\n\t\t} else if (hasGroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.groups[Object.keys(constrainedOption.groups)[0]].options[0];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\tselected = this.isSelected(this.getOption(constrainingId));\n\t\tconstraint = this.optionConstraints.byConstraining[constrainingId].find( c => { return c.option === optId; });\n\n\t\treturn this.optionIsConstrained(constraint, constrainingId, selected);\n\t}\n}","export class OptionUpgradeHandler {\n\n\tconstructor(prefix, options, option) {\n\t\tthis.prefix = prefix;\n\t\tthis.options = options;\n\t\tthis.option = option;\n\t}\n\n\tisSourceLine() {\n\t\treturn this.option.priorBundledQuantity != null;\n\t}\n\n\tgetLine() {\n\t\treturn this.option;\n\t}\n\n\tgetLines() {\n\t\treturn this.options;\n\t}\n\n\tgetSourceOrUpgrade(sourceOp, upgradeOp) {\n\t\tfor(let i = 0; i < this.options.length; i++) {\n\t\t\tlet sourceOption = sourceOp || this.options[i];\n\t\t\tlet upgradeOption = upgradeOp || this.options[i];\n\n\t\t\tif(upgradeOption.sourceProductIds && (upgradeOption.sourceProductIds.indexOf(sourceOption.record[this.prefix + 'OptionalSKU__c']) != -1)) {\n\t\t\t\treturn this.options[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSourceAndUpgrade(sourceOption, upgradeOption) {\n\t\tthis.sourceOption = sourceOption;\n\t\tthis.upgradeOption = upgradeOption;\n\t}\n\n\tgetSourceIdField() {\n\t\treturn this.prefix + 'OptionalSKU__c';\n\t}\n\n\tgetUpgradeConversionRateField() {\n\t\treturn this.prefix + 'UpgradeConversionRate__c';\n\t}\n\n\tgetSourceCurrentQuantityField(sourceOption) {\n\t\treturn sourceOption.selected ? sourceOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetUpgradeCurrentQuantityField(upgradeOption) {\n\t\treturn upgradeOption.selected ? upgradeOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetSourcePriorQuantity(sourceOption) {\n\t\treturn sourceOption.priorBundledQuantity;\n\t}\n\n\tdidSourceQuantityChange(didUserChangeSourceOption, sourceOption, upgradeOption) {\n\t\treturn upgradeOption.selected && (didUserChangeSourceOption || !sourceOption.selected);\n\t}\n\n\tdidUpgradeQuantityChange(didUserChangeSourceOption, sourceOption) {\n\t\treturn sourceOption.selected && !didUserChangeSourceOption\n\t}\n\n\tisSelected(option) {\n\t\treturn option.selected;\n\t}\n\n\tsetUpdatedQuantity(sourceOption, upgradeOption, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n\t\tif(sourceOption.selected) {\n\t\t\tsourceOption.record[this.prefix + 'Quantity__c'] = sourceQtyAfterUpdate;\n\t\t}\n\n\t\tif(upgradeOption.selected) {\n\t\t\tupgradeOption.record[this.prefix + 'Quantity__c'] = upgradeQtyAfterUpdate;\n\t\t}\n\t}\n\n\tgetSourceOption() {\n\t\treturn this.sourceOption;\n\t}\n\n\tgetUpgradeOption() {\n\t\treturn this.upgradeOption;\n\t}\n\n\tsetUpgradedAssetId() {\n\t\tlet sourceOption = this.getSourceOrUpgrade(null, this.option);\n\t\tthis.option.upgradedAssetId = sourceOption.upgradedAssetId;\n\t}\n}\n","import {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class ProductReconfigurer {\n\n\tconstructor(product, quoteType) {\n\t\tthis.product = product;\n\t\tthis.product.quoteType = quoteType;\n\t}\n\n\treconfigure(configuration) {\n\t\tlet selectedOptions = {};\n\t\t// attaches nestedOptionModel on initial reconfigure over the product's loaded configuration\n\t\t// if loading from cache, it continues over the passed-in configuration object\n\t\tif (!configuration)\n\t\t\tthis.product.nestedOptionModel = this.product.nestedOptionModel || new NestedOptionsModel(this.product.configuration, true);\n\t\telse\n\t\t\tthis.product.configuration = configuration;\n\t\t// port pertinent data from configuration VO to option VO on initialization\n\t\tif (!!this.product.configuration.optionConfigurations.length) {\n\t\t\tthis.buildOptionConfiguration(this.product.configuration.optionConfigurations, selectedOptions);\n\t\t\tfor (let option of this.product.options) {\n\t\t\t\tif (selectedOptions[option.record.Id]) {\n\t\t\t\t\toption.isDynamicOption = selectedOptions[option.record.Id].isDynamicOption;\n\t\t\t\t\toption.upgradedAssetId = selectedOptions[option.record.Id].upgradedAssetId;\n\t\t\t\t\toption.priorBundledQuantity = selectedOptions[option.record.Id].priorBundledQuantity;\n\n\t\t\t\t\tif(selectedOptions[option.record.Id].configured === true || selectedOptions[option.record.Id].optionConfigurations) {\n\t\t\t\t\t\toption.configured = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toption.selected = option.selected === true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let option of this.product.options) {\n\t\t\t\tif (option.configuration)\n\t\t\t\t\tdelete option.configuration;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildOptionConfiguration(optionConfigs, selectedOptions) {\n\t\tlet segmentedMap = {};\n\t\tfor (let i=0;i<optionConfigs.length;i++) {\n\t\t\tlet config = optionConfigs[i];\n\t\t\t//W-013982: optionConfigurations lists each segmented line and this was causing duplicate options to show up\n\t\t\tif(segmentedMap[config.optionId] === true)\n\t\t\t\tcontinue;\n\t\t\tif(config.isSegmented)\n\t\t\t\tsegmentedMap[config.optionId] = true; //keeping track of segmented options\n\n\t\t\tselectedOptions[config.optionId] = this.buildStrippedOptionData(config, i);\n\t\t}\n\t}\n\n\tbuildStrippedOptionData(config, index) {\n\t\tif (config.optionConfigurations.length === 0) {\n\t\t\tlet productConfiguration = ProductReconfigurer.newConfiguration(config.optionId, config.optionData, config.isDynamicOption, index);\n\t\t\tproductConfiguration.configured = config.configured;\n\t\t\tif (this.product.quoteType === 'Amendment') {\n\t\t\t\tproductConfiguration.upgradedAssetId = config.upgradedAssetId;\n\t\t\t\tproductConfiguration.priorBundledQuantity = config.priorBundledQuantity;\n\t\t\t}\n\t\t\treturn productConfiguration;\n\t\t}\n\n\t\tlet optionConfigurations = config.optionConfigurations.length > 0;\n\t\treturn { optionId: config.optionId, optionData: config.optionData, optionConfigurations: optionConfigurations, index: index };\n\t}\n\n\tstatic newConfiguration(optionId, optionData, isDynamicOption, index) {\n\t\treturn { optionId: optionId, optionData: optionData, isDynamicOption: isDynamicOption, index: index };\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class RuleProcessor {\n\tconstructor(data, product) {\n\t\tthis.prefix = AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\tthis.data = data;\n\t\tthis.product = product;\n\t\tthis.validationMessages = [];\n\t\tthis.productRulesActions = {};\n\t\tthis.optionDataByOptionIdAndIndex = {};\n\t}\n\n\tgetValidationMessages() {\n\t\treturn this.validationMessages;\n\t}\n\n\tgetProductRulesActions() {\n\t\treturn this.productRulesActions;\n\t}\n\n\tgetOptionDataByOptionIdAndIndex() {\n\t\treturn this.optionDataByOptionIdAndIndex;\n\t}\n\n\tinit(nestedOptionModel) {\n\t\tthis.initValidationMessages();\n\n\t\tif (this.product) {\n\t\t\tthis.initProductRulesActions();\n\t\t\tthis.initDescendantTree(nestedOptionModel); // creates index properties on optionConfigurations needed by next function call\n\t\t\tthis.initOptionDataByOptionIdAndIndex();\n\t\t}\n\t}\n\n\tinitValidationMessages() {\n\t\tif (this.data.validationMessages) {\n\t\t\tfor (var message of this.data.validationMessages)\n\t\t\t\tthis.validationMessages.push(message);\n\t\t} else {\n\t\t\tfor (let product of this.data.configuredProducts) {\n\t\t\t\tfor (var message of product.configuration.validationMessages)\n\t\t\t\t\tthis.validationMessages.push(message);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitProductRulesActions(onLoad) {\n\t\tlet selectedOptionIds = {}, disabledOptionIds = {}, hiddenOptionIds = {}; // Actions returned from server\n\t\tlet selectOptions = {}, deselectOptions = {}, showOptions = {}, hideOptions = {}, enableOptions = {}, disableOptions = {}; // Actions required for client side\n\t\tfor (var serverOption of this.data.optionConfigurations)\n\t\t\t\tselectedOptionIds[serverOption.optionData.Id || serverOption.optionId] = true;\n\t\tif (this.data.disabledOptionIds != null) {\n\t\t\tfor (var disabledOption of this.data.disabledOptionIds)\n\t\t\t\tdisabledOptionIds[disabledOption] = true;\n\t\t}\n\t\tif (this.data.hiddenOptionIds != null) {\n\t\t\tfor (var hiddenOption of this.data.hiddenOptionIds)\n\t\t\t\thiddenOptionIds[hiddenOption] = true;\n\t\t}\n\n\t\tif (onLoad)\n\t\t\treturn this.assignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds);\n\n\t\tfor (var option of this.product.options) {\n\t\t\t// use 'hiddenByRule' instead of 'hidden' to ignore options hidden by applying a configuration filter\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\tthis.handleProductActions(hiddenOptionIds, option, showOptions, hideOptions, 'hiddenByRule');\n\t\t\tthis.handleProductActions(disabledOptionIds, option, enableOptions, disableOptions, 'disabled');\n\t\t\tthis.handleProductActions(selectedOptionIds, option, deselectOptions, selectOptions, 'selected');\n\t\t}\n\n\t\tthis.productRulesActions = {\n\t\t\tshowOptions: showOptions, hideOptions: hideOptions, selectOptions: selectOptions,\n\t\t\tdeselectOptions: deselectOptions, enableOptions: enableOptions, disableOptions: disableOptions\n\t\t};\n\t}\n\n\tinitOptionDataByOptionIdAndIndex() {\n\t\tlet optionConfigurations = this.data.optionConfigurations;\n\n\t\tfor(let i=0; i<optionConfigurations.length; i++) {\n\t\t\tlet config = optionConfigurations[i];\n\t\t\tif(this.optionDataByOptionIdAndIndex[config.optionId] === undefined){\n\t\t\t\tthis.optionDataByOptionIdAndIndex[config.optionId] = {};\n\t\t\t}\n\t\t\tthis.optionDataByOptionIdAndIndex[config.optionId][config.index] = {\n\t\t\t\toptionData: config.optionData,\n\t\t\t\tlistPrice: config.listPrice\n\t\t\t}\n\t\t}\n\t}\n\n\thandleProductActions(ids, option, positiveAction, negativeAction, action) {\n\t\tif (action === 'disabled') {\n\t\t\tif (ids[option.record.Id] && (option.disabledData && !option.disabledData.disabled))\n\t\t\t\treturn negativeAction[option.record.Id] = true;\n\t\t\tif (!ids[option.record.Id] && (option.disabledData && option.disabledData.disabled))\n\t\t\t\treturn positiveAction[option.record.Id] = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (ids[option.record.Id] && !option[action])\n\t\t\treturn negativeAction[option.record.Id] = true;\n\t\tif (!ids[option.record.Id] && option[action])\n\t\t\treturn positiveAction[option.record.Id] = true;\n\t}\n\n\tassignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds) {\n\t\tlet systemLabel = this.prefix + 'System__c';\n\t\tthis.product.rulesProcessed = true;\n\t\tfor (var option of this.product.options) {\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\t// always define selected property, allows disabling of record-selected product on load\n\t\t\toption.selected = option.selectedByRule = !!selectedOptionIds[option.record.Id];\n\t\t\tif (disabledOptionIds[option.record.Id])\n\t\t\t\t//Both properties disable manual selection.\n\t\t\t\t//'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t\t\toption.disabledData = {\n\t\t\t\t\t'disabled': true,\n\t\t\t\t\t'constrained': false\n\t\t\t\t};\n\t\t\tif (hiddenOptionIds[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t}\n\t}\n\tinitDescendantTree(nestedOptionModel = this.product.nestedOptionModel) {\n\t\tif(!nestedOptionModel) {\n\t\t\t// we should never get here, but instead of generating a javascript reference error lets just log a warning\n\t\t\tif(console.log) console.warn('Skipped descendant level rules', this.product);\n\t\t\treturn;\n\t\t}\n\n\t\t //Descendant Product Rules overwrite any nested option configurations if the rule because these rules are invoked after the manual configurations\n\t\tlet indices = {};\n\t\tfor (var i=0;i<this.data.optionConfigurations.length;i++) {\n\t\t\tlet optionConfig = this.data.optionConfigurations[i];\n\t\t\tindices[optionConfig.optionId] = indices[optionConfig.optionId] === undefined ? 0 : (indices[optionConfig.optionId] + 1);\n\n\t\t\tlet parentInfo = {'optionId': this.data.optionId, 'index' : this.data.index || 0},\n\t\t\t\tchildInfo = {'optionId': optionConfig.optionId, 'index': indices[optionConfig.optionId]};\n\t\t\toptionConfig.index = indices[optionConfig.optionId];\n\t\t\tnestedOptionModel.handleDescendantRules([parentInfo, childInfo], optionConfig.optionConfigurations, optionConfig.hiddenOptionIds, optionConfig.disabledOptionIds);\n\t\t}\n\t}\n\n\toptionNotInPricebook(option) {\n\t\treturn option.record[this.prefix + 'UnitPrice__c'] === undefined || option.record[this.prefix + 'UnitPrice__c'] == null;\n\t}\n}","export class ProductAlert {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-alert';\n\t\tthis.properties = {\n\t\t\talerts: Array,\n\t\t\tcontinueCB: Object,\n\t\t\tcancelCB: Object,\n\t\t\tdisplayContinueButton: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this._onCancel.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn ['init(alerts)'];\n\t}\n\n\tinit() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonRevise() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\ttoggle() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonContinue() {\n\t\tif(typeof this.continueCB === 'function')\n\t\t\tthis.continueCB();\n\t}\n\n\t_onCancel() {\n\t\tif (typeof this.cancelCB === 'function') {\n\t\t\tthis.cancelCB();\n\t\t}\n\t\tthis.$.dialog.toggle();\n\t}\n}\n\nPolymer(ProductAlert);","export class ConfigTree {\n\tconstructor(root /* unstructured tree Object */) {\n\t\tthis.root = root;\n\t\tthis.idProperties = ['optionId', 'index'];\n\t\tthis.buildSubtree(this.root);\n\t}\n\n\tbuildSubtree(obj) { //adds index property to configuration as it is built\n\t\tlet indices = {};\n\t\tthis._buildNode(obj);\n\t\tobj.getChildren(obj).forEach( child => {\n\t\t\tindices[child.optionId] = indices[child.optionId] || child.index || 0;\n\t\t\tif (child.index === undefined || indices[child.optionId] === child.index) {\n\t\t\t\tchild.index = indices[child.optionId];\n\t\t\t\tindices[child.optionId]++;\n\t\t\t}\n\t\t\tthis.buildSubtree(child);\n\t\t});\n\t}\n\n\tgetFromPath(path) {\n\t\tlet currentLevel = this.root;\n\t\tfor (let i = 0, l = path.length; i<l; i++) {\n\t\t\tcurrentLevel = this._findOnLevel(path[i], currentLevel);\n\t\t}\n\t\treturn currentLevel;\n\t}\n\n\t_buildNode(obj) {\n\t\tobj.nodeId = this._buildId(obj);\n\t\tobj.getChildren = function () {\n\t\t\treturn this.optionConfigurations;\n\t\t}.bind(obj);\n\t}\n\n\t_buildId(properties) {\n\t\tlet id = '';\n\t\tfor (let key of this.idProperties) {\n\t\t\tid += '_' + properties[key];\n\t\t}\n\t\treturn id;\n\t}\n\n\t_findOnLevel(idProperties, obj) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\tobj = obj || this.root;\n\t\treturn obj.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n}\n","import {Page} from '../../../common/core/Page.js';\n\nexport class CloneToGroupDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-clone-to-group-dialog';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tquoteModel: Object\n\t\t}, Page.properties );\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.addEventListener('sb-cancel-clone-to-group', this.onCancel);\n\t\t});\n\t}\n\n\topen() {\n\t\tthis.lineGroups = this.quoteModel.lineGroups;\n\t\tthis.$.dialog.toggle();\n\t\t// For each line group build an object that contains groupKey (marked as value), name (marked as label),\n\t\t// defaults to unselected\n\t\tlet arr = [];\n\t\tfor (let i = 0, l = this.lineGroups.length; i < l; i++) {\n\t\t\tarr.push({\n\t\t\t\tvalue: this.lineGroups[i].groupKey,\n\t\t\t\tlabel: this.lineGroups[i].groupVO.record.Name,\n\t\t\t\tselected: false\n\t\t\t});\n\t\t}\n\t\tthis.groups = arr;\n\t\tif (!this.isMobile) {\n\t\t\tthis.availableGroupTitle = this.i18n.l('Available Groups');\n\t\t\tthis.chosenGroupTitle = this.i18n.l('Selected Groups');\n\t\t}\n\t}\n\n\tonSave() {\n\t\tif (!this.isMobile) {\n\t\t\t// In Desktop Selected groups two way data bound to value in the dual-list-box component,\n\t\t\t// when save button is tapped dual-list-box sends the selected options (in our case groups) back\n\t\t\tthis.fire('sb-clone-to-group-selected', this.selectedGroups);\n\t\t} else {\n\t\t\tthis.selectedGroups = this._getSelectedGroups();\n\t\t\tthis.fire('sb-clone-to-group-selected', this.selectedGroups);\n\t\t\tthis.groups = undefined;\n\t\t}\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t\tif (this.isMobile) {\n\t\t\tthis.groups = undefined;\n\t\t}\n\t}\n\n\t_getSelectedGroups() {\n\t\tlet selectedGroups = [];\n\t\tfor (let i = 0, l = this.groups.length; i < l; i++) {\n\t\t\tif (this.groups[i].selected) {\n\t\t\t\tselectedGroups.push(this.groups[i]);\n\t\t\t}\n\t\t}\n\t\treturn selectedGroups;\n\t}\n\n\ttoggleSelectedClass(e) {\n\t\tlet currentTarget = e.currentTarget;\n\t\tlet isContainerHighlighted = currentTarget.classList.contains('backgroundContainer');\n\t\tlet dataIndex = currentTarget.dataIndex;\n\t\tthis.set(`groups.${dataIndex}.selected`, !isContainerHighlighted);\n\t\tthis.toggleClass('backgroundContainer', !isContainerHighlighted, currentTarget);\n\t}\n}\n\nPolymer( CloneToGroupDialog );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst GHOST_X_OFFSET = 410;\nconst GHOST_Y_OFFSET = 180;\nconst visibilityHidden = ' visibilityHidden';\nexport class CustomSegmentDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-segment-dialog';\n\t\tthis.properties = {\n\t\t\t// dataLineModels is incoming data, and set by the caller\n\t\t\tdataLineModels: Array,\n\t\t\t// Local variable so that the component can modify the data\n\t\t\tlineModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// GroupModel is being set by the lineModels\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// deletedLineKeys is used for the backend so that it is tracking when it's tracking lines which should be deleted\n\t\t\tdeletedLineKeys: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\t// errors to display when errors from server or errors from validation logic\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Header Actions - this is just for UI alignment purpose at this moment.\n\t\t\theaderActions: Array,\n\t\t\t// header selection checkbox\n\t\t\theaderSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-cancel-custom-segment': '_onCancel',\n\t\t\t'add-tapped': '_onAddByLine',\n\t\t\t'delete-tapped': '_onDeleteByLine'\n\t\t};\n\t}\n\n\t// Getters\n\tget observers() {\n\t\treturn ['_dataChanged(dataLineModels)',\n\t\t\t\t'_lineModelChanged(lineModels)',\n\t\t\t\t'_handleCustomSegmentsResponseChanged(updateCustomSegmentsResponse)',\n\t\t\t\t'_handleErrorResponseChanged(errorResponse)',\n\t\t\t\t'_toggleAllCheckBoxes(headerSelected)'\n\t\t];\n\t}\n\n\t/**\n\t * Get constants which are being used in the logic\n\t *\n\t * @returns {*}\n\t */\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Get quote line metadata from the editorModel.md\n\t *\n\t * @returns {*}\n\t */\n\tget quoteLineMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t}\n\n\t/**\n\t * Get the custom labels from the editorModel\n\t *\n\t * @returns {*}\n\t */\n\tget customLabels() {\n\t\treturn this.editorModel.data.customLabels;\n\t}\n\n\t/**\n\t * Helper method to find the appropriate table row to drop to.\n\t *\n\t * @param\n\t * @returns {*}\n\t * @private\n\t */\n\t_findTableRowValidTarget(el) {\n\t\tif (!el) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._ifParentIsValidTarget(el)) {\n\t\t\treturn el;\n\t\t}\n\t\tif (el.parentNode) {\n\t\t\treturn this._findTableRowValidTarget(el.parentNode);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to determine whether the element being passed is a valid target.\n\t * Criteria is whether the element's parent has a css class we're looking for.\n\t * @param {Element} element.\n\t * @private\n\t */\n\n\t_ifParentIsValidTarget(element) {\n\t\tif (!element.parentElement) return false;\n\t\tif (element.parentElement.id == 'swipe-header') {\n\t\t\tthis.targetRowElement = element.parentElement.parentElement;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * To deteremine whether it's viewport changed\n\t *\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tlet rows = this.dragDrop ? this.dragDrop.segmentRows : null;\n\t\tif (rows) {\n\t\t\tif (this._isMobileViewport() || !AppContext.isDesktop) { \n\t\t\t\tfor ( let i = 0, l = rows.length; i < l; i++) { \n\t\t\t\t\trows[i].removeEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let j = 0, l = rows.length; j < l; j++) {\n\t\t\t\t\trows[j].addEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To copy the incoming data into local data so that it can manipulate.\n\t *\n\t *\n\t * @private\n\t */\n\t_dataChanged() {\n\t\tif ( !this.dataLineModels ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.groupModel = this.dataLineModels[0].groupModel;\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\n\t\t// To create a new copies so that it can be used in every pop-up session without affecting the actual lineModels at the quote.\n\t\tlet lineModels = [];\n\t\tlet i, l = this.dataLineModels.length;\n\t\tlet lineModelByStartDate = {};\n\n\t\tfor (i=0; i < l; i++ ) {\n\t\t\tlet currentLineModel = this.dataLineModels[i];\n\t\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\t\t\tnewLineModel.selected = false;\n\t\t\tlineModelByStartDate[newLineModel.lineVO.record[this.constants.START_DATE_FIELD]] = newLineModel;\n\t\t}\n\n\t\t// Need to sort lineModels by Start Date because the incoming lineModels was not in the correct order. They were re-sorted after saving to the quote\n\t\tlet startDates = Object.keys(lineModelByStartDate).sort();\n\t\tfor(i=0; i <l; i++) {\n\t\t\tlineModels.push(lineModelByStartDate[startDates[i]]);\n\t\t}\n\n\t\tthis.lineModels = lineModels;\n\t}\n\n\t/**\n\t *  To determine if it's line model changed and reset the data\n\t *\n\t * @private\n\t */\n\t_lineModelChanged() {\n\t\tif ( this.lineModels && this.lineModels.length > 0 ) {\n\t\t\tthis.deletedLineKeys = [];\n\t\t\tthis.errors = [];\n\t\t\tthis._buildDialog();\n\t\t}\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment response, it needs to run _updateQuote so that it will update the UI\n\t *\n\t * @private\n\t */\n\t_handleCustomSegmentsResponseChanged(e) {\n\t\tif (e.partialVO) {\n\t\t\t// If the response quote is a partial VO, we need to reconcile its partial data against the full quote's data.\n\t\t\te = this._combinePartialQuoteWithFullQuote(e);\n\t\t}\n\t\tthis.fire('segmented-changed', {quoteVO: e});\n\t\t// Need to reset all data so that it won't carry from the previous session.\n\t\tthis.resetData();\n\t}\n\n\t_combinePartialQuoteWithFullQuote(partialQuote) {\n\t\tlet fullQuote = this.groupModel.quoteModel.quoteVO;\n\n\t\t// First, we should sort the received line items by their segment key, as well as map them by their key.\n\t\tlet lineSetsBySegmentKey = new Map();\n\t\tlet linesByKey = new Map();\n\t\tpartialQuote.lineItems.forEach((line) => {\n\t\t\t// Map the line by its key, and if its Segment Key is one we sent to be updated, add it to the list of lines\n\t\t\t// sharing that segment key.\n\t\t\tlinesByKey.set(line.key, line);\n\t\t\tlet segKey = line.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\tif (segKey && this._sentMDQKeys.has(segKey)) {\n\t\t\t\tlet linesSharingKey = lineSetsBySegmentKey.get(segKey) || [];\n\t\t\t\tlineSetsBySegmentKey.set(segKey, [...linesSharingKey, line]);\n\t\t\t}\n\t\t});\n\n\t\t// Now, we loop over the line items on the original quote to populate our final list\n\t\tlet combinedList = [];\n\t\tfullQuote.lineItems.forEach((line) => {\n\t\t\tlet segKey = line.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\tlet dimType = line.dimensionType;\n\t\t\tif (segKey && this._sentMDQKeys.has(segKey) && dimType && dimType.toLowerCase() === 'custom') {\n\t\t\t\t// If the line's one of the segments we sent to the server to be updated, how we handle it depends\n\t\t\t\t// on what index it is.\n\t\t\t\t// If it's the first index, we add all of the updated lines for that segment group together, in order to\n\t\t\t\t// make sure they stay together.\n\t\t\t\t// Otherwise, we ignore it, since we'll be adding its updated version (if one exists) together with the first\n\t\t\t\t// segment anyway, and we don't want to add it twice.\n\t\t\t\tlet segIndex = line.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\t\t\tif (segIndex == 1) {\n\t\t\t\t\tcombinedList = [...combinedList, ...lineSetsBySegmentKey.get(segKey)];\n\t\t\t\t}\n\t\t\t} else if (linesByKey.has(line.key)) {\n\t\t\t\t// If the line isn't part of a segment we were updating, but it was still a line that we sent,\n\t\t\t\t// we use the updated version.\n\t\t\t\tcombinedList.push(linesByKey.get(line.key));\n\t\t\t} else {\n\t\t\t\t// If we didn't send the line at all, we keep the original.\n\t\t\t\tcombinedList.push(line);\n\t\t\t}\n\t\t});\n\n\t\t// Now we assign the full list to the partial quote and mark it as a full quote.\n\t\tpartialQuote.lineItems = combinedList;\n\t\tpartialQuote.partialVO = false;\n\t\treturn partialQuote;\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment error response, it will populate the backend errors to the frontend\n\t *\n\t * @private\n\t */\n\t_handleErrorResponseChanged() {\n\t\tlet errors = this.errors || [];\n\t\tthis.set(`errors`, errors.push(this.errorResponse));\n\t}\n\n\n\t/**\n\t * To add a group of element at the end of specific index\n\t *\n\t *\n\t * @param e     format: information is stored in the e.detail (index: index Which is generated by the component\n\t * @private\n\t */\n\t_onAddByLine(e) {\n\t\tthis._onAddByIndex(e.detail.index);\n\t}\n\n\t/**\n\t * To add a new custom segments and it supports to add at the end of the segment list or at a specific location below the line\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onAdd(e) {\n\t\tthis.$.dialog.toggleMenu();\n\t\t// Add from action; otherwise, add from the line level\n\t\tlet index = this.lineModels.length - 1;\n\t\tthis._onAddByIndex(index)\n\t}\n\n\t/**\n\t * To add line by index. This will be used for the line and action which is at the end of the dialog\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onAddByIndex(index) {\n\t\t// Copy the existing lines from the clicked index\n\t\tlet currentLineModel = this.lineModels[index];\n\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\tnewLineVO.record = {};\n\t\tnewLineVO.record[this.constants.SEGMENT_LABEL_FIELD] = '';\n\t\tnewLineVO.record[this.constants.START_DATE_FIELD] = null;\n\t\tnewLineVO.record[this.constants.END_DATE_FIELD] = null;\n\n\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\n\t\t// reset the line record info\n\t\tnewLineModel.lineVO.record.Id = null;\n\t\tnewLineModel.lineVO.key = null;\n\t\tnewLineModel.selected = false;\n\n\t\tthis.splice('lineModels', index+1, 0, newLineModel);\n\t\tthis.headerSelected = false;\n\t\tthis.$.segmentGroup.addEventListener(\"dom-change\", function(e) {\n\t\t\tlet newRows = this.$.segmentRows.querySelectorAll('#segmentRow');\n\t\t\tif(newRows[newRows.length - 1].model.lineVO.key === null) {\n\t\t\t\tnewRows[newRows.length - 1].$.row.click();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\n\t/**\n\t * To delete a group of element at the end of specific index\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onDeleteByLine(e) {\n\t\tthis._onDeleteLineData(e.detail.index);\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete all custom segments\n\t *\n\t * @private\n\t */\n\t_onDelete(){\n\t\tlet i, l=this.lineModels.length;\n\t\tfor (i=l-1; i > 0; i--) {\n\t\t\tlet lineModel = this.lineModels[i];\n\t\t\tif ( lineModel.selected ) {\n\t\t\t\tthis._onDeleteLineData(i);\n\t\t\t}\n\t\t}\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete the lineModel on the frontend\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onDeleteLineData(index) {\n\t\tlet lineModel = this.lineModels[index];\n\t\tif (lineModel.lineVO.key != null) {\n\t\t\tthis.deletedLineKeys.push(lineModel.lineVO.key);\n\t\t}\n\t\tthis.splice('lineModels', index, 1);\n\t}\n\n\t/**\n\t * Upon onSave:\n\t *      - Reset all the internal properties for validation checks\n\t *      - Run the validation check\n\t *          - if everything pass, it will send it to backend and fire an iron-signal to update the quote\n\t *          - if one of them fails, the error message will be displayed on on the frontend\n\t *\n\t * @private\n\t */\n\t_onSave() {\n\t\t// Reset all properties before running any validation\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis._validateCustomSegmentLabels();\n\t\tthis._validateCustomSegmentDates();\n\t\tlet errors = [];\n\t\tif (this.hasInvalidSegmentDates) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasInvalidSegmentLabels ) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_labels);\n\t\t}\n\n\t\tif ( this.hasNonConsecutiveDates ) {\n\t\t\terrors.push(this.customLabels.msg_nonsequential_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasOverlappingSegments ) {\n\t\t\terrors.push(this.customLabels.msg_overlapping_custom_segment_dates);\n\t\t}\n\n\t\t// Reset all the errors from the previous click on Save\n\t\tthis.set('errors', []);\n\t\tthis.set('errors', errors);\n\n\n\t\t// Gather a list of information which are needed for update custom segments in the backend\n\t\tif (  errors.length == 0 ) {\n\t\t\tlet updateSegmentMap = this._getCustomSegmentUpdates();\n\t\t\tupdateSegmentMap.updateCustomSegments = true;\n\t\t\tlet minimizedQuote = this._createQuoteWithoutUnaffectedLines(this.groupModel.groupKey);\n\t\t\tlet model = {\n\t\t\t\tquote: minimizedQuote,\n\t\t\t\tupdateCustomSegments: updateSegmentMap.updateCustomSegments,\n\t\t\t\tupdatedLineKeys: updateSegmentMap.updatedLineKeys,\n\t\t\t\tdeletedLineKeys: this.deletedLineKeys,\n\t\t\t\tstartDates: updateSegmentMap.startDates,\n\t\t\t\tendDates: updateSegmentMap.endDates,\n\t\t\t\tsegmentLabels: updateSegmentMap.segmentLabels\n\t\t\t};\n\t\t\tthis.$.UpdateCustomSegmentsService.model = model;\n\t\t}\n\t}\n\n\t_createQuoteWithoutUnaffectedLines(groupKey) {\n\t\tlet quote = this.groupModel.quoteModel.quoteVO;\n\t\tif (!this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// If the JSQC isn't enabled, we have to send all of the lines, because the server's going to try to recalculate.\n\t\t\treturn quote;\n\t\t}\n\t\t// If the JSQC's enabled, we don't need to send all of the lines. In fact, the only lines we need to send are the\n\t\t// Custom-segmented lines with the targeted group key, and any lines that reference the one of those lines\n\t\t// as a source line.\n\t\t// Before we do anything else, we need to send the quote through a JSON roundtrip in order to make it a separate object.\n\t\tquote = JSON.parse(JSON.stringify(quote));\n\t\tlet necessaryLineKeys = new Set();\n\t\tlet necessaryLineIds = new Set();\n\t\tlet sentMDQKeys = new Set();\n\t\t// If the line is in the right group and it has a custom dimension, record its key and ID. Also record its segment\n\t\t// key so that we can have a list of all of the MDQ keys we sent to the server.\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (line.parentGroupKey == groupKey && line.dimensionType == this.constants.TYPE_CUSTOM_DIMENSION) {\n\t\t\t\tnecessaryLineKeys.add(line.key);\n\t\t\t\tsentMDQKeys.add(line.record[this.constants.SEGMENT_KEY_FIELD]);\n\t\t\t\tif (line.record.Id) {\n\t\t\t\t\tnecessaryLineIds.add(line.record.Id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Store the segment keys on 'this' so we can access them later.\n\t\tthis._sentMDQKeys = sentMDQKeys;\n\t\t// Now we need to record the keys of any lines whose Source ID is one of the necessary lines.\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tlet sourceId = line.record[this.constants.SOURCE_FIELD];\n\t\t\tif (sourceId && necessaryLineIds.has(sourceId)) {\n\t\t\t\tnecessaryLineKeys.add(line.key);\n\t\t\t}\n\t\t});\n\t\t// Now we loop over the lines one last time and keep only the necessary ones.\n\t\tlet necessaryLines = [];\n\t\tquote.lineItems.forEach((line) => {\n\t\t\tif (necessaryLineKeys.has(line.key)) {\n\t\t\t\tnecessaryLines.push(line);\n\t\t\t}\n\t\t});\n\t\tquote.lineItems = necessaryLines;\n\t\tquote.partialVO = true;\n\t\treturn quote;\n\t}\n\n\t/**\n\t * Reset the data\n\t * To close the dialog and reset the data back to the original\n\t *\n\t * @private\n\t */\n\t_onCancel() {\n\t\t// Before closing the dialog, clearing those data\n\t\tthis.errors = undefined;\n\t\tthis.groupModel = undefined;\n\t\tthis.deletedLineKeys = [];\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t/**\n\t * To toggle the checkbox from select all\n\t *  - First lineModel cannot be updated with selected checkbox\n\t *\n\t * @private\n\t */\n\t_toggleAllCheckBoxes() {\n\t\t// listen for when the selection list selects all of the items\n\t\tif ( this.lineModels) {\n\t\t\tlet i, l = this.lineModels.length;\n\t\t\t// Update the data model\n\t\t\tfor (i = l-1; i > 0; i--) {\n\t\t\t\tthis.set(`lineModels.${i}.selected`, this.headerSelected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset all data\n\t *\n\t */\n\tresetData() {\n\t\tthis.errors = undefined;\n\t\tthis.deletedLineKeys = [];\n\t\tthis._sentMDQKeys = undefined;\n\t}\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To build the dialog\n\t *\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tthis._buildFieldsMD();\n\t\tthis._toggleAllCheckBoxes();\n\t\tthis._buildRowData();\n\t\tthis._buildHeaderActions();\n \t}\n\n\n\t/***\n\t * Build fields metadata based on the fields that we need for the custom segment table\n\t *\n\t * @private\n\t */\n\t_buildFieldsMD() {\n\t\tlet quoteLineMD = this.quoteLineMD;\n\t\tlet fields = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet fieldsMD = [];\n\t\tfor (let i=0; i < fields.length; i++) {\n\t\t\tfieldsMD.push(quoteLineMD[fields[i]]);\n\t\t}\n\t\tthis.fields = fields;\n\t\tthis.fieldsMD = fieldsMD;\n\t}\n\n\n\t/**\n\t * To build the row data so that it can be used in the sb-table-row\n\t *\n\t * @private\n\t */\n\t_buildRowData() {\n\t\tlet recordKeys = [];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet fieldsLength = this.fields.length;\n\t\tfor (let i=0; i < fieldsLength; i++) {\n\t\t\tlet field = this.fields[i];\n\t\t\tlet fieldMD = this.fieldsMD[i];\n\t\t\tlet key = fieldMD.name;\n\t\t\trecordKeys.push(key);\n\t\t\tlet label = fieldMD.label;\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[key] = fieldMD.type;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\n\t/**\n\t * To build a header actions to occupy the space in the table to make columns align correctly.\n\t *\n\t * @private\n\t */\n\t_buildHeaderActions() {\n\t\tlet rightAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: true\n\t\t};\n\t\tthis.headerActions = [rightAction, rightAction];\n\t}\n\n\n\t/**\n\t * Build the action so that it can be attached to each row when it's using the sb-table-row\n\t * - Special condition:\n\t *      - For index = 0, it doesn't have the delete method\n\t *\n\t * @param index\n\t * @returns {Array}\n\t * @private\n\t */\n\t_buildRowActions(index) {\n\t\tlet actions = [];\n\t\tlet addAction = {\n\t\t\ticon: 'sb-icon-plus',\n\t\t\ttitle: this.customLabels.lbl_add_segment,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: this.groupModel.quoteModel.isAmendmentOrChangeQuote,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\n\t\tlet deleteAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\ttitle: this.customLabels.lbl_delete_custom_segments,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: (index == 0 || this.groupModel.quoteModel.isAmendmentOrChangeQuote),\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\t\tactions.push(addAction);\n\t\tactions.push(deleteAction);\n\n\t\treturn actions;\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t/**\n\t * Update the data path with value based on the parameter data map\n\t *\n\t * @param dataMap: {key - property, value - value to update }\n\t * @private\n\t */\n\t_updateData(/*Map*/ dataMap) {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor ( let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet keys = Object.keys(dataMap);\n\t\t\tfor ( let j=0; j < keys.length; j++ ) {\n\t\t\t\tlet key = keys[j];\n\t\t\t\tlet value = dataMap[key];\n\t\t\t\tlet path = `lineModels.${i}.${key}`;\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the segment table to reflect the rendering\n\t *\n\t * @private\n\t */\n\t_updateSegmentTable(){\n\t\tlet dataMap = {'selected': false};\n\t\tthis._updateData(dataMap);\n\t}\n\n\t/**\n\t * Generate a list information which is required for custom segment updates.\n\t *\n\t * @returns {{updatedLineKeys: Array, startDates: Array, endDates: Array, segmentLabels: Array}}\n\t * @private\n\t */\n\t_getCustomSegmentUpdates() {\n\t\tlet updates = {updatedLineKeys: [], startDates: [], endDates: [], segmentLabels: []};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++ ) {\n\t\t\tlet lineVO = this.lineModels[i].lineVO;\n\t\t\tlet record = this.lineModels[i].lineVO.record;\n\t\t\tupdates.updatedLineKeys.push(lineVO.key);\n\t\t\tupdates.segmentLabels.push(record[this.constants.SEGMENT_LABEL_FIELD]);\n\t\t\tupdates.startDates.push(record[this.constants.START_DATE_FIELD]);\n\t\t\tupdates.endDates.push(record[this.constants.END_DATE_FIELD]);\n\t\t}\n\t\treturn updates;\n\t}\n\n\t/**\n\t * To valid the custom segment labels for all segments. All custom segment labels should be unique.\n\t * To set hasInvalidSegmentLabels property so that it can be used for saving\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentLabels() {\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tlet customSegmentLabels = {};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet segmentLabel = this.lineModels[i].lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\tif (segmentLabel == null || segmentLabel.trim() === '') {\n\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (!customSegmentLabels[segmentLabel]) {\n\t\t\t\t\tcustomSegmentLabels[segmentLabel] = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * To validate custom segment dates\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentDates() {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++) {\n\t\t\tlet segment = this.lineModels[i].lineVO;\n\t\t\tlet segmentStartDate = segment.record[this.constants.START_DATE_FIELD];\n\t\t\tlet segmentEndDate = segment.record[this.constants.END_DATE_FIELD];\n\n\t\t\tlet segStartDate = new Date(segmentStartDate);\n\t\t\tlet segEndDate = new Date(segmentEndDate);\n\t\t\tif (segmentStartDate == null || segmentEndDate == null) {\n\t\t\t\tthis.hasInvalidDateFormat = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (segStartDate > segEndDate) {\n\t\t\t\t\tthis.hasInvalidSegmentDates = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (i - 1 >= 0) {\n\t\t\t\t\tlet prevSegment = this.lineModels[i - 1].lineVO;\n\t\t\t\t\tlet endDate = new Date(prevSegment.record[this.constants.END_DATE_FIELD]);\n\t\t\t\t\tlet dayAfterEndDate = Date.parse(new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate() + 1));\n\t\t\t\t\tlet startDate = Date.parse(new Date(segStartDate.getFullYear(), segStartDate.getMonth(), segStartDate.getDate()));\n\n\t\t\t\t\tif (this.editorModel.data.settings.allowsNonConsecutiveCustomSegments) {\n\t\t\t\t\t\t// allow non consecutive custom segments\n\t\t\t\t\t\t// start date of one segment must be greater than the end date of the previous segment\n\t\t\t\t\t\tif (segStartDate <= endDate) {\n\t\t\t\t\t\t\tthis.hasOverlappingSegments = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // validate logical order\n\t\t\t\t\t\t// validate consecutive start and end dates between segments\n\t\t\t\t\t\t// start date of a custom segment must be a day after the end of a previous custom segment\n\t\t\t\t\t\tif (dayAfterEndDate != startDate) {\n\t\t\t\t\t\t\tthis.hasNonConsecutiveDates = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset the properties which are relevant for saving the custom segments\n\t *\n\t * @private\n\t */\n\t_resetProperties() {\n\t\tthis.set(`errors`, []);\n\t\tthis.headerSelected = false;\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tthis.hasInvalidSegmentDates = false;\n\t\tthis.hasNonConsecutiveDates = false;\n\t\tthis.hasOverlappingSegments = false;\n\t\tthis.hasInvalidDateFormat = false;\n\t}\n}\n\nPolymer( CustomSegmentDialog );","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {DiscountTierModel} from 'quotes/models/DiscountTierModel.js';\nimport {DiscountTiersValidator} from 'quotes/models/DiscountTiersValidator.js';\nimport {Cache} from 'common/data/cache/Cache.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class DiscountScheduleDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount-schedule-dialog';\n\t\tthis.properties = {\n\t\t\tdiscountSchedule: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdiscountUnit: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tlineModel: Object,\n\t\t\tschedule: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdialogTapped: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_retrieveSchedule(discountScheduleId)',\n\t\t\t'_buildDialog(schedule)',\n\t\t\t'_discountScheduleResponseChanged(discountScheduleResponse)',\n\t\t\t'_discountScheduleChanged(discountSchedule.*)',\n\t\t\t'_createErrorHandler(error)',\n\t\t\t'_toggleEditableClasses(dialogTapped)',\n\t\t\t'_selectCheckboxes(model.selected)']\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget listeners() {\n\t\treturn { 'delete-tapped' : 'onDeleteLines',\n\t\t\t'add-tapped' : 'onAddLine' }\n\t}\n\n\tready() {\n\t\t// The dialog fires 'sb-cancel-ds' whenever the dialog is closed\n\t\tthis.addEventListener('sb-cancel-ds', this.onCancel);\n\t\t// Handle mobile discount unit changed\n\t\tthis.addEventListener('data-changed', function(e) {\n\t\t\tif (e.detail && e.detail.path == `data.${this.discountUnitField}`) {\n\t\t\t\t// Only rebuild and recalculate if the discountUnit has actually changed\n\t\t\t\tif (this.discountUnit != e.detail.value) {\n\t\t\t\t\tthis.discountUnit = e.detail.value;\n\t\t\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\t\t\tthis.buildRowData();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._handleDialogTap();\n\t\tthis._handleDialogMouseEvents();\n\t}\n\n\t/**\n\t * Service errors get routed through here and displayed in the error message toast\n\t * @private\n\t */\n\t_createErrorHandler() {\n\t\tif (this.error) {\n\t\t\tthis.errors = [this.error.message];\n\t\t}\n\t}\n\n\t/**\n\t * Creates context for discount schedule query and retrieves the quoteline's discount schedule\n\t * @param Id\n\t * @private\n\t */\n\t_retrieveSchedule(Id) {\n\t\tif (!Id) {\n\t\t\treturn;\n\t\t}\n\t\tthis.showSpinner = true;\n\t\tthis.context = {\n\t\t\tcurrencyCode: this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,\n\t\t\tfieldSetName : 'DiscountScheduleModal'\n\t\t};\n\t\tthis.$.loadDiscountScheduleService.uid = undefined;\n\t\tthis.$.loadDiscountScheduleService.context = this.context;\n\t\tthis.$.loadDiscountScheduleService.uid = Id;\n\t\t// Deactivate service spinner because modal has its own spinner\n\t\tthis.$.loadDiscountScheduleService.spinner = false;\n\t}\n\n\t/**\n\t * Instantiates discountTiers and kicks off building all of the data required to render the discountTiers\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tif (!this.schedule) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setConstants(this.constants);\n\t\tthis.discountTiers = undefined;\n\t\tthis.currencyCode = this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\tthis.editable = !this.schedule[this.overrideBehaviorField] ? false : true;\n\t\tthis.savedTiers = [];\n\t\tthis.discountSchedule = JSON.parse(JSON.stringify(this.schedule));\n\t\tthis.data = this.discountSchedule;\n\t\tthis.discountSchedule[this.discountUnitField] = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis._setDSFields();\n\t\tthis.showRevertBtn = this.discountSchedule[this.originalScheduleField] ? true : false;\n\t\tthis.discountUnit = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis.buildRowData();\n\t\tlet tierModels = this.buildTiers();\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis.buildFieldData();\n\t\tthis.discountTiers = tierModels;\n\t\tthis._createActions();\n\t\tthis._toggleEditableClasses();\n\t\tif (this.isMobile) {\n\t\t\tthis._buildTabData();\n\t\t}\n\t\tthis.showSpinner = false;\n\t}\n\n\t/**\n\t * The response of cloning or updating a discount schedule goes here\n\t * Updates the lineModel's discount schedule Id\n\t * Runs a calculate to update formula field values if the user happens to add a formula field to the discount tier fieldset\n\t * @private\n\t */\n\t_discountScheduleResponseChanged() {\n\t\tlet newScheduleId = this.discountScheduleResponse.Id;\n\t\tthis.lineModel.lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\tif (this.lineModel.lineVO.record[this.segmentKeyField]) {\n\t\t\tlet segments = this.lineModel.segments;\n\t\t\tfor (let i = 0, l = segments.length; i < l; i++) {\n\t\t\t\tsegments[i].lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\t\t}\n\t\t}\n\t\tif (this.action === 'save') {\n\t\t\tthis.onCancel();\n\t\t} else {\n\t\t\t// Rebuild rows to update with formula field values and remove dirty\n\t\t\tthis.schedule = this.discountScheduleResponse;\n\t\t\tthis.showRevertBtn = this.discountScheduleResponse[this.originalScheduleField];\n\t\t}\n\t\tthis.domHost.onFlagCalculate();\n\t}\n\n\t/**\n\t * If discount unit field has changed, it will recreate row data and display the correct discount column\n\t * @param changedRecord\n\t * @private\n\t */\n\t_discountScheduleChanged(changedRecord) {\n\t\tif (changedRecord.path == `discountSchedule.${this.discountUnitField}`) {\n\t\t\tthis.discountUnit = changedRecord.value;\n\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\tthis.buildRowData();\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves visible discount tier records, then turns them into DiscountTierModels\n\t * @returns {Array}\n\t */\n\tbuildTiers() {\n\t\tlet tiers = [];\n\t\tlet discountTierRecords = this._retrieveRecords();\n\t\tthis.previousLowerBound = undefined;\n\t\tdiscountTierRecords.forEach(function(tier) {\n\t\t\t// Tier lowerbound will be undefined if there are no tiers defined in the database\n\t\t\t// Creates a row so the user never sees a blank discount tier section\n\t\t\tif (tier[this.lowerBoundField] == null) {\n\t\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.discountUnit == \"Percent\" && this.previousLowerBound != tier[this.lowerBoundField]) {\n\t\t\t\tthis.previousLowerBound = tier[this.lowerBoundField];\n\t\t\t} else if (this.discountUnit == \"Percent\" || tier.CurrencyIsoCode != this.currencyCode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t}.bind(this));\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Creates field data for discount schedule name input and discount unit picklist\n\t */\n\tbuildFieldData() {\n\t\tif (this.fieldNames) {\n\t\t\treturn;\n\t\t}\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.discountScheduleField];\n\t\tfieldsMD[this.discountUnitField].required = true;\n\t\tthis.fieldTableData = fieldsMD;\n\t\tthis.fieldNames = ['Name', this.discountUnitField];\n\t}\n\n\t/**\n\t * Creates maps that populate and style table rows\n\t */\n\tbuildRowData() {\n\t\tif (this.fieldsArray) {\n\t\t\tthis.fire('iron-signal', {name :'delete-groups'});\n\t\t}\n\t\tlet fields = this.editorModel.data.discountScheduleModalFieldNames;\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.tierField];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet priceLabel = this.editorModel.data.customLabels.lbl_price;\n\t\tlet prefixedFieldsByFields = {};\n\t\tfields.forEach(function(field) {\n\t\t\tprefixedFieldsByFields[field] = 'template.' + field;\n\t\t}.bind(this));\n\t\tif (this.discountUnit === 'Price') {\n\t\t\tprefixedFieldsByFields[priceLabel] = 'template.' + priceLabel;\n\t\t\tfieldsMD[priceLabel] = JSON.parse(JSON.stringify(fieldsMD[this.discountAmountField]));\n\t\t\tfieldsMD[priceLabel].label =  priceLabel + '(' + (this.currencyCode || this.editorModel.data.currencySymbol) + ')';\n\t\t\tfieldsMD[priceLabel].name = priceLabel;\n\t\t}\n\t\tthis.fieldsArray = Object.keys(prefixedFieldsByFields);\n\t\tlet prefixedFieldsArray = [];\n\t\tthis.fieldsArray.forEach(function(field) {\n\t\t\tif (!this._isFieldShown(field)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fieldMD = fieldsMD[field];\n\t\t\tvar key = fieldMD.name;\n\t\t\tvar label;\n\t\t\tif (field === this.numberField) {\n\t\t\t\tlabel = '#';\n\t\t\t} else if (field === this.discountAmountField) {\n\t\t\t\tlabel = fieldMD.label.replace('{0}', (this.currencyCode || this.editorModel.data.currencySymbol));\n\t\t\t\tfieldMD.label = label;\n\t\t\t} else {\n\t\t\t\tlabel = fieldMD.label;\n\t\t\t}\n\t\t\tprefixedFieldsArray.push(prefixedFieldsByFields[field]);\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[prefixedFieldsByFields[field]] = fieldMD.type;\n\t\t}.bind(this));\n\t\tthis.set('model.fieldsMD', fieldsMD);\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.selected', false);\n\t\t\tthis.set('model.headerClassMap', new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build());\n\t\t\tthis.set('model.fieldLabels', fieldLabels);\n\t\t}\n\t\tthis.set('model.rowClassMap', new TableClassBuilder(prefixedFieldsArray, 'Td', itemTypeMap).build());\n\t\tthis.set('model.fieldLabelMap', fieldLabelMap);\n\t\tthis.set('model.recordKeys', prefixedFieldsArray);\n\t}\n\n\t// Discount Schedule Modal Actions\n\n\t/**\n\t * Retrieves the original discount schedule\n\t */\n\tonRevert() {\n\t\tthis._retrieveSchedule(this.discountSchedule[this.originalScheduleField]);\n\t}\n\n\t/**\n\t * Called by clicking row level add action or by clicking add\n\t * Add will always push a new tier to the very end\n\t * @param e\n\t */\n\tonAddLine(e) {\n\t\tlet record = this._createBlankTierRecord();\n\t\tlet tierModel = new DiscountTierModel(record, this.discountSchedule);\n\t\ttierModel.rowActions = this._createRowActions();\n\t\tif (e.detail && e.detail.index !== undefined) {\n\t\t\tthis.splice('discountTiers', e.detail.index + 1, 0, tierModel);\n\t\t} else {\n\t\t\tthis.push('discountTiers', tierModel);\n\t\t}\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Called by clicking row level delete action or by selecting tiers and clicking Delete\n\t * @param e\n\t */\n\tonDeleteLines(e) {\n\t\tif (e.detail && e.detail.index) {\n\t\t\tthis.splice('discountTiers', e.detail.index, 1);\n\t\t} else {\n\t\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\t\tif (!this.discountTiers[i]) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this.discountTiers[i].selected) {\n\t\t\t\t\tthis.splice('discountTiers', i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.set('model.selected', false);\n\t\t}\n\t\tthis._selectCheckboxes(false);\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Assigns important values on discount schedule and saves to the server\n\t * @param e\n\t */\n\tonSave(e) {\n\t\tthis.errors = undefined;\n\t\tthis.tiers = this._processForSaving();\n\t\tif (!this.tiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis.errors = undefined;\n\t\tthis.action = e.currentTarget.attributes.id.value;\n\t\tlet model;\n\n\t\tif (this.discountSchedule[this.userDefinedField] && this.lineModel.lineVO.record.Id === this.discountSchedule[this.quoteLineField]) {\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleUpdaterService.uid = this.discountSchedule.Id;\n\t\t\tthis.$.discountScheduleUpdaterService.model = model;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.quoteLineField] = this.lineModel.lineVO.record.Id;\n\t\t\tthis.discountSchedule[this.userDefinedField] = true;\n\t\t\tthis.discountSchedule[this.originalScheduleField] = this.discountSchedule.Id;\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleClonerService.model = model;\n\t\t}\n\t}\n\n\t/**\n\t * Called on mouse-out or when dialog is closed\n\t * Attempts to clean out dialog so transition is clean between viewing other discount schedules\n\t */\n\tonCancel() {\n\t\tthis.fire('iron-signal', {name :'delete-groups'});\n\t\tthis.dialogTapped = false;\n\t\tthis.dialogOverlapping = false;\n\t\tthis.set('model.fieldsEditable', false);\n\t\tthis.errors = undefined;\n\t\tthis.schedule = undefined;\n\t\tthis.discountSchedule = undefined;\n\t\tthis.discountTiers = undefined;\n\t\tthis.discountScheduleId = undefined;\n\t\tthis.$.dialog.close();\n\t}\n\n\t// Helper Functions\n\n\t/**\n\t * Combines all tiers that are visible or saved from current tier only behavior\n\t * Then renumbers, sorts, calculates discounts, creates multi-currency records,\n\t * runs front end validation, and then sets discount unit field\n\t * @returns {*}\n\t * @private\n\t */\n\t_processForSaving() {\n\t\t// Combine saved tiers from 'current tier only' behavior and tiers shown in the modal\n\t\tlet hiddenTiers = this._sortTiers(this.savedTiers);\n\t\tlet visibleTiers = this._sortTiers(this.discountTiers);\n\t\tif (!hiddenTiers || !visibleTiers) {\n\t\t\treturn null;\n\t\t}\n\t\tlet tierModels = hiddenTiers.concat(visibleTiers);\n\t\tthis._renumberLines(tierModels, false);\n\t\tthis.set('discountTiers', visibleTiers);\n\t\tthis._updateActions();\n\t\t// Calculate discount amounts and sort before validating\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis._createTiers(tierModels);\n\t\tlet validator = new DiscountTiersValidator(this.discountSchedule, this.editorModel);\n\t\tlet errors = validator.validate(tierModels);\n\t\tif (errors.size > 0) {\n\t\t\tthis._createError(errors);\n\t\t\treturn null;\n\t\t}\n\t\tlet tiers = [];\n\t\ttierModels.forEach(function(tierModel) {\n\t\t\ttierModel.tiers.forEach(function(tier) {\n\t\t\t\ttiers.push(tier);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t\tthis.discountSchedule[this.tiersField].records = tiers;\n\t\tthis.discountSchedule[this.tiersField].totalSize = tiers.length;\n\t\tif (this.discountUnit === \"Price\") {\n\t\t\tthis.discountSchedule[this.discountUnitField] = \"amount\";\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = true;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = false;\n\t\t}\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Renames all of the constants used because it is cleaner without caps\n\t * @param constants\n\t * @private\n\t */\n\t_setConstants(constants) {\n\t\tthis.discountAmountField = constants.DISCOUNT_AMOUNT_FIELD;\n\t\tthis.discountScheduleField = constants.DISCOUNT_SCHEDULE_FIELD;\n\t\tthis.discountRateField = constants.ADDITIONAL_DISCOUNT_RATE_FIELD;\n\t\tthis.discountUnitField = constants.DISCOUNT_UNIT_FIELD;\n\t\tthis.lowerBoundField = constants.LOWER_BOUND_FIELD;\n\t\tthis.numberField = constants.NUMBER_FIELD;\n\t\tthis.originalScheduleField = constants.ORIGINAL_SCHEDULE_FIELD;\n\t\tthis.overrideBehaviorField = constants.OVERRIDE_BEHAVIOR_FIELD;\n\t\tthis.quantityField = constants.QUANTITY_FIELD;\n\t\tthis.quoteLineField = constants.QUOTE_LINE;\n\t\tthis.segmentKeyField = constants.SEGMENT_KEY_FIELD;\n\t\tthis.specialPriceField = constants.SPECIAL_PRICE_FIELD;\n\t\tthis.tierField = constants.DISCOUNT_TIER_FIELD;\n\t\tthis.tiersField = constants.DISCOUNT_TIERS_FIELD;\n\t\tthis.upperBoundField = constants.UPPER_BOUND_FIELD;\n\t\tthis.usePriceForAmountField = constants.USE_PRICE_FOR_AMOUNT_FIELD;\n\t\tthis.userDefinedField = constants.USER_DEFINED_FIELD;\n\t}\n\n\t_createError(errors) {\n\t\tlet errorsArray = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowNumber = this.discountTiers[i].template[this.numberField];\n\n\t\t\t// Create error message Array\n\t\t\tif (errors && errors.get(rowNumber)) {\n\t\t\t\terrorsArray.push(errors.get(rowNumber))\n\t\t\t};\n\t\t}\n\n\t\tif (errorsArray.length > 0) {\n\t\t\tthis.errors = errorsArray;\n\t\t}\n\n\t}\n\n\t/**\n\t * Creates error icons on the left\n\t * Creates Add (plus icon) and Delete (trash can) on the right\n\t * @param errors\n\t * @private\n\t */\n\t_createActions() {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet headerActions = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowActions = this._createRowActions(i);\n\n\t\t\t// Update the UI with new rowActions\n\t\t\tthis.set(`discountTiers.${i}.rowActions`, rowActions);\n\t\t}\n\t\t// Add to filler icons to the right side of header so actions are aligned correctly\n\t\theaderActions.push({icon : 'sb-icon-plus', position: 'right', hidden: true, invisible: true});\n\t\theaderActions.push({icon : 'sf-icon-delete', position: 'right', hidden: true, invisible: true});\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.headerActions', headerActions);\n\t\t}\n\t}\n\n\t/**\n\t * Set default index to 1.  This is used for adding a new row, the index is irrelevant in this case\n\t * @param index\n\t * @returns {*[]}\n\t * @private\n\t */\n\t_createRowActions(index = 1) {\n\t\treturn [{icon : 'sb-icon-plus',\n\t\t\ttitle: 'Add',\n\t\t\tposition: 'right',\n\t\t\tinvisible: false,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t}, {icon : 'sf-icon-delete',\n\t\t\ttitle: 'Delete',\n\t\t\tposition: 'right',\n\t\t\tinvisible: index == 0,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t}];\n\t}\n\n\t/**\n\t * Only runs if override behavior is 'current tier only'\n\t * Finds the matching tier for the line's current quantity and will save tiers that come prior\n\t * to matching tier which will be added back before saving to server\n\t * If DS is user defined, it will show all tiers after the current matching tier as well\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveVisibleRecords(tiers) {\n\t\tlet visibleTiers = [];\n\t\tlet currentQuantity = this.lineModel.lineVO.record[this.quantityField];\n\t\ttiers.forEach( function(tier) {\n\t\t\tlet lowerBound = tier[this.lowerBoundField];\n\t\t\tlet upperBound = tier[this.upperBoundField];\n\t\t\tlet userDefined = this.discountSchedule[this.userDefinedField];\n\t\t\t// User defined discount schedules will show tiers above currently matching tier\n\t\t\tif (!upperBound) {\n\t\t\t\treturn (currentQuantity >= lowerBound || userDefined) ? visibleTiers.push(tier) : visibleTiers;\n\t\t\t}\n\t\t\t// Saves tiers where current quantity is greater than lower and upper bound\n\t\t\tif (currentQuantity >= lowerBound && currentQuantity >= upperBound) {\n\t\t\t\tthis.savedTiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\t// Finds the tier where the current quantity is between the lower and upper bound\n\t\t\t} else if (lowerBound <= currentQuantity && currentQuantity < upperBound) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t\t// Display all tiers following the matching tier if discount schedule is user defined\n\t\t\t} else if (userDefined && lowerBound > currentQuantity) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t}\n\t\t}.bind(this));\n\t\t// Special Corner Case for when there is no matching tier\n\t\t// Ex: There exists only Discount Tier which is 1-11\n\t\t// Quantities below 1 will create a blank discount tier and not save the 1-11 tier\n\t\t// Quantities above 11 will create a tier where the lower bound is locked to 11 and tier 1-11 will be saved\n\t\tif (visibleTiers.length == 0 && tiers.length > 0) {\n\t\t\tlet lastPositionIndex = tiers.length - 1;\n\t\t\tlet lowestBound = tiers[0][this.lowerBoundField];\n\t\t\tlet highestBound = tiers[lastPositionIndex][this.upperBoundField];\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\tif (currentQuantity < lowestBound) {\n\t\t\t\trecord[this.numberField] = 1;\n\t\t\t} else if (currentQuantity >= highestBound) {\n\t\t\t\trecord[this.numberField] = tiers[lastPositionIndex][this.numberField] + 1;\n\t\t\t\trecord[this.lowerBoundField] = highestBound;\n\t\t\t}\n\t\t\tvisibleTiers.push(record);\n\t\t}\n\t\treturn visibleTiers;\n\t}\n\n\t/**\n\t * Creates a blank record if the discount doesn't have any\n\t * Otherwise, it will return the records that are used for displaying and editing purposes\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveRecords() {\n\t\tlet records = [];\n\t\tif (!this.discountSchedule[this.tiersField]) {\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\trecord[this.numberField] = 1;\n\t\t\trecords.push(record);\n\t\t} else {\n\t\t\trecords = this.discountSchedule[this.tiersField].records;\n\t\t\tif (this.discountSchedule[this.overrideBehaviorField] === 'Current Tier Only') {\n\t\t\t\t// current tier only setting will save all tiers before the tier that matches the line item quantity\n\t\t\t\t// and append them back right before the record is saved\n\t\t\t\trecords = this._retrieveVisibleRecords(records);\n\t\t\t\t// used in DSTableCell to disable first lower bound so it can't be edited\n\t\t\t\t// Only disable the field if there are tiers that are hidden because of current tier only functionality\n\t\t\t\tif (this.savedTiers.length > 0) {\n\t\t\t\t\tthis.editorModel.disabledDiscountTier = records[0][this.numberField];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.editorModel.disabledDiscountTier = undefined;\n\t\t\t}\n\t\t}\n\t\treturn records;\n\t}\n\n\t/**\n\t * Calculates and sets price, discount and discount amount fields\n\t * Will set them to zero if the value is undefined\n\t * Also sets the upperbound to null if undefined so it will display as an editble field\n\t * @param tiers\n\t * @private\n\t */\n\t_calculateDiscountAmounts(tiers) {\n\t\tif (!tiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet specialPrice = this.lineModel.lineVO.record[this.specialPriceField];\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet row = tier.template;\n\t\t\tif (this.discountUnit === 'Price') {\n\t\t\t\t// discount amount is equal to special price minus the price entered by the user\n\t\t\t\trow.Price = !row.Price && row.Price !== 0 ? (specialPrice - row[this.discountAmountField]) : row.Price;\n\t\t\t\trow[this.discountAmountField] = (specialPrice - row.Price);\n\t\t\t} else {\n\t\t\t\trow[this.discountRateField] = row[this.discountRateField] || 0;\n\t\t\t\trow[this.discountAmountField] = row[this.discountAmountField] || 0;\n\t\t\t}\n\t\t\t// Upper Bound may not always be defined so set it to null so field is editable\n\t\t\tif (!row[this.constants.UPPER_BOUND_FIELD] && row[this.constants.UPPER_BOUND_FIELD] != 0) {\n\t\t\t\trow[this.constants.UPPER_BOUND_FIELD] = null;\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Renumbers line starting from 1 if override behavior is not 'current tier only'\n\t * otherwise start from the first tier that is visible\n\t * Do a notifyPath so UI is updated for all cases except for when we sort all tiers\n\t * in the 'current tier only' scenario where there might be tiers not in the UI\n\t * @param tiers\n\t * @param notify\n\t * @private\n\t */\n\t_renumberLines(tiers, notify) {\n\t\tlet behavior = this.discountSchedule[this.overrideBehaviorField];\n\t\t// current tier only could have a visible tier that should start at a number that isn't 1\n\t\tlet number = behavior === 'Current Tier Only' && this.savedTiers.length > 0 ? tiers[0].template[this.numberField] : 1;\n\t\tfor (let i = 0, l = tiers.length; i < l; i ++) {\n\t\t\tif (tiers[i].template[this.numberField] != number) {\n\t\t\t\tif (notify) {\n\t\t\t\t\tthis.set(`discountTiers.${i}.template.${this.numberField}`, number);\n\t\t\t\t} else {\n\t\t\t\t\ttiers[i].template[this.numberField] = number;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnumber++;\n\t\t}\n\t}\n\n\t/**\n\t * Sorts tiers based on lowerbound value\n\t * Creates an error if there are matching lowerbounds\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_sortTiers(tiers) {\n\t\tlet lowerBoundList = [];\n\t\tlet tiersByLowerBound = {};\n\t\tlet sortedTiers = [];\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet lowerBound = tier.template[this.lowerBoundField];\n\t\t\tif (tiersByLowerBound[lowerBound]) {\n\t\t\t\tthis.errors = [this.editorModel.data.customLabels.msg_identical_lower_bounds];\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tlowerBoundList.push(lowerBound);\n\t\t\ttiersByLowerBound[lowerBound] = tier;\n\t\t}.bind(this));\n\t\tlowerBoundList.sort(function (a, b) {\n\t\t\treturn a - b\n\t\t});\n\t\tlowerBoundList.forEach(function(lowerBound) {\n\t\t\tlet tier = tiersByLowerBound[lowerBound];\n\t\t\tsortedTiers.push(tier);\n\t\t}.bind(this));\n\t\treturn sortedTiers;\n\t}\n\n\t/**\n\t * Loops through all the displayed discount tiers to populate tiers array and clones displayed tiers if multi-currency is enabled\n\t * @param tiers\n\t * @private\n\t */\n\t_createTiers(tiers) {\n\t\tlet isoCodes = this.editorModel.data.settings.currencyIsoCodes;\n\t\t// discount tiers for all currencies, including the quote's currency\n\t\ttiers.forEach(function(row) {\n\t\t\trow.tiers = [];\n\t\t\tif (!isoCodes) {\n\t\t\t\trow.tiers.push(row.template);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisoCodes.forEach(function(isoCode) {\n\t\t\t\tif (isoCode == this.currencyCode) {\n\t\t\t\t\trow.template.CurrencyIsoCode = isoCode;\n\t\t\t\t\trow.tiers.push(row.template);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (this.discountUnit === 'Percent') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trow.tiers.push(this._createMultiCurrencyRecord(row.template, isoCode));\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Loops through all of the tiers and sets the selected property\n\t * @param selected\n\t * @private\n\t */\n\t_selectCheckboxes(selected) {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 1, l = this.discountTiers.length; i < l; i++) {\n\t\t\tif (this.discountTiers[i]) {\n\t\t\t\tthis.set(`discountTiers.${i}.selected`, selected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Copies Discount Tier record to create more tiers but with different currency codes\n\t * @param tier\n\t * @param isoCode\n\t * @private\n\t */\n\t_createMultiCurrencyRecord(tier, isoCode) {\n\t\tlet record = JSON.parse(JSON.stringify(tier));\n\t\trecord['CurrencyIsoCode'] = isoCode;\n\t\trecord[this.discountAmountField] = 0;\n\t\trecord[this.discountRateField] = record[this.discountRateField] || 0;\n\t\t// Price needs to be removed before sending data to the server\n\t\tdelete record.Price;\n\t\treturn record;\n\t}\n\n\t/**\n\t * Creates a blank record for when a new line is added\n\t * @returns {{}}\n\t * @private\n\t */\n\t_createBlankTierRecord() {\n\t\tlet record = {};\n\t\tthis.fieldsArray.forEach(function(fieldName) {\n\t\t\trecord[fieldName] = null;\n\t\t\trecord['CurrencyIsoCode'] = this.currencyCode;\n\t\t\trecord[this.discountAmountField] = 0;\n\t\t\trecord[this.discountRateField] = 0;\n\t\t}.bind(this));\n\t\treturn record;\n\t}\n\n\t/**\n\t * Called each time mouse-over, mouse-out, on-tap is called on the discount schedule icon\n\t * Initiates the query for discount schedule and toggles dialog boxShadow\n\t * Assigns dialogTapped which determines if full modal view is shown and toggles field editability if valid\n\t * @param e\n\t * @private\n\t */\n\t_handleIconAction(e) {\n\t\tlet event = e.detail.event;\n\t\tlet type = event.type;\n\t\tlet model = e.detail.model;\n\t\tthis.lineModel = this.editorModel.quoteModel.lineModelsByKey[model.serviceModel.keys[0]];\n\t\tthis.discountScheduleId = model.serviceModel.scheduleId;\n\t\tswitch(type) {\n\t\t\tcase 'mouseenter':\n\t\t\t\tif (!this.isMobile && !this.dialogTapped) {\n\t\t\t\t\tthis._toggleDialogClasses(true);\n\t\t\t\t\tthis.$.dialog.open();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'mouseleave':\n\t\t\t\t// Adding to the debounce gives the event listener attached to the dialog's mouseenter a chance to determine dialog is overlapping\n\t\t\t\tthis.debounce('closeDialog',function() {\n\t\t\t\t\tif (!this.isMobile && !this.dialogTapped && !this.dialogOverlapping) {\n\t\t\t\t\t\tthis.onCancel();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), 1);\n\t\t\t\tbreak;\n\t\t\tcase 'tap':\n\t\t\t\tthis._openDialog();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_openDialog() {\n\t\tif (this.dialogTapped) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dialogTapped = true;\n\t\tthis.$.dialog.open();\n\t\tthis._toggleDialogClasses(false);\n\t}\n\n\t_toggleDialogClasses(applyClasses) {\n\t\tlet dialog = Polymer.dom(this.$.dialog.root);\n\t\tlet sbDialog = dialog.querySelector('.sbDialog');\n\t\tthis.toggleClass('boxShadow', applyClasses, sbDialog);\n\t\tthis.toggleClass('noMarginBottom', applyClasses, dialog.querySelector('#content'));\n\t}\n\n\t_handleDialogTap() {\n\t\tthis.addEventListener('sb-tap-ds', function() {\n\t\t\tif (this.isMobile || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._openDialog();\n\t\t}.bind(this));\n\t}\n\n\t_handleDialogMouseEvents() {\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tlet dialog = Polymer.dom(this.$.dialog.root).querySelector('.sbDialog');\n\t\tdialog.addEventListener('mouseenter', function() {\n\t\t\tif (this.dialogTapped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.dialogOverlapping = true;\n\t\t}.bind(this));\n\n\t\tdialog.addEventListener('mouseleave', function() {\n\t\t\tif (this.dialogTapped || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onCancel();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Called each time dialogTapped is triggered (when icon is clicked)\n\t * @private\n\t */\n\t_toggleEditableClasses() {\n\t\tthis.set('model.fieldsEditable', this.editable && this.dialogTapped);\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setDisabled();\n\t\tthis._updateActions();\n\t}\n\n\t_updateActions() {\n\t\tfor ( let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tlet rowActions = this.discountTiers[i].rowActions;\n\t\t\tif (!rowActions) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let j = 0, k = rowActions.length; j < k; j++) {\n\t\t\t\tlet invisible = i == 0 && rowActions[j].icon == 'sf-icon-delete';\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.hidden`, !this.model.fieldsEditable);\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.invisible`, invisible);\n\t\t\t}\n\t\t}\n\t\tif (!this.isMobile && this.model.headerActions) {\n\t\t\tfor ( let m = 0, n = this.model.headerActions.length; m < n; m ++) {\n\t\t\t\tthis.set(`model.headerActions.${m}.hidden`, !this.model.fieldsEditable);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Toggles field edibility\n\t * @private\n\t */\n\t_setDisabled() {\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tthis.set(`discountTiers.${i}.disabled`, !this.model.fieldsEditable);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the Quote and Account fields for the discount schedule with the correct value\n\t * @private\n\t */\n\t_setDSFields() {\n\t\tlet quote = this.editorModel.quoteModel.quoteVO;\n\t\tthis.discountSchedule[this.constants.QUOTE] = quote.record.Id;\n\t\tlet accountId;\n\t\tif (quote.record[this.constants.ACCOUNT_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.ACCOUNT_FIELD].Id;\n\t\t} else if (quote.record[this.constants.OPPORTUNITY_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.OPPORTUNITY_FIELD].AccountId;\n\t\t}\n\t\tthis.discountSchedule[this.constants.ACCOUNT_ID_FIELD] = accountId;\n\t}\n\n\t/**\n\t * Used as a filter when looping over the discount tier field set so the correct discount unit field is shown\n\t * @param field\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_isFieldShown(field) {\n\t\tif (this.discountUnit === 'Percent' && field === this.discountAmountField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Amount' && field === this.discountRateField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Price' && (field === this.discountRateField || field === this.discountAmountField)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Builds the tab data used for mobile user defined discount schedule\n\t * @private\n\t */\n\t_buildTabData() {\n\t\tlet tabs = [],\n\t\t\tlabels = ['Details', 'Tiers'];\n\n\t\tif (this.tabs === tabs) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0, len = labels.length; i < len; i++) {\n\t\t\tlet label = labels[i];\n\t\t\tlet tId = \"t\" + i;\n\t\t\tlet bind;\n\t\t\tlet pageComponent;\n\t\t\tif (label === 'Details') {\n\t\t\t\tbind = ['data', 'fieldNames', 'md', 'numColumns', 'disabled'];\n\t\t\t\tpageComponent = 'sb-field-table';\n\t\t\t} else if (label === 'Tiers') {\n\t\t\t\tbind = ['discountTiers', 'model', 'editorModel'];\n\t\t\t\tpageComponent = 'sb-ds-tiers';\n\t\t\t}\n\t\t\ttabs.push({name: tId, label: label, bind: bind, pageComponent: pageComponent});\n\t\t}\n\t\tthis.tabs = tabs;\n\t}\n\n\t/**\n\t * Sets the isMobile variable as the viewport changes\n\t */\n\tviewportChanged() {\n\t\tthis.isMobile = (this.viewport && this.viewport.isMobile()) ? true : false;\n\t}\n}\n\nPolymer( DiscountScheduleDialog );","export class FavoriteDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-dialog';\n\t\tthis.properties = {\n\t\t\tfavName: String\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-fav', this.onCancel);\n\t}\n\n\tonSave() {\n\t\tif (this.favName == \"\" || this.favName === undefined) {\n\t\t\tthis.errors = ['Favorite name cannot be left blank.'];\n\t\t\treturn;\n\t\t}\n\t\tlet favoriteKeys = [];\n\t\tif (this.favoritedGroup) {\n\t\t\t// saves each line within the group to send up\n\t\t\tlet numGroupLines = this.groupLines.length;\n\t\t\tfor (let i=0; i<numGroupLines; i++) {\n\t\t\t\tif (!this.groupLines[i].component) {\n\t\t\t\t\tfavoriteKeys.push(this.groupLines[i].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfavoriteKeys.push(this.favoritedLine[0]);\n\t\t}\n\n\t\tthis.fire('sb-favorite-saved', {keys: favoriteKeys, name: this.favName, groupKey: this.favoritedGroup} );\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n}\n\nPolymer( FavoriteDialog );","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class PricebookDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pricebook-dialog';\n\t\tthis.properties = {\n\t\t\tpricebooks: Array,\n\t\t\tselectedPricebook: String,\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.select.addEventListener('change', function(e) {\n\t\t\tthis.selectedPricebook = e.detail.value; // Change in pricebook picklist selection\n\t\t}.bind(this));\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this.onCancel.bind(this));\n\t}\n\n\topen() {\n\t\tthis.$.pricebookLoaderService.addEventListener('response-changed', function(e) {\n\t\t\tlet pricebooks = [],\n\t\t\t\tresults = e.detail.value,\n\t\t\t\tnumResults = results.length;\n\n\t\t\tfor (let i =0; i < numResults; i++) {\n\t\t\t\tpricebooks.push({ value: results[i].Id, label: results[i].Name, selected: false});\n\t\t\t}\n\n\t\t\tpricebooks[0].selected = true; // Auto-select the first pricebook\n\t\t\tthis.selectedPricebook = pricebooks[0].value;\n\n\t\t\t// Sets up the user's pricebook list in a select\n\t\t\tthis.$.select.value = this.selectedPricebook;\n\t\t\tthis.$.select.isRequired = true;\n\t\t\tthis.pricebooks = pricebooks;\n\n\t\t\tthis.$.dialog.toggle();\n\t\t}.bind(this));\n\n\t\t// ServiceLoader requires uid and context, but no values are needed\n\t\tthis.$.pricebookLoaderService.uid = '';\n\t\tthis.$.pricebookLoaderService.context = '';\n\t}\n\n\tonSave() {\n\t\tthis.$.pricebookSaverService.addEventListener('response-changed', function(e) {\n\t\t\tthis.fire('pricebook-saved', e.detail.value); // Response is the quoteVOResponse\n\t\t}.bind(this));\n\n\t\tthis.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD] = this.selectedPricebook;\n\t\tthis.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_LOOKUP_ID_FIELD] = this.selectedPricebook;\n\t\tthis.$.pricebookSaverService.model = new DataBuilder()\n\t\t\t.add('pricebookId', this.selectedPricebook)\n\t\t\t.add('quoteId', this.editorModel.quoteModel.quoteVO.record.Id)\n\t\t\t.add('oppId', this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.OPPORTUNITY_ID_FIELD])\n\t\t\t.build();\n\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: 'onCancel'}\n\t\t});\n\t}\n}\n\nPolymer( PricebookDialog );","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class LEFieldMD {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-field-md';\n\t\tthis.properties = {\n\t\t\tdata: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['getFieldNames(data, prefix)'];\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function(e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldsMap = {},// map of fields {objectName: {fieldNames: field}}\n\t\t\t\tfieldLabelsMap = {}; // map of fieldLabels {fieldName: fieldLabel} for easy access for the <sb-group> component\n\n\t\t\tif (!this.constants)\n\t\t\t\tthis.constants = new Constants(this.prefix);\n\n\t\t\tlet unitPriceFields = this.constants.UNIT_PRICE_FIELDS;\n\t\t\tlet quantityFields = this.constants.QUANTITY_FIELDS;\n\t\t\tfor (let item in md) {\n\t\t\t\tlet parts = item.split(\".\"),\n\t\t\t\t\tobjName = parts[0],\n\t\t\t\t\tfieldName = parts[1];\n\n\t\t\t\tif (!fieldsMap[objName]) {\n\t\t\t\t\tfieldsMap[objName] = {};\n\t\t\t\t}\n\t\t\t\t// Unit Price Fields always follow the package level unit price scale\n\t\t\t\t// Otherwise, if the field is type currency and the org is multi-currency, the scale will use currencyDecimalScale (defined by CurrencyType table)\n\t\t\t\tif (unitPriceFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.priceScale;\n\t\t\t\t} else if (md[item].type == 'currency' && this.settings.isMultiCurrencyOrg) {\n\t\t\t\t\tmd[item].scale = this.currencyDecimalScale;\n\t\t\t\t} else if (quantityFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.quantityScale || this.settings.quantityScale === 0 ? this.settings.quantityScale : md[item].scale;\n\t\t\t\t}\n\n\t\t\t\tfieldsMap[objName][fieldName] = md[item];\n\t\t\t\tfieldLabelsMap[fieldName] = md[item].label;\n\t\t\t}\n\n\t\t\tthis.md = {fieldsMap : fieldsMap, fieldLabelsMap: fieldLabelsMap};\n\t\t}.bind(this));\n\n\t\tthis.$.describe.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\tgetFieldNames() {\n\t\t// Create an array of objectName.fieldName for retrieving field metadata\n\t\tlet fieldNames = [];\n\t\tfor (let obj in this.data) {\n\t\t\t// prefix object names only - field names are returned prefixed from the server\n\t\t\tfor (var i = 0, l = this.data[obj].length; i < l; i++) {\n\t\t\t\tlet fieldName = this.data[obj][i];\n\t\t\t\tfieldNames.push(obj + '.' + fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// describe call is initiated when fields are bound here - they are not passed in through the html\n\t\tthis.$.describe.fields = fieldNames;\n\t}\n\n}\n\nPolymer( LEFieldMD );","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class CSETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-cse-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trender: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, value, model, data)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.groupModel.editorModel.constants;\n\t}\n\n\n\n\tbuildCell() {\n\t\tlet tableCols = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet quoteLineFieldsMD = this.model.groupModel.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t\tlet fieldsMD = [];\n\n\t\tfor (let i = 0; i < tableCols.length; i++) {\n\t\t\tlet fieldMD = quoteLineFieldsMD[tableCols[i]];\n\t\t\tfieldsMD[tableCols[i]] = fieldMD;\n\t\t}\n\n\t\t//if (fieldsMD && fieldsMD[this.item] && fieldsMD[this.item].type) {\n\t\tthis.editing = true;\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.viewport && this.viewport.isMobile() ) {\n\t\t\tthis.render = true;\n\t\t\tif (this.index === 0) {\n\t\t\t\tthis.editing = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.disabled = false;\n\t\tthis.md = fieldsMD[this.item];\n\t}\n}\n\nPolymer(CSETableCell);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n *  <sb-custom-action>\n *\n *  Features:\n *\n **/\nexport class CustomAction {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-action';\n\t\tthis.properties = {\n\t\t\tcustomAction: Object,\n\t\t\tmodel: Object,\n\t\t\tactionHidden: Boolean,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbutton: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tspan: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t\tgroupAction: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tallOptional: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_toggleQuoteButton(model.allOptional)', '_toggleLineButton(model.favorite)'];\n\t}\n\n\tready() {\n\t\tif (this.customAction && this.customAction.isSeparator) {\n\t\t\tthis.button = false;\n\t\t\tthis.span = true;\n\t\t}\n\t\t\n\t\t// for the case of closing a menu inside a menu\n\t\tthis.addEventListener('paper-dropdown-close', function(e) {\n\t\t\tif (this.$$('#menuButton'))\n\t\t\t\tthis.$$('#menuButton').close();\n\t\t});\n\n\t\tif (!this.horizontalAlign) {\n\t\t\tthis.horizontalAlign = this.span ? \"left\" : \"right\";\n\t\t}\n\t\tthis.horizontalOffset = this.span ? 18 : 0;\n\t\tthis.verticalOffset = this.span ? -30 : 0;\n\t}\n\n\ttriggerCustomAction(e) {\n\t\t// If event is showDSModal, fire event for mouseover, mouseout and tap; otherwise, the event\n\t\t// must be type == 'tap' and will fire normal tap event\n\t\tif (this.customAction.eventHandlerName === \"showDSModal\") {\n\n\t\t\t// If mobile and not a tap gesture, we want to return early\n\t\t\tif (this.classList.contains('swipe-menu-item') && e.type !== 'tap') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.fire('iron-signal', {name: 'schedule-action', data: {event: e, model: this.model}});\n\t\t\treturn;\n\n\t\t} else if (e.type !== 'tap') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: this.customAction,\n\t\t\tmodel: this.model\n\t\t});\n\t\tthis.fire('paper-dropdown-close');\n\t}\n\n\t_showAction(customAction, model) {\n\t\treturn !customAction.isHidden(model);\n\t}\n\n\t_getLabel(customAction, viewport) {\n\t\treturn (!customAction.icon || (viewport && (viewport.isMobile() || viewport.S.down) ))\n\t\t\t\t&& customAction.renderLocation !== 'Line'\n\t\t\t? customAction.label : null;\n\t}\n\n\t_hasMenu(customAction, viewport, button, span) {\n\t\treturn (!button && !span) || (customAction.hasMenu && !(viewport && (viewport.isMobile() || viewport.S.down)));\n\t}\n\n\t_hasMenuButton(customAction, viewport, button, span) {\n\t\treturn this._hasMenu(customAction, viewport, button, span) && !span;\n\t}\n\n\t_getButtonClass(customAction, viewport, button, span, groupAction) {\n\t\treturn (groupAction ? 'groupButton ' : '')\n\t\t\t+ (customAction.icon && !this._getLabel(customAction, viewport) ? customAction.icon : '')\n\t\t\t+ (customAction.first ? '':' notFirst')\n\t\t\t+ (customAction.last && !this._hasMenu(customAction, viewport, button, span) ? '':' notLast')\n\t\t\t+ (customAction.primary ? ' primary':'');\n\t}\n\n\t_getMenuClass(customAction, button, groupAction) {\n\t\treturn !button && groupAction ? 'mobileGroupMenu'\n\t\t\t: (groupAction ? 'groupMenu ' : '') + (customAction.last ? '' : 'notLast');\n\t}\n\n\t_toggleQuoteButton(allOptional = false) {\n\t\tthis.allOptional = allOptional;\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleLineButton() {\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleButton() {\n\t\t// Logic that swaps fav swipeItems after the first time\n\t\tif (this.viewport && this.viewport.isMobile() && !this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.style.transform) {\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n\t_setButtonClassAndLabel() {\n\t\t// Logic that swaps fav swipeItems for the first time\n\t\tif (this.viewport && this.viewport.isMobile() && this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.parentElement) {\n\t\t\tPolymer.dom(this.parentElement).flush();\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n}\n\nPolymer( CustomAction );","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class DSTableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, model, data, index, viewport)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.constants;\n\t}\n\n\tbuildCell() {\n\t\tlet fieldsMD = this.model.md.fieldsMap[this.constants.DISCOUNT_TIER_FIELD];\n\t\tlet field = this.item.replace('template.', '');\n\t\tif (this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\t\tthis.handleOriginalValues();\n\t\tthis.editing = this.isEditable(field, fieldsMD);\n\t\tthis.md = fieldsMD[field];\n\t}\n\n\tisEditable(field, fieldsMD) {\n\t\tif(field === this.constants.NUMBER_FIELD)\n\t\t\treturn false;\n\n\t\tif(field === this.constants.LOWER_BOUND_FIELD && this.data.template[this.constants.NUMBER_FIELD] === this.model.disabledDiscountTier)\n\t\t\treturn false;\n\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif(this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\treturn false;\n\n\t\treturn fieldsMD[field].updateable;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data.original && this.data.template) {\n\t\t\tthis.data.original = {};\n\t\t\tthis.data.original.template = JSON.parse(JSON.stringify(this.data.template));\n\t\t}\n\t\tif(this.data.original)\n\t\t\tthis.$.field.originalValue = this.get('data.original.' + this.item);\n\t}\n}\n\nPolymer(DSTableCell);","export class DSTiers {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-tiers';\n\t\tthis.properties = {\n\t\t\tdiscountTiers: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 && this.model.fieldsEditable ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t_deleteGroups() {\n\t\t// Used when switching between different discount units\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\trows.forEach(function(row) {\n\t\t\t// Guarantees that the groups are re-rendered properly\n\t\t\trow.cols = undefined;\n\t\t\trow.$.row.destroyGroup();\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( DSTiers );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FieldSetTable {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tobjectName: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodel: Object\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['generateColumns(editorModel, objectName, viewport, model)'];\n\t}\n\n\tgenerateColumns() {\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tlet fieldNames = [];\n\t\tlet numFields;\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tif (this.objectName == this.editorModel.constants.QUOTE_LINE_GROUP ) {\n\t\t\tlet groupFieldNames = this.editorModel.fieldsetMap.groupFieldNames.slice();\n\t\t\t// Name and Description fields are handled else where\n\t\t\tfor (let i = 0, l = groupFieldNames.length; i < l; i++) {\n\t\t\t\tif (!this.isMobile && (this.editorModel.constants.DESCRIPTION_FIELD == groupFieldNames[i] ||  'Name' == groupFieldNames[i])) {\n\t\t\t\t\tgroupFieldNames.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfieldNames = groupFieldNames;\n\t\t\tnumFields = groupFieldNames.length;\n\t\t} else if (this.objectName == this.editorModel.data.quoteObjectName) {\n\t\t\tfieldNames = this.editorModel.fieldsetMap.quoteFieldNames;\n\t\t\tnumFields = this.editorModel.fieldsetMap.quoteFieldNames.length;\n\t\t}\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.model;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.model;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.model;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n}\n\nPolymer(FieldSetTable);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetTableItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t},\n\t\t\trenderReadOnly: {\n\t\t\t\tvalue: false,\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\ttype: String\n\t\t}\n\t}\n\n\tattached() {\n\t\tif (this.renderReadOnly) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\t_datePickerOpened(e) {\n\t\t// True if in multi-group view\n\t\t// This code should eventually not be needed\n\t\tif (this.renderReadOnly) {\n\t\t\treturn;\n\t\t}\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdateInput = Polymer.dom(dateContainer).querySelector('input'),\n\t\t\tdatepicker = e.detail.datepicker,\n\t\t\tdatepickerHeight = e.detail.datepicker.offsetHeight,\n\t\t\tdatepickerWidth = e.detail.datepicker.offsetWidth,\n\t\t\twindowHeight = window.innerHeight,\n\t\t\twindowWidth = window.innerWidth,\n\t\t\tdateContainerBoundingClientRect = dateContainer.getBoundingClientRect(),\n\t\t\tdistanceFromBottom = windowHeight - dateContainerBoundingClientRect.bottom - datepickerHeight,\n\t\t\tdistanceFromRight = windowWidth - dateContainerBoundingClientRect.left - datepickerWidth;\n\n\t\tdatepicker.style.position = 'fixed';\n\n\t\t// Style depending on distance from right side of screen to position appropriately\n\t\tif (distanceFromRight < 0) {\n\t\t\t// Use date input here instead of container so that the datepicker is aligned with the input box\n\t\t\tdatepicker.style.left = dateInput.getBoundingClientRect().right - datepickerWidth + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t}\n\n\t\t// Style depending on distance from bottom of screen to position appropriately\n\t\tif (distanceFromBottom < 0) {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top - datepickerHeight + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.bottom + 'px';\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldData(item, model, data)',\n\t\t\t\t'_displayChanged(value, display, item, data, md)',\n\t\t\t\t'_valueChanged(value, md)',\n\t\t\t\t'_updateOriginalValue(model, item)'];\n\t}\n\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tthis.md = this.model.getFieldMD(this.item);\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// Mobile RTE's should be null if there is no value, ie Group Description\n\t\tthis.label = (this.value == null && this.md.extraTypeInfo === 'richtextarea' && this.isMobile) ? null : this.md.label;\n\t\t\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\t// To set the field is editable because it's required for the sb-field.\n\t\t// Calculated and roll-up summary fields should not be editable\n\n\t\t// Update CurrencyIsoCode for quote and group level fields\n\t\tif (this.data.CurrencyIsoCode) {\n\t\t\tthis.md['CurrencyIsoCode'] = this.data.CurrencyIsoCode;\n\t\t}\n\n\t\tthis.$.field.editing = !!this.md.updateable; //true if this.md.updateable == true\n\t\tthis.$.field.disabled = !this.md.updateable;\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_valueChanged() {\n\t\tthis._updateLookupDisplayValue();\n\t\tthis.$.field.value = this.value;\n\t\tif (this.data && this.item) {\n\t\t\tthis.data[this.item] = this.value;\n\t\t}\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tif (!this.data) {\n\t\t\treturn;\n\t\t}\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_handleFieldValueChanged(e) {\n\t\tlet suppressImmediateCalcuation = e.detail ? e.detail.suppressImmediateCalcuation : false;\n\t\tif (this.calculateImmediately && !suppressImmediateCalcuation) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t}\n\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.md.referenceTo[0]);\n\t}\n\n\t_updateOriginalValue() {\n\t\tif (!this.type) {\n\t\t\treturn;\n\t\t}\n\t\t// Avoids data marked as dirty when front end operation (i.e. delete lines, sort lines, etc) from displaying dirty when they shouldn't be\n\t\tthis.model[this.type]._transient_ = this.model[this.type]._transient_ || {};\n\t\tthis.model[this.type]._transient_.original = this.model[this.type]._transient_.original || JSON.parse(JSON.stringify(this.model[this.type].record));\n\t\tlet originalRecord = this.get(`model.${this.type}._transient_.original`);\n\t\tthis.$.field.originalValue = originalRecord[this.item];\n\t}\n\n}\n\nPolymer(FieldSetTableItem);\n","import {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class LEDrawer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-drawer';\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array,\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [ 'init(fieldNames, lineModel)',\n\t\t\t\t '_lineRecordChanged(lineModel.*)'];\n\t}\n\n\tinit() {\n\t\tthis.itemClassMap = this.lineModel.itemClassMap;\n\t\tlet richTextFields = [];\n\t\tfor (let field of this.fieldNames) {\n\t\t\tif (this._isRichTextField(field)) {\n\t\t\t\trichTextFields.push(field);\n\t\t\t}\n\t\t}\n\t\tthis.richTextFields = richTextFields;\n\t}\n\n\t_isRichTextField(field) {\n\t\treturn this.lineModel.getFieldMD(field).extraTypeInfo === 'richtextarea';\n\t}\n\n\t_lineRecordChanged(e) {\n\t\tif (e.path === 'lineModel.lineVO.fieldVisibility') {\n\t\t\tthis._visibilityChanged();\n\t\t} else if (e.path === 'lineModel.lineVO.fieldEditability') {\n\t\t\tthis._editabilityChanged();\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tthis.lineModel.setItemClassMap();\n\t\tthis.itemClassMap = this.lineModel.itemClassMap;\n\t}\n\n\t_editabilityChanged() {\n\t\tthis.itemEditableMap = this.lineModel.lineVO.fieldEditability;\n\t}\n\n\t_showLineMultiActions(editorModel) {\n\t\treturn (editorModel.actionsOnTheLeft ? 'actionsOnTheLeft ' : '')\n\t\t\t+ (editorModel.data.settings.multiLineDeleteEnabled ? 'multiDeleteEnabled' : '');\n\t}\n}\n\nPolymer(LEDrawer);","export class LEFooter {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-footer';\n\t\tthis.properties = {\n\t\t\tquoteModel: Object,\n\t\t\tquoteTotal: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\tquoteTotalMd: Object,\n\t\t\teditorModel: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_showQuoteTotal(quoteModel.quoteVO.*)',\n\t\t\t\t'_setTotalWidth(quoteModel.editorModel.layout)'];\n\t}\n\n\tget settings() {\n\t\treturn this.quoteModel.editorModel.data.settings;\n\t}\n\n\tget quoteFields() {\n\t\treturn this.quoteModel.editorModel.md.fieldsMap[this.settings.developerPrefix + 'Quote__c'];\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_setTotalWidth() {\n\t\tif(this.showQuoteTotal) {\n\t\t\tlet editorModel = this.quoteModel.editorModel;\n\t\t\tthis.toggleClass('largeQuote', editorModel.largeQuoteExperienceEnabled, this.$.container);\n\t\t\tthis.labelClass = editorModel.deviceContext.isMobile ? 'hidden' : '';\n\t\t\tif (!editorModel.layout || editorModel.deviceContext.isMobile || editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.totalWidth = this.quoteModel.editorModel.layout.totalWidth + 'px';\n\t\t}\n\t}\n\n\t_showQuoteTotal() {\n\t\tthis.grouped = this.quoteModel.grouped ? 'grouped' : '';\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tthis.showQuoteTotal = this.settings.lineEditorTotalsField != 'doNotDisplay' && this.quoteVO.lineItems && this.quoteVO.lineItems.length > 0;\n\t\tthis._setQuoteTotal();\n\t}\n\n\t_setQuoteTotal() {\n\t\tlet total,\n\t\t\tpriceScale,\n\t\t\tconstants = this.quoteModel.editorModel.constants,\n\t\t\ttotalsField = this.settings.lineEditorTotalsField; // Quote total field to be displayed. If the user has never saved this setting, its value would be null\n\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tif (!totalsField || totalsField == 'Default') { // Default or unchanged totals field\n\t\t\tif (this.settings.isMultiCurrencyOrg) {\n\t\t\t\tpriceScale = this.quoteVO.currencyDecimalScale;\n\t\t\t} else {\n\t\t\t\tif (this.quoteVO.applyAdditionalDiscountLast) {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.CUSTOMER_AMOUNT_FIELD].scale;\n\t\t\t\t} else {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.NET_AMOUNT_FIELD].scale;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttotal = this.quoteVO.applyAdditionalDiscountLast ? this.quoteVO.customerTotal : this.quoteVO.netTotal;\n\t\t} else { // Custom totals field\n\t\t\tpriceScale = this.settings.isMultiCurrencyOrg ? this.quoteVO.currencyDecimalScale :\n\t\t\t\tthis.quoteFields[totalsField] ? this.quoteFields[totalsField].scale : 0;\n\t\t\ttotal = this.quoteVO.record[totalsField] || 0; // If totalsField is not found, default to 0\n\t\t}\n\t\tif (!this.quoteTotalMd) {\n\t\t\tthis.quoteTotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.quoteTotal = total.toFixed(priceScale);\n\t}\n}\n\nPolymer( LEFooter );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\n\n/**\n * <sb-le-group>\n *\n * Features:\n *\n */\nexport class LEGroup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - hosts the GroupVO information and line items */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_groupModelChanged'\n\t\t\t},\n\t\t\tgroupClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tsubtotal: Number,\n\t\t\tsubtotalMd: Object,\n\t\t\t/** Description, labeled value to interact properly with sb-field */\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_descriptionChanged'\n\t\t\t},\n\t\t\tdescriptionMd: Object,\n\t\t\tgroupLevelTabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfavorited: Boolean,\n\t\t\tui3Enabled: Boolean,\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_groupRecordChanged(groupModel.groupVO.record.*)', '_toggleGrouping(groupModel.groupVO)',\n\t\t\t'_segmentedPrimaryMobileColsChanged(groupModel.editorModel.segmentedPrimaryMobileCols)',\n\t\t\t'_updateTableProperties(groupModel.standardLines.splices)', '_updateTableProperties(groupModel.segmentedLinesByDimension.*)',\n\t\t\t'_createDragDropModel(editorModel)',\n\t\t\t'_groupCustomActionsChanged(groupModel.editorModel.groupCustomActions)',\n\t\t\t'_showSubtotal(groupModel.groupVO.record.*)'];\n\t}\n\n\tready() {\n\t\tthis.groupExpanded = false;\n\t\tthis.showSpinner = false;\n\t\tthis.ui3Enabled = AppContext.org.isUI3Enabled || false;\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'cseDialog-tapped': '_handleCSEDialogTapped',\n\t\t\t'segmented-changed': '_customSegmentedUpdated',\n\t\t\t'upgrade-asset-quantity-changed': '_setUpgradeQuantity'\n\t\t};\n\t}\n\n\t_createDragDropModel() {\n\t\tlet validTargets = new Set(['sb-droppable-mdqRows', 'sb-droppable-emptyTable',\n\t\t\t'sb-droppable-emptyMDQTable', 'sb-droppable-emptyMDQSegmentTab',\n\t\t\t'sb-droppable-sidePanelGroups', 'emptyTableMessage']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sb-le-table-row',\n\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\t/**\n\t *  To determine whether the lines are changed\n\t *\n\t * @private\n\t */\n\t_groupModelChanged() {\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\t\tthis._updateTableProperties();\n\t\tthis._updatePageData();\n\t\tthis._setIsButton();\n\t\tthis.isMobile = this.viewport ? this.viewport.isMobile() : false;\n\t\tif (this.isMobile || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.set('groupModel.groupExpanded', this.groupExpanded);\n\t\t\tthis.buildGroupTabs();\n\t\t}\n\t\t// Always show buttons in desktop\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tthis.set('groupModel.groupExpanded', true);\n\t\t\tthis._setTotalWidth();\n\t\t}\n\n\t\tthis.containerClass = this.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\t}\n\n\t_setIsButton() {\n\t\tthis.isButton = this.viewport ? (this.viewport.isDesktop() && this.viewport.M.up) : true;\n\t}\n\n\t_setTotalWidth() {\n\t\tif (!this.editorModel.layout || this.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.totalWidth = this.editorModel.layout.totalWidth + 2 + 'px';\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_updateTableProperties() {\n\t\tthis.groupHasStandardProducts = this.groupModel._groupHasStandardProducts();\n\t\tthis.groupHasSegmentedProducts = this.groupModel._groupHasSegmentedProducts();\n\t\tthis.groupedAndHasNoLineItems = this.groupModel.quoteModel.grouped && !this._groupHasLineItems();\n\t\tthis.groupHasBothProducts = this._groupHasBothProducts();\n\t\tthis._showSubtotal();\n\t\tthis._setGroupDescription();\n\t}\n\n\t_segmentedPrimaryMobileColsChanged() {\n\t\tthis._updatePageData();\n\t}\n\n\t/**\n\t * To update the page data so that it will be rendered\n\t *\n\t * @private\n\t */\n\t_updatePageData() {\n\t\tif (this.$$('#leGroupTabs')) {\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t}\n\n\t\tlet tabs = [],\n\t\t\tdimensions = this.groupModel.dimensions;\n\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\n\t\t\tif (this.groupModel.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: this.groupModel.quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + this.groupModel.groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseDialog';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.tabs = tabs;\n\t\tif (!this.groupMDQTabs) {\n\t\t\tthis.groupMDQTabs = tabs;\n\t\t}\n\t}\n\n\t/**\n\t * Open the Custom Segment Dialog with the custom segment information from the quote\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_handleCSEDialogTapped(e) {\n\t\tthis.fire('cse-tapped', {\n\t\t\tdialog: 'cseDialog',\n\t\t\tgroupModelKey: this.groupModel.groupKey\n\t\t});\n\t}\n\n\t_groupHasBothProducts() {\n\t\treturn this.groupModel._groupHasStandardProducts() && this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupHasLineItems() {\n\t\treturn this.groupModel._groupHasStandardProducts() || this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupRecordChanged(changedRecord) {\n\t\tif (changedRecord.path == `groupModel.groupVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`) {\n\t\t\tthis.fire('iron-signal', {name: 'toggle-optional-clicked', data : {toggleOptionalBoolean : changedRecord.value, groupKey: this.groupModel.groupKey}});\n\t\t}\n\t\tlet groupRecord = this.groupModel.groupVO.record\n\t\tthis.favorited = !!(groupRecord && groupRecord[this.editorModel.constants.FAVORITE_ID_FIELD]);\n\t}\n\n\t_setGroupDescription() {\n\t\tif (!this.groupModel.groupVO.record) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.value = this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tif (this.groupModel && this.editorModel.md && this.editorModel.constants) {\n\t\t\tthis._getDescriptionMd();\n\t\t}\n\t\tif (this.value) {\n\t\t\treturn;\n\t\t}\n\t\t// If there is no description, give value a placeholder string\n\t\tthis.value = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t}\n\n\t_descriptionChanged() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tif (this.value !== description) {\n\t\t\tthis.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD] = this.value;\n\t\t}\n\t}\n\n\t_getDescriptionMd() {\n\t\tlet groupObjMd = this.editorModel.md.fieldsMap[this.groupModel.groupObjectName];\n\t\tthis.descriptionMd = groupObjMd[this.editorModel.constants.DESCRIPTION_FIELD];\n\t}\n\n\t_getSegmentKeys() {\n\t\treturn Object.keys(this.groupModel.segmentedLinesBySegmentKey);\n\t}\n\t\n\ttriggerCustomAction(e) {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: e.currentTarget.attributes.eventHandlerName.value},\n\t\t\tmodel: this.groupModel\n\t\t});\n\t}\n\n\t// Helper Functions\n\n\tshowGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('hidden', true, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', false, this.$$('#groupNameInput'));\n\t\tthis.$$('#groupNameInput').focus();\n\t\tthis.$$('#groupNameInput').setSelectionRange(0, this.groupModel.groupVO.record.Name.length);\n\t}\n\n\tcheckInputValue(e) {\n\t\te.stopPropagation();\n\t\tif (e.target.value != \"\") {\n\t\t\tthis.set('groupModel.groupVO.record.Name', e.target.value);\n\t\t}\n\t\tthis.toggleClass('hidden', false, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', true, this.$$('#groupNameInput'));\n\t}\n\n\tcloseGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (e.keyCode == '13') {\n\t\t\tthis.$$('#groupNameInput').blur();\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.groupModel.groupVO.record)\n\t\t\treturn;\n\n\t\tlet settings = this.groupModel.quoteModel.editorModel.data.settings;\n\t\tif (this.groupModel.quoteModel.grouped && settings.lineEditorGroupSubtotalsField != 'doNotDisplay' && ((this.groupModel.segmentedLines.length > 0 && this.groupModel._groupHasStandardProducts()) || (this.viewport && this.viewport.isMobile()) || this.groupModel.editorModel.largeQuoteExperienceEnabled)) {\n\t\t\tthis._getSubtotal(); // if subtotal is shown, set subtotal to the correct value\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tif (!this.groupModel.quoteModel.grouped) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorModel = this.groupModel.quoteModel.editorModel,\n\t\t\tsettings = editorModel.data.settings,\n\t\t\tpriceScale,\n\t\t\tsubtotal;\n\n\t\tlet subtotalField = settings.lineEditorGroupSubtotalsField;\n\t\t// Determine which Org Settings field to use for subtotals\n\t\tif (subtotalField == 'Default' || subtotalField == null) {\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.groupModel.quoteModel.quoteVO.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\tsubtotal = this.groupModel.groupVO.record[editorModel.constants.NET_TOTAL_FIELD] || 0;\n\t\t} else { // Custom subtotals field\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.groupModel.quoteModel.quoteVO.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][subtotalField].scale;\n\t\t\tsubtotal = this.groupModel.groupVO.record[settings.lineEditorGroupSubtotalsField] || 0; // If subtotalsField is not found, default to 0\n\t\t}\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.subtotal = subtotal;\n\t}\n\n\t_toggleGrouping(){\n\t\t// Necessary for IE to update when toggling between grouped and ungrouped\n\t\tthis.notifyPath('groupModel.quoteModel.grouped', this.groupModel.quoteModel.grouped);\n\t\tthis.set('groupClass', this.groupModel.quoteModel.grouped ? 'group' : 'virtualGroup');\n\t}\n\n\tbuildGroupTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForGroupLayout = [];\n\t\tif (this.editorModel.fieldsetMap.groupFieldNames.length > 0 && this._groupHasLineItems() && !this.editorModel.largeQuoteExperienceEnabled)\n\t\t\tnamesForGroupLayout.push('details');\n\t\tif (this.groupModel._groupHasSegmentedProducts())\n\t\t\tnamesForGroupLayout.push('segmented');\n\t\tif (this.groupModel._groupHasStandardProducts())\n\t\t\tnamesForGroupLayout.push('standard');\n\n\t\tlet tabs = [];\n\t\t// Used in sb-group-tabs to create mdq tabs\n\t\tthis.groupModel.groupMDQTabs = this.tabs;\n\n\t\tif (!this._renderTabs(namesForGroupLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#groupTabs')) {\n\t\t\tthis.$$('#groupTabs').destroyTabs();\n\t\t}\n\n\t\tfor (let i = 0, l = namesForGroupLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForGroupLayout[i];\n\n\t\t\ttabs.push({name: tId, label: tabName});\n\t\t}\n\t\tthis.groupLevelTabs = undefined;\n\t\tthis.bind = ['groupModel', 'editorModel'];\n\t\tthis.groupMDQTabs = this.groupModel.groupMDQTabs;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.groupLevelTabs = tabs;\n\t}\n\n\t_renderTabs(namesForGroupLayout) {\n\t\tif (this.groupLevelTabs.length !== namesForGroupLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModel.groupMDQTabs && this.groupMDQTabs.length !== this.groupModel.groupMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.groupLevelTabs.length; i < l; i++) {\n\t\t\tif (this.groupLevelTabs[i].label !== namesForGroupLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\texpandGroup(e) {\n\t\tif (!e.target.hasAttribute('triggersExpandGroup') || !this.isMobile || this.showSpinner){\n\t\t\treturn;\n\t\t}\n\n\t\t// if the mobile group tabs are rendered, then there should be no lag to show/hide the tabs, so a spinner shouldn't appear.\n\t\tif (!this.$$('#mobileGroupTabs')) {\n\t\t\tthis.showSpinner = true;\n\t\t}\n\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.set('groupModel.groupExpanded', !this.groupModel.groupExpanded);\n\t\t\tthis.groupExpanded = this.groupModel.groupExpanded;\n\t\t\t\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tthis.showSpinner = false;\n\t\t\t});\n\t\t});\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setIsButton();\n\t\tif (this.viewport && this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\trenderNewTab(e) {\n\t\tlet groupKey = e.detail.groupKey;\n\t\tif (groupKey === this.groupModel.groupKey) {\n\t\t\tthis._updatePageData();\n\t\t\tif (this.isMobile || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tthis.buildGroupTabs();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * @param {Object} e - event object\n\t * @private\n\t */\n\t_setUpgradeQuantity(e) {\n\t\tlet sourceIndex = e.detail.sourceIndex;\n\t\tlet upgradeIndex = e.detail.upgradeIndex;\n\t\tlet sourceLineVO = e.detail.sourceLineVO;\n\t\tlet upgradeLineVO = e.detail.upgradeLineVO;\n\n\t\tthis.debounce('Handle user input for automatic upgrade asset quantity changed', () => {\n\t\t\tif (sourceLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex, sourceLineVO, true);\n\t\t\t} else if (upgradeLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(upgradeIndex, sourceIndex, upgradeLineVO, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex);\n\t\t\t}\n\t\t\tsourceLineVO.invalidQuantity = null;\n\t\t\tupgradeLineVO.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * Fires validate-quantity-changed event listened for in LineEditor.js for use of toast\n\t * @param {Number} index1 - index to update for either the source or upgrade\n\t * @param {Number} index2 - index to update for the opposite of index1\n\t * @param {Object} lineVO - either the source or upgrade lineVO containing the record to be updated\n\t * @param {Boolean} invalidQuantity - flag for whether the user entered an invalidQuantity or not, added to avoid case where invalidQuantity is set to a number that evaluates to truthy\n\t */\n\t_notifyQuantityChanged(index1, index2, lineVO, invalidQuantity) {\n\t\tlet invalidQuantityCheck;\n\t\tlet validQuantityCheck;\n\t\tthis.groupModel.standardLines[index1].internalUpdate = true;\n\t\tthis.groupModel.standardLines[index2].internalUpdate = true;\n\n\t\t// Adds boolean check for invalidQuantity in case invalidQuantity is set to a number that evaluates to truthy\n\t\tif (invalidQuantity) {\n\t\t\tinvalidQuantityCheck = lineVO.invalidQuantity;\n\t\t\tvalidQuantityCheck = lineVO.validQuantity;\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.invalidQuantity;\n\t\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index1].internalUpdate = false;\n\t\tthis.notifyPath(`groupModel.standardLines.${index2}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index2].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index2].internalUpdate = false;\n\n\t\t// Event must be at end of function and gets called in invalidQuantity on lineVO\n\t\tthis.fire('validate-quantity-changed', {\n\t\t\tinvalidQuantity: invalidQuantityCheck,\n\t\t\tvalidQuantity: validQuantityCheck\n\t\t});\n\t}\n\n\taddSegmentedLineToEmptyTable(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tif (!this.groupModel.hasVisibleSegmentedLines) {\n\t\t\tthis.groupModel.hasVisibleSegmentedLines = {};\n\t\t}\n\n\t\t//Create all segment tabs to allow for drag and dropping on all segments\n\n\t\tthis.groupModel.setDimensionProperties(dimension);\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t// Update multisegment columns to render the row properly, using the column data on quote since it will still be there\n\t\tthis.groupModel.groupVO.multiSegmentColumns[dimension] = lineModel.editorModel.data.quote.multiSegmentColumns[dimension];\n\t\tthis.groupModel.groupVO.localizedMultiSegmentColumns[dimension] = lineModel.editorModel.data.quote.localizedMultiSegmentColumns[dimension];\n\t\tthis.groupModel.colWidth[dimension] = lineModel.groupModel.colWidth[dimension];\n\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\t\t// Rebuild Tabs\n\t\tthis._updatePageData();\n\t}\n\n\taddSegmentedLineToExistingTab(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\n\t}\n\n\t// Removes segmented line from previous group\n\tremoveSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.groupModel.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.groupModel.quoteVO.multiSegmentKeys) ? this.groupModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tthis.groupModel.segmentedLines.splice(this.groupModel.segmentedLines.indexOf(lineModel), 1);\n\t\tdelete this.groupModel.segmentedLinesBySegmentKey[segmentKey];\n\t\tthis.splice(`groupModel.segmentedLinesByDimension.${dimension}`, this.groupModel.segmentedLinesByDimension[dimension].indexOf(lineModel), 1);\n\t\tif (this.groupModel.segmentedLinesByDimension[dimension].length === 0) {\n\t\t\tthis.groupModel.removeDimensionProperties(dimension);\n\t\t\tdelete this.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t\tdelete this.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t\t// Rebuild Tabs\n\t\t\tthis._updatePageData();\n\t\t}\n\t}\n\n\t_onTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tthis.dragDrop.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tthis.linesByParentKey = this.editorModel.quoteModel.linesByParentItemKey;\n\t\tthis.indexByGroupKey = this.groupModel.quoteModel.indexByGroupKey;\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\t\tthis.dragDrop.dragLineModel = [];\n\t\tthis.dragDrop.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tthis.dragDrop.dragKey = dragElement.lineModel.lineVO.key;\n\t\tthis.dragDrop.dragLineModel = dragElement.lineModel;\n\t\tthis.dragDrop.segment = dragElement.domHost.dimension;\n\t\tthis.dragDrop.dragIndex = this.groupModel.segmentedLinesByDimension[this.dragDrop.segment].indexOf(dragElement.lineModel);\n\n\t\t//Toggle true the 'hidden' attribute to hide rows being dragged from page.\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dragDrop.segment}.${this.dragDrop.dragIndex}.hidden`, true);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) return;\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.getAttribute('ref') === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tswitch(dd.targetClass) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tdd._updateMDQTableRowHoverOverObject(dd.sourceElement, hoverElement);\n\t\t\t\tif (!dd.hoverOver) return;\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = false;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (dd.keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (dd.keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tthis.dragDrop.dropKey = null;\n\t\tthis.dragDrop.dropIndex = null;\n\t\tthis.dragDrop.dropGroupModel = null;\n\t\tlet segment = this.dragDrop.segment,\n\t\t\tdropLeGroup,\n\t\t\tdropSegLinesTable,\n\t\t\tdragLineModel = this.dragDrop.dragLineModel;\n\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${segment}.${this.dragDrop.dragIndex}.hidden`, false);\n\n\t\tif (!dropElement) return;\n\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\tthis.dragDrop.dragGroupModel._updateSegmentedSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tdragElement.domHost.fieldNames = dragElement.domHost._getFields();\n\t\t\tdragElement.domHost._setColumnWidths();\n\t\t}\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tlet dropGroupModel = dropElement.lineModel.groupModel;\n\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost.domHost;\n\t\t\t\tdropSegLinesTable = dropElement.domHost;\n\n\t\t\t\tthis.dragDrop.dropGroupModel = dropGroupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\t\t\t\t//Get index of where drop will occur on array of segmentedLinesByDimension after line has been spliced\n\t\t\t\t//from it's original groupModel.\n\t\t\t\tlet dropIndex = dropGroupModel.segmentedLinesByDimension[segment].indexOf(dropElement.lineModel);\n\t\t\t\t//Adjust index of drop depending on whether it's dropped before or after.\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdropIndex = dropIndex >= 0 ? dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dropIndex;\n\t\t\t\t}\n\t\t\t\t//Update relevant lineModel properties to maintain it's group information\n\t\t\t\tdragLineModel.groupModel = dropGroupModel;\n\t\t\t\tdragLineModel.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\tdragLineModel.segments.forEach(function(seg){\n\t\t\t\t\tseg.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\t\tseg.groupModel = dropGroupModel;\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\t//Splice line into it's new position/group.\n\t\t\t\tdropLeGroup.splice(`groupModel.segmentedLinesByDimension.${segment}`, dropIndex, 0, dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\tcase 'emptyTableMessage':\n\t\t\t\tdropLeGroup = Polymer.dom(dropElement).getOwnerRoot().host;\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = this.dragDrop._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\n\t\t\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\n\t\t\t\tif (!this.dragDrop.dropGroupModel.dimensions.includes(this.dragDrop.segment)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dragLineModel);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (className === 'sb-droppable-mdqRows') {\n\t\t\tlet model = dropLeGroup.groupModel.segmentedLinesByDimension[segment];\n\t\t\tdropElement.domHost.notifyPath(`groupModel.segmentedLinesByDimension.${segment}`, model.slice());\n\t\t\tdropElement.domHost.notifyPath('lineModels', model.slice());\n\t\t}\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t\t// post drop refreshing\n\t\tvar dragTable = dragElement.domHost;\n\t\tvar dropTable = dropElement.domHost;\n\t\tif (dragTable && dragTable.tagName === 'SF-SEGMENTED-TABLE') {\n\t\t\tdragTable._prepareUIData();\n\t\t}\n\t\tif (dropTable && dropTable.tagName === 'SF-SEGMENTED-TABLE' && dragTable !== dropTable) {\n\t\t\tdropTable._prepareUIData();\n\t\t}\n\t}\n\n\t_groupCustomActionsChanged(e) {\n\t\tlet l = e ? e.length : 0;\n\t\tfor(let i = 0; i < l; i++)\n\t\t\tthis.notifyPath(`editorModel.groupCustomActions.${i}.children`);\n\t}\n}\n\nPolymer( LEGroup );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {removeTopBottomBorderClass} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\n\nexport class LEGroupLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group-layout';\n\t\tthis.properties = {\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlayoutLink: String,\n\t\t\tlayoutWidth: Number,\n\t\t\tlayoutLeft: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '24px'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tlastSelectedGroup: Object,\n\t\t\tselectedGroupKey: { /* Selected group's key in Single Group View (Large Quote Experience)*/\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\teditorModel: Object,\n\t\t};\n\t}\n\n\tget listeners() {\n\t\treturn {'side-toggle-clicked' : 'toggle'};\n\t}\n\n\tget observers() {\n\t\treturn ['_groupModelsAreChanged(editorModel, groupModels, rightSideButton)', '_spliceObserver(groupModels.splices)', '_createDragDropModel(groupModels)'];\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis._resize = function() {\n\t\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\t\tthis.buildLayout();\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\t\tthis.fire('iron-signal', {name: 'col-widths-changed', data: {layout: this.editorModel.layout, groupKey: this.selectedGroupKey}});\n\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t}.bind(this);\n\t\t\twindow.addEventListener('resize', this._resize);\n\t\t});\n\t}\n\n\tdetached() {\n\t\twindow.removeEventListener('resize', this._resize);\n\t}\n\n\tget isMobile() {\n\t\treturn this.editorModel.deviceContext.isMobile;\n\t}\n\n\t_spliceObserver(splicedRecords) {\n\t\tif (!splicedRecords || splicedRecords.indexSplices[0].addedCount == 0)\n\t\t\treturn;\n\t\tthis.addedIndex = splicedRecords.indexSplices[0].index;\n\t\tthis.addedKey = splicedRecords.indexSplices[0].object[this.addedIndex].groupVO.key;\n\t\tif (!this.observersAttached) {\n\t\t\tthis._attachObservers();\n\t\t}\n\t}\n\n\t/**\n\t * Assigns 'hiddenGroup' class to groups that are not displayed in Single Group View.\n\t * Only the selected group gets flex:1 css property so that it fills the entire screen.\n\t * @param groupKey\n\t * @returns {}\n\t */\n\tgetGroupClass(groupKey) {\n\t\tif (!this.editorModel) {\n\t\t\treturn;\n\t\t}\n\t\tlet groupClass = '';\n\t\tif (this.selectedGroupKey != groupKey) {\n\t\t\tgroupClass += 'hiddenGroup';\n\t\t}\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tgroupClass += ' largeQuote';\n\t\t}\n\t\treturn groupClass;\n\t}\n\n\tgetContainerClass() {\n\t\treturn this.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\t}\n\n\ttoggle() {\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.closePanel();\n\t\t} else {\n\t\t\tthis.openPanel();\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.fire('iron-signal', {name: 'group-panel-toggled', data: {drawerState: this.drawerState, groupKey: this.selectedGroupKey}});\n\t\t});\n\t}\n\n\topenPanel() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.$.drawerPanel.style.left = '0px';\n\t\t\tthis.$.mainPanel.style.paddingLeft = '280px';\n\t\t} else {\n\t\t\tthis.$.drawerPanel.style.display = 'block';\n\t\t}\n\t\tthis.drawerState = 'open';\n\t}\n\n\tclosePanel() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.$.drawerPanel.style.left = '-256px';\n\t\t} else {\n\t\t\tthis.$.drawerPanel.style.display = 'none';\n\t\t}\n\t\tthis.$.mainPanel.style.paddingLeft = !this.isMobile && this.rightSideButton ? '24px' : '0px';\n\t\tthis.drawerState = 'closed';\n\t}\n\n\tgroupPanelCreated() {\n\t\tif (!this.isMobile) {\n\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\tthis.buildLayout();\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tthis.fire('iron-signal', {name: 'col-widths-changed', data: {layout: this.editorModel.layout}});\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\t/**\n\t * Catches groupAdded event fired from LECustoActionServices when a new group is added to the quote and navigates to the new group\n\t * @param e\n\t */\n\tgroupAdded(e) {\n\t\tthis.navTo(e);\n\t}\n\n\t/**\n\t * Catches groupDeleted event fired from LECustoActionServices when a group is deleted from the quote and navigates to the first group\n\t * @param e\n\t */\n\tgroupDeleted(e) {\n\t\tthis.navTo(e);\n\t}\n\n\t/**\n\t * Catches pageResized event from the line editor when quote details section is toggled. Fires 2 events:\n\t * iron-list-resized: to adjust for the height update on the page\n\t * col-widths-changed: to adjust for the width update on the screen\n\t */\n\tpageResized(e) {\n\t\t// adjust columnWidths as total width on the screen might have changed with the full screen\n\t\tif (e.detail.isFullScreenToggleEvent) {\n\t\t\tthis.buildLayout();\n\t\t\tthis.fire('iron-signal', {name: 'col-widths-changed', data: {layout: this.editorModel.layout, groupKey: this.selectedGroupKey}});\n\t\t}\n\t}\n\n\t_groupModelsAreChanged() {\n\t\t// Set default drawer state and position\n\t\tif (!this.drawerState) {\n\t\t\tthis.closePanel();\n\t\t} else if (this.drawerState == \"closed\") {\n\t\t\t// Necessary when adding or removing the second group\n\t\t\tthis.$.mainPanel.style.paddingLeft = !this.isMobile && this.rightSideButton ? '24px' : '0px';\n\t\t}\n\n\t\tthis.buildLayout();\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tif (!this.observersAttached)\n\t\t\t\tthis._attachObservers();\n\t\t});\n\t}\n\n\tbuildLayout(event) {\n\t\tif (this.isMobile) return;\n\t\tlet group = event ? event.detail.group : null;\n\t\tlet layout = {},\n\t\t\tmd = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],\n\t\t\tactionsOnTheLeft = this.editorModel.actionsOnTheLeft,\n\t\t\tmultiDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled,\n\t\t\thasLines = this.editorModel.quoteModel.quoteVO.lineItems.length > 0,\n\t\t\thasStandardDrawer = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0;\n\t\tlayout.totalWidth = hasLines ? this._getMaxTableWidth(this._getAvailableWidth(), md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer) : this._getAvailableWidth();\n\t\t// Update layout for a single group\n\t\tif (group) {\n\t\t\tgroup.colWidth = this._calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, group, hasStandardDrawer);\n\t\t} else {\n\t\t\tthis.editorModel.quoteModel.lineGroups.forEach((groupModel) => {\n\t\t\t\tgroupModel.colWidth = this._calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, groupModel, hasStandardDrawer);\n\t\t\t});\n\t\t\tthis.set('editorModel.layout', layout);\n\t\t}\n\t}\n\n\t_getAvailableWidth() {\n\t\tlet pageContainer = document.getElementById('sbPageContainer');\n\t\t// return early for tests to not fail as there is no pageContainer\n\t\tif (!pageContainer) return;\n\t\tlet availableWidth = Polymer.dom(pageContainer.root).querySelector('sb-line-editor').clientWidth;\n\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tavailableWidth -= 30 + 2; // group padding and borders\n\t\t\tif (this.editorModel.quoteModel.lineGroups.length > 1) {\n\t\t\t\tavailableWidth -= 24; //closed side panel width\n\t\t\t\tif (this.drawerState && this.drawerState == 'open') {\n\t\t\t\t\tavailableWidth -= 256; // expanded side panel width\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn availableWidth;\n\t}\n\n\t_getMaxTableWidth(availableWidth, md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer) {\n\n\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, this._getQuoteStandardFields(), md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer);\n\t\tthis.tableLayoutBuilder.build();\n\t\tlet maxWidth = this.tableLayoutBuilder.getTotalWidth();\n\n\t\tlet cols = this.editorModel.quoteModel.quoteVO.multiSegmentColumns,\n\t\t\tmultiSegmentFieldNames = this._getQuoteSegmentedFields();\n\t\tfor (let dimension in cols) {\n\t\t\tif (!cols.hasOwnProperty(dimension)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet fieldNames = multiSegmentFieldNames.concat(cols[dimension]).concat('total');\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, fieldNames, md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer);\n\t\t\tthis.tableLayoutBuilder.build();\n\t\t\tlet totalWidth = this.tableLayoutBuilder.getTotalWidth();\n\t\t\tif (totalWidth > maxWidth) {\n\t\t\t\tmaxWidth = totalWidth;\n\t\t\t}\n\t\t}\n\t\treturn maxWidth;\n\t}\n\n\t_calculateGroupWidth(layout, md, actionsOnTheLeft, multiDeleteEnabled, groupModel, hasStandardDrawer) {\n\t\tlet groupKey = groupModel.groupKey,\n\t\t\tcols = groupModel.quoteModel.grouped ? groupModel.groupVO.multiSegmentColumns : groupModel.quoteModel.quoteVO.multiSegmentColumns,\n\t\t\tgroupLayout = {};\n\n\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getGroupStandardFields(groupKey), md, actionsOnTheLeft, multiDeleteEnabled, hasStandardDrawer);\n\t\tgroupLayout['Standard'] = this.tableLayoutBuilder.build();\n\t\tlayout.leftOffset = this.tableLayoutBuilder.getLeftOffset();\n\n\t\tfor (let dim in cols) {\n\t\t\tif (!cols.hasOwnProperty(dim)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getSegmentedFieldNames(groupModel, cols[dim]), md, actionsOnTheLeft, multiDeleteEnabled, false);\n\t\t\tgroupLayout[dim] = this.tableLayoutBuilder.build();\n\t\t}\n\n\t\treturn groupLayout;\n\t}\n\n\t_getQuoteStandardFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].standardSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this._getStandardFields(subsScope);\n\t}\n\n\t_getGroupStandardFields(groupKey) {\n\t\tlet group = this.editorModel.quoteModel.groupsByKey[groupKey];\n\t\treturn this._getStandardFields(group.standardSubscriptionScopeEditable);\n\t}\n\n\t_getStandardFields(subsScope) {\n\t\tlet fields = this.editorModel.fieldsetMap.lineFieldNames;\n\t\tif (subsScope) {\n\t\t\tfields = [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields);\n\t\t}\n\t\treturn fields;\n\t}\n\n\t_getQuoteSegmentedFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].segmentedSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tlet multiSegmentSummaryFieldNames = this.editorModel.data.multiSegmentLineSummaryFieldNames;\n\t\treturn subsScope ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(multiSegmentSummaryFieldNames) : multiSegmentSummaryFieldNames;\n\t}\n\n\t_getSegmentedFieldNames(groupModel, colNames) {\n\t\tlet summaryFields = this.editorModel.data.multiSegmentLineSummaryFieldNames,\n\t\t\tfieldNames = groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(summaryFields) : summaryFields.slice();\n\t\tfor (let i = 0, len = colNames.length; i < len; i++) {\n\t\t\tfieldNames.push(colNames[i].replace(/\\W/g, ''));\n\t\t}\n\t\tfieldNames.push('total');\n\t\treturn fieldNames;\n\t}\n\n\t_attachObservers() {\n\t\tif (this.rightSideButton || (this.isMobile)) {\n\t\t\tthis.observersAttached = true;\n\t\t\t// Observe child nodes to see when a group is added or removed\n\t\t\tthis._observeNodes = Polymer.dom(this.$$('#groups')).observeNodes(function (info) {\n\t\t\t\tlet addedNodes = info.addedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\" && node.groupModel.groupVO.key == this.addedKey)\n\t\t\t\t}.bind(this));\n\t\t\t\tlet removedNodes = info.removedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\")\n\t\t\t\t});\n\t\t\t\tif (addedNodes[0] === removedNodes[0]) return;\n\t\t\t\tthis.processNewGroups(addedNodes);\n\t\t\t\tthis.processRemovedGroups(removedNodes);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tprocessNewGroups(addedNodes) {\n\t\tif (this.addedKey && addedNodes.length > 0) {\n\t\t\t// Only runs this code if add group is clicked\n\t\t\tlet groupKey = this.addedKey;\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.closePanel();\n\t\t\t}\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\tPolymer.dom(this.$$('#groups')).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t\tthis.addedKey = null;\n\t\t}\n\t}\n\n\tprocessRemovedGroups(removedNodes) {\n\t\tif (this.lastSelectedGroup && removedNodes.length == 1) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t\tthis.lastSelectedGroup = undefined;\n\t\t\tPolymer.dom(this.$$('#groups')).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t}\n\t}\n\n\ttoggleSelectedAndScroll(key) {\n\t\tlet groupElement = this.$$('#_' + key);\n\t\tif (this.lastSelectedGroup) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t}\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.toggleClass('selected-tab', true, groupElement);\n\t\t\tthis.lastSelectedGroup = groupElement;\n\t\t}\n\t\tif (!this.$$('#Group_' + key))\n\t\t\treturn;\n\t\tthis._scrollIntoView(this.$$('#Group_' + key));\n\t\tthis.$$('#_' + key).scrollIntoView(false);\n\t\tif (this.isMobile) {\n\t\t\tthis.$$('#Group_' + key).set('groupModel.groupExpanded', true);\n\t\t\tthis.$$('#Group_' + key).groupExpanded = true;\n\t\t}\n\t}\n\n\t_scrollIntoView(target) {\n\t\tthis.$$('#mainPanel').scrollTop = this.isMobile ? target.offsetTop : target.offsetTop - 15;\n\t}\n\n\tnavTo(e) {\n\t\te.stopPropagation();\n\n\t\tif (this.isMobile) {\n\t\t\tvar loadingSpinner = e.target.querySelector('.loadingSpinner');\n\t\t\tloadingSpinner.toggleClass('invisible', false);\n\t\t}\n\t\t\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tlet groupKey = e.detail.groupKey || Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\t// update selectedGroupKey for large quotes (Single Group VIew)\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tlet prevGroupKey = this.selectedGroupKey,\n\t\t\t\t\tcurrentGroupKey = parseInt(groupKey);\n\t\t\t\tthis.set('selectedGroupKey', currentGroupKey);\n\t\t\t\tif (currentGroupKey != prevGroupKey) {\n\t\t\t\t\tthis.fire('iron-signal', {name:'group-toggled', data: {groupKey: this.selectedGroupKey}})\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.isMobile){\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tloadingSpinner.toggleClass('invisible', true);\n\t\t\t\t});\n\t\t\t\tthis.toggle();\n\t\t\t}\n\t\t});\n\t}\n\n\t_createDragDropModel() {\n\t\t// No editorModel means not mobile.\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet validTargets = new Set(['sb-droppable-sidePanelGroups']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'div', validTargets,\n\t\t\tthis.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\tonTrack(e) {\n\t\tif (this.isMobile || !AppContext.isDesktop || this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tlet dd = this.dragDrop;\n\t\tdd.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tdd.dragIndex = dragElement.dataIndex;\n\t\tdd.dragGroupModel = this.groupModels[dd.dragIndex];\n\t\tlet groupLayout = this.$$('#groupLayout');\n\t\tthis.toggleAttribute('hidden', true, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = this.dragDrop._findSidePanelGroupValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.ref === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tdd.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\tdd.targetHost = this;\n\t\tdd.highlightableElements = [];\n\t\tdd.highlightableElements.push(dd.hoverOver.comp); // Get the exact element whose border can be highlighted based on path from hoverOver\n\t\tdd.usePlaceholder = true;\n\t\tdd.enableHighLight = false;\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dd = this.dragDrop;\n\t\tthis.toggleAttribute('hidden', false, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);   // Unhide the drag element\n\t\tif (!dropElement) {return;}     // Return early if dropElement does not exist\n\t\tlet sideGrp = this.$.sbDroppableSidePanelGroups;\n\t\tlet maxIndex = sideGrp.querySelectorAll('.nav-item').length - 1;\n\n\t\tdd.dropIndex = dropElement.dataIndex;\n\t\tif (dropElementBefore){\n\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t} else{\n\t\t\t++dd.dropIndex;\n\t\t}\n\n\t\tremoveTopBottomBorderClass(dropElement);    // Remove highlighting if any on the drop element\n\t\tthis.splice('groupModels', dd.dragIndex, 1);\n\t\tif (dd.dropIndex < maxIndex){\n\t\t\tthis.splice('groupModels', dd.dropIndex, 0, dd.dragGroupModel);\n\t\t} else {\n\t\t\tthis.push('groupModels', dd.dragGroupModel);\n\t\t}\n\n\t\tdd.lineEditor.renumber();\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tdd.lineEditor.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n}\n\nPolymer(LEGroupLayout);\n","import {registerComponent} from 'quotes/models/UiNotifier.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class LEList {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list';\n\n\t\tthis.properties = {\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t};\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this);\n\t\tsetTimeout(this._ironListResize.bind(this), 100);\n\t}\n\n\tready() {\n\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\tthis.ironList = this.$$('iron-list');\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.$$('iron-list').items.length + 10 - idx;\n\t}\n\n\t/**\n\t * LEGroupLayout.js has fired the 'col-widths-changed' event, which means that the page has been resized\n\t * As a result, the iron-list needs to be resized as well - previously this done by StandardLines.js and SegmentedLines.js.\n\t */\n\tcolWidthsChanged() {\n\t\tthis._ironListResize();\n\t}\n\n\t_ironListResize() {\n\t\tthis.$$('iron-list').fire('iron-resize');\n\t}\n}\n\nPolymer( LEList );\n","export class LEListGroupFooterRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-group-footer-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object\n\t\t};\n\t}\n}\n\nPolymer( LEListGroupFooterRow );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class LEListGroupHeaderRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-group-header-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object, /* GroupModel */\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: Number,\n\t\t\tsubtotalMd: Object,\n\t\t\t/** Description, labeled value to interact properly with sb-field */\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_descriptionChanged'\n\t\t\t},\n\t\t\tdescriptionMd: Object,\n\t\t\tfavorited: Boolean,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\tisStandard: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(model)',\n\t\t\t'_groupCustomActionsChanged(editorModel.groupCustomActions)',\n\t\t\t'_groupRecordChanged(model.groupVO.record.*)'\n\t\t]\n\t}\n\n\t_showTabs(tabs) {\n\t\treturn tabs && tabs.length > 0;\n\t}\n\n\t_buildRow() {\n\t\tthis.editorModel = this.model.quoteModel.editorModel;\n\t\tthis.isStandard = this.model.lineType === 'Standard' && this.model.standardLines.length > 0; // Ensures no standard row header is built for empty group\n\n\t\tthis._setSubtotal();\n\t\tthis._setGroupDescription();\n\n\t\tif (this.isStandard) {\n\t\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\t\tthis.settings = this.editorModel.data.settings;\n\t\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\t\tthis._setFieldNames();\n\t\t\t// Column names is only populated when there are segmented lines\n\t\t\tthis.columnNames = null;\n\t\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\t\tthis.columnWidths = {};\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this.getFields();\n\t}\n\n\tgetFields() {\n\t\treturn this.model.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tthis.columnWidths = this.model.standardLineColumnWidths;\n\t}\n\n\tgetStandardColWidths() {\n\t\treturn this.editorModel.deviceContext.isMobile || !this.editorModel.layout ? undefined\n\t\t\t: this.model.colWidth.Standard;\n\t}\n\n\t_groupRecordChanged() {\n\t\tlet groupRecord = this.model.groupVO.record;\n\t\tthis.favorited = !!(groupRecord && groupRecord[this.editorModel.constants.FAVORITE_ID_FIELD]);\n\t}\n\n\t// Helper Functions\n\n\tshowGroupNameEditor(e) {\n\t\te.stopPropagation();\n\n\t\tthis.toggleClass('hidden', true, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', false, this.$$('#groupNameInput'));\n\t\tthis.$$('#groupNameInput').focus();\n\t\tthis.$$('#groupNameInput').setSelectionRange(0, this.model.groupVO.record.Name.length);\n\t}\n\n\tcheckInputValue(e) {\n\t\te.stopPropagation();\n\t\tif (e.target.value != \"\") {\n\t\t\tthis.set('model.groupVO.record.Name', e.target.value);\n\t\t}\n\t\tthis.toggleClass('hidden', false, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', true, this.$$('#groupNameInput'));\n\t}\n\n\tcloseGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (e.keyCode == '13') {\n\t\t\tthis.$$('#groupNameInput').blur();\n\t\t}\n\t}\n\n\ttriggerCustomAction(e) {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: e.currentTarget.attributes.eventHandlerName.value},\n\t\t\tmodel: this.model\n\t\t});\n\t}\n\n\t_setSubtotal() {\n\t\tif (!this.model.quoteModel.grouped) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet settings = this.editorModel.data.settings,\n\t\t\tpriceScale,\n\t\t\tsubtotal;\n\n\t\tlet subtotalField = settings.lineEditorGroupSubtotalsField;\n\t\t// Determine which Org Settings field to use for subtotals\n\t\tif (subtotalField == 'Default' || subtotalField == null) {\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.model.quoteModel.quoteVO.currencyDecimalScale : this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\tsubtotal = this.model.groupVO.record[this.editorModel.constants.NET_TOTAL_FIELD] || 0;\n\t\t} else { // Custom subtotals field\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? this.model.quoteModel.quoteVO.currencyDecimalScale : this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][subtotalField].scale;\n\t\t\tsubtotal = this.model.groupVO.record[settings.lineEditorGroupSubtotalsField] || 0; // If subtotalsField is not found, default to 0\n\t\t}\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.model.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.subtotal = subtotal;\n\t}\n\n\t_setGroupDescription() {\n\t\tif (!this.model.groupVO.record) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.value = this.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tif (this.model && this.editorModel.md) {\n\t\t\tlet groupObjMd = this.editorModel.md.fieldsMap[this.model.groupObjectName];\n\t\t\tthis.descriptionMd = groupObjMd[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\t}\n\t\tif (this.value) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If there is no description, give value a placeholder string\n\t\tthis.value = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t}\n\n\t_descriptionChanged() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tif (this.value !== description) {\n\t\t\tthis.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD] = this.value;\n\t\t}\n\t}\n\n\t_getRecordValue(fieldName) {\n\t\treturn this.model.groupVO.record[fieldName];\n\t}\n\n\t_groupCustomActionsChanged(e) {\n\t\tlet l = e ? e.length : 0;\n\t\tfor(let i = 0; i < l; i++)\n\t\t\tthis.notifyPath(`editorModel.groupCustomActions.${i}.children`);\n\t}\n}\n\nPolymer( LEListGroupHeaderRow );\n","import {registerComponent} from 'quotes/models/UiNotifier.js';\n\nconst factoryMap = {\n\tGroupModel: {\n\t\tGROUP_HEADER: \"sb-le-list-group-header-row\",\n\t\tGROUP_FOOTER: \"sb-le-list-group-footer-row\",\n\t},\n\tLineModel: {\n\t\tSTANDARD_LINE: \"sb-le-list-standard-line-row\",\n\t\tSEGMENTED_LINE: \"sb-le-list-segmented-line-row\",\n\t},\n}\n\nexport class LEListRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-row';\n\n\t\tthis.properties = {\n\t\t\trowType: String,\n\t\t\tmodel: Object,\n\t\t\tindex: Number,\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_dataChanged(rowType, model, index)',\n\t\t]\n\t}\n\n\t_dataChanged(rowType, model, index) {\n\t\tconst wrapper = this.$.wrapper;\n\t\tconst targetName = factoryMap[model.constructor.name][rowType];\n\t\tconst currentEl = wrapper.children[0];\n\t\tlet targetEl = currentEl;\n\t\tif (currentEl && currentEl.localName === targetName) {\n\t\t\tcurrentEl.set('model', model);\n\t\t} else {\n\t\t\tif (currentEl) {\n\t\t\t\twrapper.removeChild(currentEl);\n\t\t\t}\n\t\t\ttargetEl = document.createElement(targetName);\n\t\t\ttargetEl.model = model;\n\t\t\ttargetEl.index = index;\n\t\t\twrapper.appendChild(targetEl);\n\t\t}\n\t\tregisterComponent(this);\n\t\tregisterComponent(targetEl);\n\t}\n}\n\nPolymer( LEListRow );\n","export class LEListSegmentedLineRow {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-segmented-line-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object\n\t\t};\n\t}\n\n}\n\nPolymer( LEListSegmentedLineRow );\n","export class LEListStandardLineRow {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-list-standard-line-row';\n\n\t\tthis.properties = {\n\t\t\tmodel: Object, /* LineModel */\n\t\t\tindex: Number,\n\t\t};\n\t}\n}\n\nPolymer( LEListStandardLineRow );\n","/**\n * A table row meant for displaying summary data.\n */\nexport class LESummaryRow {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-row';\n\t\tthis.properties = {\n\t\t\t// The model where all the data *should* belong.\n\t\t\tmodel: { type: Object, observer: '_modelChanged' },\n\n\t\t\t// The fields to display summaries for.\n\t\t\tfieldNames: Array,\n\n\t\t\t// The summaries for the table.\n\t\t\tsummaries: Object,\n\t\t};\n\t}\n\n\t_modelChanged(model) {\n\t\tthis.toggleClass('largeQuote', model.editorModel.largeQuoteExperienceEnabled, this.$.container);\n\t}\n\n\t_colWidthsChanged(e) {\n\t\tthis.notifyPath('model');\n\t}\n}\n\nPolymer( LESummaryRow );\n","import {setThenNotify} from 'quotes/models/UiNotifier.js';\n\nexport function getUnitAndDisplayValue(model, item) {\n\tif (isAdditionalDiscountField(model, item)) {\n\t\tconst units = model.editorModel.data.additionalDiscountUnitOptions;\n\t\treturn (model.lineVO.targetCustomerAmount !== null && model.lineVO.targetCustomerAmount !== undefined)\n\t\t\t\t? { units, unit: 'UnitOverride', displayValue: model.lineVO.targetCustomerAmount }\n\t\t\t: (model.lineVO.targetCustomerTotal !== null && model.lineVO.targetCustomerTotal !== undefined)\n\t\t\t\t? { units, unit: 'TotalOverride', displayValue: model.lineVO.targetCustomerTotal }\n\t\t\t: model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) != null\n\t\t\t\t? { units, unit: 'Amount', displayValue: model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) }\n\t\t\t: model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) != null\n\t\t\t\t? { units, unit: 'Percent', displayValue: model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) }\n\t\t\t: { units, unit: model.editorModel.data.defaultAdditionalDiscountUnit.replace(/ /g,''), displayValue: null }\n\t} else {\n\t\tconst units = model.editorModel.data.markupUnitOptions;\n\t\treturn model.getField(model.constants.MARKUP_AMOUNT_FIELD) != null\n\t\t\t\t? { units, unit: 'Amount', displayValue: model.getField(model.constants.MARKUP_AMOUNT_FIELD) }\n\t\t\t: model.getField(model.constants.MARKUP_RATE_FIELD) != null\n\t\t\t\t? { units, unit: 'Percent', displayValue: model.getField(model.constants.MARKUP_RATE_FIELD) }\n\t\t\t: { units, unit: model.editorModel.data.defaultMarkupUnit.replace(/ /g,''), displayValue: null }\n\t}\n}\n\nexport function updateUnitIfAmountInactive(model, fieldName) {\n\tlet { units, unit, displayValue } = getUnitAndDisplayValue(model, fieldName);\n\t// We need to see if amount is even activated as units\n\tif (model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) && !units.some((u) => u.value ==='Amount')) {\n\t\tlet nextActiveUnitValue = model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)\n\t\t&& units.some((u) => u.value === 'Percent')\n\t\t\t? 'Percent' : units[0].value;\n\n\t\tconvertDiscountValue(model, fieldName, nextActiveUnitValue);\n\t}\n}\n\nexport function setDiscountValue(model, item, value) {\n\tlet { unit, displayValue } = getUnitAndDisplayValue(model, item);\n\tconst record = model.lineVO.record;\n\tlet setAdditionalDiscountValues = () => {\n\t\tif (unit === 'Percent') {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = value;\n\t\t} else if (unit === 'Amount') {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = value;\n\t\t} else if (unit === 'UnitOverride') {\n\t\t\tmodel.lineVO.targetCustomerAmount = value;\n\t\t} else if (unit === 'TotalOverride') {\n\t\t\tmodel.lineVO.targetCustomerTotal = value;\n\t\t}\n\t\tdisplayValue = getUnproratedDiscount(model)/(model.lineVO.amountDiscountProrated ? record[model.constants.PRORATE_MULTIPLIER_FIELD] : 1);\n\t}\n\tlet setMarkupValues = () => {\n\t\tif (unit === 'Percent') {\n\t\t\trecord[model.constants.MARKUP_RATE_FIELD] = value;\n\t\t} else if (unit === 'Amount') {\n\t\t\trecord[model.constants.MARKUP_AMOUNT_FIELD] = value;\n\t\t}\n\t\tdisplayValue = record[model.constants.MARKUP_AMOUNT_FIELD] || (record[model.constants.UNIT_COST_FIELD] ? record[model.constants.UNIT_COST_FIELD] * value / 100 : null);\n\t}\n\n\tif (isAdditionalDiscountField(model, item)){\n\t\tsetAdditionalDiscountValues();\n\t} else {\n\t\tsetMarkupValues();\n\t}\n\n\t// if value is not a number, then simply set it to zero\n\tsetThenNotify(model, ['lineVO', 'record', model.constants.ADDITIONAL_DISCOUNT_FIELD], isNaN(displayValue) ? 0 : displayValue);\n}\n\nfunction getUnproratedDiscount(model) {\n\tlet price = model.getField(model.constants.REGULAR_PRICE_FIELD);\n\t// The raw discount is calculated directly from the relevant discount field, and may need to be changed to undo\n\t// proration effects\n\tlet rawDiscount;\n\t// Modifier is what we need to multiply the raw discount by to get the true discount. Under normal use cases, it should be 1,\n\t// but it can be other values if we need to un-prorate the discount\n\tlet modifier;\n\tif (model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)) {\n\t\trawDiscount = price * (model.getField(model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD) / 100);\n\t\t// Percent discounts don't give a hoot about proration, so there's no modifier\n\t\tmodifier = 1;\n\t} else if (model.lineVO.targetCustomerAmount) {\n\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t// For Unit Target Amount, the raw discount is calculated as the difference between the overridden price\n\t\t// and the regular price. As such, the multiplier is 1\n\t\trawDiscount = price - model.lineVO.targetCustomerAmount;\n\t\tmodifier = 1;\n\t} else if (model.lineVO.targetCustomerTotal) {\n\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t// For Total Target Amount, the raw discount is the difference between the overridden unit price and the regular price,\n\t\t// so the multiplier is 1\n\t\trawDiscount = price - (model.lineVO.targetCustomerTotal / getEffectiveQuantity(model));\n\t\tmodifier = 1;\n\t} else if (model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)) {\n\t\trawDiscount = model.getField(model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD);\n\t\t// If amountDiscountProrated is active, then our multiplier is our ProrateMultiplier, otherwise it's 1\n\t\tmodifier = model.lineVO.amountDiscountProrated ? model.getField(model.constants.PRORATE_MULTIPLIER_FIELD) : 1;\n\t}\n\telse {\n\t\trawDiscount = 0;\n\t\tmodifier = 1;\n\t}\n\t// The adjusted discount is the actual difference between the regular unit price and the discounted price\n\treturn rawDiscount * modifier;\n}\n\nfunction getEffectiveQuantity(model) {\n\t// This method is duplicated from QuoteLineVO.cls\n\tconst record = model.lineVO.record;\n\tlet quantity = record[model.constants.QUANTITY_FIELD];\n\tlet priorQuantity = record[model.constants.PRIOR_QUANTITY_FIELD];\n\tlet actualQuantity = record[model.constants.EXISTING_FIELD] ? quantity - priorQuantity : quantity;\n\tif ((record[model.constants.PRICING_METHOD_FIELD] == 'Block' || record[model.constants.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab') && record[model.constants.EXISTING_FIELD] && priorQuantity != null && quantity - priorQuantity == 0) {\n\t\treturn 0;\n\t}\n\telse if ((record[model.constants.PRICING_METHOD_FIELD] == 'Block' || record[model.constants.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab')) {\n\t\treturn 1;\n\t}\n\telse if (record[model.constants.EXISTING_FIELD] && model.dynamicSubscription && record[model.constants.LIST_PRICE_FIELD] != 0 && actualQuantity == 0) {\n\t\treturn quantity;\n\t}\n\telse if (model.groupModel.quoteModel.quoteVO.record[model.constants.TYPE_FIELD] == 'Amendment' && !model.subscription && actualQuantity < 0) {\n\t\treturn 0;\n\t} else {\n\t\treturn actualQuantity;\n\t}\n}\n\nexport function convertDiscountValue(model, item, discountUnit) {\n\tconst { displayValue: previousDisplayValue } = getUnitAndDisplayValue(model, item);\n\tif (!discountUnit) {\n\t\treturn;\n\t}\n\tconst record = model.lineVO.record;\n\tlet changeAdditionalDiscountUnit = () => {\n\t\tlet price = record[model.constants.REGULAR_PRICE_FIELD];\n\t\tlet nullifyAll = () => {\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\trecord[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\tif (model.lineVO.targetCustomerAmount) {\n\t\t\t\tmodel.lineVO.targetCustomerAmount = null;\n\t\t\t}\n\t\t\tif (model.lineVO.targetCustomerTotal) {\n\t\t\t\tmodel.lineVO.targetCustomerTotal = null;\n\t\t\t}\n\t\t};\n\n\t\tif (price === null || price === undefined)  {\n\t\t\tnullifyAll();\n\t\t\treturn;\n\t\t}\n\n\t\tlet unproratedDiscount = getUnproratedDiscount(model);\n\n\t\t// Null out all the discount fields so we don't end up with conflicts.\n\t\tnullifyAll();\n\n\t\t// Assign the discount to the selected unit field\n\t\tif (discountUnit == 'Percent') {\n\t\t\t// The discount percent isn't affected by proration\n\t\t\treturn record[model.constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = (unproratedDiscount / price) * 100;\n\t\t} else if (discountUnit == 'Amount') {\n\t\t\t// Amount discount can be affected by proration, so we need to check that. If amountDiscount is prorated, then\n\t\t\t// we divide the discount by the prorate multiplier\n\t\t\tlet amountMultiplier = model.lineVO.amountDiscountProrated ? record[model.constants.PRORATE_MULTIPLIER_FIELD] : 1;\n\t\t\treturn record[model.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = unproratedDiscount / amountMultiplier;\n\t\t} else if (discountUnit == 'UnitOverride') {\n\t\t\t// Unit Override uses the unprorated discount\n\t\t\treturn model.lineVO.targetCustomerAmount = price - unproratedDiscount;\n\t\t} else if (discountUnit == 'TotalOverride') {\n\t\t\t// Total Override uses the unprorated discount for each unit\n\t\t\treturn model.lineVO.targetCustomerTotal = (price - unproratedDiscount) * getEffectiveQuantity(model);\n\t\t}\n\t};\n\tlet changeMarkupUnit = () => {\n\t\tlet cost = record[model.constants.UNIT_COST_FIELD];\n\t\tif (discountUnit === 'Percent') {\n\t\t\tlet markup = record[model.constants.MARKUP_AMOUNT_FIELD];\n\t\t\tif (markup == null) {\n\t\t\t\tmarkup = 0;\n\t\t\t}\n\t\t\trecord[model.constants.MARKUP_AMOUNT_FIELD] = null;\n\t\t\treturn record[model.constants.MARKUP_RATE_FIELD] = (cost != null) ? (markup / cost * 100) : null;\n\t\t} else {\n\t\t\tlet markup = record[model.constants.MARKUP_RATE_FIELD];\n\t\t\tif (markup == null) {\n\t\t\t\tmarkup = 0;\n\t\t\t}\n\t\t\trecord[model.constants.MARKUP_RATE_FIELD] = null;\n\t\t\treturn record[model.constants.MARKUP_AMOUNT_FIELD] = (cost != null) ? (cost * (markup / 100)) : null;\n\t\t}\n\t}\n\n\tconst displayValue = isAdditionalDiscountField(model, item) ? changeAdditionalDiscountUnit() : changeMarkupUnit();\n\tconst unit = discountUnit;\n\n\t// if display value is not a number, simply set it back to the previous display value\n\treturn { unit,\n\t\tdisplayValue: !isNaN(displayValue) ? displayValue\n\t\t\t: !isNaN(previousDisplayValue) ? previousDisplayValue\n\t\t\t: null\n\t};\n}\n\nfunction isAdditionalDiscountField(model, item) {\n\treturn item === model.constants.ADDITIONAL_DISCOUNT_FIELD;\n}\n","import {Swiper} from '../sb-le-table-cell/Swiper.js';\nimport {Localizer} from '../sb-le-table-cell/Localizer.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\nimport {QuoteLineUpgradeHandler} from '../sb-le-table-cell/QuoteLineUpgradeHandler.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nlet classNames = {\n\tICON: 'sf-icon-chevrondown',\n\tTOP_LEVEL: 'top-level',\n\tOPTION: 'option',\n\tINDENT: 'sbIndent',\n\tRIGHT: 'right',\n\tCENTER: 'center',\n\tOVERRIDDEN: 'overridden'\n}\n\n\nexport class LETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-cell';\n\n\t\tthis.properties = {\n\t\t\titem: String, /** required - field name */\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { /** optional - data to be bound by the sb-group component */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldClass: String,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tindex: Number,\n\t\t\tdetailsOnHover: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trenderTooltip: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\teditable: Boolean,\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\n\t_onTap() {\n\t\t// this event must exist to expand rows on Android devices\n\t}\n\n\tget observers() {\n\t\treturn ['_modelIsChanged(model, index, viewport)',\n\t\t\t\t'_displayChanged(display)',\n\t\t\t\t'_dataOrValueChanged(data, value, item)',\n\t\t\t\t'_updateOriginalValue(model, item)',\n\t\t\t\t'_editableChanged(editable, model, item)']; // TODO Why include model and item here?\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'tap': '_onTap',\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\n\t\tif(this.wasModelIsChangedCalledBeforeAttached)\n\t\t\tthis._modelIsChanged();\n\n\t\tif (this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] && this.model.groupModel.quoteModel.isAmendmentOrChangeQuote && this.item === this.constants.QUANTITY_FIELD) {\n\t\t\t// Logic for automatic upgrade source quantity ratio enforcement lives in separate class UpgradeAssetQuantityCalculator\n\t\t\tthis.quoteLineUpgradeHandler = new QuoteLineUpgradeHandler(this.model);\n\t\t\tif (this.quoteLineUpgradeHandler.getSourceLineVO() && this.quoteLineUpgradeHandler.getUpgradeLineVO()) {\n\t\t\t\tthis.addEventListener('value-changed', this._quantityChanged);\n\t\t\t\tthis.assetUpgradeQuantityCalculator = new AssetUpgradeQuantityCalculator(this.quoteLineUpgradeHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Listeners\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker,\n\t\t\tdateRow       = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\t// W-4333506: when quote is grouped and large quote experience is off ensure datePicker table lines up with date table cell by skipping if block\n\t\tlet quoteModel = this.model.groupModel.quoteModel;\n\t\tif (!quoteModel.grouped && quoteModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\t\t}\n\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\n\t\t// We shouldn't stop propagation; however, not stopping it will cause the positions to be set, again\n\t\t// TODO: Find the source of the the positions being reset if propagation isn't stopped.\n\t\te.stopPropagation();\n\t}\n\n\t// Observers\n\t_modelIsChanged() {\n\t\t// cannot call this before attached because this method may change this.value if a discount field\n\t\t// and that change gets overwritten to the bound value by standard Polymer processing if done before this component is attached\n\t\tthis.wasModelIsChangedCalledBeforeAttached = !this.isAttached;\n\t\tif(!this.isAttached || !this.model)\n\t\t\treturn;\n\n\t\tif (this.item === this.constants.SUBSCRIPTION_SCOPE_FIELD && !this.model.subscriptionScopeEditable) {\n\t\t\tthis.fieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// TODO: Custom segments editor should render segment labels editable without breaking primary mobile columns in segmented detail row\n\n\t\t// primary class attaches to any cell rendered in main card in mobile (ie. Segment Label and Net Total)\n\t\tthis.overrideEditable = this.classList.contains('mdqSummaryRow') || this.classList.contains('primary');\n\t\tlet editable = this._setEditable();\n\n\t\tlet fieldMD = this._setFieldMD();\n\t\tif (this._setFieldClassAndFieldContent(fieldMD))\n\t\t\treturn;\n\n\t\tif (fieldMD.defaultValue && this.value == null && !(fieldMD.controllingPicklist || fieldMD.dependentPicklist))\n\t\t\tthis.value = fieldMD.defaultValue;\n\n\t\t// Use case: Quote Subscription Term change calls updateQuote and creates new models\n\t\t// The usual JSQCNotifier isn't ran in this case so fields are never updated\n\t\tif (this.data && this.value != this.data[this.item]) {\n\t\t\tthis.value = this.data[this.item];\n\t\t}\n\n\t\tif (this.value === undefined) {\n\t\t\tthis.value = null;\n\t\t}\n\n\t\tthis.label = fieldMD.label;\n\t\tthis.$.field.editing = editable;\n\t\tthis.$.field.md = fieldMD;\n\t\tthis.$.field.property = this.item;\n\n\t\tif(this.model.segmented && !(/__c$/.test(this.item)) && (this.item != 'total')) {\n\t\t\t// Remove event listeners first to ensure there are no duplicates when this method is called\n\t\t\tthis.removeEventListener('mouseenter', this._showDetails);\n\t\t\tthis.removeEventListener('mouseleave', this._showDetails);\n\t\t\tthis.renderTooltip = true;\n\t\t\tthis.addEventListener('mouseenter', this._showDetails);\n\t\t\tthis.addEventListener('mouseleave', this._showDetails);\n\t\t}\n\t}\n\n\t_updateOriginalValue() {\n\t\t// Avoids data marked as dirty when front end operation (i.e. delete lines, sort lines, etc) from displaying dirty when they shouldn't be\n\t\tif (this.model.lineVO) {\n\t\t\tthis.model.lineVO._transient_ = this.model.lineVO._transient_ || {};\n\t\t\tthis.model.lineVO._transient_.original = this.model.lineVO._transient_.original || JSON.parse(JSON.stringify(this.model.lineVO.record));\n\t\t}\n\t\tlet originalRecord = this.get('model.lineVO._transient_.original');\n\t\t// Setting originalValue will trigger observer in Field.js which updates its originalFormattedValue for dirty check\n\t\t// In case this.item is additional discount field we must divide by quantity to ensure that dirty check in Field.js works correctly\n\t\tthis.$.field.originalValue = originalRecord[this.item];\n\t}\n\n\t_dataOrValueChanged() {\n\t\t// Make sure these match, group.js will update data first and trigger this before value has been updated\n\t\t// This will ensure the following logic is ran once with the correct information\n\t\tif (this.value != this.data[this.item])\n\t\t\treturn;\n\n\t\tthis.internal = true;\n\t\tif (this.userChangedLookupValue) { // Update __r field on data so it persists on navigation or sort\n\t\t\tthis._updateRelationshipName();\n\t\t} else { // Update formatted display value\n\t\t\tthis._updateLookupDisplayValue();\n\t\t}\n\n\t\tthis.$.field.value = this.value;\n\t\tthis.internal = false;\n\t\tthis.userChangedLookupValue = false;\n\t}\n\n\t_updateRelationshipName() {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.model.getFieldMD(this.item).referenceTo[0]);\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship()) {\n\t\t\tthis.display = rfm.getRelationshipName();\n\t\t} else { // Re-evalulate display so rows without a lookup value don't inherit incorrect display when sorting\n\t\t\tthis.display = undefined;\n\t\t}\n\t}\n\n\t_displayChanged() {\n\t\tthis.userChangedLookupValue = !this.internal;\n\t}\n\n\t_setEditable() {\n\t\treturn this.overrideEditable ? false : this.model.isEditable(this.item);\n\t}\n\n\t_editableChanged() {\n\t\tthis.$.field.editing = this.overrideEditable ? false : this.model.isEditable(this.item);\n\t}\n\n\t_setFieldMD() {\n\t\t// substitute Net Total field metadata in case a segment label is passed into sb-field instead of a field label (ie. SBQQ__ProductName__c)\n\t\tlet fieldMD = this.model.getFieldMD(this.item) ? this.model.getFieldMD(this.item) : this.model.getFieldMD(this.constants.NET_TOTAL_FIELD);\n\t\tfieldMD.CurrencyIsoCode = this.model.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\t// Applying quantity scale to quantity fields in order of priority (product qs -> package settings qs -> default field qs)\n\t\tif (this.constants.QUANTITY_FIELDS && this.constants.QUANTITY_FIELDS.has(this.item)) {\n\t\t\tif (this.model.lineVO.productQuantityScale != null) {\n\t\t\t\tfieldMD = Object.assign({}, fieldMD, {scale: this.model.lineVO.productQuantityScale});\n\t\t\t}\n\t\t}\n\t\treturn fieldMD;\n\t}\n\n\t/**\n\t * Sets class and content of the field container.\n\t * @param {Object} fieldMD MD of the field to determine text-alignment\n\t * @return {Boolean} returns true if the field is overriden and should not continue to set sb-field properties\n\t */\n\t_setFieldClassAndFieldContent(fieldMD) {\n\t\tlet fieldClass = '';\n\t\tif (this.model.editorModel.data.settings.productHierarchyVisualized && !this.model.segmented) {\n\t\t\tif (!this.isMobile) {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD) {\n\t\t\t\t\tif (this.model.isBundle) {\n\t\t\t\t\t\tfieldClass += `${classNames.ICON} `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.model.component) {\n\t\t\t\t\t\t\tfieldClass += `${classNames.TOP_LEVEL} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.model.component) {\n\t\t\t\t\t\tif (!this.model.isBundle) {\n\t\t\t\t\t\t\tfieldClass += `${classNames.OPTION} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfieldClass += `${classNames.INDENT}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD || this.item === this.constants.NET_TOTAL_FIELD) {\n\t\t\t\t\tfieldClass += `${classNames.INDENT}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._isSegmentedDrawer() || (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency')) {\n\t\t\tfieldClass += ` ${classNames.RIGHT}`;\n\t\t\tif (this.classList.contains('drawerCell'))\n\t\t\t\tthis._togglePreventNumericAlignment();\n\n\t\t\tif (this._isSegmentedDrawer())\n\t\t\t\tthis._toggleSegmentedAlignment();\n\t\t}\n\n\t\tif (fieldMD.type == 'boolean') {\n\t\t\tfieldClass += ` ${classNames.CENTER}`;\n\t\t}\n\n\t\tif (this.model.bundled && this.item === this.constants.LIST_PRICE_FIELD) {\n\t\t\tthis.overrideValue = AppContext.properties.i18n.value().l('Included');\n\t\t\tfieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tlet localizedValue = Localizer.getLocalizedValue(this.model, this.item);\n\t\tif (localizedValue) {\n\t\t\tthis.overrideValue = localizedValue;\n\t\t\tfieldClass += ` ${classNames.OVERRIDDEN}`;\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tthis.fieldClass = fieldClass;\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Used to align table cell value to ensure pencil or lock icon show up on correct side of cell field value,\n\t * relevant primarily for LEDrawer components\n\t */\n\t_togglePreventNumericAlignment() {\n\t\tthis.$.field.preventNumericAlignment = !this.$.field.preventNumericAlignment;\n\t}\n\n\t_toggleSegmentedAlignment() {\n\t\tthis.$.field.segmentedAlignment = true;\n\t}\n\n\t_isSegmentedDrawer() {\n\t\treturn this.model.itemClassMap.attributes === 'mdqSummaryRow' && !this.classList.contains('mdqSummaryRow');\n\t}\n\n\t/**\n\t * Invoked on the 'value-changed' event for automatic upgrade source quantity ratio enforcement\n\t * Fires 'upgarde-asset-quantity-changed' with index of line that needs its quantity re-rendered based upon change to target line. Listened for in LEGroup.js\n\t * @param {object} e - event object\n\t */\n\t_quantityChanged(e) {\n\t\tif (this.model.internalUpdate) {\n\t\t\treturn;\n\t\t}\n\t\tthis.assetUpgradeQuantityCalculator.setQuantitiesByRatio();\n\t\tlet indexes = this.quoteLineUpgradeHandler.getIndexes();\n\n\t\tlet sourceLineVO = this.quoteLineUpgradeHandler.getSourceLineVO();\n\t\tlet upgradeLineVO = this.quoteLineUpgradeHandler.getUpgradeLineVO();\n\n\t\t// index is the position in standardLines array that the line which needs its quantity to be updated based upon the change to the target line\n\t\tthis.fire('upgrade-asset-quantity-changed', {\n\t\t\tsourceIndex: indexes[\"sourceIndex\"],\n\t\t\tupgradeIndex: indexes[\"upgradeIndex\"],\n\t\t\tsourceLineVO: sourceLineVO,\n\t\t\tupgradeLineVO: upgradeLineVO\n\t\t});\n\t}\n\n\t_handleFieldValueChanged() {\n\t\tif (this.calculateImmediately) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t\t//fire events based on the changed item\n\t\tlet data = { value: this.item };\n\t\tthis.fire('field-updated', data);\n\t}\n\n\t_showDetails(e) {\n\t\tlet type = e.type;\n\t\tthis.detailsOnHover = type == 'mouseenter';\n\t}\n\n\t_getLineModel() {\n\t\tif ( this.item != 'total' && this.model.segmentsByLabel != null ) {\n\t\t\tlet lineModelKeys = Object.keys(this.model.segmentsByLabel);\n\t\t\tlet lineModelKeysLength = lineModelKeys.length;\n\t\t\tfor (let i = 0; i < lineModelKeysLength; i++ ) {\n\t\t\t\t// Need to take out the white space from the lineModelkeys\n\t\t\t\tlet key = lineModelKeys[i].replace(/\\W/g, '');\n\t\t\t\tif ( key == this.item ) {\n\t\t\t\t\treturn this.model.segmentsByLabel[lineModelKeys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.model;\n\t}\n\n\t_getRecord() {\n\t\treturn this._getLineModel().lineVO.record;\n\t}\n\n\t// Getters\n\tget constants() {\n\t\treturn this.model.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.model.lineVO.record;\n\t}\n\n\tset record(val) {\n\t\tthis.model.lineVO.record = val;\n\t}\n}\n\nPolymer( LETableCell );\n","export class Localizer {\n\n\t/**\n\t * Retrives the localized value of a field if it exists.\n\t * @return {String} - Localized value if it exists.\n\t */\n\tstatic getLocalizedValue(model, item, lookupNameField) {\n\t\tlet constants = model.editorModel.constants;\n\t\tlet productLocalization = model.groupModel.quoteModel.quoteVO.localizationByFieldByProductId[model.getField(constants.PRODUCT)];\n\t\tlet fieldMD = model.getFieldMD(item);\n\t\tif (!productLocalization || !fieldMD) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prefix = model.editorModel.data.developerPrefix;\n\t\tlet fieldName = (fieldMD && fieldMD.calculatedFormula && fieldMD.calculatedFormula.indexOf(`${prefix}Product__r`) === 0) ? fieldMD.calculatedFormula.split('.')[1].replace(prefix, '') : fieldMD.name;\n\n\t\tlet productFieldLocalization = lookupNameField ? productLocalization[fieldName][lookupNameField] : productLocalization[fieldName];\n\t\tif (!productFieldLocalization) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn productFieldLocalization.record[constants.TEXT_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.LONG_TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.RICH_TEXT_AREA_FIELD];\n\t}\n\n}\n\n\n","export class QuoteLineUpgradeHandler {\n\n\tconstructor(model) {\n\t\tthis.model = model;\n\t\tthis.indexes = {};\n\t}\n\n\tisSourceLine() {\n\t\treturn this.model.existing;\n\t}\n\n\tgetLine() {\n\t\treturn this.model.lineVO;\n\t}\n\n\tgetLines() {\n\t\treturn this.model.groupModel.standardLines;\n\t}\n\n\t/**\n\t * Takes into account bundleKeptTogether setting in case source or upgrade option is moved from one group to another\n\t * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line\n\t * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n\t */\n\tgetSourceOrUpgrade(source) {\n\t\tlet sourceOrUpgradeLineVO;\n\t\tif (this.model.editorModel.data.settings.bundleKeptTogether) {\n\t\t\tsourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, this.model.groupModel);\n\t\t} else {\n\t\t\tlet groups = this.model.groupModel.quoteModel.lineGroups;\n\t\t\tfor (let i = 0, groupCount = groups.length; i < groupCount; i++) {\n\t\t\t\tif (sourceOrUpgradeLineVO) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, groups[i]);\n\t\t\t}\n\t\t}\n\t\treturn sourceOrUpgradeLineVO;\n\t}\n\n\t/**\n\t * Sets the index that will be sent to LEGroup.js for the correct lineVO's quantity that should be re-rendered\n\t * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line, if null should be set to source\n\t * @param {groupModel} group - ensures that bundleKeptTogether setting works for source and upgrade options that will be moved from one group to another\n\t * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n\t */\n\t_findLineWithTargetAssetId(source, group) {\n\t\tlet seekExistingLine = source ? false : true;\n\t\tlet lineVO; // Either the source or the target lineVO (the opposite of the one that is updated by the user)\n\t\tlet targetAssetId = this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD];\n\n\t\tfor (let i = 0, lineCount = group.standardLines.length; i < lineCount; i++) {\n\t\t\tlet line = group.standardLines[i];\n\t\t\tif (line.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] === targetAssetId && line.lineVO.record[this.constants.EXISTING_FIELD] === seekExistingLine) {\n\t\t\t\tlet key = seekExistingLine ? \"sourceIndex\" : \"upgradeIndex\";\n\t\t\t\tthis.indexes[key] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n\t\t\t\tlineVO = line.lineVO;\n\t\t\t}\n\t\t\tif (this.model.lineVO.key === line.lineVO.key) {\n\t\t\t\tlet key2 = (!this.indexes[\"sourceIndex\"] && this.model.existing) ? \"sourceIndex\" : \"upgradeIndex\";\n\t\t\t\tthis.indexes[key2] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n\t\t\t}\n\t\t}\n\t\treturn lineVO;\n\t}\n\n\tsetSourceAndUpgrade(sourceLineVO, upgradeLineVO) {\n\t\tthis.sourceLineVO = sourceLineVO;\n\t\tthis.upgradeLineVO = upgradeLineVO;\n\t}\n\n\tgetSourceIdField() {\n\t\treturn this.constants.PRODUCT;\n\t}\n\n\tgetUpgradeConversionRateField() {\n\t\treturn this.constants.UPGRADE_CONVERSION_RATE;\n\t}\n\n\tgetSourceCurrentQuantityField(sourceLineVO) {\n\t\treturn sourceLineVO.record[this.constants.QUANTITY_FIELD];\n\t}\n\n\tgetUpgradeCurrentQuantityField(upgradeLineVO) {\n\t\treturn upgradeLineVO.record[this.constants.QUANTITY_FIELD];\n\t}\n\n\tgetSourcePriorQuantity(sourceLineVO) {\n\t\treturn sourceLineVO.record[this.constants.PRIOR_QUANTITY_FIELD];\n\t}\n\n\tdidSourceQuantityChange(didUserChangeSourceLine) {\n\t\treturn didUserChangeSourceLine;\n\t}\n\n\tdidUpgradeQuantityChange(didUserChangeSourceLine) {\n\t\treturn !didUserChangeSourceLine;\n\t}\n\n\tisSelected() {\n\t\treturn true;\n\t}\n\n\tsetUpdatedQuantity(sourceLineVO, upgradeLineVO, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n\t\tsourceLineVO.record[this.constants.QUANTITY_FIELD] = sourceQtyAfterUpdate;\n\t\tupgradeLineVO.record[this.constants.QUANTITY_FIELD] = upgradeQtyAfterUpdate;\n\t}\n\n\tgetIndexes() {\n\t\treturn this.indexes;\n\t}\n\n\tgetSourceLineVO() {\n\t\treturn this.sourceLineVO;\n\t}\n\n\tgetUpgradeLineVO() {\n\t\treturn this.upgradeLineVO;\n\t}\n\n\t// Getters\n\tget constants() {\n\t\treturn this.model.fieldNames;\n\t}\n}\n","const SWIPE_DISTANCE = 75;\nconst OPEN_DISTANCE = -185; // Must be in sync with sb-group.less .swipe{left}\nconst SWIPE_MARGIN = 50; // Must be in sync with sb-group.less .swipe{left}\nlet swiping = false;\n\nexport class Swiper {\n\tconstructor(cell) {\n\t\tthis.cell = cell;\n\t\tthis.primaryCells = cell.parentElement.querySelectorAll('.primary');\n\t}\n\n\t/**\n\t * Mobile swipe action\n\t * @param  {object} detail - event detail\n\t */\n\tswipe(detail) {\n\t\tif (!this.leTableRow)\n\t\t\tthis.leTableRow = this.cell.domHost.domHost;\n\t\tlet open = this.cell.classList.contains('open'); /** mobile state that determines if the line item has been swiped opened to access line actions */\n\n\t\tswitch( detail.state ) {\n\t\t\tcase 'start':\n\t\t\t\tif (Math.abs(detail.dy) > SWIPE_MARGIN || ((!open && detail.dx > 0) || (open && detail.dx < 0)))\n\t\t\t\t\treturn;\n\t\t\t\tswiping = true;\n\t\t\t\tthis.leTableRow.classFollows('open', null, this.leTableRow.$$('.tr'));\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.position = 'relative';\n\t\t\t\tbreak;\n\t\t\tcase 'track':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.left = `${(open ? OPEN_DISTANCE : 0) + detail.dx}px`;\n\t\t\t\tbreak;\n\t\t\tcase 'end':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tswiping = false;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < this.primaryCells.length; i++) {\n\t\t\t\t\tthis.primaryCells[i].style.left = '';\n\t\t\t\t\tthis.primaryCells[i].style.position = '';\n\t\t\t\t\tif (detail.dx < -SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', this.primaryCells[i]);\n\t\t\t\t\t\topen = true;\n\t\t\t\t\t} else if (detail.dx > SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', null, this.primaryCells[i]);\n\t\t\t\t\t\topen = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (open)\n\t\t\t\t\tthis.leTableRow.classFollows('open', this.leTableRow.$$('.tr'));\n\t\t}\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {setThenNotify} from 'quotes/models/UiNotifier.js';\n\nexport class LETableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header';\n\t\tthis.properties = {\n\t\t\tlineModels: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tfieldClasses: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconstants: Object,\n\t\t\tfields: Object,\n\t\t\tsettings: Object,\n\t\t\tactionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false,\n\t\t\t\tcomputed: '_getActionsPlacement(settings)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t]\n\t}\n\n\t_getActionsPlacement() {\n\t\treturn this.settings.actionsColumnPlacement == 'Left';\n\t}\n\n\t/**\n\t * Loops through field and column names and updates group array for both standard and segmented table header row\n\t * @private\n\t */\n\t_buildRows() {\n\t\tlet group = [],\n\t\t\tfieldsRenderedAsNumber = {};\n\n\t\t// loop through standard line field names to update group and identify the fields that are rendered as number\n\t\tfor (let i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\tgroup.push(fieldName);\n\n\t\t\t// create a map of field labels to indicate the fields that are rendered as number - for styling purposes on the cell level\n\t\t\tlet fieldMD = this.fields[fieldName];\n\t\t\tif (fieldMD && (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency')) {\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[fieldName]] = true;\n\t\t\t} else if (fieldMD && fieldMD.type == 'boolean') {\n\t\t\t\tthis.fieldClasses[fieldMD.name] = 'center';\n\t\t\t}\n\t\t}\n\n\t\t// loop through column names (there are column names only when the quote/group has segmented lines) to update group and identify the fields that are rendered as number\n\t\tif (this.columnNames) {\n\t\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\t\tgroup.push(columnName);\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[columnName]] = true;\n\t\t\t}\n\t\t\t// TODO: Localize this string\n\t\t\tgroup.push('total');\n\t\t\tthis.fieldClasses[this.constants.SEGMENT_LABEL_FIELD] = 'hiddenInMobile';\n\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap['total']] = true;\n\t\t}\n\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\t\tif (this.header && this.header.group.length != group.length) {\n\t\t\tthis.header.destroyGroup();\n\t\t}\n\n\t\t// model needs to be assigned before the group; otherwise the model will not be attached to the elements sb-group creates\n\t\tthis.header = this.$.header;\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.header.model = fieldsRenderedAsNumber;\n\t\tthis.header.model.isStandard = !(this.columnNames && this.columnNames.length > 0);\n\t\tthis.header.model.settings = this.settings;\n\t\tthis.header.itemClassMap = this.fieldClasses;\n\t\tthis.header.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.header.columnWidths = this.columnWidths;\n\t\tif(!this.header.group) // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\t\tthis.header.group = group;\n\t\tthis.data = this.fieldLabelsMap;\n\n\t\tthis.displayDrawerIcon = this.editorModel && this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0 && !this.columnNames;\n\n\t\tif (this.columnNames) {\n\t\t\tthis.expansionIconClass = 'sf-icon-right';\n\t\t}\n\t\tif (this.displayDrawerIcon) {\n\t\t\tthis.lineItemDrawerIconClass = 'sf-icon-chevronright';\n\t\t}\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.header || this.viewport && this.viewport.isMobile()) return;\n\t\tthis.header.columnWidths = this.columnWidths;\n\t}\n\n\t/**\n\t * Expands all lines in the table to display segment details or the standard line item drawer\n\t */\n\ttoggleAllLinesExpansion() {\n\t\tif (this.columnNames) {\n\t\t\tlet expanded = this.expansionIconClass != 'sf-icon-right';\n\t\t\tthis.expansionIconClass = !expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\t\tthis.set('lineModels.' + i + '.lineVO.expanded', !expanded);\n\t\t\t\tthis.set('lineModels.' + i + '.expandedIconClass', this.expansionIconClass);\n\t\t\t}\n\t\t} else if (this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0) {\n\t\t\tlet expanded = this.lineItemDrawerIconClass != 'sf-icon-chevronright';\n\t\t\tthis.lineItemDrawerIconClass = !expanded ? 'sf-icon-chevrondown' : 'sf-icon-chevronright';\n\t\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\t\tthis.set('lineModels.' + i + '.lineVO.expanded', !expanded);\n\t\t\t\tthis.set('lineModels.' + i + '.lineItemDrawerIconClass', this.lineItemDrawerIconClass);\n\t\t\t}\n\n\t\t}\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.fire('line-toggled', {index: null});\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of each line in this table in order to toggle the \"checked\" state of each line item\n\t */\n\ttoggleAllCheckBoxes() {\n\t\tfor (let i = 0; i < this.lineModels.length; i++) {\n\t\t\tsetThenNotify(this.lineModels[i], ['selected'], this.selected);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of the multi delete checkbox to false after action that causes updateQuote to run in LineEditor.js\n\t */\n\tdeselectCheckbox() {\n\t\tthis.set('selected', false);\n\t}\n}\n\nPolymer( LETableHeader );","import {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from '../../../common/core/AppContext.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\n\nexport class LETableRow {\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped',\n\t\t\t'field-updated' : 'handleFieldValueChanged'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tdata: Object,\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tcolumnNames: Array,\n\t\t\tcolumnWidths: Object,\n\t\t\tmobileCols: Array,\n\t\t\tlineNumber: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t},\n\t\t\tisDesktopAndHasNoActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisDesktopAndHasActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmdqFields: {\n\t\t\t\ttype: Set,\n\t\t\t\tvalue: new Set()\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowCheckbox: Boolean,\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(fieldNames, columnNames, lineModel, columnWidths, viewport, dataIndex)',\n\t\t\t'_lineRecordChanged(lineModel.*)',\n\t\t\t'_columnWidthsChanged(columnWidths)',\n\t\t\t'_expanded(expanded)',\n\t\t\t'_toggleSelection(lineModel, expandDisabled)'];\n\t}\n\n\tattached() {\n\t\tif (!this.isMobile) {\n\t\t\tlet ironList;\n\t\t\t// We pass in an ironList to this component when Multi Group View is enabled\n\t\t\tif (this.ironList) {\n\t\t\t\tironList = this.ironList;\n\t\t\t} else if (this.lineModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\tironList = this.domHost.$$('iron-list');\n\t\t\t} else {\n\t\t\t\tironList = null;\n\t\t\t}\n\t\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', 'sb-le-table-cell', 'root', this.dataIndex, 'data-index', ironList);\n\t\t\tthis.signaler.signalOnFocus('sb-row-focus-signal');\n\t\t}\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.expandDisabled = e.detail.isOpen;\n\t}\n\n\t/**\n\t * Loops through field sets and segments and updates data map and group array for both standard and segmented table row\n\t * @private\n\t */\n\t_buildRow() {\n\t\tif (!this.lineModel.lineVO.key) return;\n\n\t\t// data and group objects are consumed by <sb-group> component in forming the group of cells in the table\n\t\tlet data = {},\n\t\t\tgroup = [],\n\t\t\titemClassMap = {};\n\n\t\tif (!this.columnNames) {\n\t\t\t// standard lines\n\t\t\tdata = this.lineModel.lineVO.record;\n\t\t\tgroup = this.fieldNames;\n\t\t} else {\n\t\t\t// segmented lines\n\t\t\t// update data and group for the field names in the summary quote line field set\n\t\t\tfor (var i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\t\tdata[fieldName] = this.record[fieldName];\n\t\t\t\tgroup.push(fieldName);\n\t\t\t}\n\n\t\t\t// create a map to store net totals by columns and populate the columnLabels array\n\t\t\tlet totalsByColumns = {};\n\t\t\tfor (var j = 0, len = this.lineModel.segments.length; j < len; j++) {\n\t\t\t\tlet segment = this.lineModel.segments[j],\n\t\t\t\t\tlabel = segment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, '');\n\t\t\t\ttotalsByColumns[label] = segment.lineVO.record[this.constants.NET_TOTAL_FIELD];\n\t\t\t}\n\n\t\t\t// update data and group for the columns (one-time and time-based segments)\n\t\t\tif (!this.isMobile) {\n\t\t\t\tfor (var k = 0, len = this.columnNames.length; k < len; k++) {\n\t\t\t\t\tlet label = this.columnNames[k].replace(/\\W/g, '');\n\t\t\t\t\t// if a line item does not have a column, pass in null and that is displayed as a blank cell\n\t\t\t\t\tdata[label] = totalsByColumns[label] !== undefined ? totalsByColumns[label] : null;\n\t\t\t\t\tgroup.push(label);\n\t\t\t\t\tthis.mdqFields.add(label);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO: Update for localization\n\t\t\tdata['total'] = this.quoteVO.multiSegmentRowTotals[this.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\tgroup.push('total');\n\t\t\tthis.mdqFields.add('total');\n\t\t}\n\n\t\t// Set lineNumber on initial render\n\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\n\t\t// Flag to determine whether to display drawer icon cell\n\t\t// Based on whether there are fields on the field set, that this table row is not a segmented line, and that we're in desktop\n\t\tthis.displayDrawerIconCell = (this.lineModel.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length > 0) && !this.columnNames && !this.isMobile;\n\t\t// If we should display the drawer icon, but in a line that should not have/display a drawer\n\t\tthis.toggleClass('rowWithoutDrawerIcon', this.displayDrawerIconCell && !this.lineModel.hasStandardLineItemDrawer, this);\n\n\t\t// Flags to display invalid pricebook/opportunity messages\n\t\t// If the opportunity line item does not exist and the quote is a primary quote, then we need the tooltip warning, check for == false in case of null or undefined\n\t\tthis.invalidPricebookEntry = this.lineModel.lineVO.validPricebookEntryExists == false;\n\t\tthis.opportunityWarning = this.lineModel.groupModel.quoteModel.isPrimary && this.lineModel.lineVO.opportunityLineItemExists == false && this.invalidPricebookEntry;\n\t\t// If there is not a valid pricebook entry for the line item and the opportunity warning is not already displayed,\n\t\t// display the invalid pricebook entry warning\n\t\tthis.invalidEntryWarning = this.invalidPricebookEntry && !this.opportunityWarning;\n\t\tthis.isDesktopAndHasActionsOnTheLeft   = !this.isMobile && this.lineModel.editorModel.actionsOnTheLeft;\n\t\tthis.isDesktopAndHasNoActionsOnTheLeft = !this.isMobile && !this.lineModel.editorModel.actionsOnTheLeft;\n\n\t\t// Make sure the \"open\" class isn't there when the row is built.\n\t\tif (this.$$('.tr').classList.contains('open'))\n\t\t\tthis.classFollows('open', null, this.$$('.tr'));\n\n\t\tthis.row = this.$$('#row');\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\n\t\tif (this.row && this.row.group !== undefined && this.row.group.length != group.length) {\n\t\t\tthis.row.destroyGroup();\n\t\t}\n\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.itemClassMap = this.lineModel.itemClassMap;\n\t\tthis.widths = this.columnWidths;\n\t\tthis.model = this.lineModel;\n\t\t// TODO this is a temp fix for major release to avoid possible regression. The real fix should be relying on data as our lineVO object and not using model to reference actual data changing\n\t\tif(this.row && this.row.template) // since our model is actually a data wrapper, we need to ensure its assigned to template before data\n\t\t\tthis.row.template.model = this.lineModel;\n\t\tthis.primaryItems = this.mobileCols || [];\n\t\tthis.groupDisplay = this.fieldLabelsMap;\n\t\tif (!this.row || !this.row.group)\n\t\t\tthis.group = group;  // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\tthis.data = data;\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tif (this.isMobile && this.row && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\t// If expanded is not already set, set the lineVO so that the MDQ drawers are closed when navigating from somewhere else\n\t\t\tif (this.expanded == null) {\n\t\t\t\tthis.lineModel.lineVO.expanded = false;\n\t\t\t} else {\n\t\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\t\tevt.initEvent('tap', true, false);\n\t\t\t\tlet cell = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (!this.isMobile && !this.lineModel.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.listen(this, 'track', 'onTrack')\n\t\t}\n\n\t\t// update rowIndex on the signaler to make sure signaler has accurate data-index when iron-list recycles rows\n\t\tif (this.lineModel.editorModel.largeQuoteExperienceEnabled && this.signaler) {\n\t\t\tthis.signaler.rowIndex = this.dataIndex;\n\t\t}\n\n\t\tthis.toggleClass('largeQuote', this.lineModel.editorModel.largeQuoteExperienceEnabled, this.$.root);\n\t\tthis.toggleClass(this.lineModel.lineTypeClass, true);\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.row || this.row.model.editorModel.deviceContext.isMobile) return;\n\t\tthis.widths = this.columnWidths;\n\t}\n\n\n\t//Redirect to segmented lines or standard lines component\n\tonTrack(e) {\n\t\tif ((this.viewport && this.viewport.isMobile()) || !AppContext.isDesktop) {\n\t\t\treturn;\n\t\t}\n\t\t// ignore track event when resizing of dialog or textarea\n\t\tlet path = Polymer.dom(e).path;\n\t\tfor (let a = 0, l = path.length; a < l; a ++){\n\t\t\tlet nodeName = path[a].nodeName;\n\t\t\tif (nodeName === 'SB-DIALOG' || nodeName === 'TEXTAREA') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.domHost.onTrack(e);\n\t}\n\n\t// Getters\n\tget quoteVO() {\n\t\treturn this.lineModel.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.lineModel.lineVO.record;\n\t}\n\n\t// Helper methods\n\t\n\t_lineRecordChanged(e) {\n\t\tif(e.path === 'lineModel.lineVO.fieldVisibility')\n\t\t\tthis._visibilityChanged();\n\t\telse if(e.path === 'lineModel.lineVO.fieldEditability')\n\t\t\tthis._editabilityChanged();\n\t\telse if(e.path === 'lineModel.selected')\n\t\t\tthis._selectedChanged();\n\t\telse {\n\t\t\tlet path = e.path.split('.')[e.path.split('.').length - 1];\n\t\t\tif (!e.path.endsWith('__c') && !e.path.endsWith('__r') && !this.mdqFields.has(path)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._handleFieldValueChanged(path);\n\t\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\t\t\tthis.set(`data.${path}`, e.value);\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tthis.lineModel.setItemClassMap();\n\t\tthis.row.itemClassMap = this.lineModel.itemClassMap;\n\t}\n\n\t_editabilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tthis.row.itemEditableMap = this.lineModel.lineVO.fieldEditability;\n\t}\n\n\t_selectedChanged() {\n\t\tif (this.lineModel.selected) {\n\t\t\tthis.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key] = this.lineModel;\n\t\t} else {\n\t\t\tdelete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key];\n\t\t}\n\t}\n\n\texpand(e) {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$$('#row').fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\t_expanded() {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableEditableFields();\n\t\tthis.toggleLineExpansion();\n\t}\n\n\t/**\n\t * Expands line to display segment details (uses the Segmented Line Field Set)\n\t */\n\ttoggleLineExpansion(e) {\n\t\t// Only change this value if expanded on component does not match so it doesn't override it during a server call\n\t\tif (this.lineModel.lineVO.expanded != this.expanded) {\n\t\t\tthis.set('lineModel.lineVO.expanded', !this.lineModel.lineVO.expanded);\n\t\t}\n\t\tif (this.lineModel.segmented) {\n\t\t\tthis.set('lineModel.expandedIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-right' : 'sf-icon-down');\n\t\t} else {\n\t\t\tif (this.lineModel.hasStandardLineItemDrawer) {\n\t\t\t\tthis.set('lineModel.lineItemDrawerIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-chevronright' : 'sf-icon-chevrondown');\n\t\t\t}\n\t\t}\n\t\tif(this.lineModel.editorModel.largeQuoteExperienceEnabled || this.lineModel.editorModel.isMultiGroupViewEnabled) {\n\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t}\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\thandleFieldValueChanged(evt) {\n\t\tlet path = evt.detail.value;\n\t\tthis._handleFieldValueChanged(path);\n\t}\n\n\t_handleFieldValueChanged(path) {\n\t\tconst fields = [];\n\t\tswitch (path) {\n\t\t\t// handle change based on the path\n\t\t\tcase this.constants.PRICE_EDITABLE_FIELD:\n\t\t\t\tfields.push(this.constants.LIST_PRICE_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.PRICING_METHOD_FIELD:\n\t\t\t\tfields.push(this.constants.MARKUP_FIELD);\n\t\t\t\tfields.push(this.constants.LIST_PRICE_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.PRICING_METHOD_EDITABLE_FIELD:\n\t\t\t\tfields.push(this.constants.PRICING_METHOD_FIELD);\n\t\t\t\tbreak;\n\t\t\tcase this.constants.NON_DISCOUNTABLE_FIELD:\n\t\t\t\tfields.push(this.constants.ADDITIONAL_DISCOUNT_FIELD);\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._handleFieldEditability(fields);\n\t}\n\n\t_handleFieldEditability(fields) {\n\t\tfor (var field of fields) {\n\t\t\t// If fieldEditability is defined, it means that the page security plugin has already determined field editability, so don't override it\n\t\t\tif (!this.lineModel.lineVO.fieldEditability) {\n\t\t\t\tthis.row = this.row || this.$$('#row');\n\t\t\t\tlet editableMap = {};\n\t\t\t\tlet editable = this.lineModel.isEditable(field);\n\t\t\t\teditableMap[field] = editable;\n\t\t\t\tthis.row.itemEditableMap = editableMap;\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// toggle optional is handled separately in standard lines so that it affects optional whether it is in a drawer or on the line's fieldset\n\t\tif (!this.columnNames) {\n\t\t\treturn;\n\t\t}\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.lineModel.groupModel.groupVO.key) {\n\t\t\tthis.set(`data.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_toggleSelection(e) {\n\t\tlet multiLineDeleteEnabled = this.lineModel ? this.lineModel.editorModel.data.settings.multiLineDeleteEnabled : true;\n\t\tlet mobileDrawerOpened = this.isMobile && e.detail && e.detail.drawerState === 'open';\n\t\tthis.showCheckbox = multiLineDeleteEnabled && !this.expandDisabled && !mobileDrawerOpened;\n\t}\n\n\t_modelChanged() {\n\t\tregisterComponent(this, \"lineModel\");\n\t}\n\n\tget selector() {\n\t\treturn this.signaler ? this.signaler.selector : null;\n\t}\n}\n\nPolymer( LETableRow );\n","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\nexport class LETableHeaderCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header-cell';\n\t\tthis.properties = {\n\t\t\tbyOrder: String,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tshowSortableHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showSortableHeader(model)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tthis.constants = new Constants(AppContext.org.prefix + '__');\n\t\t\t\t\treturn AppContext.org.prefix;\n\t\t\t\t}\n\t\t\t},\n\t\t\toverflowTrue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\t_modelChanged() {\n\t\tPolymer.dom(this.$.headerCell).observeNodes(function() {\n\t\t\tlet headerNode = this.$$('#header');\n\t\t\tthis.toggleClass('right', this.model[this.value], headerNode);\n\t\t\tlet bundlesVisualized = (this.model.settings && this.model.settings.productHierarchyVisualized && this.model.isStandard && this.getAttribute('item') === this.constants.PRODUCT_NAME_FIELD);\n\t\t\tthis.toggleClass('bundlesVisualized', bundlesVisualized, headerNode);\n\t\t}.bind(this));\n\t}\n\n\tsortLines(e) {\n\t\tlet newSort = \"\";\n\n\t\tlet headers = this.parentElement.children;\n\n\t\tfor(let i = 0; i < headers.length; i++) {\n\t\t\theaders[i].toggleClass('asc', false, headers[i].$$('#header'));\n\t\t\theaders[i].toggleClass('desc', false, headers[i].$$('#header'));\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowup', true, headers[i].$$('#arrow')) : null;\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowdown', false, headers[i].$$('#arrow')) : null;\n\t\t\tPolymer.dom(headers[i]).classList.remove('column-selected');\n\t\t}\n\n\t\tif (!this.byOrder){\n\t\t\tnewSort = 'asc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'asc'){\n\t\t\tnewSort = 'desc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', false, this.$$('#arrow'));\n\t\t\tthis.toggleClass('sf-icon-arrowdown', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'desc') {\n\t\t\tnewSort = '';\n\t\t}\n\n\t\tthis.sortByField = newSort ? this._getKeyByValue(this.value, this.data) : null;\n\t\tthis.toggleClass('column-selected', newSort);\n\t\tthis.byOrder = newSort;\n\t\tif (newSort){\n\t\t\tthis.toggleClass(newSort, true, this.$$('#header'));\n\t\t}\n\t\tthis.fire('table-header-sort-clicked', {order: this.byOrder, field: this.sortByField});\n\t}\n\n\t_showSortableHeader() {\n\t\t//Make sure segmented line detail and 'Additional Disc.' field headers are not sortable.\n\t\tif (this.model.lineVO || this.getAttribute('item') === this.constants.ADDITIONAL_DISCOUNT_FIELD || this.classList.contains('hoverFieldHeader')) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t_getKeyByValue(value, object) {\n\t\tfor(let prop in object ) {\n\t\t\tif( object.hasOwnProperty( prop ) ) {\n\t\t\t\tif( object[ prop ] === value )\n\t\t\t\t\treturn prop;\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( LETableHeaderCell );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class SegmentedDetailRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-detail-row';\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t},\n\t\t\tindex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_lineRecordChanged(lineModel.segments.*)',\n\t\t\t\t'_lineModelChanged(lineModel)',\n\t\t\t\t'_setGroup(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\tget selector() {\n\t\treturn this.signaler ? this.signaler.selector : null;\n\t}\n\n\tget isMobile() {\n\t\tthis.viewport && this.viewport.isMobile();\n\t}\n\n\tready() {\n\t\tthis.expanded = false;\n\t}\n\n\texpand(e) {\n\t\tif(this.isMobile) this.enableEditableFields();\n\t\tthis.$.column.fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$.column.root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\t/**\n\t * Propagates value changes on each segment separately so sb-group can update the UI correctly\n\t * @param e\n\t * @private\n\t */\n\t_lineRecordChanged(e) {\n\t\tif (!e.path) return;\n\n\t\t// Isolate the segment number from the path to notify the correct segment child\n\t\tvar firstIndex = e.path.indexOf('#');\n\t\tvar lastIndex = e.path.indexOf('.',firstIndex);\n\t\tvar segmentNumber = e.path.substring(firstIndex + 1, lastIndex);\n\t\tif (!this._pathRefersToMySegmentRecord(segmentNumber)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet pathList = e.path.split('.');\n\t\tlet property = pathList[pathList.length - 1];\n\t\tif (property == 'fieldEditability') {\n\t\t\tthis._editabilityChanged();\n\t\t} else if (property == 'fieldVisibility') {\n\t\t\tthis._visibilityChanged();\n\t\t} else {\n\t\t\tthis.set(`segmentRecord.${property}`, e.value);\n\t\t}\n\t}\n\n\t_lineModelChanged() {\n\t\tthis.dimension = this.lineModel.lineVO.dimensionType;\n\t\tthis.segmentModel = this.lineModel.segmentsByLabel[this.columnName]\n\t\t\t? this.lineModel.segmentsByLabel[this.columnName]\n\t\t\t: new LineModel({key: null, record: {}}, this.lineModel.groupModel);\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tlet column = this.$$('#column');\n\t\tif (this.isMobile && column && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\tevt.initEvent('tap', true, false);\n\t\t\tlet cell = Polymer.dom(column.root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\tif (cell) {\n\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t}\n\t\t}\n\t}\n\n\t_setGroup() {\n\t\tif(!this.$.column.group) {\n\t\t\tthis._initializeFieldVisibility();\n\t\t\tthis.$.column.group = this.detailFieldNames;\n\t\t}\n\t}\n\n\t_initializeFieldVisibility() {\n\t\tlet itemClassMap = {};\n\t\tthis.detailFieldNames.forEach( fieldName => {\n\t\t\tif (!this.segmentModel.isFieldRendered(fieldName, this.isMobile)) {\n\t\t\t\titemClassMap[fieldName] = this.isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t}\n\t\t});\n\t\tthis.$.column.itemClassMap = itemClassMap;\n\t}\n\n\t_visibilityChanged() {\n\t\tif (!this.segmentModel.lineVO.fieldVisibility) {\n\t\t\treturn;\n\t\t}\n\t\tthis.detailFieldNames.forEach( fieldName => {\n\t\t\tlet visible = this.segmentModel.isFieldRendered(fieldName, this.isMobile);\n\t\t\tlet classes = [ { class: 'hiddenInMobile', value: !visible}, { class: 'hiddenInDesktop', value: !visible} ];\n\t\t\tthis.$.column.set('itemClassMap.' + fieldName, classes );\n\t\t});\n\t}\n\n\t_editabilityChanged() {\n\t\tthis.$.column.itemEditableMap = this.segmentModel.lineVO.fieldEditability;\n\t}\n\n\t_pathRefersToMySegmentRecord(segmentNumber) {\n\t\tif (!this.segmentRecord) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.lineModel.segments && !this.lineModel.segments[segmentNumber]) {\n\t\t\treturn false;\n\t\t}\n\t\tvar referencedSegmentVO = this.lineModel.segments[segmentNumber].lineVO;\n\t\tvar referencedKey = referencedSegmentVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar referencedIndex = referencedSegmentVO.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar referencedLabel = referencedSegmentVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\tvar mySegmentKey = this.segmentRecord[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar mySegmentIndex = this.segmentRecord[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar mySegmentLabel = this.segmentRecord[this.constants.SEGMENT_LABEL_FIELD];\n\t\treturn (referencedKey === mySegmentKey) && (referencedIndex === mySegmentIndex) && (referencedLabel === mySegmentLabel);\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'column', 'sb-le-table-cell', null, this.index);\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n}\n\nPolymer( SegmentedDetailRow );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class SegmentedLineDetails {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-line-details';\n\t\tthis.properties = {\n\t\t\tlineModel: { /** required - lineModel that is being rendered */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array, /** required - names of the fields in the summary field set*/\n\t\t\tdetailFieldNames: Array, /** required - names of the fields in the segmented line field set*/\n\t\t\tfieldLabelsMap: Object, /** required - map of field names to labels*/\n\t\t\tcolumnNames: Array, /** required - names of the segment columns in the group*/\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: '_initTabIndex(viewport)'\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(detailFieldNames, fieldNames, lineModel, columnWidths)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t];\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile()\n\t}\n\n\t/**\n\t * Returns the lineVO.record of the segment. If the line does not have that segment, it returns an empty lineVO.record for rendering purposes.\n\t * @param label\n\t * @returns {lineVO.record}\n\t */\n\tgetSegmentRecord(label) {\n\t\treturn this.lineModel.segmentsByLabel[label]\n\t\t\t? this.lineModel.segmentsByLabel[label].lineVO.record\n\t\t\t: new LineModel({key: null, record: {}}, this.lineModel.groupModel).lineVO.record;\n\t}\n\n\tsegmentExists(columnName) {\n\t\treturn !this.lineModel.segmentsByLabel[columnName] ? 'desktopOnly' : '';\n\t}\n\n\tforwardFocusDown(e) {\n\t\tif(e.keyCode === 9 && !e.shiftKey) // tab key\n\t\t\tRowFocusSignaler.signalFirstEditableTargetFirstRow(this, 'sb-segmented-detail-row', 'index');\n\t}\n\n\tforwardFocusUp(e) {\n\t\tif (e.keyCode === 9 && e.shiftKey) // shift+tab key\n\t\t\tRowFocusSignaler.signalLastEditableTargetLastRow(this, 'sb-segmented-detail-row', this.columnNames.length, 'index');\n\t}\n\n\t_buildRow() {\n\t\tthis._setColumnWidths();\n\t\tthis.$.header.itemClassMap = this.itemClassMap;\n\t\t// need to assign sb-group component's group attribute from here otherwise the itemClassMap will not be taken into account\n\t\t// because itemClassMap is optional for sb-group\n\t\tthis.detailFieldNamesWithLabel = this.isMobile()\n\t\t\t? [this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD].concat(this.detailFieldNames)\n\t\t\t: this.detailFieldNames;\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = this.detailFieldNamesWithLabel;\n\t}\n\n\t_isActionsOnTheLeft(editorModel) {\n\t\treturn editorModel.actionsOnTheLeft;\n\t}\n\n\t/**\n\t * Sets column widths within segmented line drawers. Runs at every window resize\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tif (this.isMobile()) return;\n\t\tlet colWidths = this.columnWidths;\n\t\tif (!colWidths || !this.columnNames) {\n\t\t\treturn;\n\t\t}\n\t\t// get the width of the label column which should align with the last summary line field\n\t\tlet labelColWidth = 0;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += colWidths[field];\n\t\t}\n\t\tthis.fieldNamesColWidth = labelColWidth + 'px';\n\n\t\t// set width of each segment\n\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\tthis.colWidth = colWidths[columnName] + 'px';\n\t\t}\n\t\t// set width of the total column\n\t\tthis.totalColWidth = colWidths['total'] + 'px';\n\t}\n\n\t/**\n\t * Updates column widths based on window resizing or group side panel toggling\n\t * @private\n\t */\n\t_columnWidthsChanged() {\n\t\tthis._setColumnWidths();\n\t}\n\n\t_initTabIndex() {\n\t\treturn this.isMobile() ? -1 : 0;\n\t}\n}\n\nPolymer( SegmentedLineDetails );","/**\n * Abstract class for a field that controls the values of other fields based on value selected\n * on the controlling field\n */\nexport class ControllingField {\n\n\t/**\n\t * Returns the field name of the controlling field\n\t */\n\tgetFieldName() {}\n\n\t/**\n\t * Updates all of the fields that this field is controlling\n\t *\n\t * @param tableRow\n\t * @param controllingFieldValue\n\t */\n\tupdateControlledFields(tableRow, controllingFieldValue) {}\n\n}\n","import {DeviceDelegate} from 'quotes/layout/sf-le-table-row/DeviceDelegate.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\nexport class DesktopDelegate extends DeviceDelegate {\n\n\tstatic getInstance() {\n\t\tif (!this._instance) {\n\t\t\tthis._instance = new DesktopDelegate();\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * @override\n\t * @param row\n\t */\n\tinitListeners(row) {\n\t\trow.listeners.mouseover = 'onHovered';\n\t\trow.listeners.mouseout = 'onUnhovered';\n\t\trow.listeners['rte-esc'] = 'onRteCancel';\n\t}\n\n\t/**\n\t * @override\n\t * @param newValue\n\t * @param oldValue\n\t * @param row\n\t */\n\texpansionChanged(newValue, oldValue, row) {\n\t\tif (!row.isSegmented) {\n\t\t\tlet spanElem = row.$$('.drawerContainer span');\n\t\t\tif (spanElem) {\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.CHEVRON_DOWN_ICON, newValue);\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.CHEVRON_RIGHT_ICON, !newValue);\n\t\t\t}\n\t\t} else {\n\t\t\tlet spanElem = row.$$('.segmentedContainer');\n\t\t\tif(spanElem) {\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.DOWN_ICON, newValue);\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.RIGHT_ICON, !newValue);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t * @param row\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row) {\n\t\tlet writeElem = container.querySelector('.w');\n\t\tlet readElem = container.querySelector('.r');\n\t\tlet isRichTextArea = metadata.extraTypeInfo === \"richtextarea\";\n\t\trow.toggleClass('hidden', isEdit && !isRichTextArea, readElem);\n\t\trow.toggleClass(TemplateGenerator.classNames.EDIT_MODE, isEdit && !isRichTextArea, container);\n\t\t// add / remove edit field component\n\t\tif (isEdit) {\n\t\t\tif (!writeElem) {\n\t\t\t\twriteElem = row._createWritableElement(field, container);\n\t\t\t}\n\t\t\t// focus on first input within cell if it exists but give current event loop chance to finish first\n\t\t\t// sb-rte.focus is also needed for IE11 to trigger the firing of sb-open-rte-dialog event\n\t\t\tlet input = writeElem.querySelector( 'input:not([type=\"hidden\"]), checkbox, select, textarea, sb-rte' );\n\t\t\tif( input ) {\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tinput.focus();\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t} else if (writeElem) { // nothing to toggle back to if writeElem doesn't already exist\n\t\t\tif (!isRichTextArea) {\n\t\t\t\tcontainer.removeChild(writeElem);\n\t\t\t}\n\t\t\tif (row.commitPendingEdit()) {\n\t\t\t\tlet newValue = row._formatNewValue(field, metadata);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\trow.fire('line-toggled', {index: row.dataIndex});\n\t\t\t\t});\n\t\t\t\trow._toggleDirtyClass(newValue, field, readElem);\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(event, row) {\n\t\tlet stopPropagation = false;\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase 27: // escape\n\t\t\t\tstopPropagation = this._onEscapePress(event, row);\n\t\t\t\tbreak;\n\t\t\tcase 32: // space\n\t\t\t\t// Space toggles checkbox field and row selection\n\t\t\t\tstopPropagation = this._onSpaceBarPress(event, row);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn stopPropagation;\n\t}\n\n\t/**\n\t * Handle key event for space bar when it's on an editable boolean field or a row selection CB\n\t * @param event\n\t * @param row\n\t * @return whether the event should stop further processing on the parent (SFAbstractTable) level\n\t * @private\n\t */\n\t_onSpaceBarPress(event, row) {\n\t\tlet element = Polymer.dom(event).path[0];\n\t\tif ((element.classList.contains(TemplateGenerator.classNames.EDITABLE) && element.classList.contains(TemplateGenerator.classNames.BOOLEAN)) ||\n\t\t\telement.classList.contains(TemplateGenerator.classNames.SELECTION)) {\n\t\t\tlet cbContainer = element.querySelector('.checkboxcontainer');\n\t\t\tif (cbContainer) {\n\t\t\t\trow.toggleCheckbox(cbContainer);\n\t\t\t\t// stop event propagation so we don't invoke toggleInlineEdit for checkbox fields\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Handle key event for escape key press. This will prevent pending inline edit from being committed, or reset AdditionalDiscount field to its original value\n\t * @param event\n\t * @param row\n\t * @returns {boolean} whether the event should stop further processing on the parent (SFAbstractTable) level\n\t * @private\n\t */\n\t_onEscapePress(event, row) {\n\t\t// discard inline edit change if it comes from a field being inline edited\n\t\tlet container = row.findElementForEvent(event, TemplateGenerator.classNames.EDIT_MODE);\n\t\tif (container && container.getAttribute('field')) {\n\t\t\t// additional discount field is special (of course) and we need to invoke resetToOriginal directly\n\t\t\tif (container.getAttribute('field') === row._getEditorModel().constants.ADDITIONAL_DISCOUNT_FIELD) {\n\t\t\t\tlet discountComp = container.querySelector('sb-discount');\n\t\t\t\tif (discountComp) {\n\t\t\t\t\tdiscountComp.resetToOriginal();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trow.setDiscardPendingEdit(true);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Device-aware logic for applying focus\n\t * @param container\n\t * @param evt\n\t * @param row, the table row\n\t * @private\n\t */\n\tapplyFocus(container, evt, row) {\n\t\tlet table = row.getTableComponent(evt);\n\t\tif (table) {\n\t\t\ttable.applyCellFocus(container);\n\t\t}\n\t}\n}\n","/**\n * Abstract class for concrete, device-aware table row implementation\n */\nexport class DeviceDelegate {\n\n\t/**\n\t * Initialize device-aware listeners for the row\n\t * @param row Row for which listeners are initialized\n\t */\n\tinitListeners(row) {}\n\n\t/**\n\t * Device-aware onTap handling\n\t * @param evt The tap event\n\t * @param row Row being tapped\n\t */\n\tonTap(evt, row) {}\n\n\t/**\n\t * Device-aware logic for when row is expanded, (mobile row or drawer on desktop)\n\t * @param newValue New value of expansion\n\t * @param oldValue Old value of expansion\n\t * @param row The row for which the expansion state is changing\n\t */\n\texpansionChanged(newValue, oldValue, row) {}\n\n\t/**\n\t * Device-aware logic for toggling inline edit\n\t * @param container The container div for the edited field\n\t * @param isEdit Whether inline edit is being turned on or off\n\t * @param field Name of field being edited\n\t * @param metadata Metadata for the field being edited\n\t * @param row The row for which inline edit is being toggled\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row) {}\n\n\t/**\n\t * Device-aware keydown handler\n\t * @param event\n\t * @param row\n\t */\n\tonKeyDown(event, row) {}\n\n\t/**\n\t * Device-aware logic for applying focus\n\t * @param container\n\t * @param evt\n\t * @param row, the table row\n\t */\n\tapplyFocus(container, evt, row) {}\n}\n\n\n","import {ControllingField} from 'quotes/layout/sf-le-table-row/ControllingField.js';\n\n/**\n * Represents a controlling field that updates the editability of its controlled fields\n */\nexport class EditabilityControllingField extends ControllingField {\n\n\tupdateControlledFields(tableRow, controllingFieldValue) {\n\t\tif (this._getEditableFieldValues().includes(controllingFieldValue)) {\n\t\t\tlet markedEditable = false;\n\t\t\tthis._getControlledFields().forEach((field) => {\n\t\t\t\tif (tableRow.lineModel.isFieldRendered(field) && tableRow.lineModel.isEditable(field)) {\n\t\t\t\t\tvar tableCell = tableRow.querySelector('div[field=\\'' + field + '\\']');\n\t\t\t\t\tif (tableCell) {\n\t\t\t\t\t\tmarkedEditable = true;\n\t\t\t\t\t\ttableCell.classList.add('editable');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (markedEditable) {\n\t\t\t\t// if anything was switched to editable, we need to load hover pencils for this row if necessary\n\t\t\t\ttableRow._handleEditableCellsHover(true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._getControlledFields().forEach((field) => {\n\t\t\t\tif (tableRow.lineModel.isFieldRendered(field)) {\n\t\t\t\t\tvar tableCell = tableRow.querySelector('div[field=\\'' + field + '\\']');\n\t\t\t\t\tif(tableCell) {\n\t\t\t\t\t\ttableCell.classList.remove('editable');\n\t\t\t\t\t}\n\t\t\t\t\tif (this._shouldClearFieldValue()) {\n\t\t\t\t\t\ttableRow._clearFieldValue(field);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Returns list of controlled fields\n\t *\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getControlledFields() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Returns the values of the controlling field in which controlled fields should\n\t * be marked editable.  Otherwise, they should be marked uneditable.\n\t *\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getEditableFieldValues() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Returns true if the controlled field value should be cleared when it is\n\t * marked undeditable\n\t *\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_shouldClearFieldValue() {\n\t\treturn true;\n\t}\n}\n\n\n","import {DeviceDelegate} from 'quotes/layout/sf-le-table-row/DeviceDelegate.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n\nexport class MobileDelegate extends DeviceDelegate {\n\n\tstatic getInstance() {\n\t\tif (!this._instance) {\n\t\t\tthis._instance = new MobileDelegate();\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\t/**\n\t * @override\n\t * @param row\n\t */\n\tinitListeners(row) {\n\t\trow.listeners['row-swiped'] = 'onRowSwiped';\n\t}\n\n\t/**\n\t * @override\n\t * @param evt\n\t * @param row\n\t */\n\tonTap(evt, row) {\n\t\tif(evt && !row.expansionDisabled && row.findElementForEvent(evt, 'primary')){\n\t\t\tvar expanded = row.toggleExpanded();\n\t\t\tvar swipeCont = row.querySelector('sb-swipe-container')\n\t\t\tif(swipeCont !== null) {\n\t\t\t\tswipeCont.groupExpanded = expanded;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * If row is swiped in Mobile, the expansion of the row should be disabled\n\t * @override\n\t * @param e - row swipe event\n\t * @param row\n\t */\n\tonRowSwiped(e, row) {\n\t\tif(e && e.detail) {\n\t\t\trow.expansionDisabled = e.detail.isOpen;\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param newValue\n\t * @param oldValue\n\t * @param row\n\t */\n\texpansionChanged(newValue, oldValue, row) {\n\t\tif(!row.expansionDisabled) {\n\t\t\tlet spanElem = row.$$('.container.first');\n\t\t\tif (spanElem) {\n\t\t\t\tlet secondaryContainer = row.$$('.secondary');\n\t\t\t\tif (!secondaryContainer) {\n\t\t\t\t\t//secondary container hasn't been loaded yet\n\t\t\t\t\tthis._loadSecondaryFields(row);\n\t\t\t\t\tsecondaryContainer = row.$$('.secondary'); // container exists now\n\t\t\t\t}\n\t\t\t\tspanElem.classList.toggle(TemplateGenerator.classNames.EXPANDED, newValue); // toggle chevron\n\t\t\t\tsecondaryContainer.classList.toggle(TemplateGenerator.classNames.EXPANDED, newValue); // toggle container\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Lazy Load the secondary fields by hydrating and applying instance to the dom.\n\t * @private\n\t */\n\t_loadSecondaryFields(row) {\n\t\trow.templateInstance = row.hydrateTemplateFromNode(row.secondaryRowTemplate.cloneNode(true), row.uiData);\n\t\tPolymer.dom(row.$.content).appendChild(row.templateInstance.root);\n\t\t//Setup editable fields\n\t\tlet fields = Array.from(row.$$('.secondary').children);\n\t\tfields.forEach((field) => {\n\t\t\tif(field.classList.contains(TemplateGenerator.classNames.EDITABLE) &&\n\t\t\t\t!field.classList.contains(TemplateGenerator.classNames.BOOLEAN)) {\n\t\t\t\t// hide all read elements on first time when secondary fields are loaded\n\t\t\t\tlet readElem = field.querySelector('.r');\n\t\t\t\tif (readElem) {\n\t\t\t\t\trow.toggleClass('hidden', true, readElem);\n\t\t\t\t}\n\t\t\t\trow.toggleInlineEdit(field, true);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t * @param container\n\t * @param isEdit\n\t * @param field\n\t * @param metadata\n\t * @param row\n\t */\n\ttoggleInlineEdit(container, isEdit, field, metadata, row) {\n\t\tlet writeElem = container.querySelector('.w');\n\t\trow.toggleClass(TemplateGenerator.classNames.EDIT_MODE, isEdit, container);\n\t\t// add / remove edit field component\n\t\tif (isEdit) {\n\t\t\tif (!writeElem) {\n\t\t\t\trow._createWritableElement(field, container);\n\t\t\t}\n\t\t} else if (writeElem && row.commitPendingEdit())  {\n\t\t\t// recreate the write element so that it can be populated with the newly formatted value\n\t\t\t// not ideal, but until we can re-stamp the edit component\n\t\t\trow._formatNewValue(field, metadata);\n\t\t\twriteElem.removeChild(writeElem.firstChild); // remove div element\n\t\t\trow._createEditField(writeElem, container.getAttribute('index'), field);\n\t\t}\n\t}\n}","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class NonDiscountableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.NON_DISCOUNTABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD,\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,\n\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [false];\n\t}\n}\n\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PriceEditableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICE_EDITABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.LIST_PRICE_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [true];\n\t}\n\n\t_shouldClearFieldValue() {\n\t\treturn false;\n\t}\n\n}\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PricingMethodControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICING_METHOD_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.MARKUP_FIELD,\n\t\t\tQuoteContext.constants.MARKUP_AMOUNT_FIELD,\n\t\t\tQuoteContext.constants.MARKUP_RATE_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn ['Cost'];\n\t}\n}\n\n\n","import {QuoteContext} from 'quotes/QuoteContext.js';\nimport {EditabilityControllingField} from 'quotes/layout/sf-le-table-row/EditabilityControllingField.js';\n\nexport class PricingMethodEditableControllingField extends EditabilityControllingField {\n\n\tgetFieldName() {\n\t\treturn QuoteContext.constants.PRICING_METHOD_EDITABLE_FIELD;\n\t}\n\n\t_getControlledFields() {\n\t\treturn [\n\t\t\tQuoteContext.constants.PRICING_METHOD_FIELD\n\t\t];\n\t}\n\n\t_getEditableFieldValues() {\n\t\treturn [true];\n\t}\n\n\t_shouldClearFieldValue() {\n\t\treturn false;\n\t}\n\n}\n\n\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {Formatter} from 'common/formatter/Formatter.js';\nimport {SFComponentFactory} from 'quotes/sf-component-factory/SFComponentFactory.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {SFTableRowBehavior} from 'common/behaviors/SFTableRowBehavior.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {registerComponent} from 'quotes/models/UiNotifier.js';\nimport {DateParser} from \"common/forms/DateParser.js\";\nimport {DependentPicklistBuilder} from \"common/forms/DependentPicklistBuilder.js\";\nimport {AppContext} from 'common/core/AppContext.js';\nimport {DeviceBehavior} from 'common/behaviors/DeviceBehavior.js';\nimport {DesktopDelegate} from 'quotes/layout/sf-le-table-row/DesktopDelegate.js';\nimport {MobileDelegate} from 'quotes/layout/sf-le-table-row/MobileDelegate.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {ControllingField} from 'quotes/layout/sf-le-table-row/ControllingField.js';\nimport {PricingMethodControllingField} from 'quotes/layout/sf-le-table-row/PricingMethodControllingField.js';\nimport {NonDiscountableControllingField} from 'quotes/layout/sf-le-table-row/NonDiscountableControllingField.js';\nimport {PricingMethodEditableControllingField} from 'quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js';\nimport {PriceEditableControllingField} from 'quotes/layout/sf-le-table-row/PriceEditableControllingField.js';\n\n/**\n * Row level component for templatizing and stamping row HTML\n *\n * @author kzheng\n * @since 212\n */\nexport class SFLETableRow {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.SFTableRowBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-le-table-row';\n\n\t\tthis.properties = Polymer.Base.extend({\n\n\t\t\t// line model contains raw data and UI data\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\n\t\t\t// presentation data for stamping row template\n\t\t\tuiData: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: \"_populateContent\"\n\t\t\t},\n\n\t\t\t// whether the row represents a segmented line\n\t\t\tisSegmented: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t},\n\n\t\t\t// column width for resizing\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: \"_columnsResized\"\n\t\t\t},\n\n\t\t\t// original field values for dirty field tracking (post inline edit pre server save)\n\t\t\toriginalFieldValues: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\n\t\t\t//Template for mobile's secondary fields\n\t\t\tsecondaryRowTemplate: {\n\t\t\t\ttype: Object\n\t\t\t},\n\n\t\t\t// flag to track whether this row has be marked dirty (as in any cell was edited)\n\t\t\tisDirty: Boolean,\n\n\t\t\t// row index\n\t\t\tdataIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t},\n\n\t\t\t//flag for disabling secondary drawer from opening when row is swiped\n\t\t\texpansionDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t},SFTableRowBehavior.properties );\n\n\t\tthis.listeners = {\n\t\t\ttap: 'onTap',\n\t\t\tchange: 'onChange',\n\t\t\t'selected-date-changed': 'onChange',\n\t\t\t'rte-value-changed': 'onChange',\n\t\t\t'lookup-value-changed': 'onChange'\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_recordChanged(lineModel.lineVO.record.*)',        // for global events such as calculate\n\t\t\t'_expansionChanged(lineModel.lineVO.expanded)',     // table-wide drawer expand / collapse\n\t\t\t'_selectionChanged(lineModel.selected)',            // table-wide select all\n\t\t];\n\t}\n\n\tcreated() {\n\t\tthis._deviceDelegate = AppContext.isMobile ? MobileDelegate.getInstance() : DesktopDelegate.getInstance();\n\t\tthis._deviceDelegate.initListeners(this);\n\t}\n\n\tready() {\n\t\t// For shady DOM, we need to make sure all element sub-trees are properly scoped with host's css class\n\t\t// see scopeSubtree for detail (https://www.polymer-project.org/1.0/docs/api/Polymer.Base#method-scopeSubtree)\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\n\t\tthis.deviceClasses = '';\n\t\tlet devices = new DeviceBehavior().getDeviceClasses();\n\t\tfor (let device of devices) {\n\t\t\tthis.deviceClasses += device + ' ';\n\t\t}\n\t}\n\n\tgetControllingFields() {\n\t\treturn [\n\t\t\tnew PricingMethodControllingField(),\n\t\t\tnew NonDiscountableControllingField(),\n\t\t\tnew PricingMethodEditableControllingField(),\n\t\t\tnew PriceEditableControllingField()\n\t\t];\n\t}\n\n\t/**\n\t * React to row template change, in which case templateInstance may need to be rebuilt and data re-stamped\n\t * @Override\n\t * @private\n\t */\n\t_rowTemplateChanged(newValue, oldValue) {\n\t\t// clear out old template instance and HTML content if it's already been built\n\t\tif (this.templateInstance) {\n\t\t\tPolymer.dom(this.$.content).innerHTML = '';\n\t\t\tthis.templateInstance = null;\n\t\t}\n\t\tthis._populateContent();\n\t}\n\n\t/**\n\t * Invoked when rowTemplate and uiData become available to hydrate this row's template\n\t * @private\n\t */\n\t_populateContent() {\n\t\tif (this.rowTemplate && this.uiData) {\n\t\t\tif (this.templateInstance) {\n\t\t\t\t// row is already templatized, just update its content\n\t\t\t\tObject.keys(this.uiData).forEach((key) => {\n\t\t\t\t\tthis.templateInstance[key] = this.uiData[key];\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.templateInstance = this.hydrateTemplateFromNode(this.rowTemplate.cloneNode(true), this.uiData);\n\t\t\t\tPolymer.dom(this.$.content).appendChild(this.templateInstance.root);\n\t\t\t}\n\t\t\tthis._resetPencilLoaded();\n\t\t\tthis._refreshDirtyIndicators();\n\t\t\t// line warning is lazily added when applicable\n\t\t\tif (this.uiData.hasLineWarning) {\n\t\t\t\tthis._loadLineWarning();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Lazy load line warning\n\t * @private\n\t */\n\t_loadLineWarning() {\n\t\tlet container = this.querySelector('#itemNumber .warning');\n\t\tif (container && !container.hasChildNodes()) {\n\t\t\tlet elem = document.createElement('sf-line-warning');\n\t\t\telem.key = this.uiData.lineWarningKey;\n\t\t\telem.message = this.uiData.lineWarningMsg;\n\t\t\tcontainer.appendChild(elem);\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when the underlying record has changed, such as when user clicks calculate\n\t * @param newValue the new record\n\t * @param oldValue the old record\n\t * @private\n\t */\n\t_recordChanged(newValue, oldValue) {\n\t\t// we're only interested in record change when template has been hydrated\n\t\tif (this.templateInstance) {\n\t\t\tlet path = newValue.path;\n\t\t\tif (path !== LineModel.recordPath) {\n\t\t\t\t// individual field changed\n\t\t\t\tlet field = path.substring(LineModel.recordPath.length + 1);\n\t\t\t\tlet rawData = newValue.value;\n\t\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\t\tif(metadata) {\n\t\t\t\t\tthis.templateInstance[field] = Formatter.formatFieldData(this.lineModel, rawData, metadata, this._getRecord());\n\t\t\t\t\tthis._handleChangeControllingField(metadata.name, newValue.value);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// entire line has changed\n\t\t\t\tthis.templateInstance.lineModel = this.lineModel;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Create, hydrate and attach inline-edit field the given container field\n\t * @param parentElement The parent element where the inline edit field will be appended to\n\t * @param index index of the field in this row\n\t * @param name of field\n\t */\n\t_createEditField(parentElement, index, field) {\n\t\tlet metadata = this._getFieldMetadata(field);\n\t\tlet editField = SFComponentFactory.getFieldComponent(metadata, this.lineModel, index);\n\t\tlet templateData = {};\n\t\teditField.attachTo(templateData);\n\t\tlet templateInstance = this.hydrateTemplate(editField.html, templateData);\n\t\tparentElement.appendChild(templateInstance.root);\n\t}\n\n\t/**\n\t * Handles change event from inline editing:\n\t * - Update data model with new value\n\t * - Clear/update dependent picklist when applicable\n\t * @param evt\n\t */\n\tonChange(evt) {\n\t\tlet container = SFAbstractTable.findCell(evt);\n\t\tif (container) {\n\t\t\tlet field = container.getAttribute('field');\n\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\tif (evt.detail) {\n\t\t\t\t// THe new edited value is pending until committed (when inline edit is toggled off)\n\t\t\t\tthis._pendingEdit = {\n\t\t\t\t\tfield: field,\n\t\t\t\t\teventDetail: evt.detail,\n\t\t\t\t\teventType: evt.type\n\t\t\t\t};\n\n\t\t\t\t// For RTE, onChange signals editing is over and it should be committed\n\t\t\t\tif (metadata.extraTypeInfo === \"richtextarea\") {\n\t\t\t\t\tthis.toggleInlineEdit(container, false);\n\t\t\t\t\t//removing the child for rte before calling toggleInlineEdit bc we don't remove it in\n\t\t\t\t\t// toggleInlineEdit\n\t\t\t\t\tcontainer.removeChild(container.querySelector('.w'));\n\t\t\t\t\t// put focus back on the read element\n\t\t\t\t\tthis._applyFocus(container, evt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Updates \"discardPendingEdit\" flag to indicate whether pending edit should be ignored\n\t * This flag is set to true when user hits escape key,\n\t * then it's consumed by \"commitPendingEdit\" method, which resets it back to false\n\t * @param value\n\t */\n\tsetDiscardPendingEdit(value) {\n\t\tthis._discardPendingEdit = value;\n\t}\n\n\t/**\n\t * Invoked when inline edit is turned off, commit the pending value into object model\n\t * Commit might be ignored if there's no pending data, or discardPendingEdit is set to true\n\t * @return {Boolean} true if pending edit data is available and is committed, false otherwise\n\t */\n\tcommitPendingEdit() {\n\t\tlet committed = false;\n\t\tif (this._pendingEdit && !this._discardPendingEdit) {\n\t\t\tlet field = this._pendingEdit.field;\n\t\t\tlet eventDetail = this._pendingEdit.eventDetail;\n\t\t\tlet eventType = this._pendingEdit.eventType;\n\t\t\tthis._preserveOriginalValue(field);\n\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\tthis._getRecord()[field] = this._parseFieldData(metadata, eventDetail.value);\n\t\t\tif (metadata) {\n\t\t\t\tif (metadata.controllingPicklist) {\n\t\t\t\t\t// dependent picklist handling\n\t\t\t\t\tthis._updateDependentPicklist(field);\n\t\t\t\t} else if (metadata.relationshipName && eventType === 'lookup-value-changed') {\n\t\t\t\t\t// reference field also need updating of its relationship field (__r)\n\t\t\t\t\tthis._getRecord()[metadata.relationshipName] = eventDetail.value == null ? undefined : {\n\t\t\t\t\t\tId: eventDetail.value,\n\t\t\t\t\t\tName: eventDetail.refDisplay\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._handleChangeControllingField(metadata.name, eventDetail.value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommitted = true;\n\t\t\t// We don't need to calculate if customer total is set\n\t\t\tif (this._calculateImmediately(field)) {\n\t\t\t\tthis.fire('calculate-immediately');\n\t\t\t}\n\t\t}\n\t\tthis._discardPendingEdit = false;\n\t\tthis._pendingEdit = null;\n\t\treturn committed;\n\t}\n\n\tonRteCancel(evt) {\n\t\tlet container = SFAbstractTable.findCell(evt);\n\t\tthis.toggleInlineEdit(container, false);\n\t\t//removing the child for rte before calling toggleInlineEdit bc we don't remove it in\n\t\t// toggleInlineEdit\n\t\tcontainer.removeChild(container.querySelector('.w'));\n\t\t// put focus back on the read element\n\t\tthis._applyFocus(container, evt);\n\t}\n\n\t/**\n\t * when a controlling picklist's value has changed,\n\t * clear out the dependent picklist's value if necessary\n\t * @private\n\t */\n\t_updateDependentPicklist(controllerField) {\n\t\tlet depFields = this._getEditorModel().getDependentFields(controllerField);\n\t\tif (depFields && depFields.length > 0) {\n\t\t\tdepFields.forEach((field) => {\n\t\t\t\tlet value = this._getFieldValue(field);\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tlet metadata = this._getFieldMetadata(field);\n\t\t\t\t\tlet newOptions = new DependentPicklistBuilder(metadata, this._getFieldValue(controllerField)).build();\n\t\t\t\t\tlet values = metadata.type === 'multipicklist' ? value.split(';') : [value];\n\t\t\t\t\t// iterate through the values list, break when a value is not found in the new options list and dependent picklist is cleared\n\t\t\t\t\tvalues.some((v) => {\n\t\t\t\t\t\tlet validOption = newOptions.some((option) => {\n\t\t\t\t\t\t\treturn option.value === v;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!validOption) {\n\t\t\t\t\t\t\t// no valid option matches the current value so clear it out\n\t\t\t\t\t\t\tthis._clearFieldValue(field);\n\t\t\t\t\t\t\t// propagate the update further downstream when there's a dependency chain\n\t\t\t\t\t\t\tthis._updateDependentPicklist(field);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t_handleChangeControllingField(controllingFieldName, controllingFieldValue) {\n\t\tthis.getControllingFields().forEach((controllingField) => {\n\t\t\tif (controllingField.getFieldName() == controllingFieldName) {\n\t\t\t\tcontrollingField.updateControlledFields(this, controllingFieldValue);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Goes through a parser to check if the value passed is valid or needs a lil' formatting.\n\t * @param metadata\n\t * @param detailValue is the new value the user inputted\n\t * @return {object} parsed field data object\n\t */\n\t_parseFieldData(metadata, detailValue) {\n\t\tif (detailValue === '' || detailValue === null) {\n\t\t\treturn null;\n\t\t}\n\t\tswitch (metadata.type) {\n\t\t\tcase 'currency':\n\t\t\tcase 'double':\n\t\t\tcase 'percent':\n\t\t\t\t//Parse the value in case it's invalid: ex. 2,0000\n\t\t\t\tlet numberParser = new NumberParser();\n\t\t\t\treturn numberParser.parse(detailValue, false, metadata.scale);\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\tlet dateParser = new DateParser();\n\t\t\t\tlet dateObj = dateParser.parse(detailValue);\n\t\t\t\treturn metadata.type === 'date' ?\n\t\t\t\t\tFormatter.toApexDate(dateObj) :\n\t\t\t\t\tFormatter.toApexDateTime(dateObj);\n\t\t\tdefault:\n\t\t\t\treturn detailValue;\n\t\t}\n\t}\n\n\t/**\n\t * Hide/show edit field\n\t * When inline edit begins, turn off other inline edit fields on the same row to ensure only one field is being edited at any time\n\t * When inline edit ends, update the templateInstance with formatted data\n\t * @param container\n\t * @param isEdit\n\t * @param isEditOnFocus whether this is a result of keyboard navigation focus move\n\t */\n\ttoggleInlineEdit(container, isEdit, isEditOnFocus = false) {\n\t\tif (!container || !container.classList.contains('editable')) {\n\t\t\treturn;\n\t\t}\n\t\tlet field = container.getAttribute('field');\n\t\tlet metadata = this._getFieldMetadata(field);\n\t\t// boolean or checkbox types can be edited directly so we're not doing anything to toggle inline edit\n\t\tif (metadata.type === 'boolean' || metadata.type === 'checkbox') {\n\t\t\treturn;\n\t\t}\n\t\t// skip toggling if the field is RTE and it's coming from \"edit on focus\" (i.e., keyboard nav from another editing field)\n\t\tif (isEdit && isEditOnFocus && metadata.extraTypeInfo === \"richtextarea\") {\n\t\t\treturn;\n\t\t}\n\t\t// special handling for \"SBQQ__AdditionalDiscount__c\" field\n\t\tif (QuoteContext.isDiscountField(field) && isEdit) {\n\t\t\tthis._preserveOriginalValue(QuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD);\n\t\t\tthis._preserveOriginalValue(QuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD);\n\t\t\tthis._preserveOriginalValue(QuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD);\n\t\t}\n\t\tthis._deviceDelegate.toggleInlineEdit(container, isEdit, field, metadata, this);\n\t}\n\n\t/**\n\t * Format the new value that the user has inputted.\n\t * And add it to the field's template instance\n\t * @param field\n\t * @param metadata\n\t * @returns newValue\n\t * @private\n\t */\n\t_formatNewValue(field, metadata) {\n\t\tlet newValue = this._getFieldValue(field);\n\t\tlet formattedValue = Formatter.formatFieldData(this.lineModel, newValue, metadata, this._getRecord());\n\t\tthis.templateInstance[field] = formattedValue;\n\t\treturn newValue;\n\t}\n\n\t/**\n\t * Create a writable element for the field.\n\t * @param field\n\t * @param container\n\t * @private\n\t */\n\t_createWritableElement(field, container) {\n\t\tlet writeElem = document.createElement('div');\n\t\twriteElem.className = 'w';\n\t\tlet index = container.getAttribute('index');\n\t\tthis._createEditField(writeElem, index, field);\n\t\tcontainer.appendChild(writeElem);\n\t\treturn writeElem;\n\t}\n\n\thook_onHovered(evt) {\n\t\tif (this.isSegmented) {\n\t\t\tthis._handleSegmentedCellHover(evt);\n\t\t}\n\t\tthis._handleEditableCellsHover();\n\t}\n\n\t// QLE table only tap handling\n\thook_onTap(evt, handled, containerEditable) {\n\t\tlet editorModel = this._getEditorModel();\n\t\tthis._deviceDelegate.onTap(evt, this);\n\n\t\t// drawer icon\n\t\tif (!handled && editorModel.hasDrawerFields()) {\n\t\t\tlet drawerContainer = this.findElementForEvent(evt, 'drawerContainer');\n\t\t\tif (drawerContainer) {\n\t\t\t\tthis.toggleDrawer();\n\t\t\t}\n\t\t}\n\t\t// checkbox selection or boolean field edit\n\t\tlet cbContainer = this.findElementForEvent(evt, 'checkboxcontainer');\n\t\tif (cbContainer) {\n\t\t\tthis.toggleCheckbox(cbContainer);\n\t\t}\n\t\t// Segmented line drawer\n\t\tif (!handled && this.lineModel.segments) {\n\t\t\tlet segmentedContainer = this.findElementForEvent(evt, 'segmentedContainer');\n\t\t\tif (segmentedContainer) {\n\t\t\t\tthis.toggleDrawer();\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(event) {\n\t\tthis._deviceDelegate.onKeyDown(event, this);\n\t}\n\n\tonRowSwiped(event) {\n\t\tthis._deviceDelegate.onRowSwiped(event, this);\n\t}\n\n\t/**\n\t * Toggle the value of a checkbox/boolean field or row select checkbox\n\t * This also causes lineModel.selected (for row selection) or lineModel.lineVO.record.[field] value (for boolean field) to change and triggers event listener to react if applicable\n\t * @param cbContainer The div with 'checkboxcontainer' class\n\t * @private\n\t */\n\ttoggleCheckbox(cbContainer) {\n\t\tif (cbContainer && cbContainer.parentElement) {\n\t\t\tlet grandParentElem = cbContainer.parentElement.parentElement;\n\t\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\t\tif (grandParentElem && cb) {\n\t\t\t\tif (grandParentElem.classList.contains(TemplateGenerator.classNames.EDITABLE)) {\n\t\t\t\t\tlet fieldName = grandParentElem.getAttribute('field');\n\t\t\t\t\tif (fieldName) {\n\t\t\t\t\t\t// it's an editable boolean field\n\t\t\t\t\t\tthis.set(`lineModel.lineVO.record.${fieldName}`, !cb.checked);\n\t\t\t\t\t}\n\t\t\t\t} else if (cbContainer.parentElement.classList.contains(TemplateGenerator.classNames.SELECTION) && this._getEditorModel().data.settings.multiLineDeleteEnabled) {\n\t\t\t\t\t// row selection checkbox\n\t\t\t\t\tthis.set('lineModel.selected', !cb.checked);\n\t\t\t\t\tif (cb.checked) {\n\t\t\t\t\t\tthis.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key] = this.lineModel;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Given an event, look for an element that contains the expected class in the event's path\n\t * @param event\n\t * @param clazz\n\t */\n\tfindElementForEvent(event, clazz) {\n\t\treturn Polymer.dom(event).path.find((pathElem) => {\n\t\t\tlet classList = pathElem.classList;\n\t\t\treturn classList && classList.contains(clazz);\n\t\t});\n\t}\n\n\t/**\n\t * Toggle drawer component for this row\n\t */\n\ttoggleDrawer() {\n\t\t// toggle data model, this causes the drawer to expand/collapse via 2-way binding\n\t\tthis.toggleExpanded();\n\t\t// extra event to tell iron-list to resize when LQE is enabled\n\t\tif(this._getEditorModel().largeQuoteExperienceEnabled || this._getEditorModel().isMultiGroupViewEnabled) {\n\t\t\tthis.fire('line-toggled', {index: this._getLineNumber() - 1});\n\t\t}\n\t}\n\n\ttoggleExpanded() {\n\t\tlet expanded = !this.lineModel.lineVO.expanded;\n\t\tthis.set('lineModel.lineVO.expanded', expanded);\n\t\treturn expanded;\n\t}\n\n\t/**\n\t * Invoked when line's expanded state changes\n\t * @param newValue the new value for lineModel.lineVO.expanded\n\t * @param oldValue the old value for lineModel.lineVO.expanded\n\t * @private\n\t */\n\t_expansionChanged(newValue, oldValue) {\n\t\tthis._deviceDelegate.expansionChanged(newValue, oldValue, this);\n\t}\n\n\t/**\n\t * Invoked when line's selection state changes\n\t * @private\n\t */\n\t_selectionChanged() {\n\t\tlet cbContainer = this.$$('.checkboxcontainer');\n\t\tif (cbContainer && !cbContainer.classList.contains(TemplateGenerator.classNames.DISABLED)) {\n\t\t\tlet cb = cbContainer.querySelector('input[type=checkbox]');\n\t\t\tcb.checked = this.lineModel.selected;\n\t\t}\n\t}\n\n\t_getFieldMetadata(field) {\n\t\treturn this._getEditorModel().getFieldMetadata(field);\n\t}\n\n\t_getEditorModel() {\n\t\treturn this.lineModel.editorModel;\n\t}\n\n\t_getLineNumber() {\n\t\treturn this.uiData.lineNumber;\n\t}\n\n\t_getRecord() {\n\t\treturn this.uiData.lineModel.lineVO.record;\n\t}\n\n\t_getFieldValue(field) {\n\t\treturn this._getRecord()[field];\n\t}\n\n\t/**\n\t * Clear record's field value via Polymer API\n\t * @param field\n\t * @param value\n\t * @private\n\t */\n\t_clearFieldValue(field) {\n\t\tthis._preserveOriginalValue(field);\n\t\tthis.set(`lineModel.lineVO.record.${field}`, null);\n\t\tif (this.templateInstance) {\n\t\t\tthis.templateInstance[field] = null;\n\t\t}\n\t}\n\n\t/**\n\t * Event bus registration\n\t * @param model\n\t * @private\n\t */\n\t_modelChanged() {\n\t\tregisterComponent(this, 'lineModel');\n\t\t// register DnD track listener\n\t\tthis.unlisten(this, 'track', 'onTrack');\n\t\tif (this._isDragAndDropEnabled()) {\n\t\t\tthis.listen(this, 'track', 'onTrack');\n\t\t}\n\t}\n\n\t/**\n\t * DnD is enabled only for non-LQE desktop\n\t * @returns {*|boolean}\n\t * @private\n\t */\n\t_isDragAndDropEnabled() {\n\t\treturn AppContext.isDesktop && !this.lineModel.editorModel.largeQuoteExperienceEnabled;\n\t}\n\n\t/**\n\t * Lazy load segmented cell tooltip\n\t * @private\n\t */\n\t_handleSegmentedCellHover(evt) {\n\t\tlet fieldContainer = this.findElementForEvent(evt, 'container');\n\t\tif (fieldContainer) {\n\t\t\tlet field = fieldContainer.getAttribute('field');\n\t\t\tif (field && !field.endsWith('__c') && field !== 'total') {\n\t\t\t\tif (!fieldContainer.querySelector('paper-tooltip')) {\n\t\t\t\t\tlet tooltipCmp = document.createElement('paper-tooltip');\n\t\t\t\t\ttooltipCmp.position = 'bottom';\n\t\t\t\t\ttooltipCmp.animationDelay = 0;\n\t\t\t\t\tfieldContainer.appendChild(tooltipCmp);\n\t\t\t\t\tlet tooltipBody = document.createElement('sf-segmented-cell-tooltip');\n\t\t\t\t\ttooltipBody.lineModel = this.lineModel;\n\t\t\t\t\ttooltipBody.field = field;\n\t\t\t\t\tPolymer.dom(tooltipCmp).appendChild(tooltipBody);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Lazy load pencil icons for editable cells\n\t * @private\n\t */\n\t_handleEditableCellsHover(forceLoad) {\n\t\tif (!this._pencilLoaded || forceLoad) {\n\t\t\tlet editableCells = this.querySelectorAll('.container.editable');\n\t\t\tif (editableCells && editableCells.length > 0) {\n\t\t\t\tlet cellsArr = Array.from(editableCells);\n\t\t\t\tlet resizeRow = false;\n\t\t\t\tcellsArr.forEach((cell) => {\n\t\t\t\t\tif (!cell.querySelector('span.pencil')) {\n\t\t\t\t\t\tresizeRow = true;\n\t\t\t\t\t\tlet pencilSpan = document.createElement('span');\n\t\t\t\t\t\tpencilSpan.classList.add(TemplateGenerator.classNames.EDIT_ICON);\n\t\t\t\t\t\tif (cell.classList.contains(TemplateGenerator.classNames.RIGHT) ||\n\t\t\t\t\t\t\tcell.classList.contains(TemplateGenerator.classNames.CENTER)) {\n\t\t\t\t\t\t\tlet readElem = cell.querySelector('div.r');\n\t\t\t\t\t\t\treadElem.insertBefore(pencilSpan, readElem.firstChild);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcell.querySelector('div.r').appendChild(pencilSpan);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t\t\t});\n\n\t\t\t}\n\t\t\tthis._pencilLoaded = true;\n\t\t}\n\t}\n\n\t/**\n\t * Preserve original field value before updating\n\t * @param field\n\t * @private\n\t */\n\t_preserveOriginalValue(field) {\n\t\tlet recordId = this._getRecordOrSourceId();\n\t\tif (!this.originalFieldValues[recordId]) {\n\t\t\tthis.originalFieldValues[recordId] = {};\n\t\t}\n\t\tif (!this.originalFieldValues[recordId].hasOwnProperty(field)) {\n\t\t\tthis.originalFieldValues[recordId][field] = this._getRecord()[field];\n\t\t}\n\t}\n\n\t/**\n\t * Toggle the dirty CSS class for a given field for the newValue\n\t * @param newValue\n\t * @param field\n\t * @param container The div container whose css class is to be toggled\n\t * @private\n\t */\n\t_toggleDirtyClass(newValue, field, container) {\n\t\tif (container) {\n\t\t\tlet dirty;\n\t\t\tlet recordId = this._getRecordOrSourceId();\n\t\t\tlet originalValues = this.originalFieldValues[recordId];\n\t\t\tif (originalValues) {\n        \t\tif (QuoteContext.isDiscountField(field)) {\n\t\t\t\t\tdirty = this._isAdditionalDiscountUpdated(originalValues);\n\t\t\t\t} else {\n\t\t\t\t\tdirty = originalValues.hasOwnProperty(field) && originalValues[field] !== newValue;\n\t\t\t\t}\n\n\t\t\t\t// Add/Remove the dirty class\n\t\t\t\tif (dirty) {\n\t\t\t\t\tif(!container.classList.contains(TemplateGenerator.classNames.DIRTY)) {\n\t\t\t\t\t\tcontainer.classList.add(TemplateGenerator.classNames.DIRTY);\n\t\t\t\t\t}\n\t\t\t\t\tthis.isDirty = true;\n\t\t\t\t}else {\n\t\t\t\t\tcontainer.classList.remove(TemplateGenerator.classNames.DIRTY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Whether AdditionalDiscount field has new value\n\t * @param originalValues\n\t * @private\n\t */\n\t_isAdditionalDiscountUpdated(originalValues) {\n\t\tlet discount = QuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD;\n\t\tlet discountAmount = QuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD;\n\t\tlet additionalDiscount = QuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD;\n\n\t\t//pre-existing lines have some undefined discount values based on the unit of discount on the quote line\n\t\tlet discountAmountChanged =\n\t\t\tthis._getRecord()[discountAmount] !== undefined && originalValues[discountAmount] !== undefined &&\n\t\t\toriginalValues[discountAmount] !== this._getRecord()[discountAmount];\n\t\tlet additionalDiscountChanged =\n\t\t\tthis._getRecord()[additionalDiscount] !== undefined && originalValues[additionalDiscount] !== undefined &&\n\t\t\toriginalValues[additionalDiscount] !== this._getRecord()[additionalDiscount];\n\t\tlet discountChanged =\n\t\t\tthis._getRecord()[discount] !== undefined && originalValues[discount] !== undefined &&\n\t\t\toriginalValues[discount] !== this._getRecord()[discount];\n\n\t\treturn discountAmountChanged || additionalDiscountChanged || discountChanged;\n\t}\n\n\t/**\n\t * Reset the _pencilLoaded attribute if pencil has been shown.\n\t * We want to do this for each line because we re-use the following row(s) when cloning, sorting, deleting...\n\t * which can cause the pencil icon to not appear (or appear) on a row that previously was not an editable cell\n\t */\n\t_resetPencilLoaded() {\n\t\tif(this._pencilLoaded) {\n\t\t\tlet pencilSpans = Array.from(this.querySelectorAll('.container.editable span.pencil'));\n\t\t\tpencilSpans.forEach(function(cell) {\n\t\t\t\tcell.parentNode.removeChild(cell);\n\t\t\t});\n\t\t\tthis._pencilLoaded = false;\n\t\t}\n\t}\n\n\t/**\n\t * Clear all the dirty cells in this row, then re-apply dirty class for each cell\n\t * This is invoked after this row's content is re-stamped, which necessitates a complete reset of dirty class\n\t * @private\n\t */\n\t_refreshDirtyIndicators() {\n\t\t// short circuit if there's no editing\n\t\tif (Object.keys(this.originalFieldValues).length === 0) {\n\t\t\treturn;\n\t\t}\n\t\t// first clear out all the dirty cells if any\n\t\tif (this.isDirty) {\n\t\t\tArray.from(this.querySelectorAll('div.groupDetails div.r')).forEach((elem) => {\n\t\t\t\telem.classList.toggle('dirty', false);\n\t\t\t});\n\t\t\tthis.isDirty = false;\n\t\t}\n\t\t// now reset the dirty cells if any\n\t\tlet recordId = this._getRecordOrSourceId();\n\t\tlet originalValues = this.originalFieldValues[recordId];\n\t\tif (originalValues) {\n\t\t\tObject.keys(originalValues).forEach((field) => {\n\t\t\t\tlet dirty = QuoteContext.isDiscountField(field) ?\n\t\t\t\t\tthis._isAdditionalDiscountUpdated(originalValues) :\n\t\t\t\t\toriginalValues[field] !== this._getRecord()[field];\n\t\t\t\tif (dirty) {\n\t\t\t\t\tlet container = this.querySelector(`div.td[field='${field}'] div.r`);\n\t\t\t\t\tthis._enableDirtyClass(container);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Enables dirty class for given container\n\t * @param container to enable dirty class for\n\t * @private\n\t */\n\t_enableDirtyClass(container) {\n\t\tif (container) {\n\t\t\tcontainer.classList.toggle('dirty', true);\n\t\t\tthis.isDirty = true;\n\t\t}\n\t}\n\n\t/**\n\t * @return The record's ID, or source record's ID if this line is a result of cloning\n\t * @private\n\t */\n\t_getRecordOrSourceId() {\n\t\treturn this._getRecord().Id || this._getRecord()[this._getEditorModel().constants.SOURCE_FIELD];\n\t}\n\n\t/**\n\t * Invoked when column width valuees are changed\n\t * @param newValue\n\t * @param oldValue\n\t * @private\n\t */\n\t_columnsResized(newValue, oldValue) {\n\t\t// only interested in resizing, i.e., when old value is already set\n\t\tif (newValue != null && oldValue != null) {\n\t\t\tObject.keys(newValue).forEach((field) => {\n\t\t\t\tlet container = this.$$(`div.container[field='${field}']`);\n\t\t\t\tif (container) {\n\t\t\t\t\tcontainer.style.minWidth = newValue[field] + 'px';\n\t\t\t\t\tcontainer.style.maxWidth = newValue[field] + 'px';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonTrack(e) {\n\t\tif (e) {\n\t\t\t// ignore track event when resizing of dialog or textarea\n\t\t\tlet path = Polymer.dom(e).path;\n\t\t\tfor (let a = 0, l = path.length; a < l; a++) {\n\t\t\t\tlet nodeName = path[a].nodeName;\n\t\t\t\tif (nodeName === 'SB-DIALOG' || nodeName === 'TEXTAREA') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.domHost.onTrack(e);\n\t\t}\n\t}\n\n\t/**\n\t * Provide a deep clone of this node for drag & drop (see DragDropModel#_clonePolyerElement)\n\t * This method strictly clones DOM elements, without any component property or listeners\n\t * @returns {*} A deep clone of this node with all its child elements.\n\t */\n\tdeepCloneNode() {\n\t\tlet clone = this.cloneNode(true);\n\t\tlet contentChild = this.$$('#content div:first-child').cloneNode(true);\n\t\tclone.querySelector('#content').appendChild(contentChild);\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Apply focus on the given container cell in some special cases\n\t * @param container\n\t * @param evt\n\t * @private\n\t */\n\t_applyFocus(container, evt) {\n\t\tthis._deviceDelegate.applyFocus(container, evt, this);\n\t}\n\n\t/**\n\t *  Determine if we should calculate immediately\n\t *\n\t *  A Discount type cannot be changed and doesn't need calculating\n\t *  when Target Customer Total is active\n\t * @param field\n\t * @returns {*}\n\t * @private\n\t */\n\t_calculateImmediately(field) {\n\t\tif (!AppContext.org.calculateImmediately) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tlet hasCustomerTotalValue = this.lineModel.quoteModel.quoteVO.record[QuoteContext.constants.TARGET_CUSTOMER_AMOUNT] !== null;\n\t\t\tif (!hasCustomerTotalValue) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst discountConstants = [QuoteContext.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD,\n\t\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,\n\t\t\t\tQuoteContext.constants.ADDITIONAL_DISCOUNT_FIELD];\n\n\t\t\tfor (let i = 0; i < discountConstants.length; i++) {\n\t\t\t\tif (discountConstants[i] === field) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n}\n\nPolymer( SFLETableRow );\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n/**\n * Light-weight component for line warning icon and tooltip\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFLineWarning {\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-line-warning';\n\n\t\tthis.properties = {\n\n\t\t\tkey: String,        // warning message i18n key\n\n\t\t\tmessage: String,    // warning message (default)\n\t\t}\n\t}\n}\n\nPolymer (SFLineWarning);","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {SFTableRowBehavior} from 'common/behaviors/SFTableRowBehavior.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\n/**\n * Tooltip content for segmented table cells\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFSegmentedCellTooltip {\n\n\tget behaviors() {\n\t\treturn [ Polymer.Templatizer, window.CommonBehaviors.SFTableRowBehavior ];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-segmented-cell-tooltip';\n\n\t\tthis.properties = {\n\n\t\t\tlineModel: Object,          // the line model\n\n\t\t\tfield: String,              // the field for which the tooltip content is to be rendered\n\t\t};\n\n\t\tthis.observers = [\n\t\t\t'_init(lineModel, field)'\n\t\t];\n\t}\n\n\tready() {\n\t\tif (this.shadyRoot) {\n\t\t\tthis.scopeSubtree(this.$.content, true);\n\t\t}\n\t}\n\n\t/**\n\t * Initialize the tooltip content by finding the segmented lineModel, then constructing the table content\n\t * @private\n\t */\n\t_init() {\n\t\tif (this.lineModel && this.field) {\n\t\t\tlet segmentedModel = this._getSegmentedLine();\n\n\t\t\tlet editorModel = this.lineModel.editorModel;\n\t\t\tlet fields = editorModel.data.multiSegmentLineFieldNames;\n\t\t\tlet quoteLineFields = editorModel.md.fieldsMap[editorModel.data.quoteLineObjectName];\n\t\t\tlet fieldLabels = editorModel.md.fieldLabelsMap;\n\n\t\t\t// build the data table\n\t\t\tlet uiData = this._prepareLineData(segmentedModel, fields, quoteLineFields);\n\t\t\tlet template = new TemplateGenerator().generateSegmentedTooltipFieldSetTemplate(fields, fieldLabels, editorModel);\n\t\t\tthis.templateInstance = this.hydrateTemplate(template, uiData);\n\t\t\tPolymer.dom(this.$.content).appendChild(this.templateInstance.root);\n\t\t}\n\t}\n\n\t_prepareLineData(segmentedModel, fields, quoteLineFields) {\n\t\treturn UIDataManager.prepareLineData([segmentedModel], fields, quoteLineFields)[0];\n\t}\n\n\t/**\n\t * Find the segmented line model for the field\n\t * @return {*}\n\t * @private\n\t */\n\t_getSegmentedLine() {\n\t\tlet segmentedModel = this.lineModel;\n\t\tif (this.lineModel && this.lineModel.segmentsByLabel != null) {\n\t\t\tlet key = Object.keys(this.lineModel.segmentsByLabel).find((key) => {\n\t\t\t\treturn this.field === key.replace(/\\W/g, '');\n\t\t\t});\n\t\t\tif (key) {\n\t\t\t\tsegmentedModel = this.lineModel.segmentsByLabel[key];\n\t\t\t}\n\t\t}\n\t\treturn segmentedModel;\n\t}\n}\n\nPolymer(SFSegmentedCellTooltip);","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {LineModel} from 'quotes/models/LineModel.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Line action component that encapsulates the info icon as well as visible actions for the given line\n * Note that for simplified usability and better performance, menu is no longer supported in line actions\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFLineActions {\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sf-line-actions';\n\n\t\tthis.properties = {\n\t\t\tlineModel: {          // line model\n\t\t\t\tObject,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tactions: Array,       // list of actions to be displayed\n\t\t\tshowInfoIcon: {       // whether info icon should be displayed\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isShowInfoIcon(lineModel)'\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.toggleClass('mobile', AppContext.isMobile);\n\t}\n\t\n\t/**\n\t * Update list of actions after lineModel is populated, so that only visible actions are rendered\n\t * @private\n\t */\n\t_modelChanged() {\n\t\tif (this.lineModel && this.lineModel instanceof LineModel) {\n\t\t\tthis.actions = this.lineModel.editorModel.lineCustomActions.filter((action) => {\n\t\t\t\treturn !action.isHidden(this.lineModel);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when action is tapped, or hovered when it's show discount schedule\n\t */\n\thandleAction(evt) {\n\t\tlet action = evt.model.get('action');\n\t\tif (action) {\n\t\t\tif (action.eventHandlerName === \"showDSModal\") {\n\t\t\t\tthis.fire('iron-signal', {name: 'schedule-action', data: {event: evt, model: this.lineModel}});\n\t\t\t\treturn;\n\t\t\t} else if (evt.type === 'tap') {\n\t\t\t\tthis.fire('le-action-tapped', {\n\t\t\t\t\tcustomAction: action,\n\t\t\t\t\tmodel: this.lineModel\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Info icon is displayed when line has parent and in desktop mode\n\t * @param lineModel\n\t * @returns {boolean|*}\n\t * @private\n\t */\n\t_isShowInfoIcon(lineModel) {\n\t\treturn !AppContext.isMobile && lineModel && lineModel.hasParent;\n\t}\n\n}\n\nPolymer( SFLineActions );","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\n\n\n/**\n * Template generator for line editor\n *\n * @author kzheng\n * @since 212\n *\n **/\nexport class LETemplateGenerator extends TemplateGenerator {\n\n\tconstructor(editorModel, groupModel, segmentedColumns, dimension, isSecondary) {\n\t\tsuper();\n\t\tthis.editorModel = editorModel;\n\t\tthis.groupModel = groupModel;\n\t\tthis.segmentedColumns = segmentedColumns;\n\t\tthis.dimension = dimension;\n\t\tthis.isSecondary = isSecondary;\n\t}\n\n\t/**\n\t * Generate a div element with innerHTML populated with field template\n\t * @param fields\n\t * @param attributes\n\t * @return a div node with generated template as innerHTML\n\t */\n\tgenerateRowNode(fields, attributes) {\n\t\tlet src = this.generateRow(fields);\n\t\tlet node = document.createElement('div');\n\t\tif (attributes) {\n\t\t\tObject.keys(attributes).forEach((attr) => {\n\t\t\t   node.setAttribute(attr, attributes[attr]);\n\t\t\t});\n\t\t}\n\t\tnode.innerHTML = src;\n\t\treturn node;\n\t}\n\n\tgenerateRow(fields) {\n\t\tlet fieldSetTemplate;\n\t\tlet isSegmented = false;\n\t\tif (!this.segmentedColumns){\n\t\t\tfieldSetTemplate = super.generateFieldSetTemplate(fields, this.groupModel, this.editorModel, this.isSecondary);\n\t\t} else {\n\t\t\t// Build field set for row segments\n\t\t\tisSegmented = true;\n\t\t\tlet segments = [];\n\t\t\tthis.segmentedColumns.forEach((column) => {\n\t\t\t\t// Remove whitespace from the segmented label \"Year 1\" becomes \"Year1\"\n\t\t\t\tlet label = column.replace(/\\W/g, '');\n\t\t\t\tsegments.push(label);\n\t\t\t});\n\t\t\tsegments.push('total');\n\t\t\tfieldSetTemplate = super.generateSegmentedFieldSetTemplate(fields, segments, this.dimension, this.groupModel, this.editorModel, this.isSecondary);\n\t\t}\n\n\t\tlet actionsTemplate = this.generateActionsTemplate();\n\n\t\tlet itemNumTemplate = this.generateItemNumberTemplate(isSegmented);\n\n\t\tlet checkboxTemplate = this.generateCheckboxTemplate('', this.editorModel, this.isSecondary);\n\n\t\tlet drawerCellTemplate = this.generateDrawerCellTemplate();\n\n\t\tlet result = '';\n\n\t\tresult += checkboxTemplate + itemNumTemplate + fieldSetTemplate;\n\t\tresult = this.addLineActionsToTemplate(result, actionsTemplate);\n\n\t\tresult += drawerCellTemplate;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Generate action widget (info icon + action buttons)\n\t * @return {string}\n\t */\n\tgenerateActionsTemplate() {\n\t\treturn '<div id=\"swipe-menu\" class=\"td actionsContainer lineActions sf-le-table-row\">' +\n\t\t\t\t\t`<sf-line-actions line-model=\"[[lineModel]]\"></sf-line-actions>` +\n\t\t\t\t'</div>';\n\t}\n\n\t/**\n\t * Generate item number column\n\t * @return {string}\n\t */\n\tgenerateItemNumberTemplate(isSegmented) {\n\t\t// Build field set template for segmented columns\n\t\tconst itemNumSegmentedTemplate = isSegmented ? '<span id=\"expandCollapseIcon\" class=\"sf-icon-right segmentedContainer\" ></span>' : '';\n\t\treturn `<div tabindex=\"0\" class=\"td focusable sf-le-table-row\" id=\"itemNumber\"><span>[[lineNumber]]</span><span class=\"warning\"></span>${itemNumSegmentedTemplate}</div>`;\n\t}\n\n\t/**\n\t * Generate drawer cell column when applicable\n\t */\n\tgenerateDrawerCellTemplate() {\n\t\tconst shouldRender = !this.segmentedColumns && this.editorModel.hasDrawerFields();\n\t\tif (shouldRender) {\n\t\t\treturn '<div class=\"td focusable drawerContainer sf-le-table-row\">' +\n\t\t\t\t'<span class=\"sf-icon-chevronright\"></span>' +\n\t\t\t\t'</div>';\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * @param field\n\t * @return {null|string}\n\t */\n\tgetColumnClass(field) {\n\t\tlet fieldMetadata = this.editorModel.getFieldMetadata(field);\n\t\t// In the case of segmented lines, fields like \"Year1\" or \"Month1\" will resolve to null/undefined\n\t\t// but the metadata should resemble that of NetTotal__c\n\t\tif ((fieldMetadata == null || fieldMetadata == undefined) && this.segmentedColumns) {\n\t\t\tfieldMetadata = this.editorModel.getFieldMetadata(QuoteContext.constants.NET_TOTAL_FIELD);\n\t\t}\n\t\tlet fieldClass = '';\n\t\tlet type = fieldMetadata.type;\n\t\tlet classNames = TemplateGenerator.classNames;\n\n\t\tif (type == 'number' || type == 'double' || type == 'percent' || type == 'currency') {\n\t\t\tfieldClass = `${classNames.RIGHT} `;\n\t\t} else if (type == 'boolean') {\n\t\t\tfieldClass = `${classNames.CENTER} ${classNames.BOOLEAN} `;\n\t\t}\n\n\t\treturn fieldClass;\n\t}\n\n\taddLineActionsToTemplate(template, actionsTemplate) {\n\t\tif(this.editorModel.actionsOnTheLeft) {\n\t\t\treturn actionsTemplate + template;\n\t\t} else {\n\t\t\treturn template + actionsTemplate;\n\t\t}\n\t}\n}\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\n\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\n\n/**\n * Mobile template generator for line editor\n *\n * @author jhang\n * @since 212\n *\n **/\nexport class MobileLETemplateGenerator extends LETemplateGenerator {\n\n\tgetPrimaryClass(colIndex, isSecondary) {\n\t\tif(!isSecondary) {\n\t\t\treturn colIndex === 0 ? 'primary first' : 'primary multi';\n\t\t}\n\t\treturn '';\n\t}\n\n\t/**\n\t * @override\n\t * override to include extra div around primary fields for mobile\n\t * @param fields\n\t * @param colWidths\n\t * @param editorModel\n\t * @param isSecondary\n\t * @param startIndex\n\t * @returns {*}\n\t */\n\tgenerateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary, startIndex = 0) {\n\t\tif(!isSecondary) {\n\t\t\treturn \"<div id='swipe-header'>\" +\n\t\t\t\tsuper.generateInnerFieldSetTemplate(fields,colWidths,editorModel,isSecondary, startIndex) + '</div>';\n\t\t} else {\n\t\t\treturn super.generateInnerFieldSetTemplate(fields,colWidths,editorModel,isSecondary, startIndex);\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * override to include swipe-container for mobile\n\t * @param fields\n\t * @returns {string}\n\t */\n\tgenerateRow(fields) {\n\t\tif(!this.isSecondary) {\n\t\t\treturn '<sb-swipe-container variant=\"ui3qle\">' + super.generateRow(fields) + '</sb-swipe-container>';\n\t\t} else {\n\t\t\treturn super.generateRow(fields);\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * override to prevent actions from showing on the left in mobile\n\t * @param template - table row template\n\t * @param actionsTemplate\n\t * @returns {*}\n\t */\n\taddLineActionsToTemplate(template, actionsTemplate) {\n\t\treturn template + actionsTemplate;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string}\n\t */\n\tgenerateActionsTemplate() {\n\t\tif(this.isSecondary) {\n\t\t\treturn '';\n\t\t} else {\n\t\t\treturn super.generateActionsTemplate();\n\t\t}\n\t}\n\n\tgetFieldLabel(fieldMetadata, isSecondary) {\n\t\tif (isSecondary) {\n\t\t\t// Mobile's Secondary fields needs a field-label to show.\n\t\t\treturn `<span class=\"field-label\">${fieldMetadata.label}</span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tgetColWidths(groupModel, dimension) {\n\t\treturn null;\n\t}\n\n\tgenerateItemNumberTemplate(isSegmented) {\n\t\treturn '';\n\t}\n\n\tgenerateDrawerCellTemplate() {\n\t\treturn '';\n\t}\n}\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Template generator for QLE table row\n *\n * @author kzheng\n * @since 212\n *\n */\n\nconst CLASS_NAMES = {\n\tCHEVRON_DOWN_ICON: 'sf-icon-chevrondown',       // Desktop drawer chevron expanded\n\tCHEVRON_RIGHT_ICON: 'sf-icon-chevronright',     // Desktop drawer chevron collapsed\n\tRIGHT_ICON: 'sf-icon-right',                    // Segmented line chevron collapsed\n\tDOWN_ICON: 'sf-icon-down',                      // Segmented line chevron expanded\n\tOPTION: 'option',                               // Child level non-bundle product\n\tRIGHT: 'right',                                 // Cell content right alignment\n\tCENTER: 'center',                               // Cell content center alignment\n\tOVERRIDDEN: 'overridden',                       // Cell content override with \"Include\" (is this being used?)\n\tTOP_LEVEL: 'top-level',                         // Top level bundle product\n\tINDENT: 'sbIndent',                             // Indentation level for hierarchical product names\n\tEDITABLE: 'editable',                           // Denote an editable field cell\n\tDISABLED: 'disabled',                           // Disabled checkbox (row selection for child product)\n\tBOOLEAN: 'boolean',                             // Boolean field cell class\n\tHAS_FOCUS: 'sf-has-focus',                      // When a cell has focus\n\tEDIT_ICON: 'pencil',                            // Pencil edit icon\n\tSECONDARY: 'secondary',                         // Secondary field container for mobile\n\tEXPANDED: 'expanded',                           // When mobile secondary field container is expanded\n\tEDIT_MODE: 'editMode',                          // When a field is being inline edited\n\tSELECTION: 'selection',                         // Row selection cell\n\tDIRTY: 'dirty',\t\t\t\t\t\t\t\t\t// Field is now Dirty\n\tHIDE_CHECKBOX: 'hideCheckbox',                  // Hide checkbox field (via Page Security Plugin)\n}\n\nexport class TemplateGenerator {\n\n\t/**\n\t * Generate template for given set of fields\n\t * @param fields\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param isSecondary for mobile use, whether the template is secondary fields\n\t * @return {string}\n\t */\n\tgenerateFieldSetTemplate(fields, groupModel, editorModel, isSecondary) {\n\t\t// we do not calculate column widths for mobile\n\t\tconst colWidths = this.getColWidths(groupModel);\n\t\treturn this.generateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary); // fieldSetTemplate\n\t}\n\n\t/**\n\t * Generate vertical table template for segmented cell tooltip\n\t * @param fields\n\t */\n\tgenerateSegmentedTooltipFieldSetTemplate(fields, fieldLabels, editorModel) {\n\t\tlet fieldSetTemplate = '<table><tbody>';\n\t\tfields.forEach((field) => {\n\t\t\tfieldSetTemplate += `<tr><th>${fieldLabels[field]}</th><td>`;\n\t\t\tlet metadata = editorModel.getFieldMetadata(field);\n\t\t\tif(metadata.type === 'boolean') {\n\t\t\t\tfieldSetTemplate += this.generateCheckboxTemplate(field, editorModel);\n\t\t\t} else {\n\t\t\t\tfieldSetTemplate += `[[${field}]]`;\n\t\t\t}\n\t\t\tfieldSetTemplate += '</td>';\n\t\t});\n\t\tfieldSetTemplate += '</tbody></table>';\n\t\treturn fieldSetTemplate;\n\t}\n\n\t/**\n\t * Generate template for given set of fields and segments\n\t * @param fields\n\t * @param segments\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param isSecondary for mobile use, whether the template is secondary fields\n\t * @return {string}\n\t */\n\tgenerateSegmentedFieldSetTemplate(fields, segments, dimension, groupModel, editorModel, isSecondary) {\n\t\t// we do not calculate column widths for mobile\n\t\tconst colWidths = this.getColWidths(groupModel, dimension);\n\t\tlet fieldSetTemplate = this.generateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary);\n\t\tif (!AppContext.isMobile) {\n\t\t\t// include template for segmented fields\n\t\t\tfieldSetTemplate += this.generateInnerFieldSetTemplate(segments, colWidths, editorModel, isSecondary, fields.length);\n\t\t}\n\t\treturn fieldSetTemplate;\n\t}\n\n\t/**\n\t * Generate template for given set of fields\n\t * @param fields\n\t * @param colWidths Map of each column's fixed width in pixels\n\t * @param editorModel\n\t * @param startIndex\n\t * @return {string}\n\t */\n\tgenerateInnerFieldSetTemplate(fields, colWidths, editorModel, isSecondary, startIndex = 0) {\n\t\tlet template = '';\n\t\tlet colIndex = startIndex;\n\t\tfields.forEach((field) => {\n\t\t\tlet metadata = editorModel.getFieldMetadata(field);\n\t\t\tlet columnClass = this.getColumnClass(field);\n\t\t\tlet dataType = metadata ? metadata.type : null;\n\t\t\tlet primary = this.getPrimaryClass(colIndex, isSecondary);\n\n\t\t\tif( metadata && metadata.extraTypeInfo === 'richtextarea' ) {\n\t\t\t\tdataType = 'richtextarea';\n\t\t\t}\n\t\t\tif( metadata && metadata.calculatedFormula && metadata.calculatedFormula.includes(\"IMAGE\")) {\n\t\t\t\tdataType = 'image';\n\t\t\t}\n\t\t\tif( metadata && metadata.calculated && metadata.htmlFormatted ) {\n\t\t\t\tdataType = 'formulaHtml';\n\t\t\t}\n\t\t\ttemplate += `<div tabindex=\"0\" class$=\"container td sf-le-table-row focusable ${primary} ${columnClass} {{computeCellClass(rowIndex, '${field}', _cellClasses)}}\"`;\n\t\t\tif (colWidths) {\n\t\t\t\ttemplate += `style=\"min-width:${colWidths[field]}px;max-width:${colWidths[field]}px\"`;\n\t\t\t}\n\t\t\ttemplate += ` index=\"${colIndex}\" field=\"${field}\" >`;\n\t\t\ttemplate += this.getFieldLabel(metadata, isSecondary);\n\t\t\ttemplate += '<div class=\"r\">'; // beginning of r div\n\t\t\t//Polymer doesn't stamp data correctly if the label is a number hence the following line\n\t\t\tfield = isNaN(field) ? field : \"TimeSegment\" + field;\n\t\t\tswitch( dataType ) {\n\t\t\t\tcase 'boolean':\n\t\t\t\t\ttemplate += this.generateCheckboxTemplate(field, editorModel, isSecondary);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image':\n\t\t\t\t\ttemplate += `<div class=\"imgFormula\" inner-h-t-m-l=\"[[${field}]]\"></div>`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'richtextarea':\n\t\t\t\tcase 'formulaHtml':\n\t\t\t\t\ttemplate += `<div class=\"htmlField\" inner-h-t-m-l=\"[[${field}]]\"></div>`; // data is sanitized in Formatter\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'url':\n\t\t\t\t\ttemplate += `<a href=\"[[${field}]]\" target=\"_blank\">[[${field}]]</a>`; // data is sanitized in Formatter\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\ttemplate += `[[${field}]]`;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\ttemplate += '</div>'; // end of r div\n\t\t\ttemplate += '</div>';\n\t\t\tcolIndex++;\n\t\t});\n\t\treturn template;\n\t}\n\n\t/**\n\t * Generate template for selection checkbox\n\t * Use computeCellClass to disable the CB on row level, for example, when the line is part of a bundled product\n\t * @param field\n\t * @param editorModel\n\t * @return {*}\n\t */\n\tgenerateCheckboxTemplate(field, editorModel, isSecondary) {\n\t\tvar checkboxTemplate = '';\n\t\t//Make sure if mld is enabled, field is empty and its not a secondary field.\n\t\tif (field !== '' || (editorModel.data.settings.multiLineDeleteEnabled && field === '' && !isSecondary)) {\n\t\t\tcheckboxTemplate += (field !== '') ?\n\t\t\t\t// Cell level checkbox\n\t\t\t\t`<div class=\"checkboxcontainer\">` +\n\t\t\t\t`<input type=\"checkbox\" class=\"hidden\" checked=\"[[${field}]]\">` :\n\t\t\t\t//Multiline Delete Checkbox\n\t\t\t\t`<div tabindex=\"0\" class=\"td focusable ${CLASS_NAMES.SELECTION} sf-le-table-row\">` +\n\t\t\t\t`<div class$=\"checkboxcontainer sf-le-table-row {{computeCellClass(rowIndex, '_selectionCB', _cellClasses)}}\">` +\n\t\t\t\t'<input type=\"checkbox\" class=\"hidden\">';\n\n\t\t\tcheckboxTemplate += '<div class=\"paper-checkbox\">' +\n\t\t\t\t\t\t\t\t\t'<div class=\"checkmark\"></div>' +\n\t\t\t\t\t\t\t\t'</div>' + // paper-checkbox\n\t\t\t\t\t\t\t'</div>'; // checkboxcontainer\n\t\t\tif (field === '') {\n\t\t\t\tcheckboxTemplate += '</div>'; // td selection\n\t\t\t}\n\t\t}\n\t\treturn checkboxTemplate;\n\t}\n\n\t/**\n\t * Get extra css class for this column, to be overriden by subclass\n\t * @param field for which the column is display\n\t * @return {string}\n\t */\n\tgetColumnClass(field) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the primary class for a field, typically only needed for mobile\n\t * @param colIndex column index of this field\n\t * @param isSecondary true if this one of the a secondary field\n\t * @returns {string}\n\t */\n\tgetPrimaryClass(colIndex, isSecondary) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the template html for field label, typically only needed for mobile\n\t * @param fieldMetadata metadata for this field\n\t * @param isSecondary true if this one of the a secondary field\n\t * @returns {string}\n\t */\n\tgetFieldLabel(fieldMetadata, isSecondary) {\n\t\treturn '';\n\t}\n\n\t/**\n\t * Get the column widths for this row\n\t * @param the group model\n\t * @param dimension the segment dimension, for segmented rows\n\t */\n\tgetColWidths(groupModel, dimension) {\n\t\tif (dimension) {\n\t\t\treturn groupModel.colWidth[dimension];\n\t\t}\n\t\treturn groupModel.colWidth.Standard;\n\t}\n\n\tstatic get classNames() {\n\t\treturn CLASS_NAMES;\n\t}\n}\n","import {Util} from '../../../common/Util.js';\nimport {Page} from '../../../common/core/Page.js';\nimport {Navigator} from '../../../common/core/Navigator.js';\nimport {EditorModel} from '../../models/EditorModel.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {removeTopBottomBorderClass} from 'quotes/models/DragDropModel.js';\nimport {JSQCPrecacheWorkerManager} from 'quotes/precaching/JSQCPrecacheWorkerManager.js';\nimport {ConnectionClient} from 'common/data/client/ConnectionClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {QuoteRuleExecutor} from 'common/rules/QuoteRuleExecutor.js';\n\nconst GHOST_X_OFFSET = 53;\nconst GHOST_Y_OFFSET = 77;\n/**\n *  <sb-line-editor>\n *\n *  Features:\n *\n **/\nexport class LineEditor extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\t/** raw data - coming from the server */\n\t\t\trawData: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t/** data - initialized and sanitized */\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_dataIsChanged'  //creates the fieldNamesByObjectNames map to retrieve metadata in one combined query\n\t\t\t},\n\t\t\t/** md - metadata requested from the metadata */\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** editorModel - created by the EditorModel from the data */\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** groupModels - created by the groupModels from the data */\n\t\t\tgroupModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tquoteLevelTabs : {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tpageLoaded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trules: Array\n\t\t}, Page.properties );\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'le-action-tapped': '_executeCustomAction',\n\t\t\t'cseMobile-tapped': '_handleMobileCSE',         // Need to have special handler for mobile because of the tab is different\n\t\t\t'cse-tapped': '_handleCSE',\n\t\t\t'segmented-changed': '_handleCSEResponse',\n\t\t\t'change-ghost' : '_handleGhostChanges',\n\t\t\t'renumber-lines' : 'renumber',\n\t\t\t'validate-quantity-changed': '_displayUpgradeQuantityToast',\n\t\t\t'field-change-validated': '_updateFieldValidations',\n\t\t\t'calculate-immediately': '_calculateImmediately',\n\t\t\t'rte-saved': '_updateIronList'\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_createEditorModel(data, md)',\n\t\t\t'_errorEventHandled(error)',\n\t\t\t'_loadObjectMD(app.org)',\n\t\t\t'_groupModelsChanged(groupModels.*)',\n\t\t\t'_init(rawData, rules)'\n\t\t];\n\t}\n\n\t/**\n\t * Fires an iron signal which will trigger resize for iron-lists in the line editor.\n\t */\n\t_updateIronList() {\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.fire('iron-signal', {name: 'update-iron-list', data:{index:null}});\n\t\t}\n\t}\n\n\t_loadObjectMD() {\n\t\tlet prefix = this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t\tthis.mdObjects = [prefix + 'QuoteLineGroup__c', prefix + 'QuoteLine__c', prefix + 'Quote__c', prefix + 'DiscountTier__c', prefix + 'DiscountSchedule__c'];\n\t}\n\n\t_loadProductRules() {\n\t\tlet getFromService = AppContext.org.hasQuoteSelectionProductRules && AppContext.org.isJSProductRulesEnabled;\n\t\tif (getFromService === false) this.rules = {}; // need to set rules object if we aren't loading rules from the service\n\t\treturn getFromService;\n\t}\n\n\t_executeCustomAction(e) {\n\t\tlet customActionName = e.detail.customAction.eventHandlerName,\n\t\t\thasPermission = true;\n\n\t\tswitch (customActionName) {\n\t\t\tcase 'onAddProducts':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onSave':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onQuickSave':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onFlagCalculate':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (hasPermission === false) {\n\t\t\tthis.errors = [this.i18n.l(\"Insufficient privileges to perform that action\")];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.eventDetail = e.detail;\n\t}\n\n\tattached() {\n\t\tdocument.addEventListener('LineEditor-cached', function() {\n\t\t\tthis.needsInit = true;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Creates EditorModel (which contains the QuoteModel, GroupModels, and LineModels) from the server object,\n\t * Attaches Metadata that is queried separately onto the EditorModel\n\t * @param: data     - raw data from the server\n\t * @param: md       - metadata which will pull information from server to the client\n\t * @private\n\t */\n\t_createEditorModel() {\n\t\tif (this.ctx.params && this.ctx.params.cmd == 'onFlagCalculate') {\n\t\t\t// Special nastiness for running calculate command.\n\t\t\tthis.data.quote.calculationRequired = true;\n\t\t\tthis.ctx.params.cmd = null;\n\t\t}\n\n\t\tif (this.data.quote.calculationRequired) {\n\t\t\tthis.$.customActionServices.onFlagCalculate(this.pageLoaded);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editorModel = new EditorModel(this.data, this.md, this); // Ideally would only pass in 'this' but do not want to destabilize the app before the release\n\n\t\t// Attach metadata to the editorModel and add the segmented column labels\n\t\tthis._updateFieldLabelsMap();\n\n\t\tthis._handleGroupCustomActions(); // Ideally would be handled in the editorModel.\n\n\t\tthis.groupModels = this._getGroupModels();\n\t\tthis.rightSideButton = !this.editorModel.deviceContext.isMobile && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.quoteId = this.editorModel.quoteModel.quoteVO.record.Id;\n\n\t\tthis.hasQuoteFieldSet = (this.editorModel.fieldsetMap.quoteFieldNames.length > 0);\n\n\t\t// Assuming this.viewport is only not present during testing, in that case assume desktop\n\t\tthis._viewportChanged(this.editorModel.deviceContext.isMobile);\n\n\t\tthis.renumber();\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.ctx.params && this.ctx.params.cmd != null) {\n\t\t\tthis._executeCmd(this.ctx.params.cmd);\n\t\t\tthis.ctx.params.cmd = null;\n\t\t} else if(this.$.sbLineEditorRead.isLastReadQuoteUnopened && this.editorModel.quoteModel.quoteVO.isCoTermPrompted) {\n\t\t\tthis._navigateToContractLookupPage();\n\t\t} else if (!this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]) {\n\t\t\t// Should be the last part of _createEditorModel\n\t\t\tthis._handleMissingPricebook();\n\t\t} else {\n\t\t\t// Run default custom actions if there are any\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}\n\n\t\t//run js product rules after model finishes initializing\n\t\tif(this._loadProductRules() && this._redirectToLineEditor())\n\t\t\tthis.executeProductRules();\n\t\telse\n\t\t\tthis.pageLoaded = true;\n\n\t\tif (this.editorModel.deviceContext.isMobile || this.editorModel.largeQuoteExperienceEnabled)\n\t\t\tthis.quoteTotalDisplayed = true;\n\n\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.quoteDetailsIconClass = 'sf-icon-chevrondown';\n\t\t\t// When selectedGroupKey is obtained from the url, make sure groupKey can be referenced from the groupsByKey map.\n\t\t\t// On quick save, the currently selected group key is assigned to returnGroupKeyAfterQuickSave property\n\t\t\t// If returnGroupKeyAfterQuickSave is not defined, look at the groupKey in the actual URL which is populated during navigation\n\t\t\tlet groupKeyInUrl = this.returnGroupKeyAfterQuickSave ? this.returnGroupKeyAfterQuickSave : this.ctx.params.groupKey;\n\t\t\tvar selectedGroupKey = groupKeyInUrl && this.editorModel.quoteModel.groupsByKey[groupKeyInUrl] ? groupKeyInUrl : this.groupModels[0].groupKey;\n\t\t}\n\n\t\tthis.selectedGroupKey = this.editorModel.largeQuoteExperienceEnabled ? selectedGroupKey : null;\n\n\t\tthis._isSubtitleCombined();\n\n\t}\n\n\t/**\n\t * Updates subtitleCombined property which determines whether the page title is diplayed next to the Quote # or in the row\n\t * @private\n\t */\n\t_isSubtitleCombined() {\n\t\tthis.subtitleCombined = this.editorModel.largeQuoteExperienceEnabled && this.data.settings.lineEditorTotalsField != 'doNotDisplay' && (this.data.quote.lineItems.length > 0);\n\t}\n\n\t_handleGroupCustomActions(notify) {\n\t\tif(!this.editorModel)\n\t\t\treturn;\n\n\t\tlet isExpanded = this.viewport && this.viewport.isDesktop() && this.viewport.M.up;\n\t\tthis.editorModel.groupCustomActions = !isExpanded ? [this.editorModel.groupMobileMenuButtonAction] : this.editorModel.customActionsByLocation.Group;\n\n\t\tif(!notify && !isExpanded) {\n\t\t\t// this ensures that in desktop when the viewport causes the group buttons to expand, that the first button have a label and correct borders\n\t\t\tthis.editorModel.groupCustomActions[0].label = this.editorModel.customActionsByLocation.Group[0].label;\n\t\t\tthis.editorModel.groupCustomActions[0].first = this.editorModel.customActionsByLocation.Group[0].first;\n\t\t\tthis.editorModel.groupCustomActions[0].eventHandlerName = this.editorModel.customActionsByLocation.Group[0].eventHandlerName;\n\t\t\tthis.editorModel.groupCustomActions[0].record = this.editorModel.customActionsByLocation.Group[0].record;\n\t\t}\n\n\t\tif(!notify || !this.groupModels)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.groupModels.length; i < l; i++)\n\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.groupCustomActions`);\n\t}\n\n\t_handleMissingPricebook() {\n\t\tthis.addEventListener('pricebook-saved', function(e) {\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}.bind(this));\n\n\t\tlet retUrl = window.location.href;\n\t\tif (retUrl.indexOf('cp=1') > -1) {\n\t\t\tdocument.location.assign(this.editorModel.communityPrefix + '/' + this.editorModel.quoteModel.quoteVO.record.Id);\n\t\t\treturn;\n\t\t}\n\t\tlet userType = this.data.userType;\n\t\t// Only Standard and PowerPartner users can edit pricebooks\n\t\tif (userType != \"Standard\" && userType != \"PowerPartner\") {\n\t\t\tthis.errors = ['A PriceBook Id is missing. Please contact your administrator to resolve the issue.']; // TODO: update with labels\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$.pricebookDialog.open();\n\t}\n\n\t_updateFieldLabelsMap() {\n\t\tlet fieldLabelsMap = this.editorModel.md.fieldLabelsMap,\n\t\t\tlocalizedDimensions = this.editorModel.data.quote.localizedMultiSegmentColumns,\n\t\t\tdimensions = this.editorModel.data.quote.multiSegmentColumns;\n\n\t\tfor (let dim in dimensions) {\n\t\t\tlet segments = dimensions[dim];\n\t\t\tlet localizedSegments = localizedDimensions[dim];\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\n\t\t\t\tfieldLabelsMap[segments[i].replace(/\\W/g, '')] = localizedSegments[i];\n\t\t\t}\n\t\t}\n\t\t// TODO: Make sure this label is localized\n\t\tfieldLabelsMap['total'] = 'Total';\n\t}\n\n\t_navigateToContractLookupPage() {\n\t\tthis.nav('#', {'qId': this.editorModel.quoteModel.quoteVO.record.Id}, ['contract', 'lookup'], false);\n\t}\n\n\t/**\n\t * Updates number field on each lineVO.record\n\t */\n\trenumber() {\n\t\tthis.editorModel.quoteModel.renumber();\n\t\tthis.fire('iron-signal', { name: 'rows-renumbered' });\n\t}\n\n\t_updateFieldValidations(e) {\n\t\tthis.errors = e.detail.error ? [e.detail.error] : null;\n\t}\n\n\t_calculateImmediately(showSpinner = true, setPageLoaded = false) {\n\t\t// Prevent dependent pick-list value changes from triggering multiple calculates\n\t\tthis.debounce('calculateImmediately', function() {\n\t\t\tthis.$.customActionServices.onFlagCalculate(showSpinner, false, function() {\n\t\t\t\tif(setPageLoaded)\n\t\t\t\t\tthis.pageLoaded = true;\n\t\t\t}.bind(this));\n\t\t}.bind(this), 50);\n\t}\n\n\t_executeCmd(cmd) {\n\t\tlet quoteActions = this.editorModel.customActionsByLocation.Quote;\n\t\tif (!quoteActions|| quoteActions.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tfor (let i = 0, l = quoteActions.length; i < l; i++) {\n\t\t\tif (quoteActions [i].eventHandlerName === cmd) {\n\t\t\t\tthis._executeCustomAction({\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tcustomAction: quoteActions[i],\n\t\t\t\t\t\tmodel: this.editorModel.quoteModel\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_executeDefaultCustomAction() {\n\t\tlet defaultCustomActions = this.editorModel.defaultCustomActions;\n\t\tif (!defaultCustomActions  || defaultCustomActions.length === 0 || this.data.quote.lineItems.length > 0 || this.data.quote.lineItemGroups.length > 1 || this.editorModel.quoteModel.grouped) {\n\t\t\treturn\n\t\t}\n\t\tlet eventHandlerName = this.editorModel.quoteModel.isRenewal ? \"onRenewSubscriptions\" : \"onAddProducts\";\n\t\tfor (let i = 0, l = defaultCustomActions.length; i < l; i++) {\n\t\t\tif (defaultCustomActions[i].eventHandlerName === eventHandlerName) {\n\t\t\t\tthis._executeCustomAction({detail:{customAction:defaultCustomActions[i], model:this.editorModel.quoteModel}});\n\t\t\t}\n\t\t}\n\t}\n\n\tviewportChanged() {\n\t\tthis._handleGroupCustomActions(true);\n\t\tif (this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\tbuildQuoteTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForQuoteLayout = [];\n\t\tif (this.editorModel.fieldsetMap.quoteFieldNames.length > 0)\n\t\t\tnamesForQuoteLayout.push('details');\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis.toggleClass('maxHeight', true, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels.length > 0) {\n\t\t\t\tnamesForQuoteLayout.push('groups');\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.groupModels.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.toggleClass('maxHeight', false, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels[0]._groupHasSegmentedProducts()) {\n\t\t\t\tthis.buildUngroupedSegmentedTabs();\n\t\t\t\tnamesForQuoteLayout.push('segmented');\n\t\t\t}\n\t\t\tif (this.groupModels[0]._groupHasStandardProducts()) {\n\t\t\t\tnamesForQuoteLayout.push('standard');\n\t\t\t}\n\t\t}\n\n\t\tif (!this._renderTabs(namesForQuoteLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#quoteTabs')) {\n\t\t\tthis.$$('#quoteTabs').destroyTabs();\n\t\t}\n\n\t\tlet tabs = [];\n\n\t\tfor (let i = 0, l = namesForQuoteLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForQuoteLayout[i],\n\t\t\t\tbind;\n\t\t\tswitch (tabName) {\n\t\t\t\tcase 'details':\n\t\t\t\t\tbind = ['groupModels','editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'groups':\n\t\t\t\t\tbind = ['groupModels', 'rightSideButton', 'editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'standard':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'segmented':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttabs.push({name: tId, label: tabName, bind: bind});\n\t\t}\n\t\tthis.ungroupedMDQTabs = this.groupModels[0] ? this.groupModels[0].quoteMDQTabs : null;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.quoteLevelTabs = tabs;\n\t}\n\n\t/**\n\t * Determines whether or not the quote level tabs need to be rendered by comparing quoteLevelTabs and namesForQuoteLayout\n\t * @param namesForQuoteLayout\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_renderTabs(namesForQuoteLayout) {\n\t\tif (this.quoteLevelTabs.length !== namesForQuoteLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModels[0] && this.groupModels[0].quoteMDQTabs && this.ungroupedMDQTabs.length !== this.groupModels[0].quoteMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.quoteLevelTabs.length; i < l; i++) {\n\t\t\tif (this.quoteLevelTabs[i].label !== namesForQuoteLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t *\n\t * @returns {Array}         - Return a line groups array based on the QuoteModel\n\t * @private\n\t */\n\t_getGroupModels() {\n\t\treturn this.editorModel.quoteModel.lineGroups;\n\t}\n\n\t/**\n\t * Determines whether the quote is ungrouped and has no lines - used to display the empty quote message\n\t * @returns {boolean}\n\t * @private\n\t */\n\tquoteHasNoLines() {\n\t\tif (this.data.quote.lineItems.length == 0) {\n\t\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\t\tthis.groupedQuoteHasNoGroups =  (quoteModel.grouped  && quoteModel.lineGroups.length == 0);\n\t\t\tthis.ungroupedQuoteHasNoLines =  !quoteModel.grouped;\n\n\t\t}\n\t}\n\n\t/**\n\t * Based on the parameter quoteVO, it will update the following things\n\t *  1. Update the data.quote with the update of the data.quote. It will automatically trigger an update to the EditorModel\n\t *  2. Update the groupModels so that it will get the update reference because it doesn't update this property automatically.\n\t *\n\t * @param quote      - QuoteVO\n\t * @param {Function} recombineFn - (serverQuote, originalQuote) => combinedQuote\n\t * @private\n\t */\n\tupdateQuote(quote, recombineFn) {\n\t\tif (quote != undefined) {\n\t\t\tif (quote.partialVO && this.data.quote && recombineFn) {\n\t\t\t\tquote = recombineFn(quote, this.data.quote);\n\t\t\t\tquote.partialVO = false;\n\t\t\t}\n\t\t\t// Wait for jsqc calculate to finish before running the code below\n\t\t\tthis.set('data.quote', quote);\n\t\t\tif (this.data.settings.usesClientCalculator && this.data.quote.calculationRequired) {\n\t\t\t\tthis.$.customActionServices.onFlagCalculate(true, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// create the editor model just in case it hasn't been created yet\n\t\t\tif(!this.editorModel)\n\t\t\t\tthis._createEditorModel();\n\n\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\t\tlet groupModels = this._getGroupModels();\n\t\t\tthis._updateFieldLabelsMap();\n\n\t\t\tthis.set('groupModels', groupModels);\n\n\t\t\tthis.rightSideButton = (this.viewport && !this.viewport.isMobile()) && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\n\t\t\t// Update Group Count for badge\n\t\t\tthis.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\t\t\tthis.set('editorModel.quoteModel', this.editorModel.quoteModel); // Used for quote totals\n\t\t\tthis.renumber();\n\n\t\t\tif (this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\t\t// QuoteModel creates an empty group when the quote is grouped (no line items yet).\n\t\t\t\t// We need to update the selectedGroupKey to this empty group's key so that the page does not blank out\n\t\t\t\tlet quoteModel = this.editorModel.quoteModel,\n\t\t\t\t\tgroups = quoteModel.lineGroups;\n\t\t\t\tif (quoteModel.grouped && groups.length == 1 && this.selectedGroupKey != groups[0].groupKey) {\n\t\t\t\t\tthis.selectedGroupKey = groups[0].groupKey;\n\t\t\t\t}\n\t\t\t\tthis._isSubtitleCombined();\n\t\t\t}\n\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.buildQuoteTabs();\n\t\t\t}\n\t\t}\n\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.data.settings.multiLineDeleteEnabled) {\n\t\t\t// Fire iron signal for deselecting multi line delete checkbox listened for in LETableHeader\n\t\t\tthis.fire('iron-signal', { name: 'deselect-checkbox'});\n\t\t}\n\t}\n\n\t/**\n\t * Goes through all of the paths collected in JSQCNotifier and will update UI if the value doesn't match the original value.\n\t * @param notifier\n\t */\n\tupdateAfterJSQC(notifier, sortRequired) {\n\t\tif (!notifier) {\n\t\t\treturn;\n\t\t}\n\t\tObject.keys(notifier.pathsToNotify).forEach(function(path) {\n\t\t\tlet originalValue = notifier.originalPathValues[path];\n\t\t\tlet pathsToNotify = notifier.pathsToNotify;\n\t\t\tlet value = notifier.pathsToNotify[path].value;\n\t\t\tlet root = pathsToNotify[path].root;\n\t\t\t// QuoteLineModel paths will be updated through the sort method which creates brand new objects\n\t\t\tlet shouldNotify = !sortRequired || (sortRequired && root != 'QuoteLineModel');\n\t\t\tif( originalValue != value && shouldNotify ) {\n\t\t\t\tthis.notifyPath(path, undefined);\n\t\t\t\tthis.notifyPath(path, value);\n\t\t\t}\n\t\t}.bind(this));\n\n\n\t\tObject.keys(notifier.pathsToSet).forEach(function(path) {\n\t\t\tlet originalValue = notifier.originalPathValues[path];\n\t\t\tlet pathsToSet = notifier.pathsToSet;\n\t\t\tlet value = pathsToSet[path].value;\n\t\t\tlet root = pathsToSet[path].root;\n\t\t\t// QuoteLineModel paths will be updated through the sort method which creates brand new objects\n\t\t\tlet shouldNotify = !sortRequired || (sortRequired && root != 'QuoteLineModel');\n\t\t\tif( originalValue != value && shouldNotify ) {\n\t\t\t\tthis.set(path, undefined);\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t_init() {\n\t\tif (this.needsInit) {\n\t\t\t// Only perform needs-init actions once, the first time rawData is set.\n\t\t\tlet inVFPage = typeof Visualforce !== 'undefined';\n\t\t\tif (inVFPage && this.rawData.settings.usesClientCalculator && this.rawData.settings.orgUrl && window.Worker) {\n\t\t\t\t// Currently, precaching is only supported in VF pages.\n\t\t\t\tnew JSQCPrecacheWorkerManager(this.rawData).beginPrecaching();\n\t\t\t}\n\t\t\tthis.needsInit = false;\n\t\t}\n\n\t\t// Perform Page Security Plugin action every time rawData is updated.\n\t\tif (this.rawData.settings.usesClientCalculator && typeof SB !== 'undefined' && SB.JSQC) {\n\t\t\tlet client = new ConnectionClient(this.app.org.prefix);\n\t\t\tlet qc = new SB.JSQC(this.rawData.settings, this.rawData.quote, null);\n\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\tlet connectionPromiseArray = [client.getConnection(), client.getConnection()];\n\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\tthis.rawData.settings.displayedLookupMap = this.$.customActionServices.getDisplayedLookupNames(this.rawData);\n\t\t\t\tlet promise = qc.onLoad();\n\t\t\t\tpromise.then(function() {\n\t\t\t\t\tthis.data = this.rawData;\n\t\t\t\t}.bind(this), this._setError.bind(this))\n\t\t\t\t.catch(this._setError.bind(this));\n\t\t\t}.bind(this), this._setError.bind(this));\n\t\t}\n\t\telse {\n\t\t\tthis.data = this.rawData;\n\t\t}\n\t}\n\n\texecuteProductRules() {\n\t\tlet ruleExecutor = new QuoteRuleExecutor(this.rawData.quote, this.rules, this.rawData.settings.developerPrefix, this.rawData.settings.jsprLabels),\n\t\t\truleResponse;\n\n\t\ttry {\n\t\t\truleResponse = ruleExecutor.execute();\n\t\t} catch (e) {\n\t\t\tlet errors;\n\t\t\tif (typeof e === 'object' && e.type === 'info') {\n\t\t\t\t//expected errors\n\t\t\t\terrors = [e];\n\t\t\t} else {\n\t\t\t\t//unexpected errors\n\t\t\t\terrors = [{'msg': e.toString(), 'type': 'warning'}];\n\t\t\t}\n\t\t\t// Don't know why but we need to do this\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tthis.errors = errors;\n\t\t\t});\n\t\t}\n\n\t\tif (ruleResponse && ruleResponse.requiredProductIds.length > 0) {\n\t\t\tthis.handleLinesAddedByProductRules();\n\t\t\tthis.$.quoteLineAdder.quote = this.rawData.quote;\n\t\t\tthis.$.quoteLineAdder.productIds = ruleResponse.requiredProductIds;\n\t\t} else {\n\t\t\tthis.pageLoaded = true;\n\t\t}\n\t}\n\n\t_setError(err) {\n\t\tthis.error = {message: err.message || err};\n\t}\n\n\t/**\n\t * When data (quoteEditorModel) is returned from the server, creates a map of object names to field names\n\t * in order to query objects with the fields on their related fieldsets (instead of all fields on the objects)\n\t * When fieldNamesByObjectNames if bound, <sb-le-field-md> component will make the server call\n\t * @private\n\t */\n\t_dataIsChanged() {\n\t\t// fire a custom event on document to alert other services (like MetricsService) that the data has changed\n\t\tvar e = new CustomEvent('sf-qle-data-changed', {bubbles: false, detail: this.data});\n\t\tdocument.dispatchEvent(e);\n\n\t\t// MD is fetched everytime because the field set might have changed (Quote Line View functionality)\n\t\t// Currently, precaching is only supported in VF pages. If at some point we add support for Localhost, this will\n\t\t// change.\n\t\tlet prefix = this.data.developerPrefix;\n\t\tlet fieldNamesByObjectNames = {}; // obj to store fields by object name {'SBQQ__QuoteLine__c': ['SBQQ__ProductCode__c',...],'SBQQ__QuoteLineGroup__c': ['SBQQ__Optional__c',...] }\n\n\t\tthis._removeDuplicateLineFieldsInDrawer();\n\n\t\t// combine all quote line field sets avoiding duplicates\n\t\tlet fieldNames = [],\n\t\t\tfieldNameSet = new Set(),\n\t\t\tfieldSets = ['lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone', 'standardLineItemDrawerFieldNames', 'multiSegmentLineFieldNames', 'multiSegmentLineSummaryFieldNames'];\n\t\tfor (let i = 0, len = fieldSets.length; i< len; i++) {\n\t\t\tlet fieldSet = this.data[fieldSets[i]],\n\t\t\t\tnumOfFields = fieldSet && fieldSet.length;\n\t\t\tif (numOfFields) {\n\t\t\t\tfor (let j= 0; j< numOfFields; j++) {\n\t\t\t\t\tlet name = fieldSet[j];\n\t\t\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\t\t\tfieldNameSet.add(name);\n\t\t\t\t\t\tfieldNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// add fields that are not part of a field set but needed in the UI\n\t\tlet additionalFields = [`${prefix}SubscriptionScope__c`, `${prefix}SegmentLabel__c`, `${prefix}StartDate__c`, `${prefix}EndDate__c`, `${prefix}PriceEditable__c`];\n\t\tfor (let k = 0, ln = additionalFields.length;k < ln; k++) {\n\t\t\tlet name = additionalFields[k];\n\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\tfieldNameSet.add(name);\n\t\t\t\tfieldNames.push(name);\n\t\t\t}\n\t\t}\n\t\t// Concat with empty array to avoid pushing unwanted fields into field set array\n\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName] = [].concat(fieldNames);\n\t\tlet lineEditorSubtotalsField = this.data.settings.lineEditorSubtotalsField;\n\t\tif (!lineEditorSubtotalsField || lineEditorSubtotalsField == 'Default') {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(lineEditorSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorSubtotalsField);\n\t\t}\n\n\t\t// add quote level fields\n\t\tfieldNamesByObjectNames[this.data.quoteObjectName] = [].concat(this.data.quoteFieldNames);\n\t\tfor (let m = 0, n = this.data.quoteFieldNames.length; m < n; m++) {\n\t\t\tfieldNameSet.add(this.data.quoteFieldNames[m]);\n\t\t}\n\t\tlet lineEditorTotalsField = this.data.settings.lineEditorTotalsField;\n\t\t if (!lineEditorTotalsField || lineEditorTotalsField == 'Default') {\n\t\t\tif (this.data.quote.applyAdditionalDiscountLast) {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}CustomerAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}CustomerAmount__c`);\n\t\t\t} else {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}NetAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}NetAmount__c`);\n\t\t\t}\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(lineEditorTotalsField);\n\t\t\tfieldNameSet.add(lineEditorTotalsField);\n\t\t}\n\n\t\t// add group level fields\n\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`] = [].concat(this.data.groupFieldNames);\n\t\tfor (let o = 0, p = this.data.groupFieldNames.length; o < p; o++) {\n\t\t\tfieldNameSet.add(this.data.groupFieldNames[o]);\n\t\t}\n\t\tlet lineEditorGroupSubtotalsField = this.data.settings.lineEditorGroupSubtotalsField;\n\t\tif (!lineEditorGroupSubtotalsField || lineEditorGroupSubtotalsField == 'Default') {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(lineEditorGroupSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorGroupSubtotalsField);\n\t\t}\n\n\t\t// add discount tier and discount schedule fields\n\t\tfieldNamesByObjectNames[`${prefix}DiscountTier__c`] = this.data.discountScheduleModalFieldNames;\n\t\tfieldNamesByObjectNames[`${prefix}DiscountSchedule__c`] = ['Name', `${prefix}DiscountUnit__c`];\n\n\t\tthis.fieldNameSet = fieldNameSet;\n\t\tthis.$.md.data = fieldNamesByObjectNames;\n\t}\n\n\t_removeDuplicateLineFieldsInDrawer() {\n\t\tlet drawerFields = this.data.standardLineItemDrawerFieldNames;\n\t\tif (!drawerFields || drawerFields.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prefix = this.data.developerPrefix;\n\t\tlet deviceContext = this.app.deviceContext;\n\n\t\tlet removeDuplicates = function(primary, secondary) {\n\t\t\tlet primarySet = new Set(primary);\n\t\t\tfor (let i = 0, l = secondary.length; i < l; i++) {\n\t\t\t\t// if primary array contains this fieldName, splice it out of secondary array to avoid repeating fields\n\t\t\t\t// Number field is always shown in the UI even if it isn't in the field set, always strip it out of the line item drawer\n\t\t\t\tif (primarySet.has(secondary[i]) || secondary[i] == prefix + 'Number__c') {\n\t\t\t\t\tsecondary.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (this.data.lineFieldNamesPhone && deviceContext.isPhone) {\n\t\t\tremoveDuplicates(this.data.lineFieldNamesPhone, drawerFields);\n\t\t} else if ( this.data.lineFieldNamesTablet && (deviceContext.isTablet || deviceContext.isPhone) ) {\n\t\t\tremoveDuplicates(this.data.lineFieldNamesTablet, drawerFields);\n\t\t} else {\n\t\t\tremoveDuplicates(this.data.lineFieldNames, drawerFields);\n\t\t}\n\t}\n\n\t/**\n\t * General error event handler for line editor page.\n\t * @private\n\t */\n\t_errorEventHandled() {\n\t\tif (this.error) {\n\t\t\tif (this.error.validations) {\n\t\t\t\t// Handles validation exceptions coming from server\n\t\t\t\tthis.errors = this.error.validations;\n\t\t\t\t// Ensures that the UI updates after a validation error to update any fields that may need updating\n\t\t\t\tthis.$.customActionServices.updateUIAfterCalculate(this.editorModel.quoteModel.quoteVO);\n\t\t\t} else {\n\t\t\t\t// Handles standard error messages coming from server, in array format in case of multiple errors\n\t\t\t\tthis.errors = [this.error.message];\n\t\t\t}\n\t\t}\n\t\tthis.$.customActionServices.showSpinner = false;\n\t}\n\n\t_handleMobileCSE(e) {\n\t\tthis._openDialog({dialog: 'cseDialog', groupModelKey: null});\n\t}\n\n\t_handleCSE(e) {\n\t\tthis._openDialog(e.detail);\n\t}\n\n\t_handleCSEResponse(e) {\n\t\tthis.updateQuote(e.detail.quoteVO);\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t_openDialog(action) {\n\t\tif (action.dialog === 'cseDialog') {\n\t\t\tlet cseDialog = this.$.cseDialog;\n\t\t\tlet segments = this.editorModel.quoteModel.groupsByKey[action.groupModelKey].segmentedLinesByDimension.Custom[0].segmentsByLabel;\n\t\t\tlet segmentsArray = [];\n\t\t\tObject.keys(segments).forEach(function(key) {\n\t\t\t\tlet lineModel = segments[key];\n\t\t\t\tif (lineModel.lineVO.dimensionType == lineModel.groupModel.editorModel.constants.CUSTOM_VALUE) {\n\t\t\t\t\tsegmentsArray.push(lineModel);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcseDialog.dataLineModels = segmentsArray;\n\t\t}\n\t\tthis.$[action.dialog].$.dialog.toggle();\n\t}\n\n\ttoggleGroupPanel() {\n\t\tif (this.viewport.isMobile()) {\n\t\t\tthis.fire('iron-signal', { name: 'toggle-panel-clicked'});\n\t\t}\n\t}\n\n\t/**\n\t * Toggles quoteDetailsHidden status when quote details section is toggled directly\n\t */\n\tupdateQuoteDetails() {\n\t\tthis.quoteDetailsHidden = !this.quoteDetailsHidden;\n\t\tthis.toggleQuoteDetails(false);\n\t}\n\n\t/**\n\t * Toggles quote details icon class and fires a page resized event which will trigger resize for iron-lists on the selected group\n\t */\n\ttoggleQuoteDetails(isFullScreenToggleEvent) {\n\t\tthis.set('quoteDetailsIconClass', this.quoteDetailsHidden ? 'sf-icon-chevronright' : 'sf-icon-chevrondown');\n\t\tthis.fire('iron-signal', {name: 'page-resized', data: {isFullScreenToggleEvent: isFullScreenToggleEvent}});\n\t}\n\n\t/**\n\t * Updates quoteDetailsHidden status, toggles quote details section, and fires browser's requestFullScreen on our page container\n\t * to the page container to position itself accordingly.\n\t */\n\ttoggleFullScreenMode(e) {\n\t\tthis._toggleFullscreen(e);\n\t\tthis.quoteDetailsHidden = this.inFullScreenMode;\n\t\tthis.toggleQuoteDetails(true);\n\t}\n\n\t/**\n\t * Fires requestFullScreen on the browser and updates the inFullScreenMode status\n\t * @param e\n\t * @private\n\t */\n\t_toggleFullscreen(e) {\n\t\tif (this.inFullScreenMode) {\n\t\t\tthis.exitFullScreenMode();\n\t\t} else {\n\t\t\tthis.enterFullScreenMode();\n\t\t}\n\n\t\t//  stop bubbling so we don't get bounce back\n\t\te.stopPropagation();\n\t}\n\n\tenterFullScreenMode() {\n\t\tlet elm = document.querySelector('sb-page-container');\n\t\tif (elm.requestFullScreen) { // Edge\n\t\t\telm.requestFullscreen();\n\t\t} else if (elm.msRequestFullscreen) { // IE\n\t\t\telm.msRequestFullscreen();\n\t\t} else if (elm.mozRequestFullScreen) { // Firefox\n\t\t\telm.mozRequestFullScreen();\n\t\t} else if (elm.webkitRequestFullscreen) { // Chrome,Safari\n\t\t\telm.webkitRequestFullscreen();\n\t\t}\n\t\tthis.inFullScreenMode = true;\n\t}\n\n\texitFullScreenMode() {\n\t\tlet elm = document.querySelector('sb-page-container');\n\t\tif (elm.requestFullScreen) { // Edge\n\t\t\tdocument.cancelFullScreen();\n\t\t} else if (elm.msRequestFullscreen) { // IE\n\t\t\tdocument.msExitFullScreen();\n\t\t} else if (elm.mozRequestFullScreen) { // Firefox\n\t\t\tdocument.mozCancelFullScreen();\n\t\t} else if (elm.webkitRequestFullscreen) { // Chrome,Safari\n\t\t\tdocument.webkitCancelFullScreen();\n\t\t}\n\t\tthis.inFullScreenMode = false;\n\t}\n\n\t/**\n\t * Changes the primary columns used for mobile and desktop.\n\t * @param  {Boolean} isMobile -flag for whether viewport.XS.only is true (mobile) or false (desktop).\n\t */\n\t_viewportChanged(isMobile) {\n\t\tif (!this.editorModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('hidden', !isMobile, Polymer.dom(this.root).querySelector('.fixedActions'));\n\t\t// Use primitive to ensure that the primaryMobileCols array actually changed\n\t\tlet standardPrimaryMobileColsLength = this.editorModel.standardPrimaryMobileCols.length;\n\t\tthis.editorModel.standardPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tlet segmentedPrimaryMobileColsLength = this.editorModel.segmentedPrimaryMobileCols.length;\n\t\tthis.editorModel.segmentedPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, 'total'] : [];\n\t\tthis.editorModel.segmentedDetailsPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.SEGMENT_LABEL_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tif (this.groupModels &&\n\t\t\t(standardPrimaryMobileColsLength !== this.editorModel.standardPrimaryMobileCols.length ||\n\t\t\tsegmentedPrimaryMobileColsLength !== this.editorModel.segmentedPrimaryMobileCols.length)) { // Avoid loops if primaryMobileCols did not change\n\t\t\tfor (let i = 0; i < this.groupModels.length; i++) {\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.standardPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedDetailsPrimaryMobileCols`);\n\t\t\t}\n\t\t}\n\n\t\tif (isMobile) {\n\t\t\tthis.buildQuoteTabs();\n\t\t}\n\n\t\tthis.isMobileRendered = isMobile;\n\t\tthis.isDesktopRendered = !isMobile;\n\t}\n\n\tbuildUngroupedSegmentedTabs() {\n\t\tif (!this.groupModels || this.groupModels.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet tabs = [],\n\t\t\tdimensions = this.groupModels[0].dimensions;\n\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\t\t\tif (this.groupModels[0].hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: this.groupModels[0].quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + this.groupModels[0].groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseMobile';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.groupModels[0].quoteMDQTabs = tabs;\n\t\tif(!this.ungroupedMDQTabs) {\n\t\t\tthis.ungroupedMDQTabs = tabs;\n\t\t}\n\t}\n\n\t_openCSE() {\n\t\tlet e = {\n\t\t\tdialog: event.currentTarget.attributes.dialog.value\n\t\t};\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t/**\n\t * Displays toast warning if user enters a number greater than the max quantity of either the upgrade or source for auto quanitty ratio enforcement.\n\t * @param  {Object} e - event object containing the valid and invalid quantity to notify user of max quantity enforcement.\n\t */\n\t_displayUpgradeQuantityToast(e) {\n\t\tlet invalidQuantity = e.detail.invalidQuantity;\n\t\tlet validQuantity = e.detail.validQuantity;\n\n\t\t// Set to null to avoid toast messages stacking on top of each other in UI\n\t\tthis.errors = null;\n\n\t\tif(invalidQuantity > 0) {\n\t\t\tlet errorMessage = this.i18n.l('Exceeded maximum quantity available. Value has been reduced to {0}', [validQuantity]);\n\t\t\tthis.errors = [{\n\t\t\t\ttype: 'warning',\n\t\t\t\tmsg: errorMessage\n\t\t\t}];\n\t\t}\n\t}\n\n\tdestampGroups() {\n\t\tthis.isMobileRendered = false;\n\t\tthis.isDesktopRendered = false;\n\t}\n\n\t/**\n\t * Displays guided messages product alert modal during save or quickSave event called from LECustomActionServices.js\n\t * @param serviceType {String} - determines whether the save or quickSave service action was performed\n\t * @param response {Object} - An object representing the response returned from a service call\n\t * @param response.guidedMessages {Array} - contains strings with the product alert guided messages\n\t */\n\thandleProductRuleAlertModal(serviceType, response) {\n\t\tlet guidedMessages = response.guidedMessages;\n\t\tif (!guidedMessages || guidedMessages.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (serviceType === 'saveService') {\n\t\t\t// If the alerts are being displayed after a Save, then we need to define a cancel callback method to update\n\t\t\t// the data based on the changd performed by the server.\n\t\t\t// We define the method as a variable instead of as a property of of the productAlertModel because we need the\n\t\t\t// method's scope and its 'this' to be the current scope and 'this', instead of that of the productAlertModal.\n\t\t\tlet cancelCB = () => {\n\t\t\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t\t\t// If the JSQC is enabled, then the server's result doesn't contain the entire quoteVO, but instead\n\t\t\t\t\t// a separate object containing only the properties of the QuoteVO that could have changed. As such,\n\t\t\t\t\t// we must apply those changes.\n\t\t\t\t\tlet originalQuote = this.editorModel.data.quote;\n\t\t\t\t\tlet quoteChanges = response.quote;\n\t\t\t\t\t// Apply line changes.\n\t\t\t\t\tlet lineCount = originalQuote.lineItems.length;\n\t\t\t\t\t// A simple method for copying properties from the updated version of an object back to the original,\n\t\t\t\t\t// defined here to spare repeated code.\n\t\t\t\t\tlet copyChanges = (originalObj, objChanges) => {\n\t\t\t\t\t\tfor (let prop in objChanges) {\n\t\t\t\t\t\t\toriginalObj[prop] = objChanges[prop];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\t\t\tlet originalLine = originalQuote.lineItems[i];\n\t\t\t\t\t\tlet updatedLine = quoteChanges.lineItems[i];\n\t\t\t\t\t\t// Saving may have created an ID for the line item, so copy that property.\n\t\t\t\t\t\toriginalLine.record.Id = updatedLine.record.Id;\n\t\t\t\t\t\t// Delete the record from the change object so it doesn't interfere with copying\n\t\t\t\t\t\tdelete updatedLine.record;\n\t\t\t\t\t\tcopyChanges(originalLine, updatedLine);\n\t\t\t\t\t}\n\t\t\t\t\t// Apply group changes\n\t\t\t\t\tlet groupCount = originalQuote.lineItemGroups.length;\n\t\t\t\t\tfor (let i = 0; i < groupCount; i++) {\n\t\t\t\t\t\tlet originalGroup = originalQuote.lineItemGroups[i];\n\t\t\t\t\t\tlet updatedGroup = quoteChanges.lineItemGroups[i];\n\t\t\t\t\t\t// Saving may have created an ID for the group, so copy that property\n\t\t\t\t\t\toriginalGroup.record.Id = updatedGroup.record.Id;\n\t\t\t\t\t}\n\t\t\t\t\t// Copy the ID from the updated quote to the original quote.\n\t\t\t\t\toriginalQuote.record.Id = quoteChanges.record.Id;\n\t\t\t\t\t// Delete the lines and groups and record from the updated quote in order to avoid them interfering in copying.\n\t\t\t\t\tdelete quoteChanges.lineItems;\n\t\t\t\t\tdelete quoteChanges.lineItemGroups;\n\t\t\t\t\tdelete quoteChanges.record;\n\t\t\t\t\t// Copy the changes to the original quote\n\t\t\t\t\tcopyChanges(originalQuote, quoteChanges);\n\t\t\t\t\tthis.updateQuote(originalQuote);\n\t\t\t\t\t// Even though the quote was calculated before saving, and a JSQCNotifier was created and populated,\n\t\t\t\t\t// that notifier was never actually used to trigger the UI updates. It should still be floating around,\n\t\t\t\t\t// so use it now.\n\t\t\t\t\tif (this.$.customActionServices.notifier) {\n\t\t\t\t\t\tthis.updateAfterJSQC(this.$.customActionServices.notifier);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If the JSQC is NOT in use, then we need to completely replace the new model with the old one.\n\t\t\t\t\tthis.updateQuote(response.quote);\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.$.productAlertModal.cancelCB = cancelCB;\n\t\t\tthis.$.productAlertModal.displayContinueButton = true;\n\t\t\tthis.$.productAlertModal.continueCB = () => {\n\t\t\t\t// Pass true to ensure validation process is called in LECustomActionServices navigateToReturnUrl\n\t\t\t\tthis.$.customActionServices.navigateToReturnUrl(true);\n\t\t\t};\n\t\t} else {\n\t\t\tthis.$.productAlertModal.cancelCB = null;\n\t\t}\n\t\tthis.$.productAlertModal.alerts = guidedMessages;\n\t}\n\n\t_groupModelsChanged(change) {\n\t\tif (this.editorModel.isMultiGroupViewEnabled) {\n\t\t\tconst pathArr = change.path.split('.');\n\t\t\tpathArr[0] = 'lineGroups';\n\t\t\tthis.editorModel.quoteModel.notifyUi(pathArr);\n\t\t}\n\t}\n\n\t_redirectToLineEditor() {\n\t\tif(!this.ctx.params || !this.ctx.params.jspr)\n\t\t\treturn false;\n\t\tlet source = Navigator.getPreviousRoute();\n\t\treturn (source === 'product/pc' || source === 'product/lookup' || source === 'favorite/lookup' ||\n\t\t\tsource === 'asset/lookup' || source === 'subscription/lookup')\n\t}\n\n\thandleLinesAddedByProductRules() {\n\t\tthis.$.quoteLineAdder.addEventListener('lines-added-by-rules-changed', function(e) {\n\t\t\tlet newData = JSON.parse(JSON.stringify(this.data));\n\t\t\tnewData.quote.lineItems = newData.quote.lineItems.concat(e.detail.value);\n\t\t\tthis.updateQuote(newData.quote);\n\t\t\tthis._calculateImmediately(false, true);\n\t\t}.bind(this));\n\t}\n\n\ttoggleOptional(e) {\n\t\tconst groupKey = e.detail.groupKey,\n\t\t\t  optional = e.detail.toggleOptionalBoolean;\n\t\tthis.editorModel.quoteModel.toggleOptional(optional, groupKey);\n\t}\n}\n\nPolymer( LineEditor );\n","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method to create an object capable of loading discount schedules and account summaries, and\n * posting those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, accountId) {\n\n\tfunction executeSequence() {\n\t\tvar scheduleMap = extractScheduleMapFromQuote();\n\t\tif (Object.keys(scheduleMap).length != 0) {\n\t\t\tvar context = {\n\t\t\t\t'schedules': scheduleMap,\n\t\t\t\t'overrides': {}, // If we're precaching, then obviously nothing can be overridden yet, so send empty object.\n\t\t\t\t'account': accountId\n\t\t\t};\n\t\t\treturn apex.load(prefix, 'DiscountAndAccountCallout', 'AllDiscountsAndAccounts', context)\n\t\t\t\t.then(function(results) {\n\t\t\t\t\tresultPoster({successful: true, provider: 'DiscountAndAccountCallout', uid: 'AllDiscountsAndAccounts', results: results});\n\t\t\t\t}, function(err) {\n\t\t\t\t\tself.postMessage({err: true, sequence: 'DiscountScheduleSequence', msg: err.message || err});\n\t\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\t\n\tfunction extractScheduleMapFromQuote() {\n\t\t// If the prefix is 'SBQQ', it means we're in a managed install, and all Salesforce CPQ objects will have an \n\t\t// SBQQ__ prefix.\n\t\tvar fieldPrefix = prefix == 'SBQQ' ? 'SBQQ__' : '';\n\t\tvar scheduleMap = {};\n\t\tvar volumeDiscountField = fieldPrefix + 'DiscountSchedule__c';\n\t\tvar termDiscountField = fieldPrefix + 'TermDiscountSchedule__c';\n\t\tvar productField = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar vId = line.record[volumeDiscountField];\n\t\t\tvar tId = line.record[termDiscountField];\n\t\t\tvar cId = line.costScheduleId;\n\t\t\t\n\t\t\tif (vId != null) {\n\t\t\t\tif (scheduleMap[vId] == null) {\n\t\t\t\t\tscheduleMap[vId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[vId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (tId != null) {\n\t\t\t\tif (scheduleMap[tId] == null) {\n\t\t\t\t\tscheduleMap[tId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[tId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (cId != null) {\n\t\t\t\tif (scheduleMap[convertTo18(cId)] == null) {\n\t\t\t\t\tscheduleMap[convertTo18(cId)] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[convertTo18(cId)].push(line.record[productField]);\n\t\t\t}\n\t\t});\n\t\treturn scheduleMap;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n *\n * Exports a factory method to create an object capable of retrieving SFDC Field Metadata.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} referencedFieldMap Which fields must be queried\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, referencedFieldMap) {\n\n\tfunction executeSequence() {\n\t\tvar fullNames = determineMetadataFullNames();\n\t\tif (fullNames.length == 0) {\n\t\t\t// If there's no metadata to query, then just return;\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn apex.md('CustomField', fullNames, prefix)\n\t\t\t\t.then(function (mdResults) {\n\t\t\t\t\t// For field metadata, we create a Universal ID by concatenating all of the field names together using\n\t\t\t\t\t// ','.\n\t\t\t\t\tvar uid = fullNames.join(',');\n\t\t\t\t\tresultPoster({successful: true, provider: 'CustomField', uid: uid, results: mdResults});\n\t\t\t\t}, function(err) {\n\t\t\t\t\tself.postMessage({err: true, sequence: 'MetadataSequence', msg: err.msg || err});\n\t\t\t\t});\n\t\t}\n\t}\n\n\tfunction determineMetadataFullNames() {\n\t\tif (referencedFieldMap == null) {\n\t\t\treturn [];\n\t\t}\n\t\t// The callout prefix we're given is 'SBQQ', then it means we're on a managed install, so all of the Salesforce CPQ\n\t\t// objects will have an SBQQ__ prefix.\n\t\tvar objectPrefix = prefix == 'SBQQ' ? 'SBQQ__' : '';\n\t\tvar fullNames = [];\n\t\tvar lineType = objectPrefix + 'QuoteLine__c';\n\t\tvar quoteType = objectPrefix + 'Quote__c';\n\t\tvar groupType = objectPrefix + 'QuoteLineGroup__c';\n\t\t// For all field sets, create the field's full name by adding the object name to the beginning.\n\t\tfor (var key in referencedFieldMap) {\n\t\t\tvar typeName;\n\t\t\tif (key === 'Quote Line') {\n\t\t\t\ttypeName = lineType;\n\t\t\t} else if (key === 'Group') {\n\t\t\t\ttypeName = groupType;\n\t\t\t} else if (key === 'Quote') {\n\t\t\t\ttypeName = quoteType;\n\t\t\t} else {\n\t\t\t\ttypeName = key;\n\t\t\t}\n\t\t\tif (referencedFieldMap.hasOwnProperty(key)) {\n\t\t\t\treferencedFieldMap[key].forEach(function(fieldName) {\n\t\t\t\t\tfullNames.push(typeName + '.' + fieldName);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn fullNames;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product Option fields that must be queried\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\n\tfunction executeSequence() {\n\t\tvar optionIds = getOptionIdsFromLines();\n\t\tvar context = {\n\t\t\t'requiredIds': optionIds,\n\t\t\t'requiredFields': referencedFields || []\n\t\t};\n\t\tapex.setOptions({escape: false, timeout: 120000});\n\t\treturn apex.load(prefix, 'ProductOptionServiceProvider.ProductOptionLoader', 'AllOptions', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'ProductOptionServiceProvider.ProductOptionLoader', uid: 'AllOptions', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'OptionSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getOptionIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'ProductOption__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value && !uniquenessMap[value]) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for an object that can load information about price rules, summary variables,\n * assets, and subscriptions.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, accountId) {\n\tfunction executeSequence() {\n\t\treturn loadPriceRules()\n\t\t\t.then(function(ruleRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'PriceRuleServiceProvider.PriceRuleReader', uid: 'PriceRules', results: ruleRecords});\n\t\t\t\treturn loadSummaryVariables(ruleRecords);\n\t\t\t})\n\t\t\t.then(function(svRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'SummaryVariableServiceProvider.SummaryVariableLoader', uid: 'SummaryVariables', results: svRecords});\n\t\t\t\treturn loadAssetsAndSubscriptions(svRecords);\n\t\t\t})\n\t\t\t.then(function(assetAndSubRecs) {\n\t\t\t\tresultPoster({successful: true, provider: 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', uid: 'AssetsAndSubs', results: assetAndSubRecs});\n\t\t\t})\n\t\t\t.catch(function(err) {\n\t\t\t\tself.postMessage({err: true, sequence: 'Price Rule Sequence', msg: err.msg || err});\n\t\t\t})\n\t}\n\n\t/**\n\t * Queries active Calculator-scoped price rules from the org.\n\t * @returns {Promise} Resolves to a list of records\n\t */\n\tfunction loadPriceRules() {\n\t\treturn apex.read(prefix, 'PriceRuleServiceProvider.PriceRuleReader', 'PriceRules');\n\t}\n\n\tfunction loadSummaryVariables(ruleRecords) {\n\t\tvar neededIds = getSummaryVariableIds(ruleRecords);\n\t\tvar svContext = {\n\t\t\t'svIds': neededIds\n\t\t};\n\t\treturn apex.load(prefix, 'SummaryVariableServiceProvider.SummaryVariableLoader', 'SummaryVariables', svContext);\n\t}\n\n\tfunction getSummaryVariableIds(ruleRecords) {\n\t\tvar recordPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\tvar filterVarField = recordPrefix + 'FilterVariable__c';\n\t\tvar testedVarField = recordPrefix + 'TestedVariable__c';\n\t\tvar sourceVarField = recordPrefix + 'SourceVariable__c';\n\t\tvar condRelationship = recordPrefix + 'PriceConditions__r';\n\t\tvar actionRelationship = recordPrefix + 'PriceActions__r';\n\t\tvar svIds = [];\n\t\tvar condIdCollector = function(condRecord) {\n\t\t\tif (condRecord[filterVarField]) {\n\t\t\t\tsvIds.push(condRecord[filterVarField]);\n\t\t\t}\n\t\t\tif (condRecord[testedVarField]) {\n\t\t\t\tsvIds.push(condRecord[testedVarField]);\n\t\t\t}\n\t\t};\n\t\tvar actionIdCollector = function(action) {\n\t\t\tif (action[sourceVarField]) {\n\t\t\t\tsvIds.push(action[sourceVarField]);\n\t\t\t}\n\t\t};\n\t\tif (ruleRecords.length > 0) {\n\t\t\truleRecords.forEach(function(rule) {\n\t\t\t\tif (rule[condRelationship] && rule[condRelationship].records.length > 0) {\n\t\t\t\t\trule[condRelationship].records.forEach(condIdCollector);\n\t\t\t\t}\n\t\t\t\tif (rule[actionRelationship] && rule[actionRelationship].records.length > 0) {\n\t\t\t\t\trule[actionRelationship].records.forEach(actionIdCollector);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn svIds;\n\t}\n\n\n\tfunction loadAssetsAndSubscriptions(svRecords) {\n\t\tif (!accountId) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t\tvar recordPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\tvar targetObjectField = recordPrefix + 'TargetObject__c';\n\t\tvar filterField = recordPrefix + 'FilterField__c';\n\t\tvar constraintField = recordPrefix + 'ConstraintField__c';\n\t\tvar aggregateField = recordPrefix + 'AggregateField__c';\n\n\t\tvar assetFields = [];\n\t\tvar subscriptionFields = [];\n\t\tfor (var svId in svRecords) {\n\t\t\tif (svRecords.hasOwnProperty(svId)) {\n\t\t\t\tvar svRec = svRecords[svId];\n\t\t\t\tif (svRec[targetObjectField] == 'Asset') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t} else if (svRec[targetObjectField] == 'Subscription') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar context = {\n\t\t\t'accountId': accountId,\n\t\t\t'assetFields': assetFields,\n\t\t\t'subscriptionFields': subscriptionFields\n\t\t};\n\n\t\treturn apex.load(prefix, 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', 'AssetsAndSubs', context);\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}\n","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product fields that must be included\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix == '' ? '' : 'SBQQ__';\n\tfunction executeSequence() {\n\t\tvar productIds = getProductIdsFromLines();\n\t\tvar pricebookFilter = [];\n\t\tif (quote.record[fieldPrefix + 'PricebookId__c']) {\n\t\t\tpricebookFilter.push(quote.record[fieldPrefix + 'PricebookId__c']);\n\t\t}\n\t\tvar currencyFilter = [];\n\t\tif (quote.record['CurrencyIsoCode']) {\n\t\t\tcurrencyFilter.push(quote.record['CurrencyIsoCode']);\n\t\t}\n\t\tvar context = {\n\t\t\t'requiredIds': productIds,\n\t\t\t'productFields': referencedFields,\n\t\t\t'pricebookFilter': pricebookFilter,\n\t\t\t'currencyFilter': currencyFilter\n\t\t};\n\t\tapex.setOptions({escape: false, timeout: 120000});\n\t\treturn apex.load(prefix, 'ProductServiceProvider.ProductLoader', 'AllProducts', context)\n\t\t\t.then(function (results) {\n\t\t\t\tresultPoster({\n\t\t\t\t\tsuccessful: true,\n\t\t\t\t\tprovider: 'ProductServiceProvider.ProductLoader',\n\t\t\t\t\tuid: 'AllProducts',\n\t\t\t\t\tresults: results\n\t\t\t\t});\n\t\t\t}, function (err) {\n\t\t\t\tresultPoster({err: true, sequence: 'ProductSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getProductIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value != null && uniquenessMap[value] == null) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for creating an object that can query related records referenced by the quote, lines, or groups,\n * and post those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Object} lookupFieldMap A map from lookup field names to the objects targeted by those fields\n * @param {Object} referencedFieldMap A map from objects to the required fields on those objects\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, lookupFieldMap, referencedFieldMap) {\n\tfunction executeSequence() {\n\t\tvar context = {\n\t\t\t'queryInfo': {}\n\t\t};\n\t\t\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.quoteLookups, [quote]);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.groupLookups, quote.lineItemGroups);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.lineLookups, quote.lineItems);\n\t\t\n\t\treturn apex.load(prefix, 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', 'AllAdditionalLookups', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', uid: 'AllAdditionalLookups', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'RelatedRecordSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction sweepModelsForLookupIds(context, lookupFields, models) {\n\t\t// If there are lookup relationships to test, and records to test them against...\n\t\tif (lookupFields && models && models.length > 0) {\n\t\t\t// For every lookup field on this object type...\n\t\t\tfor (var key in lookupFields) {\n\t\t\t\tif (lookupFields.hasOwnProperty(key)) {\n\t\t\t\t\t// Get the SObject type the field points to.\n\t\t\t\t\tvar targetType = lookupFields[key];\n\t\t\t\t\tvar aliasTargetType = getAliasTargetType(targetType);\n\t\t\t\t\t// Check that field on each record to see if it has a value\n\t\t\t\t\tmodels.forEach(function(model) {\n\t\t\t\t\t\tvar id = model.record[key];\n\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\tvar convertedId = convertTo18(id);\n\t\t\t\t\t\t\tif (!convertedId) {\n\t\t\t\t\t\t\t\t// If the ID didn't convert properly, we skip it\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else if (!context.queryInfo[targetType]) {\n\t\t\t\t\t\t\t\t// If the context doesn't contain query info for this object type yet, add it.\n\t\t\t\t\t\t\t\t// We need the Id and the referenced fields on this object.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType] = {\n\t\t\t\t\t\t\t\t\t'referencedFields': referencedFieldMap[aliasTargetType],\n\t\t\t\t\t\t\t\t\t'referencedIds': [convertedId]\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// If the context already has query info for this object type, we just add the ID to the\n\t\t\t\t\t\t\t\t// list of those we're querying for.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType]['referencedIds'].push(convertedId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Converts target types for custom lookups that reference Quote__c, QuoteLineGroup__c, or QuoteLine__c\n\t * into Quote, Quote Line Group, and Quote Line, so we can pull in their referenced fields\n\t * @param {String} targetType Represents the name of the custom object lookup\n\t * @returns {*}\n\t */\n\tfunction getAliasTargetType(targetType) {\n\t\tswitch(targetType) {\n\t\t\tcase 'SBQQ__Quote__c':\n\t\t\tcase 'Quote__c':\n\t\t\t\treturn 'Quote';\n\t\t\tcase 'SBQQ__QuoteLineGroup__c':\n\t\t\tcase 'QuoteLineGroup__c':\n\t\t\t\treturn 'Group';\n\t\t\tcase 'SBQQ__QuoteLine__c':\n\t\t\tcase 'QuoteLine__c':\n\t\t\t\treturn 'Quote Line';\n\t\t\tdefault:\n\t\t\t\treturn targetType;\n\t\t}\n\t};\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","import {LineModel} from 'quotes/models/LineModel.js';\nimport {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class SegmentedLines {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-lines';\n\t\tthis.properties = {\n\t\t\t// Segment Summary line column names\n\t\t\tfieldNames: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t//\n\t\t\tquoteLineFields: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// Each column name for the pricing and the customized\n\t\t\tcolumnNames: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// Currency MD which are from NetTotal__c so that we can format the subtotals and total will the correct currency format\n\t\t\tcurrencyMd: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_getNetTotalFieldMd(groupModel)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t}\n\n\t// Observers\n\tget observers() {\n\t\treturn ['_render(groupModel)',\n\t\t\t\t'_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)',\n\t\t\t\t'_showSubtotal(groupModel.*)'];\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Triggered by change to segmentedLinesByDimension map\n\t * @param e - the event that contains the dimensions that will get set and notified to lineModels\n\t * @private\n\t */\n\t_segmentedLinesByDimensionChanged(e) {\n\t\tlet parts,\n\t\t\tisCurrentDimension;\n\t\t// handles splices by setting the updated segmentedLinesByDimension array- TODO: is there a better way?\n\t\tparts = e.path.split(`.`);\n\t\tisCurrentDimension = parts.indexOf(this.dimension) >= 0 ? true : false;\n\t\tif (parts[parts.length - 1] == 'splices' && isCurrentDimension) {\n\t\t\tlet spliceChanges = e.value.indexSplices;\n\t\t\tif (spliceChanges[0].removed && spliceChanges[0].object.length === 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = false;\n\t\t\t} else if (spliceChanges[0].addedCount > 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Dereference groupModel and editorModel to build MDQ rows\n\t * @private\n\t */\n\t_render() {\n\t\tif(!this.groupModel) return;\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.dimension = this.attributes.key.value;\n\t\tthis.hasVisibleSegmentedLines = this.groupModel.hasVisibleSegmentedLines[this.dimension];\n\t\tthis.fieldNames = this._getFields();\n\t\tthis.lineModels = this.groupModel.segmentedLinesByDimension[this.dimension];\n\t\tthis.linkPaths(`groupModel.segmentedLinesByDimension.${this.dimension}`, 'lineModels');\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis.settings = this.editorModel.data.settings;\n\t\tthis.detailFieldNames = this.editorModel.fieldsetMap.multiSegmentLineFieldNames;\n\n\t\t// column names are either on the groupVO or on the quoteVO depending on the state of the quote\n\t\t// Columns, totals for subtotals and totals\n\t\tlet multiSegmentColumns = this.groupModel.groupVO.multiSegmentColumns;\n\t\tif (multiSegmentColumns && Object.keys(multiSegmentColumns).length > 0) {\n\t\t\tthis.columnNames = multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension];\n\t\t} else {\n\t\t\tthis.columnNames = this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension];\n\t\t}\n\n\t\tthis.netMultiSegmentTotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t}\n\n\t_getFields() {\n\t\tlet fields = this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;\n\t\treturn this.groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields) : fields;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = null;\n\t\t// TODO: Why do we need the check for the dimension - looks like this table is trying to re-render for a deleted group- why?\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout && this.groupModel.segmentedLinesByDimension[this.dimension]) {\n\t\t\tcolWidths = this.groupModel.colWidth[this.dimension];\n\t\t\tif (!colWidths)\n\t\t\t\treturn;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\tif (!columnWidths) {\n\t\t\treturn; //temporary fix for tests\n\t\t}\n\t\t// get the width of the subtotal label column which should align with the last summary line field\n\t\tlet labelColWidth = offset;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 'px';\n\n\t\t// set widths of each segment total\n\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\tthis.subtotalColWidth = columnWidths[columnName] + 'px';\n\t\t}\n\t\t// set width of the total column\n\t\tthis.totalColWidth = columnWidths['total'] + 'px';\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\tonTrack(e) {\n\t\tthis.domHost.domHost._onTrack(e);\n\t}\n\n\t/**\n\t * Return the raw editorModel from usps. Once the package is arrived, it will return the updated editorModel\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\t/**\n\t * Return the quoteVO from usps. Once the package is arrived, it will return the updated quoteVO\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget quoteVO() {\n\t\treturn this.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Return the multiSegmentColumnTotals based on the column name which are one-time and currency column names\n\t * @param columnName\n\t * @returns {*[]}\n\t */\n\tgetMultiSegmentColumnTotal(columnName) {\n\t\tif (this.groupModel.multiSegmentColumnTotals[this.dimension])\n\t\t\treturn [this.groupModel.multiSegmentColumnTotals[this.dimension][columnName]];\n\t}\n\n\tgetMultiSegmentTotalField() {\n\t\tif (this.groupModel.netMultiSegmentTotal)\n\t\t\treturn this.groupModel.netMultiSegmentTotal[this.dimension];\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.currencyMd) {\n\t\t\tthis.currencyMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (this.editorModel.data.settings.lineEditorSubtotalsField != \"doNotDisplay\") {\n\t\t\tthis._getNetTotalFieldMd();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t/**\n\t * Return the Quote line object from the net total field\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_getNetTotalFieldMd() {\n\t\tlet priceScale;\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\tpriceScale = this.quoteVO.currencyDecimalScale;\n\t\t} else {\n\t\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay' || subtotalField == null) {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\t} else {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t\t}\n\t\t}\n\t\treturn { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t}\n\n\t/**\n\t *  Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e      - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\t// False parameter added because we don't care about bundleKeptTogether for segmented line sorting\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], e.detail.field, e.detail.order, false, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}`, model.slice());\n\t\t\t// Still needed to update UI after sorting\n\t\t\tthis.notifyPath('lineModels', model.slice());\n\t\t} else {\n\t\t\tthis.groupModel.segmentedLinesByDimension[this.dimension] = model;\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.lineModels.length + 10 - idx;\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.lineModels.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor ( let i = 0, l = this.groupModel.segmentedLinesByDimension[this.dimension].length; i < l; i++ ) {\n\t\t\t\tfor ( let j = 0, k = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments.length; j < k; j++) {\n\t\t\t\t\tlet model = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments[j];\n\t\t\t\t\t// Keep dirty check in sync when the sb-le-table-cell's are not yet instantiated\n\t\t\t\t\t// This is the case when the MDQ summary line has not been expanded yet\n\t\t\t\t\tif (!model.lineVO._transient_) {\n\t\t\t\t\t\tmodel.lineVO._transient_ = {};\n\t\t\t\t\t\tmodel.lineVO._transient_.original = model.lineVO._transient_.original || JSON.parse(JSON.stringify(model.lineVO.record));\n\t\t\t\t\t}\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}.${i}.segments.${j}.lineVO.record.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset the expanded value of the lines, in case they're opened.\n\t * @param e\n\t * @private\n\t */\n\t_resetOnAction(e) {\n\t\tlet lineModels = Array.from(this.lineModels); // bc we support ie\n\t\tlineModels.forEach(function(lineModel) {\n\t\t\tlineModel.lineVO.expanded = false;\n\t\t});\n\t}\n}\n\nPolymer( SegmentedLines );","import {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsShareParent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsAreParentChild} from 'quotes/models/DragDropModel.js';\nimport {removeTableRowBorderClass} from 'quotes/models/DragDropModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nconst GHOST_X_OFFSET = 9;\nconst GHOST_Y_OFFSET = 147;\nexport class StandardLines {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-standard-lines';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - built from the LineEditor from the incoming data */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsettings: Object,\n\t\t\tfieldNames: Array,\n\t\t\tquoteLineFields: Object,\n\t\t\tfieldLabelsMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: {\n\t\t\t\ttype: Number\n\t\t\t},\n\t\t\tsubtotalMd: Object,\n\t\t\tdragDrop: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tvisibleLines: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_initVisibleLines(groupModel)'\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: '_initTabIndex(viewport)'\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\tthis.summaries = this.groupModel.quoteModel.grouped ? this.groupModel.groupVO.summaries : this.groupModel.quoteModel.quoteVO.summaries;\n\t\tlet validTargets = new Set(['sb-droppable-standardRows', 'sb-droppable-emptyTable', 'sb-droppable-sidePanelGroups', 'emptyTableMessage']);\n\t\tif (!this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sb-le-table-row',\n\t\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(groupModel)',\n\t\t\t'_updatePrimaryMobileColumns(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)',\n\t\t\t'_lineSplicesListener(groupModel.standardLines.splices)',\n\t\t\t'_showSubtotal(groupModel.*)',\n\t\t\t'_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)'\n\t\t];\n\t}\n\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\tget md() {\n\t\treturn this.editorModel.md;\n\t}\n\n\tget prefix() {\n\t\treturn this.editorModel.data.developerPrefix;\n\t}\n\n\t/**\n\t *  Updates fieldNames reference and binds the header data\n\t * @private\n\t */\n\t_buildRows() {\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.actionsOnTheLeft = this.editorModel.actionsOnTheLeft;\n\t\tthis.multiLineDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis._setFieldNames();\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.columnNames = null;\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis._setDrawerFields();\n\t\tthis.settings = this.editorModel.data.settings;\n\t\t// We need to resize iron list when going from grouped to ungrouped.  Try to limit calls to resize otherwise.\n\t\tif (this.$$('iron-list') // iron-list must be present and loaded\n\t\t\t&& this.groupModel.groupKey //quote must be grouped\n\t\t\t&& this.editorModel.quoteModel.quoteVO.lineItemGroups.length == 1) // adding group for the first time\n\t\t{\n\t\t\t// Note we may get here also when updateQuote is called on a 1-group quote.  Fine...notifyResize is called unnecessarily in that rare case.\n\t\t\tthis.$$('iron-list').notifyResize();\n\t\t}\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = null;\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout) {\n\t\t\tcolWidths = this.groupModel.colWidth.Standard;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\t// get the width of the subtotal label column which should align with the field before Net Total\n\t\tlet labelColWidth = offset;\n\n\t\tlet len = this.fieldNames.length;\n\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 6 + 'px'; // adjust for td padding (6px)\n\n\t\tlet lastColWidth = columnWidths[this.editorModel.constants.NET_TOTAL_FIELD];\n\t\tthis.subtotalColWidth = lastColWidth + 6 + 'px'; // adjust for td padding (6px)\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\t_setDrawerFields() {\n\t\tlet drawerFields = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,\n\t\t\tisMobile = this.editorModel.deviceContext.isMobile;\n\n\t\tif (drawerFields && !isMobile) {\n\t\t\tthis.drawerFieldNames = drawerFields;\n\t\t} else if (drawerFields && isMobile) {\n\t\t\t// if there are fields in the line item drawer field set and we're in mobile, append the fields to the field set used\n\t\t\tthis.fieldNames = this.fieldNames.concat(drawerFields);\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (settings.lineEditorSubtotalsField != \"doNotDisplay\" && this.groupModel.standardLines.length > 0) {\n\t\t\tthis._getSubtotal();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getPriceScale() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\treturn this.groupModel.quoteModel.quoteVO.currencyDecimalScale;\n\t\t}\n\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay'|| subtotalField == null) {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t} else {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tlet subtotalField,\n\t\t\tsubtotal,\n\t\t\tsettings = this.editorModel.data.settings,\n\t\t\tlines = this.groupModel.standardLines;\n\n\t\tif (settings.lineEditorSubtotalsField == 'Default' || settings.lineEditorSubtotalsField == null) {\n\t\t\tsubtotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\t} else { // Custom subtotals field\n\t\t\tsubtotalField = settings.lineEditorSubtotalsField;\n\t\t}\n\n\t\tsubtotal = 0;\n\t\tfor (let i= 0, len = lines.length; i < len; i++ ) {\n\t\t\tlet line = lines[i];\n\t\t\tif (!isNaN(line.lineVO.record[subtotalField]))\n\t\t\t\tsubtotal += line.lineVO.record[subtotalField];\n\t\t}\n\n\t\tthis.subtotal = subtotal;\n\t}\n\n\tonTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\tlet dd = this.dragDrop;\n\t\t// Get ghost from lineEditor\n\t\tdd.ghost = dd.lineEditor.$.ghost;\n\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\n\t\tdd.dragKeys = [];\n\t\tdd.dragStandardIndexes = [];\n\t\tdd.dragMdqIndexesByDim = {};\n\t\tdd.dragLineModels = [];\n\t\tdd.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tdd.dragKeys.push(dragElement.lineModel.lineVO.key);\n\t\t//Run only if keep bundle together setting is true.\n\t\tif (dd.keepBundleTogether)\n\t\t\tthis._getBundleWithChildren(dd.dragKeys[0], dd.dragKeys);  //Update list of dragged elements' line keys\n\n\t\tdd.dragKeys.forEach(function(key){   //Update list of dragged elements' line models\n\t\t\tlet lm = this.lineModelsByKey[key];\n\t\t\tdd.dragLineModels.push(lm);\n\t\t\tif (!this.lineModelsByKey[key].segmented) {\n\t\t\t\tdd.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines, key));\n\t\t\t} else {\n\t\t\t\tif (dd.dragMdqIndexesByDim[lm.dimensionType]) {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key));\n\t\t\t\t} else {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType] = [this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key)];\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tdd.dragTargetElementIndex = this._getLineIndexFromKey(this.groupModel.standardLines, dragElement.lineModel.lineVO.key );\n\n\t\t//Toggle 'hidden' attribute true to hide standard rows being dragged from page.\n\t\tfor(let j = 0, index; j < dd.dragStandardIndexes.length; j++){\n\t\t\tindex = dd.dragStandardIndexes[j];\n\t\t\tthis.set(`groupModel.standardLines.${index}.hidden`, true);\n\t\t}\n\n\t\t//Toggle 'hidden' attribute true to hide mdq rows being dragged from page.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor(let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++){\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdd.ghostField = dragElement.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD];\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop,\n\t\t\tkeepBundleTogether = this.groupModel.editorModel.data.settings.bundleKeptTogether,\n\t\t\tlastIndex = this.groupModel.standardLines.length - 1;\n\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tswitch (dd.targetClass) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd._updateTableRowHoverOverObject(hoverElement, lastIndex);\n\t\t\t\tif (!dd.hoverOver) {return;}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.parentNode.parentNode;\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dropLeGroup,\n\t\t\tdragLeGroup = dragElement.domHost.domHost,\n\t\t\tdd = this.dragDrop;\n\t\tdd.dropKey = null;\n\t\tdd.dropIndex = null;\n\t\tdd.dropGroupModel = null;\n\t\t//  Unhide standard rows being dragged.\n\t\tfor(let k = 0, indH, l = dd.dragStandardIndexes ? dd.dragStandardIndexes.length : 0; k < l; k++){\n\t\t\tindH = dd.dragStandardIndexes[k];\n\t\t\tthis.set(`groupModel.standardLines.${indH}.hidden`, false);\n\t\t}\n\t\t//  Unhide segmented rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!dropElement) return;\n\t\t// Update the subscription scope editable property to determine whether to display the 'Percent of Total Scope'\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\t// override destination table's col width with the drag element's\n\t\t\t// so that addition of PoT column is reflected\n\t\t\tdropElement.domHost.groupModel.colWidth = dragElement.lineModel.groupModel.colWidth;\n\t\t\tdd.dragGroupModel._updateStandardSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tthis._setFieldNames();\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t\t//  Remove standard rows being dragged.\n\t\tthis._removeLinesByIndex(dd.dragStandardIndexes);\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd.dropKey = dropElement.lineModel.lineVO.key;\n\t\t\t\tdd.dropGroupModel = dropElement.lineModel.groupModel;\n\t\t\t\tdd.dropIndex = this._getLineIndexFromKey(dd.dropGroupModel.standardLines, dd.dropKey);\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost;\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dd.dropIndex;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\tcase 'emptyTableMessage': \n\t\t\t\tdropLeGroup = Polymer.dom(dropElement).getOwnerRoot().host;\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = dd._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let l = 0; l < dd.dragLineModels.length; l ++) {\n\t\t\t//Splice into new location\n\t\t\tif (!dd.dragLineModels[l].segmented) {\n\t\t\t\tif (dd.dragLineModels[l].subscriptionScopeEditable) {\n\t\t\t\t\tdd.dropGroupModel.standardSubscriptionScopeEditable = true;\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(Polymer.dom(dropLeGroup.root).querySelector('#standardLines'), () => {\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setFieldNames();\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setColumnWidths();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (dd.dragLineModels[l].visible) {\n\t\t\t\t\tswitch(className) {\n\t\t\t\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\t\t\t\tdropElement.domHost.splice('groupModel.standardLines', dd.dropIndex, 0, dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\t\t\tcase 'emptyTableMessage':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t\t// Update line model's group properties\n\t\t\t\tdd.dragLineModels[l].groupModel = dd.dropGroupModel;\n\t\t\t\tdd.dragLineModels[l].lineVO.parentGroupKey = dd.dropGroupModel.groupKey;\n\t\t\t\tdd.dropIndex++;\n\t\t\t} else {\n\t\t\t\tif (dd.dragGroupModel.groupKey === dd.dropGroupModel.groupKey) continue;  //  Only add segment row if group is different\n\t\t\t\tif (!dd.dropGroupModel.dimensions.includes(dd.dragLineModels[l].segmentType)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dd.dragLineModels[l]);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//  Remove mdq rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tdd.dragMdqIndexesByDim[k].reverse();\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t\tif(dd.dragGroupModel.groupKey !== dd.dropGroupModel.groupKey){  //  Only remove segment row if group is different\n\t\t\t\t\t\tlet mdqLm = dragLeGroup.groupModel.segmentedLinesByDimension[k][index];\n\t\t\t\t\t\tdragLeGroup.removeSegmentedLine(mdqLm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n\n\t_removeLinesByIndex(indexesToRemove){\n\t\tindexesToRemove.sort( (a, b) => {\n\t\t\treturn a - b;\n\t\t});\n\n\t\tfor (let i = 0; i < indexesToRemove.length; i++) {\n\t\t\tthis.splice('groupModel.standardLines', indexesToRemove[i], 1);\n\t\t\tindexesToRemove = indexesToRemove.map( index => {\n\t\t\t\treturn --index;\n\t\t\t});\n\t\t}\n\t}\n\n\t_getBundleWithChildren(key, keyArray) {\n\t\tlet length;\n\t\tif (this.dragDrop.linesByParentKey[key]) {\n\t\t\tlength = this.dragDrop.linesByParentKey[key].length;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tfor (let j = 0; j < length; j ++) {\n\t\t\tlet nextKey = this.dragDrop.linesByParentKey[key][j].lineVO.key;\n\t\t\tkeyArray.push(nextKey);\n\t\t\tif (this.dragDrop.linesByParentKey[nextKey]){\n\t\t\t\tthis._getBundleWithChildren(nextKey, keyArray);\n\t\t\t}\n\t\t}\n\t}\n\n\t_getLineIndexFromKey(/*Standard Lines Array*/ lines, /*Array of line keys*/ key) {\n\t\tlet index;\n\t\tfor (let i = 0; i < lines.length; i++){\n\t\t\tif (lines[i].lineVO.key === key){\n\t\t\t\tindex = i;\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getStandardLineIndexesFromKeys(/*Standard Lines Array*/ lines, /*Array of line keys*/ keys) {\n\t\tlet indexes = [];\n\t\tfor(let j = 0; j < keys.length; j++){\n\t\t\tindexes.push(this._getStandardLineIndexFromKey(lines, keys[j]));\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.groupModel.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setFieldNames();\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e      - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\tlet bundleKeptTogether = this.editorModel.data.settings.bundleKeptTogether;\n\t\tthis.sortLines(this.groupModel.standardLines, e.detail.field, e.detail.order, bundleKeptTogether, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.standardLines, lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set('groupModel.standardLines', model.slice());\n\t\t} else {\n\t\t\tthis.groupModel.standardLines = model;\n\t\t}\n\t}\n\n\t_updatePrimaryMobileColumns() {\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(this.groupModel.editorModel.standardPrimaryMobileCols && this.groupModel.editorModel.standardPrimaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone'))\n\t\t\tthis.groupModel.editorModel.standardPrimaryMobileCols[0] = this.fieldSet.fields[0];\n\t}\n\n\t_lineSplicesListener(changeRecord) {\n\t\tif(!changeRecord) return;   //when a new groupModel is assigned, changeRecord is undefined\n\t\tthis.set('groupModel.hasVisibleStandardLines', this.groupModel._groupHasStandardProducts());\n\t\tthis._showSubtotal();\n\t}\n\n\ttoggleOptional(e) {\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.set(`groupModel.standardLines.${i}.lineVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.groupModel.standardLines.length + 10 - idx;\n\t}\n\n\t/**\n\t * Updates iron list size after save from Rich Text Editor Dialog.\n\t */\n\tupdateIronList() {\n\t\tlet ironList = this.$$('iron-list');\n\t\tif(ironList) {\n\t\t\tironList.fire('iron-resize');\n\t\t}\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\tforwardFocusDown(e) {\n\t\tif(e.keyCode === 9 && !e.shiftKey) // tab key\n\t\t\tRowFocusSignaler.signalFirstEditableTargetFirstRow(this, 'sb-le-table-row', 'data-index');\n\t}\n\n\tforwardFocusUp(e) {\n\t\tif (e.keyCode === 9 && e.shiftKey) // shift+tab key\n\t\t\tRowFocusSignaler.signalLastEditableTargetLastRow(this, 'sb-le-table-row', this.visibleLines.length, 'data-index');\n\t}\n\n\t_initVisibleLines() {\n\t\treturn this.groupModel.standardLines.filter(function (line) {\n\t\t\treturn line.visible;\n\t\t}.bind(this));\n\t}\n\n\t_initTabIndex() {\n\t\treturn this.viewport && this.viewport.isMobile() ? -1 : 0;\n\t}\n\n\t/**\n\t * Observes linesByParentKey in case it has been updated after\n\t * dragDrop instance has been created,\n\t * @param newValue\n\t * @private\n\t */\n\t_updateDragDropParentKey(newValue) {\n\t\tif (this.dragDrop && newValue) {\n\t\t\tthis.dragDrop.linesByParentKey = newValue;\n\t\t}\n\t}\n}\n\nPolymer( StandardLines );\n","import {LineModel} from 'quotes/models/LineModel.js';\nimport {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\n\nexport class SFSegmentedTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.SFAbstractTable];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-segmented-table';\n\t\tthis.properties = {\n\t\t\t// Segment Summary line column names\n\t\t\tfieldNames: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t//\n\t\t\tquoteLineFields: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// Each column name for the pricing and the customized\n\t\t\tcolumnNames: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// Currency MD which are from NetTotal__c so that we can format the subtotals and total will the correct currency format\n\t\t\tcurrencyMd: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_getNetTotalFieldMd(groupModel)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t},\n\t\t\tsecondaryRowTemplate: Object,\n\t\t\tuiData: Object,\n\t\t\t// original field values for dirty field tracking (post inline edit pre server save)\n\t\t\toriginalFieldValues: {\n\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\texpansionIconClass: {\n\t\t\t\ttype: String,\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tif(this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t\t});\n\t\t}\n\n\t\t// populate QuoteContext.constants\n\t\tQuoteContext.constants = this.editorModel.constants;\n\n\t\t// prepare presentation data for row-level rendering\n\t\tthis._prepareUIData();\n\n\t\t// row template\n\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, this.columnNames, this.dimension).generateRowNode(this._getFieldsForTemplate());\n\n\t\tif(this.editorModel.deviceContext.isMobile) {\n\t\t\t//secondary row template\n\t\t\tthis.secondaryRowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null, null, true).generateRowNode(this._getFields(), {'class': TemplateGenerator.classNames.SECONDARY + \" \" + TemplateGenerator.classNames.EXPANDED});\n\t\t}\n\t}\n\n\t/**\n\t * Prepare presentation-ready data for each line\n\t * This is invoked at ready, as well as when lines are spliced or rebuilt\n\t * @private\n\t */\n\t_prepareUIData() {\n\t\tthis.uiData = UIDataManager.prepareLineData(this.groupModel.segmentedLinesByDimension[this.dimension], this._getFields(), this.quoteLineFields);\n\t}\n\n\tgetUIData(index) {\n\t\treturn this.uiData[index];\n\t}\n\n\t/**\n\t * Additional cell-level css class, which is pre-calculated by UIDataManager\n\t * This function is invoked when rowTemplate is stamped (see TemplateGenerator#generateFieldSetTemplate)\n\t * This is on table level because Polymer templatization invokes the callback on rootHost (table), not host (row),\n\t * even though binding happens on host level\n\t * @param rowIndex 0-based row index\n\t * @param field name of field\n\t */\n\tcomputeCellClass(rowIndex, field) {\n\t\tlet lineModel = this.groupModel.standardLines[rowIndex];\n\t\tif (lineModel &&\n\t\t\tthis.uiData[rowIndex] &&\n\t\t\tthis.uiData[rowIndex]._cellClasses) {\n\t\t\treturn this.uiData[rowIndex]._cellClasses[field] || '';\n\t\t}\n\t}\n\n\t// Observers\n\tget observers() {\n\t\treturn ['_render(groupModel)',\n\t\t\t'_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)',\n\t\t\t'_showSubtotal(groupModel.*)'];\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Triggered by change to segmentedLinesByDimension map\n\t * @param e - the event that contains the dimensions that will get set and notified to lineModels\n\t * @private\n\t */\n\t_segmentedLinesByDimensionChanged(e) {\n\t\tlet parts,\n\t\t\tisCurrentDimension;\n\t\t// handles splices by setting the updated segmentedLinesByDimension array\n\t\tparts = e.path.split(`.`);\n\t\tisCurrentDimension = parts.indexOf(this.dimension) >= 0 ? true : false;\n\t\tif (parts[parts.length - 1] == 'splices' && isCurrentDimension) {\n\t\t\tlet spliceChanges = e.value.indexSplices;\n\t\t\tif (spliceChanges[0].removed && spliceChanges[0].object.length === 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = false;\n\t\t\t} else if (spliceChanges[0].addedCount > 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = true;\n\t\t\t}\n\t\t\tthis._prepareUIData();\n\t\t}\n\t\telse if(parts[parts.length-1] != 'segmentedLinesByDimension' && isCurrentDimension) {\n\t\t\tthis._prepareUIData();\n\t\t}\n\t}\n\n\t/**\n\t * Dereference groupModel and editorModel to build MDQ rows\n\t * @private\n\t */\n\t_render() {\n\t\tif(!this.groupModel) return;\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.dimension = this.attributes.key.value;\n\t\tthis.hasVisibleSegmentedLines = this.groupModel.hasVisibleSegmentedLines[this.dimension];\n\t\tthis.fieldNames = this._getFields();\n\t\tthis.lineModels = this.groupModel.segmentedLinesByDimension[this.dimension];\n\t\tthis.linkPaths(`groupModel.segmentedLinesByDimension.${this.dimension}`, 'lineModels');\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis.settings = this.editorModel.data.settings;\n\t\tthis.detailFieldNames = this.editorModel.fieldsetMap.multiSegmentLineFieldNames;\n\n\t\t// column names are either on the groupVO or on the quoteVO depending on the state of the quote\n\t\t// Columns, totals for subtotals and totals\n\t\tlet multiSegmentColumns = this.groupModel.groupVO.multiSegmentColumns;\n\t\tif (multiSegmentColumns && Object.keys(multiSegmentColumns).length > 0) {\n\t\t\tthis.columnNames = multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension];\n\t\t} else {\n\t\t\tthis.columnNames = this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension];\n\t\t}\n\n\t\tthis.netMultiSegmentTotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.expansionIconClass = 'sf-icon-right';\n\t}\n\n\t_getFields() {\n\t\tlet fields = this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;\n\t\treturn this.groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields) : fields;\n\t}\n\n\t_getFieldsForTemplate() {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn this.editorModel.segmentedPrimaryMobileCols;\n\t\t} else {\n\t\t\treturn this._getFields();\n\t\t}\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = null;\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout && this.groupModel.segmentedLinesByDimension[this.dimension]) {\n\t\t\tcolWidths = this.groupModel.colWidth[this.dimension];\n\t\t\tif (!colWidths)\n\t\t\t\treturn;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\tif (!columnWidths) {\n\t\t\treturn; //temporary fix for tests\n\t\t}\n\t\t// get the width of the subtotal label column which should align with the last summary line field\n\t\tlet labelColWidth = offset;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 'px';\n\n\t\t// set widths of each segment total\n\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\tthis.subtotalColWidth = columnWidths[columnName] + 'px';\n\t\t}\n\t\t// set width of the total column\n\t\tthis.totalColWidth = columnWidths['total'] + 'px';\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\tonTrack(e) {\n\t\tthis.domHost.domHost._onTrack(e);\n\t}\n\n\t/**\n\t * Return the raw editorModel from usps. Once the package is arrived, it will return the updated editorModel\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\t/**\n\t * Return the quoteVO from usps. Once the package is arrived, it will return the updated quoteVO\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget quoteVO() {\n\t\treturn this.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Return the multiSegmentColumnTotals based on the column name which are one-time and currency column names\n\t * @param columnName\n\t * @returns {*[]}\n\t */\n\tgetMultiSegmentColumnTotal(columnName) {\n\t\tif (this.groupModel.multiSegmentColumnTotals[this.dimension])\n\t\t\treturn [this.groupModel.multiSegmentColumnTotals[this.dimension][columnName]];\n\t}\n\n\tgetMultiSegmentTotalField() {\n\t\tif (this.groupModel.netMultiSegmentTotal)\n\t\t\treturn this.groupModel.netMultiSegmentTotal[this.dimension];\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.currencyMd) {\n\t\t\tthis.currencyMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (this.editorModel.data.settings.lineEditorSubtotalsField != \"doNotDisplay\") {\n\t\t\tthis._getNetTotalFieldMd();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t/**\n\t * Return the Quote line object from the net total field\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_getNetTotalFieldMd() {\n\t\tlet priceScale;\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\tpriceScale = this.quoteVO.currencyDecimalScale;\n\t\t} else {\n\t\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay' || subtotalField == null) {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\t} else {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t\t}\n\t\t}\n\t\treturn { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t}\n\n\t/**\n\t *  Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e\t  - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\t// False parameter added because we don't care about bundleKeptTogether for segmented line sorting\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], e.detail.field, e.detail.order, false, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}`, model.slice());\n\t\t\t// Still needed to update UI after sorting\n\t\t\tthis.notifyPath('lineModels', model.slice());\n\t\t\tthis._prepareUIData();\n\n\t\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, this.columnNames, this.dimension).generateRowNode(this._getFields());\n\t\t} else {\n\t\t\tthis.groupModel.segmentedLinesByDimension[this.dimension] = model;\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.lineModels.length + 10 - idx;\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.lineModels.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor ( let i = 0, l = this.groupModel.segmentedLinesByDimension[this.dimension].length; i < l; i++ ) {\n\t\t\t\tfor ( let j = 0, k = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments.length; j < k; j++) {\n\t\t\t\t\tlet model = this.groupModel.segmentedLinesByDimension[this.dimension][i].segments[j];\n\t\t\t\t\t// Keep dirty check in sync when the sb-le-table-cell's are not yet instantiated\n\t\t\t\t\t// This is the case when the MDQ summary line has not been expanded yet\n\t\t\t\t\tif (!model.lineVO._transient_) {\n\t\t\t\t\t\tmodel.lineVO._transient_ = {};\n\t\t\t\t\t\tmodel.lineVO._transient_.original = model.lineVO._transient_.original || JSON.parse(JSON.stringify(model.lineVO.record));\n\t\t\t\t\t}\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}.${i}.segments.${j}.lineVO.record.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Expands line to display segment details (uses the Segmented Line Field Set)\n\t */\n\ttoggleLineExpansion(e) {\n\t\t// Only change this value if expanded on component does not match so it doesn't override it during a server call\n\t\tif (this.lineModel.lineVO.expanded != this.expanded) {\n\t\t\tthis.set('lineModel.lineVO.expanded', !this.lineModel.lineVO.expanded);\n\t\t}\n\t\tif (this.lineModel.segmented) {\n\t\t\tthis.set('lineModel.expandedIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-right' : 'sf-icon-down');\n\t\t} else {\n\t\t\tif (this.lineModel.hasStandardLineItemDrawer) {\n\t\t\t\tthis.set('lineModel.lineItemDrawerIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-chevronright' : 'sf-icon-chevrondown');\n\t\t\t}\n\t\t}\n\t\tif(this.lineModel.editorModel.largeQuoteExperienceEnabled || this.lineModel.editorModel.isMultiGroupViewEnabled) {\n\t\t\tthis.fire('line-toggled', {index: this.dataIndex});\n\t\t}\n\t}\n\n\t/**\n\t * Reset the expanded value of the lines, in case they're opened.\n\t * @param e\n\t * @private\n\t */\n\t_resetOnAction(e) {\n\t\tlet lineModels = Array.from(this.lineModels); // bc we support ie\n\t\tlineModels.forEach(function(lineModel) {\n\t\t\tlineModel.lineVO.expanded = false;\n\t\t});\n\t}\n}\n\nPolymer( SFSegmentedTable );\n","/**\n * Copyright, 1999-2017, salesforce.com All Rights Reserved Company Confidential\n */\nimport {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {SFAbstractTable} from 'quotes/tables/SFAbstractTable.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsShareParent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsAreParentChild} from 'quotes/models/DragDropModel.js';\nimport {removeTableRowBorderClass} from 'quotes/models/DragDropModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {LETemplateGenerator} from 'quotes/layout/template-generator/LETemplateGenerator.js';\nimport {TemplateGenerator} from 'quotes/layout/template-generator/TemplateGenerator.js';\nimport {UIDataManager} from 'quotes/ui-data-manager/UIDataManager.js';\nimport {QuoteContext} from 'quotes/QuoteContext.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst GHOST_X_OFFSET = 9;\nconst GHOST_Y_OFFSET = 147;\n\n/**\n * Table-level component for QuoteLineEditor\n *\n * @author kzheng\n * @since 212\n *\n */\nexport class SFStandardTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.SFAbstractTable];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sf-standard-table';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - built from the LineEditor from the incoming data */\n\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsettings: Object,\n\t\t\tfieldNames: Array,\n\t\t\tquoteLineFields: Object,\n\t\t\tfieldLabelsMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: {\n\t\t\t\ttype: Number\n\t\t\t},\n\t\t\tsubtotalMd: Object,\n\t\t\tdragDrop: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tvisibleLines: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_initVisibleLines(groupModel)'\n\t\t\t},\n\t\t\ttabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: '_initTabIndex(viewport)'\n\t\t\t},\n\t\t\trowTemplate: {\n\t\t\t\ttype: Object,\n\t\t\t},\n\t\t\tsecondaryRowTemplate: Object,\n\t\t\tuiData: Object,\n\t\t\t// original field values for dirty field tracking (post inline edit pre server save)\n\t\t\toriginalFieldValues: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\n\t\tthis.summaries = this.groupModel.quoteModel.grouped ? this.groupModel.groupVO.summaries : this.groupModel.quoteModel.quoteVO.summaries;\n\t\tlet validTargets = new Set(['sb-droppable-standardRows', 'sb-droppable-emptyTable', 'sb-droppable-sidePanelGroups', 'emptyTableMessage']);\n\t\tif (!this.editorModel.largeQuoteExperienceEnabled) {\n\t\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sf-le-table-row',\n\t\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t\t} else {\n\t\t\tthis.addEventListener('line-toggled', this._onUpdateSizeForItem);\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t\t});\n\t\t}\n\n\t\t// populate QuoteContext.constants\n\t\tQuoteContext.constants = this.editorModel.constants;\n\n\t\t// prepare presentation data for row-level rendering\n\t\tthis._prepareUIData();\n\t\t// row template\n\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null).generateRowNode(this._getFieldsForTemplate(), {'class': 'row'});\n\n\t\tif(AppContext.isMobile) {\n\t\t\t//secondary row template\n\t\t\tthis.secondaryRowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null, null, true).generateRowNode(this._getAllFields(), {'class': TemplateGenerator.classNames.SECONDARY + \" \" + TemplateGenerator.classNames.EXPANDED});\n\t\t}\n\t}\n\n\t/**\n\t * Prepare presentation-ready data for each line\n\t * This is invoked at ready, as well as when lines are spliced or rebuilt\n\t * @private\n\t */\n\t_prepareUIData() {\n\t\tlet fields = (AppContext.isMobile ? this._getAllFields() : this._getFields());\n\t\tthis.uiData = UIDataManager.prepareLineData(this.groupModel.standardLines, fields, this.quoteLineFields);\n\t}\n\n\tgetUIData(index) {\n\t\treturn this.uiData[index];\n\t}\n\n\t/**\n\t * Additional cell-level css class, which is pre-calculated by UIDataManager\n\t * This function is invoked when rowTemplate is stamped (see TemplateGenerator#generateFieldSetTemplate)\n\t * This is on table level because Polymer templatization invokes the callback on rootHost (table), not host (row),\n\t * even though binding happens on host level\n\t * @param rowIndex 0-based row index\n\t * @param field name of field\n\t */\n\tcomputeCellClass(rowIndex, field) {\n\t\tlet lineModel = this.groupModel.standardLines[rowIndex];\n\t\tif (lineModel &&\n\t\t\tthis.uiData[rowIndex] &&\n\t\t\tthis.uiData[rowIndex]._cellClasses) {\n\t\t\treturn this.uiData[rowIndex]._cellClasses[field] || '';\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(groupModel)',\n\t\t\t'_updatePrimaryMobileColumns(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)',\n\t\t\t'_lineSplicesListener(groupModel.standardLines.splices)',\n\t\t\t'_showSubtotal(groupModel.*)',\n\t\t\t'_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)'\n\t\t];\n\t}\n\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\tget md() {\n\t\treturn this.editorModel.md;\n\t}\n\n\tget prefix() {\n\t\treturn this.editorModel.data.developerPrefix;\n\t}\n\n\t/**\n\t *  Updates fieldNames reference and binds the header data\n\t * @private\n\t */\n\t_buildRows() {\n\t\tthis.toggleClass('largeQuote', this.editorModel.largeQuoteExperienceEnabled, this);\n\t\tthis.actionsOnTheLeft = this.editorModel.actionsOnTheLeft;\n\t\tthis.multiLineDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis._setFieldNames();\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.columnNames = null;\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis._setDrawerFields();\n\t\tthis.settings = this.editorModel.data.settings;\n\t\t// re-generate ui data and template because the groupModel is updated\n\t\tif (this.uiData) {\n\t\t\tthis._prepareUIData();\n\t\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null).generateRowNode(this._getFieldsForTemplate());\n\t\t}\n\t\t// We need to resize iron list when going from grouped to ungrouped.  Try to limit calls to resize otherwise.\n\t\tif (this.$$('iron-list') // iron-list must be present and loaded\n\t\t\t&& this.groupModel.groupKey //quote must be grouped\n\t\t\t&& this.editorModel.quoteModel.quoteVO.lineItemGroups.length == 1) // adding group for the first time\n\t\t{\n\t\t\t// Note we may get here also when updateQuote is called on a 1-group quote.  Fine...notifyResize is called unnecessarily in that rare case.\n\t\t\tthis.$$('iron-list').notifyResize();\n\t\t}\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths(e) {\n\t\tlet colWidths = null;\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout) {\n\t\t\tcolWidths = this.groupModel.colWidth.Standard;\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t\tthis._ironListResize(e);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\t// get the width of the subtotal label column which should align with the field before Net Total\n\t\tlet labelColWidth = offset;\n\n\t\tlet len = this.fieldNames.length;\n\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 6 + 'px'; // adjust for td padding (6px)\n\n\t\tlet lastColWidth = columnWidths[this.editorModel.constants.NET_TOTAL_FIELD];\n\t\tthis.subtotalColWidth = lastColWidth + 6 + 'px'; // adjust for td padding (6px)\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t_ironListResize(e) {\n\t\tif (!this.$$('iron-list'))\n\t\t\treturn;\n\n\t\tif (e && e.detail && e.detail.groupKey === this.groupModel.groupKey) {\n\t\t\tthis.$$('iron-list').fire('iron-resize');\n\t\t}\n\t}\n\n\t/**\n\t * Get Standard Fields along with Drawer Fields\n\t * @param fields\n\t * @private\n\t */\n\t_getAllFields() {\n\t\tlet fields = this._getFields();\n\t\treturn fields.concat(this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames); // if there are drawer fields\n\t}\n\n\t_setDrawerFields() {\n\t\tlet drawerFields = this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,\n\t\t\tisMobile = this.editorModel.deviceContext.isMobile;\n\n\t\tif (drawerFields && !isMobile) {\n\t\t\tthis.drawerFieldNames = drawerFields;\n\t\t} else if (drawerFields && isMobile) {\n\t\t\t// if there are fields in the line item drawer field set and we're in mobile, append the fields to the field set used\n\t\t\tthis.fieldNames = this.fieldNames.concat(drawerFields);\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (settings.lineEditorSubtotalsField != \"doNotDisplay\" && this.groupModel.standardLines.length > 0) {\n\t\t\tthis._getSubtotal();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getPriceScale() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\treturn this.groupModel.quoteModel.quoteVO.currencyDecimalScale;\n\t\t}\n\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay'|| subtotalField == null) {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t} else {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tlet subtotalField,\n\t\t\tsubtotal,\n\t\t\tsettings = this.editorModel.data.settings,\n\t\t\tlines = this.groupModel.standardLines;\n\n\t\tif (settings.lineEditorSubtotalsField == 'Default' || settings.lineEditorSubtotalsField == null) {\n\t\t\tsubtotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\t} else { // Custom subtotals field\n\t\t\tsubtotalField = settings.lineEditorSubtotalsField;\n\t\t}\n\n\t\tsubtotal = 0;\n\t\tfor (let i= 0, len = lines.length; i < len; i++ ) {\n\t\t\tlet line = lines[i];\n\t\t\tif (!isNaN(line.lineVO.record[subtotalField]))\n\t\t\t\tsubtotal += line.lineVO.record[subtotalField];\n\t\t\t}\n\n\t\tthis.subtotal = subtotal;\n\t}\n\n\tonTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\tlet dd = this.dragDrop;\n\t\t// Get ghost from lineEditor\n\t\tdd.ghost = dd.lineEditor.$.ghost;\n\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\n\t\tdd.dragKeys = [];\n\t\tdd.dragStandardIndexes = [];\n\t\tdd.dragMdqIndexesByDim = {};\n\t\tdd.dragLineModels = [];\n\t\tdd.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tdd.dragKeys.push(dragElement.lineModel.lineVO.key);\n\t\t//Run only if keep bundle together setting is true.\n\t\tif (dd.keepBundleTogether)\n\t\t\tthis._getBundleWithChildren(dd.dragKeys[0], dd.dragKeys);  //Update list of dragged elements' line keys\n\n\t\tdd.dragKeys.forEach(function(key){   //Update list of dragged elements' line models\n\t\t\tlet lm = this.lineModelsByKey[key];\n\t\t\tdd.dragLineModels.push(lm);\n\t\t\tif (!this.lineModelsByKey[key].segmented) {\n\t\t\t\tdd.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines, key));\n\t\t\t} else {\n\t\t\t\tif (dd.dragMdqIndexesByDim[lm.dimensionType]) {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key));\n\t\t\t\t} else {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType] = [this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key)];\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tdd.dragTargetElementIndex = this._getLineIndexFromKey(this.groupModel.standardLines, dragElement.lineModel.lineVO.key );\n\n\t\t//Toggle 'hidden' attribute true to hide standard rows being dragged from page.\n\t\tfor(let j = 0, index; j < dd.dragStandardIndexes.length; j++){\n\t\t\tindex = dd.dragStandardIndexes[j];\n\t\t\tthis.set(`groupModel.standardLines.${index}.hidden`, true);\n\t\t}\n\n\t\t//Toggle 'hidden' attribute true to hide mdq rows being dragged from page.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor(let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++){\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdd.ghostField = dragElement.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD];\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop,\n\t\t\tkeepBundleTogether = this.groupModel.editorModel.data.settings.bundleKeptTogether,\n\t\t\tlastIndex = this.groupModel.standardLines.length - 1;\n\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tswitch (dd.targetClass) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd._updateTableRowHoverOverObject(hoverElement, lastIndex);\n\t\t\t\tif (!dd.hoverOver) {return;}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (keepBundleTogether && dd.sourceElement.lineModel.hasParent) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.parentNode.parentNode;\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dropLeGroup,\n\t\t\tdragLeGroup = dragElement.domHost.domHost,\n\t\t\tdd = this.dragDrop;\n\t\tdd.dropKey = null;\n\t\tdd.dropIndex = null;\n\t\tdd.dropGroupModel = null;\n\t\t//  Unhide standard rows being dragged.\n\t\tfor(let k = 0, indH, l = dd.dragStandardIndexes ? dd.dragStandardIndexes.length : 0; k < l; k++){\n\t\t\tindH = dd.dragStandardIndexes[k];\n\t\t\tthis.set(`groupModel.standardLines.${indH}.hidden`, false);\n\t\t}\n\t\t//  Unhide segmented rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!dropElement) return;\n\t\t// Update the subscription scope editable property to determine whether to display the 'Percent of Total Scope'\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\t// override destination table's col width with the drag element's\n\t\t\t// so that addition of PoT column is reflected\n\t\t\tdropElement.domHost.groupModel.colWidth = dragElement.lineModel.groupModel.colWidth;\n\t\t\tdd.dragGroupModel._updateStandardSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tthis._setFieldNames();\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t\t//  Remove standard rows being dragged.\n\t\tthis._removeLinesByIndex(dd.dragStandardIndexes);\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd.dropKey = dropElement.lineModel.lineVO.key;\n\t\t\t\tdd.dropGroupModel = dropElement.lineModel.groupModel;\n\t\t\t\tdd.dropIndex = this._getLineIndexFromKey(dd.dropGroupModel.standardLines, dd.dropKey);\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost;\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dd.dropIndex;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\tcase 'emptyTableMessage': \n\t\t\t\tdropLeGroup = Polymer.dom(dropElement).getOwnerRoot().host;\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = dd._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let l = 0; l < dd.dragLineModels.length; l ++) {\n\t\t\t//Splice into new location\n\t\t\tif (!dd.dragLineModels[l].segmented) {\n\t\t\t\tif (dd.dragLineModels[l].subscriptionScopeEditable) {\n\t\t\t\t\tdd.dropGroupModel.standardSubscriptionScopeEditable = true;\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(Polymer.dom(dropLeGroup.root).querySelector('#standardLines'), () => {\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setFieldNames();\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setColumnWidths();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (dd.dragLineModels[l].visible) {\n\t\t\t\t\tswitch(className) {\n\t\t\t\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\t\t\t\tdropElement.domHost.splice('groupModel.standardLines', dd.dropIndex, 0, dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\t\t\tcase 'emptyTableMessage':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t\t// Update line model's group properties\n\t\t\t\tdd.dragLineModels[l].groupModel = dd.dropGroupModel;\n\t\t\t\tdd.dragLineModels[l].lineVO.parentGroupKey = dd.dropGroupModel.groupKey;\n\t\t\t\tdd.dropIndex++;\n\t\t\t} else {\n\t\t\t\tif (dd.dragGroupModel.groupKey === dd.dropGroupModel.groupKey) continue;  //  Only add segment row if group is different\n\t\t\t\tif (!dd.dropGroupModel.dimensions.includes(dd.dragLineModels[l].segmentType)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dd.dragLineModels[l]);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//  Remove mdq rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tdd.dragMdqIndexesByDim[k].reverse();\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t\tif(dd.dragGroupModel.groupKey !== dd.dropGroupModel.groupKey){  //  Only remove segment row if group is different\n\t\t\t\t\t\tlet mdqLm = dragLeGroup.groupModel.segmentedLinesByDimension[k][index];\n\t\t\t\t\t\tdragLeGroup.removeSegmentedLine(mdqLm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t\t// post drop refreshing\n\t\tvar dragTable = dragElement.domHost;\n\t\tvar dropTable = dropElement.domHost;\n\t\tif (dragTable && dragTable.tagName === 'SF-STANDARD-TABLE') {\n\t\t\tdragTable._prepareUIData();\n\t\t}\n\t\tif (dropTable && dropTable.tagName === 'SF-STANDARD-TABLE' && dragTable !== dropTable) {\n\t\t\tdropTable._prepareUIData();\n\t\t}\n\t}\n\n\t_removeLinesByIndex(indexesToRemove){\n\t\tindexesToRemove.sort( (a, b) => {\n\t\t\treturn a - b;\n\t\t});\n\n\t\tfor (let i = 0; i < indexesToRemove.length; i++) {\n\t\t\tthis.splice('groupModel.standardLines', indexesToRemove[i], 1);\n\t\t\tindexesToRemove = indexesToRemove.map( index => {\n\t\t\t\treturn --index;\n\t\t\t});\n\t\t}\n\t}\n\n\t_getBundleWithChildren(key, keyArray) {\n\t\tlet length;\n\t\tif (this.dragDrop.linesByParentKey[key]) {\n\t\t\tlength = this.dragDrop.linesByParentKey[key].length;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tfor (let j = 0; j < length; j ++) {\n\t\t\tlet nextKey = this.dragDrop.linesByParentKey[key][j].lineVO.key;\n\t\t\tkeyArray.push(nextKey);\n\t\t\tif (this.dragDrop.linesByParentKey[nextKey]){\n\t\t\t\tthis._getBundleWithChildren(nextKey, keyArray);\n\t\t\t}\n\t\t}\n\t}\n\n\t_getLineIndexFromKey(/*Standard Lines Array*/ lines, /*Array of line keys*/ key) {\n\t\tlet index;\n\t\tfor (let i = 0; i < lines.length; i++){\n\t\t\tif (lines[i].lineVO.key === key){\n\t\t\t\tindex = i;\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getStandardLineIndexesFromKeys(/*Standard Lines Array*/ lines, /*Array of line keys*/ keys) {\n\t\tlet indexes = [];\n\t\tfor(let j = 0; j < keys.length; j++){\n\t\t\tindexes.push(this._getStandardLineIndexFromKey(lines, keys[j]));\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t * @returns Boolean for when the field names collection has changed\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.groupModel.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t_getFieldsForTemplate() {\n\t\tif (this.editorModel.deviceContext.isMobile) {\n\t\t\treturn this.groupModel.editorModel.standardPrimaryMobileCols;\n\t\t} else {\n\t\t\treturn this._getFields();\n\t\t}\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setFieldNames();\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths(e);\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths(e);\n\t}\n\n\t/**\n\t * Fires a resize event for the iron-list\n\t * In Single Group View, only the selected group iron-list has flex:1 which ensures that the iron-list fills up all available space\n\t * When current group is toggled, we need to resize selected group's list\n\t * @param e\n\t */\n\tgroupToggled(e) {\n\t\t// resize the previously selected group's table as well to keep the DOM clean\n\t\tthis._ironListResize(e);\n\t\tthis._prepareUIData();\n\t}\n\n\t/**\n\t * Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e\t  - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\tlet bundleKeptTogether = this.editorModel.data.settings.bundleKeptTogether;\n\t\tthis.sortLines(this.groupModel.standardLines, e.detail.field, e.detail.order, bundleKeptTogether, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.standardLines, lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tif (this._hasNumberField()) {\n\t\t\tthis._preserveNumberValues(lines);\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set('groupModel.standardLines', model.slice());\n\t\t\tthis._prepareUIData();\n\t\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null).generateRowNode(this._getFields());\n\t\t} else {\n\t\t\tthis.groupModel.standardLines = model;\n\t\t}\n\t}\n\t\n\t/**\n\t * Invoked when rows are renumbered as a result of clone or delete line\n\t */\n\tonRowsRenumbered() {\n\t\t// refresh UI data so row numbers are re-stamped\n\t\tthis._prepareUIData();\n\t}\n\t\n\t/**\n\t * Preserve the original number values of each line into originalFieldValues\n\t * @param lines\n\t */\n\t_preserveNumberValues(lines) {\n\t\tlines.forEach((line) => {\n\t\t\tlet record = line.lineVO.record;\n\t\t\tlet id = record.Id || record[this.editorModel.constants.SOURCE_FIELD];\n\t\t\tlet numberField = this.editorModel.constants.NUMBER_FIELD;\n\t\t\tif (!this.originalFieldValues[id]) {\n\t\t\t\tthis.originalFieldValues[id] = {};\n\t\t\t}\n\t\t\tif (!this.originalFieldValues[id].hasOwnProperty(numberField)) {\n\t\t\t\tthis.originalFieldValues[id][numberField] = record[numberField];\n\t\t\t}\n\t\t});\n\t}\n\t\n\t_hasNumberField() {\n\t\treturn this._getFields().indexOf(this.editorModel.constants.NUMBER_FIELD) > -1;\n\t}\n\t\n\t_updatePrimaryMobileColumns() {\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(this.groupModel.editorModel.standardPrimaryMobileCols && this.groupModel.editorModel.standardPrimaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone'))\n\t\t\tthis.groupModel.editorModel.standardPrimaryMobileCols[0] = this.fieldSet.fields[0];\n\t}\n\n\t_lineSplicesListener(changeRecord) {\n\t\tif(!changeRecord) return;   //when a new groupModel is assigned, changeRecord is undefined\n\t\tthis.set('groupModel.hasVisibleStandardLines', this.groupModel._groupHasStandardProducts());\n\t\tthis._showSubtotal();\n\t\tif (this._hasNumberField()) {\n\t\t\tthis._preserveNumberValues(this.groupModel.standardLines);\n\t\t}\n\t\tthis.rowTemplate = this.getTemplateGenerator(this.editorModel, this.groupModel, null).generateRowNode(this._getFieldsForTemplate(), {'class': 'row'});\n\t}\n\n\ttoggleOptional(e) {\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.groupModel.groupVO.key) {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.set(`groupModel.standardLines.${i}.lineVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Clear originalFieldValues (used when we need to clear originalFieldValues property, ex: QuickSave was invoked)\n\t */\n\tclearOriginalFieldValues() {\n\t\tif (this.originalFieldValues) {\n\t\t\tObject.keys(this.originalFieldValues).forEach((key) => {\n\t\t\t\tdelete this.originalFieldValues[key];\n\t\t\t})\n\t\t}\n\t}\n\n\tgetZIndex(idx) {\n\t\treturn this.groupModel.standardLines.length + 10 - idx;\n\t}\n\n\t/**\n\t * Catches \"line-toggled\" event fired from the a row or the header\n\t * 1. When event is fired from a row, updates size for the element at that index\n\t * 2. When event is fired from the header (the index is null), updates size for all elements\n\t * @param e - event\n\t * @private\n\t */\n\t_onUpdateSizeForItem(e) {\n\t\tif (e.detail.index) {\n\t\t\tthis.$$('iron-list').updateSizeForItem(e.detail.index);\n\t\t} else {\n\t\t\tfor (let i = 0, len = this.groupModel.standardLines.length; i < len; i++) {\n\t\t\t\tthis.$$('iron-list').updateSizeForItem(i);\n\t\t\t}\n\t\t}\n\t}\n\n\tforwardFocusDown(e) {\n\t\tif(e.keyCode === 9 && !e.shiftKey) // tab key\n\t\t\tRowFocusSignaler.signalFirstEditableTargetFirstRow(this, 'sf-le-table-row', 'data-index');\n\t}\n\n\tforwardFocusUp(e) {\n\t\tif (e.keyCode === 9 && e.shiftKey) // shift+tab key\n\t\t\tRowFocusSignaler.signalLastEditableTargetLastRow(this, 'sf-le-table-row', this.visibleLines.length, 'data-index');\n\t}\n\n\t_initVisibleLines() {\n\t\treturn this.groupModel.standardLines.filter(function (line) {\n\t\t\treturn line.visible;\n\t\t}.bind(this));\n\t}\n\n\t_initTabIndex() {\n\t\treturn this.viewport && this.viewport.isMobile() ? -1 : 0;\n\t}\n\n\t/**\n\t * Observes linesByParentKey in case it has been updated after\n\t * dragDrop instance has been created,\n\t * @param newValue\n\t * @private\n\t */\n\t_updateDragDropParentKey(newValue) {\n\t\tif (this.dragDrop && newValue) {\n\t\t\tthis.dragDrop.linesByParentKey = newValue;\n\t\t}\n\t}\n}\n\nPolymer( SFStandardTable );\n","import {Page} from 'common/core/Page.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getGroupKey(ctx.params)'\n\t\t\t},\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.smLoadService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t}.bind(this));\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus() {\n\t\tthis.$.pf.focusFirstField();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0)\n\t\t\treturn this.navigateToAssetUpgradeRoute();\n\n\t\tthis.onCancel();\n\t}\n\n\tnavigateToAssetUpgradeRoute(){\n\t\tlet queryParams = {\n\t\t\tqId: this.lineEditorModel.quote.record.Id,\n\t\t\tpIds: Object.keys(this.selectedProducts)\n\t\t};\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\n\t\tif(this.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.groupKey;\n\t\treturn this.nav('#', queryParams, ['asset', 'upgrade'], false);\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {qId: this.lineEditorModel.quote.record.Id};\n\t\tif (this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.af.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.af.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetLookupObjects = ['Asset'];\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params.groupKey;\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params.groupKey;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t}\n}\n\nPolymer(AssetLookup);","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js'\nimport {Page} from 'common/core/Page.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetUpgrade{\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-upgrade';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tupgrades: Array,\n\t\t\tupgradeSourceMap: Object,\n\t\t\tupgradeTargetMap: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalidationMessages: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tassetHeaderSelectable: { //this property is used in the HTML binding to disable the header checkbox/radio button\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t},  Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'renderUpgrades(upgrades, recordKeys)',\n\t\t\t'getUpgrades(ctx.params.pIds)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.initializeServiceSpinners();\n\t\tthis.initializeProperties();\n\t\tthis.preLoadObjects();\n\t\tthis.handleUpgradeSelected();\n\t\tthis.handleMetaDataResponse(); //metadata response\n\t\tthis.handleAddProductResponse(); //add products response\n\t\tthis.handleLineEditorModelResponse(); //line editor response\n\t\tthis.handleSelectionResponse(); //response with available upgrades\n\t}\n\n\t/**\n\t * W-3583510 (GUS) These properties were storing values set during previous navigation to this route.\n\t * We redefine them here as they should be initialized every time this component is used\n\t */\n\tinitializeProperties() {\n\t\tthis.upgradeSourceMap = {};\n\t\tthis.upgradeTargetMap = {};\n\t}\n\n\tinitializeServiceSpinners() {\n\t\tthis.$.addProducts.background = false;\n\t\tthis.$.smSelectService.background = false;\n\t}\n\n\tonSelect() {\n\t\tlet upgrades = this.getSelectedUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet quoteId = this.lineEditorModel ? this.lineEditorModel.quote.record.Id : this.ctx.params.qId;\n\t\tthis.nav('#', {'qId': quoteId}, ['quote', 'le'], false);\n\t}\n\n\trenderUpgrades() {\n\t\tfor(let upgrade of this.upgrades){\n\t\t\tthis.upgradeSourceMap[upgrade.record.Product2Id] = this.upgradeSourceMap[upgrade.record.Product2Id] || [];\n\t\t\t//build a map with an array of the source upgrades, upgrade selected must be true for all source upgrades when clicking select\n\t\t\tthis.upgradeSourceMap[upgrade.record.Product2Id].push({\n\t\t\t\tupgradeSelected : false,\n\t\t\t\tId: upgrade.record.Id,\n\t\t\t\tname: upgrade.record.Name\n\t\t\t});\n\t\t\t// We need to keep track of the index of an upgrade since you can upgrade more than one asset at a time\n\t\t\tupgrade._transient_ = upgrade._transient_ || {};\n\t\t\tupgrade._transient_.index = this.upgradeSourceMap[upgrade.record.Product2Id].length - 1;\n\n\t\t\t//for each target upgrade we build a map of the source upgrades\n\t\t\tfor(let upgradeTarget of upgrade.availableUpgrades) {\n\t\t\t\tthis.setUpgradeTargetMap(upgrade, upgradeTarget);\n\t\t\t}\n\t\t}\n\t\tthis.upgradeResults = this.upgrades; //this creates the rows\n\t}\n\n\t/**\n\t * Populates the upgradeTargetMap with values of sourceProductId to an array. An array is necessary when a user wants to\n\t * upgrade the same asset more than once.\n\t * @param upgrade\n\t * @param upgradeTarget\n\t */\n\tsetUpgradeTargetMap(upgrade, upgradeTarget) {\n\t\tconst upgradeProduct2Id = upgrade.record.Product2Id;\n\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id] = this.upgradeTargetMap[upgradeTarget.record.Id] || {};\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id] = this.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id] || [];\n\t\tthis.upgradeTargetMap[upgradeTarget.record.Id][upgradeProduct2Id].push({'upgradeSelected' : false});\n\t}\n\n\tgetUpgrades() {\n\t\tif (this.ctx.params.pIds === undefined)\n\t\t\tthis.navigateToLineEditor();\n\t\tthis.$.smSelectService.selectedProducts = this.ctx.params.pIds.split(',');\n\t}\n\n\t//returns data structured for use in the product configurator\n\tgetSelectedProducts() {\n\t\tlet selectedUpgrades = this.getSelectedUpgrades(),\n\t\t\tselectedProducts = {};\n\n\t\tfor(let upgrade of selectedUpgrades || [])\n\t\t\tselectedProducts[upgrade.record.Id] = {\n\t\t\t\trecord: upgrade.record,\n\t\t\t\tupgradedAssetId: upgrade.upgradedAssetId\n\t\t\t};\n\n\t\treturn selectedProducts;\n\t}\n\n\tapplyUpgrades() {\n\t\tlet upgrades = this.$.upgrades.getUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\t//builds up the data expected on the server for getting a new quote based on the upgrade selections\n\tgetSelectedUpgrades() {\n\t\tlet addProductsArray = [],\n\t\t\tvalidationMessages = [];\n\n\t\tfor (let upgrade of this.upgrades) {\n\t\t\tlet idx = upgrade._transient_.index;\n\t\t\tfor (let availableUpgrade of upgrade.availableUpgrades) {\n\t\t\t\tlet upgradeTargetId = availableUpgrade.record.Id,\n\t\t\t\t\tupgradeSourceId = upgrade.record.Product2Id,\n\t\t\t\t\ttargetProduct = this.upgradeTargetMap[upgradeTargetId][upgradeSourceId][idx],\n\t\t\t\t\tsourceProduct = this.upgradeSourceMap[upgradeSourceId][idx];\n\n\t\t\t\tif (sourceProduct.upgradeSelected === true)\n\t\t\t\t\tcontinue; //an upgrade has already been selected for the source product\n\n\t\t\t\tsourceProduct.upgradeSelected = targetProduct.upgradeSelected;\n\t\t\t\tsourceProduct.upgrade = targetProduct.rowData;\n\t\t\t\tsourceProduct.index = idx;\n\t\t\t}\n\t\t}\n\n\t\tfor(let i in this.upgradeSourceMap) {\n\t\t\tfor (let source of this.upgradeSourceMap[i]) {\n\t\t\t\tif (source.upgradeSelected === false) {\n\t\t\t\t\tvalidationMessages.push('You must select an upgrade for ' + source.name);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//array of selected upgrades that gets passed to addProducts on the server\n\t\t\t\taddProductsArray.push({\n\t\t\t\t\trecord: source.upgrade, //record is the selected record\n\t\t\t\t\tupgradedAssetId: source.Id, //upgradedAssetId is the Id of the upgrade record, not product record\n\t\t\t\t\tindex: source.index\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.validationMessages = validationMessages;\n\n\t\tif(validationMessages.length > 0)\n\t\t\treturn;\n\t\treturn addProductsArray;\n\t}\n\n\thandleUpgradeSelected() {\n\t\t//when an upgrade is selected, update the map to be used when clicking the select button\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e); //deselect all upgrades in a group of available upgrades\n\t\t\tconst selected = e.detail.selected,\n\t\t\t\tsourceProductId = e.detail.rowData._transient_.sourceProduct,\n\t\t\t\tupgradeTargetMap = this.upgradeTargetMap[e.detail.rowData.Id][sourceProductId][e.detail.index];\n\t\t\tupgradeTargetMap.upgradeSelected = selected;\n\t\t\tupgradeTargetMap.rowData = selected === true ? e.detail.rowData : undefined;\n\t\t}.bind(this));\n\t}\n\n\t//build the metadata required for the rows to render\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet recordKeys = [],\n\t\t\t\tfieldLabels = [],\n\t\t\t\tfieldLabelMap = {},\n\t\t\t\ttypeMap = {},\n\t\t\t\tlabelTypeMap = {},\n\t\t\t\titemTypeMap = {},\n\t\t\t\tfields = e.detail.value.fields;\n\t\t\tfields.forEach(function(field) {\n\t\t\t\tlet key = field.name;\n\t\t\t\trecordKeys.push(key);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t\tfieldLabelMap[key] = field.label;\n\t\t\t\ttypeMap[key] = {type: field.type};\n\t\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\t\titemTypeMap[key] = field.type;\n\t\t\t}.bind(this));\n\t\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\t\tthis.typeMap = typeMap;\n\t\t\tthis.recordKeys = recordKeys;\n\t\t\tthis.fieldLabels = fieldLabels;\n\t\t\tthis.fieldLabelMap = fieldLabelMap;\n\t\t}.bind(this));\n\t}\n\n\n\thandleAddProductResponse() {\n\t\tthis.$.addProducts.addEventListener('psm-response-changed', function (e) {\n\t\t\tif(e.detail.value.quote === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.lineEditorModel.quote = e.detail.value.quote;\n\t\t\tif (e.detail.value.configuredProducts !== undefined && e.detail.value.configuredProducts.length > 0)\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\telse\n\t\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\t//when a target asset requires configuration we need to route to the configurator\n\thandleConfigurableProducts(e) {\n\t\tlet response = e.detail.value;\n\t\tlet queryParams = {};\n\t\tlet configProductIds = this.getConfigProductIds(response);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tqueryParams.pId = configProductIds;\n\t\tresponse.selectedProducts = this.getSelectedProducts();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfigProductIds(products) {\n\t\tlet productIds = [];\n\t\tfor (let product of products.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.addProducts.stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\t\tthis.$.addProducts.stripLinesMessage = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tthis.$.addProducts.quote = this.$.smSelectService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectionResponse() {\n\t\tthis.$.smSelectService.useCache = false; //we don't want this service to cache because it will cause the configurator to read the wrong cache data\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\t//if no upgrades are available return to the line editor\n\t\t\tif (e.detail.value[0] === undefined || Array.isArray(e.detail.value[0].availableUpgrades) === false)\n\t\t\t\treturn this.navigateToLineEditor();\n\t\t\tthis.upgrades = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetUpgradeObjects = ['Product2'];\n\t}\n\n\tget fieldPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selected === false || e.detail.selected === undefined)\n\t\t\treturn;\n\t\tlet root = Polymer.dom(e).rootTarget, //this is the current row\n\t\t\trows = Polymer.dom(root.parentElement).querySelectorAll('sb-table-row'); //this collects all the rows\n\n\t\tfor (let row of rows)\n\t\t\tif (row.selectionType === 'radio' && row !== root)\n\t\t\t\trow.selected = false;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t}\n\n\t// build our own data to pass into table row\n\t// in case of upgrades to the same product so we have a handle of the source product it's upgrading from\n\tbuildRowDataArray(upgrade) {\n\t\tlet availableUpgrades = [];\n\t\tfor (let availableUpgrade of upgrade.availableUpgrades || []) {\n\t\t\tavailableUpgrade.record._transient_ = availableUpgrade.record._transient_ || {};\n\t\t\tObject.assign(availableUpgrade.record._transient_, { sourceProduct: upgrade.record.Product2Id, sourceProductIndex: upgrade._transient_.index});\n\t\t\tavailableUpgrades.push(availableUpgrade);\n\t\t}\n\n\t\treturn availableUpgrades;\n\t}\n}\n\nPolymer(AssetUpgrade);\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function checkboxFactory(value, disabled, hidden, tabIndex) {\n\tlet ff = new FormField('sb-checkbox');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('hide', 1, 'hide', hidden);\n\tff.addAttribute('tab-index', 1, 'tabIndex', tabIndex);\n\n\tff.formattedValue = { value, label: '' };\n\treturn ff;\n}\n","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function datePickerFactory(value, editable, disabled, i18n, renderReadOnly, type, factoryData = {range: false}, environment = PageContainer) {\n\tif(!editable)\n\t\treturn newFormattedDate(value, i18n);\n\n\tif(environment.isMobile())\n\t\treturn newMobileDatePicker(value, editable, disabled, type);\n\tif(factoryData.range === true)\n\t\treturn newDateRangePicker(value, disabled, renderReadOnly);\n\n\treturn newDatePicker(value, disabled, i18n);\n}\n\nfunction newMobileDatePicker(value, editable, disabled, type) {\n\treturn inputFactory(value, editable, disabled, 'dateInput', type);\n}\n\nfunction newDatePicker(value, disabled, i18n) {\n\tlet ff = new FormField('sb-datepicker');\n\tff.addAttribute('selected-date', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-date-esc';\n\tff.readOnlyBlurEvent = 'sb-date-blur';\n\tff.changeEvent = 'selected-date-changed';\n\n\tsetFormattedValue(value, ff, getFormattedValue(value, i18n));\n\treturn ff;\n}\n\nfunction newDateRangePicker(value, disabled, renderReadOnly) {\n\tlet ff = new FormField('sb-daterange');\n\t// Non-product search filters come with default value of null instead of '', so handle that here\n\tif (value === null)\n\t\tvalue = '';\n\n\tlet hasStart = value.start !== undefined;\n\tlet hasEnd = value.end !== undefined;\n\tff.addAttribute('formatted-value', 2, 'value', {\n\t\tstart: hasStart ? value.start : value,\n\t\tend: hasEnd ? value.end : value\n\t});\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('use-mask', 1, 'useMask', !renderReadOnly);\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-date-esc';\n\tff.readOnlyBlurEvent = 'sb-date-blur';\n\tff.changeEvent = 'selected-date-range-changed';\n\n\treturn ff;\n}\n\nfunction newFormattedDate(value, i18n) {\n\tlet formattedValue = getFormattedValue(value, i18n);\n\tlet ff = simpleFieldFactory(formattedValue);\n\tsetFormattedValue(value, ff, formattedValue);\n\treturn ff;\n}\n\nfunction getFormattedValue(value, i18n) {\n\treturn i18n.format(value, { date: true });\n}\n\nfunction setFormattedValue(value, ff, formattedDate) {\n\tff.formattedValue = { value, label: formattedDate };\n}\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {getUnitAndDisplayValue, setDiscountValue, updateUnitIfAmountInactive} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\n\nexport function discountFactory(model, disabled, renderReadOnly, inputType, pattern, numberFormatter, property) {\n\t// TODO: I'm not sure why this logic is this way -> refactor\n\tupdateUnitIfAmountInactive(model, property);\n\tlet { units, unit, displayValue } = getUnitAndDisplayValue(model, property);\n\n\tsetDiscountValue(model, property, displayValue);\n\tconst value = model.lineVO.record[model.constants.ADDITIONAL_DISCOUNT_FIELD];\n\n\tlet ff = new FormField('sb-discount');\n\tff.addAttribute('model', 1, 'model', model);\n\tff.addAttribute('property', 1, 'property', property);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('input-type', 1, 'inputType', inputType);\n\tff.addAttribute('pattern', 1, 'pattern', pattern);\n\tff.addAttribute('formatter', 1, 'formatter', numberFormatter);\n\n\tff.readOnlyBlurEvent = 'sb-discount-blur';\n\tff.changeEvent = 'sb-discount-change';\n\tff.readOnlyKeyDownEvent = 'sb-discount-keydown';\n\n\tlet label = numberFormatter.format(displayValue);\n\tlet discountUnit = getDiscountUnit(units, unit, value);\n\tunit = label != null && label !== '' ? discountUnit.label : ''; // no unit if label is nil\n\tff.formattedValue = { value, label, unit, unitValue: discountUnit.value};\n\n\tff.addAttribute('display-value', 1, 'displayValue', label);\n\tff.addAttribute('original', 1, 'original', ff.formattedValue);\n\treturn ff;\n}\n\nfunction getDiscountUnit(units, unit, value) {\n\tif(!units || isNil(value))\n\t\treturn {label: '', value: ''};\n\n\tfor(let u of units) {\n\t\tif(u.value === unit)\n\t\t\treturn {label: u.label, value: u.value};\n\t}\n}\n\nfunction isNil(value) {\n\treturn value === undefined || value === null || value === '' || isNaN(value);\n}\n","import {checkboxFactory} from 'common/forms/sb-checkbox/factory/CheckboxFactory.js';\nimport {datePickerFactory} from 'common/forms/sb-datepicker/factory/DatePickerFactory.js';\nimport {numericFieldFactory} from 'common/forms/sb-field/factory/NumericFieldFactory.js';\nimport {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {lookupFactory} from 'common/forms/sb-lookup/factory/LookupFactory.js';\nimport {selectFactory} from 'common/forms/sb-select/factory/SelectFactory.js';\nimport {textFieldFactory} from 'common/forms/sb-field/factory/TextFieldFactory.js';\n\nexport function fieldFactory(type, model, value, editable, disabled, hidden, index, metadata, i18n, renderReadOnly, selectOptions, referenceDetails, tabIndex, factoryData) {\n\tswitch(type) {\n\t\tcase 'boolean':\n\t\tcase 'checkbox':\n\t\t\treturn checkboxFactory(value, disabled, hidden, tabIndex);\n\t\tcase 'date':\n\t\tcase 'datetime':\n\t\t\treturn datePickerFactory(value, editable, disabled, i18n, renderReadOnly, type, factoryData);\n\t\tcase 'discount':\n\t\tcase 'double':\n\t\tcase 'number':\n\t\tcase 'currency':\n\t\tcase 'percent':\n\t\t\treturn numericFieldFactory(model, value, editable, disabled, metadata, i18n, renderReadOnly,\n\t\t\t\tindex == 0 ? 'first numberInput' : 'numberInput', type); // keep double equals to allow coercion if index is a string\n\t\tcase 'id':\n\t\tcase 'reference':\n\t\t\treturn lookupFactory(value, editable, disabled, metadata, referenceDetails, renderReadOnly);\n\t\tcase 'picklist':\n\t\tcase 'multipicklist':\n\t\t\treturn selectFactory(value, editable, disabled, type, metadata, i18n, !renderReadOnly, selectOptions);\n\t\tcase 'string':\n\t\tcase 'textarea':\n\t\tcase 'phone':\n\t\tcase 'url':\n\t\tcase 'email':\n\t\t\treturn textFieldFactory(value, editable, disabled, metadata, renderReadOnly, type);\n\t\tdefault:\n\t\t\treturn simpleFieldFactory(value);\n\t}\n}\n","let FRONT_BINDING = { 0: '', 1: '[[', 2: '{{' };\nlet BACK_BINDING = { 0: '', 1: ']]', 2: '}}' };\n\nexport class FormField {\n\n\tconstructor(name) {\n\t\tthis.name = name;\n\t\tthis.attributes = [];\n\t\tthis.events = [];\n\t}\n\n\taddAttribute(name, binding, variable, value, equals) {\n\t\tthis.attributes.push( { name: name, binding: binding, variable: variable, value: value, equals: equals || '=' } );\n\t}\n\n\taddEvent(event, variable, handler) {\n\t\tthis.events.push( { event: event, variable: variable, handler: handler } );\n\t}\n\n\tsetInnerText(variable, binding, value) {\n\t\tthis.innerText =  { variable: variable, binding: binding, value: value };\n\t}\n\n\tget formattedValue() {\n\t\treturn this._formattedValue;\n\t}\n\n\tset formattedValue(formattedValue) {\n\t\tthis._formattedValue = formattedValue != null && Object.keys(formattedValue).indexOf('label') !== -1 ? formattedValue : { value: formattedValue, label: formattedValue };\n\t}\n\n\tget defaultValue() {\n\t\treturn this._defaultValue;\n\t}\n\n\tset defaultValue(defaultValue) {\n\t\tthis._defaultValue = defaultValue;\n\t}\n\n\tget readOnlyKeyEvent() {\n\t\treturn this._readOnlyKeyEvent || 'keyup';\n\t}\n\n\tset readOnlyKeyEvent(readOnlyKeyEvent) {\n\t\tthis._readOnlyKeyEvent = readOnlyKeyEvent;\n\t}\n\n\tget readOnlyKeyDownEvent() {\n\t\treturn this._readOnlyKeyDownEvent || 'keydown';\n\t}\n\n\tset readOnlyKeyDownEvent(readOnlyKeyDownEvent) {\n\t\tthis._readOnlyKeyDownEvent = readOnlyKeyDownEvent;\n\t}\n\n\tget readOnlyBlurEvent() {\n\t\treturn this._readOnlyBlurEvent || 'blur';\n\t}\n\n\tset readOnlyBlurEvent(readOnlyBlurEvent) {\n\t\tthis._readOnlyBlurEvent = readOnlyBlurEvent;\n\t}\n\n\tget changeEvent() {\n\t\treturn this._changeEvent || 'change';\n\t}\n\n\tset changeEvent(changeEvent) {\n\t\tthis._changeEvent = changeEvent;\n\t}\n\n\tget numeric() {\n\t\treturn !!(this._numeric);\n\t}\n\n\tset numeric(numeric) {\n\t\tthis._numeric = numeric;\n\t}\n\n\tget html() {\n\t\treturn this._html;\n\t}\n\n\tattachTo(template, readOnlyKeyHandler, readOnlyKeyDownHandler, readOnlyBlurHandler, changeHandler, hiddenField, focusOnAttached) {\n\t\tthis._html = `<${this.name}`;\n\n\t\t// add attributes\n\t\tthis.attributes.forEach((attribute) => {\n\t\t\tthis._html += ` ${attribute.name}${attribute.equals}\"${FRONT_BINDING[attribute.binding]}${attribute.variable}${BACK_BINDING[attribute.binding]}\"`;\n\t\t\ttemplate[attribute.variable] = attribute.value;\n\t\t});\n\n\t\t// add events\n\t\tthis.events.forEach((event) => {\n\t\t\tthis._html += ` on-${event.event}=\"${event.variable}\"`;\n\t\t\ttemplate[event.variable] = event.handler;\n\t\t});\n\n\t\t// add specific event handlers if provided\n\t\tif(readOnlyKeyHandler)\n\t\t\tthis._html += ` on-${this.readOnlyKeyEvent}=\"${readOnlyKeyHandler}\"`;\n\n\t\tif(readOnlyKeyDownHandler)\n\t\t\tthis._html += ` on-${this.readOnlyKeyDownEvent}=\"${readOnlyKeyDownHandler}\"`;\n\n\t\tif(readOnlyBlurHandler)\n\t\t\tthis._html += ` on-${this.readOnlyBlurEvent}=\"${readOnlyBlurHandler}\"`;\n\n\t\tif(changeHandler)\n\t\t\tthis._html += ` on-${this.changeEvent}=\"${changeHandler}\"`;\n\n\t\t// add other miscellaneous properties if provided\n\t\tif(hiddenField)\n\t\t\tthis._html += ` hidden$=\"[[${hiddenField}]]\"`;\n\n\t\tif(focusOnAttached)\n\t\t\tthis._html += ' focus-on-attached=\"true\"';\n\n\t\t// place holder for apply focus\n\t\tthis._html += ' apply-focus=\"[[applyFocus]]\"';\n\n\t\tthis._html += `>`;\n\n\t\tif(this.innerText) {\n\t\t\tthis._html  += `${FRONT_BINDING[this.innerText.binding]}${this.innerText.variable}${BACK_BINDING[this.innerText.binding]}`;\n\t\t\ttemplate[this.innerText.variable] = this.innerText.value;\n\t\t}\n\n\t\tthis._html += `</${this.name}>`;\n\t}\n}","import {discountFactory} from 'common/forms/sb-discount/factory/DiscountFactory.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport function numericFieldFactory(model, value, editable, disabled, metadata, i18n, renderReadOnly, inputClass, type, environment = PageContainer) {\n\tconst inputType = environment.isMobile() && !Locale.isCommaDecimal() ? 'number' : 'text';\n\tconst numberFormatter = new NumberFormatter(editable, metadata, i18n, type, environment.getViewport());\n\n\tif(model && (model.constants.ADDITIONAL_DISCOUNT_FIELD === metadata.name || model.constants.MARKUP_FIELD === metadata.name)) {\n\t\tlet ff = discountFactory(model, disabled, renderReadOnly, inputType, null, numberFormatter, metadata.name);\n\t\tff.numeric = true;\n\t\treturn ff;\n\t}\n\n\tlet formattedValueWithUnits = numberFormatter.format(value, true);\n\tlet formattedValue = !editable ? formattedValueWithUnits : numberFormatter.format(value, false);\n\tlet ff = inputFactory(formattedValue, editable, disabled, inputClass, inputType, renderReadOnly);\n\tff.formattedValue = { value, label: formattedValueWithUnits };\n\tff.numeric = true;\n\treturn ff;\n}\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function simpleFieldFactory(value, fieldClass) {\n\tlet ff = new FormField('sb-div');\n\tff.addAttribute('value', 1, 'value', value);\n\tif(fieldClass)\n\t\tff.addAttribute('class', 1, 'fieldClass', fieldClass, '$=');\n\n\treturn ff;\n}\n","import {textareaFactory} from 'common/forms/sb-textarea/factory/TextareaFactory.js';\nimport {inputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {richTextEditorFactory} from 'common/forms/sb-rte/factory/RichTextEditorFactory.js';\nimport {Util} from 'common/Util.js';\n\nexport function textFieldFactory(value, editable, disabled, metadata, renderReadOnly, type) {\n\tif (metadata.extraTypeInfo === 'richtextarea')\n\t\treturn richTextEditorFactory(value, editable, renderReadOnly, metadata);\n\n\tvar ff;\n\tif(metadata.maxLength > 255 || metadata.format === 'multiline' || type === 'textarea')\n\t\tff = textareaFactory(value, editable, disabled, renderReadOnly);\n\telse\n\t\tff = inputFactory(value, editable, disabled, 'textInput', 'text', renderReadOnly);\n\n\tff.formattedValue = Util.toHTML(value);\n\n\treturn ff;\n}","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function inputFactory(value, editable, disabled, inputClass, inputType, renderReadOnly, pattern) {\n\tif(editable)\n\t\treturn newInput(value, disabled, inputClass, inputType || 'text', renderReadOnly, pattern);\n\n\treturn simpleFieldFactory(value);\n}\n\nfunction newInput(value, disabled, inputClass, inputType, renderReadOnly, pattern) {\n\tlet ff = new FormField('sb-input');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('input-class', 1, 'inputClass', inputClass);\n\tff.addAttribute('input-type', 1, 'inputType', inputType);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('pattern', 1, 'pattern', pattern);\n\n\tff.readOnlyKeyEvent = 'sb-input-key';\n\treturn ff;\n}\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport function lookupFactory(value, editable, disabled, metadata, referenceDetails, renderReadOnly) {\n\tif(!editable)\n\t\treturn newReferenceLink(value, metadata, referenceDetails);\n\n\treturn newLookup(value, disabled, metadata, referenceDetails, renderReadOnly);\n}\n\nfunction newLookup(value, disabled, metadata, referenceDetails, renderReadOnly) {\n\tlet ff = new FormField('sb-lookup');\n\tlet label =  getLabel(false, value, metadata, referenceDetails);\n\tff.formattedValue = { value, label };\n\n\tff.addAttribute('id', 0, 'lookup');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('label', 1, referenceDetails.refDisplayName, ff.formattedValue.label);\n\tff.addAttribute('label-name', 1, 'labelName', referenceDetails.refDisplayName);\n\tff.addAttribute('table-name', 1, 'refTable', referenceDetails.refTable);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('field-full-name', 1, 'fieldFullName', metadata.tableName + '.' + metadata.name);\n\tff.addAttribute('field-label', 1, 'fieldLabel', metadata.label);\n\tff.addAttribute('revert-on-escape', 1, 'revertOnEscape', renderReadOnly);\n\tff.addAttribute('calculate-list-position', 1, 'calculateListPosition', false);\n\tff.addAttribute('has-filter', 1, 'hasFilter', !!(metadata.filteredLookupInfo));\n\tff.addAttribute('record', 1, 'record', referenceDetails.record);\n\tif (metadata.filteredLookupInfo && metadata.filteredLookupInfo.controllingFields) {\n\t\tff.addAttribute('controlling-fields', 1, 'controllingFields', metadata.filteredLookupInfo.controllingFields);\n\t}\n\n\t// add event names\n\tff.readOnlyKeyEvent = 'sb-type-esc';\n\tff.readOnlyBlurEvent = 'sb-type-blur';\n\tff.changeEvent = 'lookup-value-changed';\n\n\treturn ff;\n}\n\nfunction newReferenceLink(value, metadata, referenceDetails) {\n\tlet ff = new FormField('span');\n\tlet label = getLabel(true, value, metadata, referenceDetails);\n\tff.addAttribute('value', 2, '_value_', value); // _value_ not a typo, so please leave it\n\tff.addAttribute('class', 1, 'link', 'link', '$=');\n\tff.setInnerText(referenceDetails.refDisplayName, 1, label);\n\tff.formattedValue = { value, label };\n\n\tff.addEvent('tap', 'refClick', function(e) {\n\t\twindow.open(window.location.origin + '/' + e.target.value);\n\t});\n\treturn ff;\n}\n\nfunction extractRefDisplay(metadata, referenceDetails) {\n\tlet property = referenceDetails.property;\n\tlet obj = referenceDetails.obj;\n\tlet refObjects = referenceDetails.refObjects;\n\n\tlet fieldName = property.Name ? property.Name : metadata.name;\n\tif(!fieldName)\n\t\treturn;\n\n\tlet pos = fieldName.lastIndexOf('Id');\n\tlet refObj = pos >= 0 ? fieldName.substring(0, pos) : (fieldName.lastIndexOf('__c') >= 0 ? fieldName.replace('__c', '__r') : null);\n\n\tlet refType = obj[refObj] ? obj[refObj].attributes.type : null;\n\n\tif (refObj && obj[refObj] && refObjects && refType && refObjects[refType]) {\n\t\tlet nameProp = refObjects[refType].nameField.fieldName;\n\t\tif (obj[refObj][nameProp])\n\t\t\treturn obj[refObj][nameProp];\n\n\t\treturn obj[refObj].Id;\n\t}\n}\n\nfunction getLabel(extractReferenceDisplay, value, metadata, referenceDetails) {\n\tlet label = referenceDetails[referenceDetails.refDisplayName];\n\tif(label) return label;\n\n\tif(extractReferenceDisplay)\n\t\tlabel = extractRefDisplay(metadata, referenceDetails);\n\n\t// attempt to retrieve label from a non-standard name field registered in LookupNameMapper, such as Contract -> ContractNumber\n\tif (!label && referenceDetails.refTable && metadata.relationshipName && referenceDetails.record) {\n\t\tlet nameField = new LookupNameMapper(referenceDetails.refTable).getNameField();\n\t\tlet relationshipRec = referenceDetails.record[metadata.relationshipName];\n\t\tif (relationshipRec) {\n\t\t\tlabel = relationshipRec[nameField];\n\t\t}\n\t}\n\treturn label || value || '';\n}\n","const NAME_MAP = {\n\tContract: 'ContractNumber',\n\tCase: 'CaseNumber'\n};\n\nexport class LookupNameMapper {\n\n\tconstructor(tableName) {\n\t\tthis.tableName = tableName;\n\t}\n\n\tgetNameField() {\n\t\treturn NAME_MAP[this.tableName] || 'Name';\n\t}\n}","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js'\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {DateParser} from 'common/forms/DateParser.js';\n\nexport class LookupQueryBuilder {\n\n\tconstructor(tableName, searchField, hasFilter, lookupFieldFullName, resultsLimit, currentRecordFields, currentRecord, applyMruOptimization, fields) {\n\t\tthis.tableName = tableName;\n\t\tthis.searchField = searchField;\n\t\tthis.hasFilter = hasFilter;\n\t\tthis.lookupFieldFullName = lookupFieldFullName;\n\t\tthis.resultsLimit = resultsLimit;\n\t\tthis.currentRecordFields = currentRecordFields;\n\t\tthis.currentRecord = currentRecord;\n\t\tthis.applyMruOptimization = applyMruOptimization;\n\t\tthis.fields = fields;\n\t\tthis.fieldTypeByName = fields && fields.fieldTypeObjByName ? fields.fieldTypeObjByName : null;\n\t\tthis.numberParser = new NumberParser();\n\t\tthis.dateParser = new DateParser(true);\n\t}\n\n\tbuild(searchValue = '', selectAllFields = false, searchAdditionalFields = false) {\n\t\tlet searchCriteria = '%';\n\t\tlet noWildcardSearchValue = '';\n\n\t\tif(searchValue != null && searchValue !== '') {\n\t\t\tsearchCriteria = searchValue.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/'/g, \"\\\\'\").replace(/%/g, '\\\\%').replace(/[*]+/g, '%');\n\t\t\tnoWildcardSearchValue = searchValue.replace(/\\*/g, '');\n\t\t\tif (!searchCriteria.endsWith('%'))\n\t\t\t\tsearchCriteria += '%';\n\t\t}\n\n\t\tlet scope = this.getScope(noWildcardSearchValue);\n\t\tlet scopeClause = '';\n\n\t\tif(this.hasFilter)\n\t\t\tscopeClause = ` USING SCOPE ${scope}, LOOKUP ${this.lookupFieldFullName}`;\n\t\telse if(scope === 'mru')\n\t\t\tscopeClause = ' USING SCOPE mru';\n\n\t\tlet selectClause = this.getSelectClause(selectAllFields);\n\t\tlet whereClause = this.getWhereClause(searchCriteria, searchValue, searchAdditionalFields);\n\t\tlet orderByClause = scope === 'mru' ? 'ORDER BY LastViewedDate DESC' : `ORDER BY ${this.searchField}`;\n\t\tlet query = `${selectClause} FROM ${this.tableName}${scopeClause} WHERE ${whereClause} ${orderByClause} LIMIT ${this.resultsLimit}`;\n\n\t\t// if has filter, has current record fields, and has a current record then lets add the bind clause to the query\n\t\tif(this.hasFilter && this.currentRecordFields && Object.keys(this.currentRecordFields).length > 0 && this.currentRecord) {\n\t\t\tlet index = 0;\n\t\t\tfor(let currentRecordField in this.currentRecordFields) {\n\t\t\t\tlet value = typeof this.currentRecord.getValue === 'function' ? this.currentRecord.getValue(currentRecordField) : this.currentRecord[currentRecordField];\n\t\t\t\tlet type = this.currentRecordFields[currentRecordField];\n\t\t\t\tif(this.omitField(value, type))\n\t\t\t\t\tcontinue;\n\t\t\t\tif(index === 0)\n\t\t\t\t\tquery += ' BIND ';\n\t\t\t\tif(index++ > 0)\n\t\t\t\t\tquery += ', ';\n\t\t\t\tquery += `${currentRecordField} = ${this.getBindValue(value, type)}`;\n\t\t\t}\n\t\t}\n\t\treturn query;\n\t}\n\n\tgetScope(searchValue) {\n\t\tif (!this.applyMruOptimization)\n\t\t\treturn 'everything';\n\n\t\tlet searchValueLength = searchValue == null ? 0 : searchValue.length;\n\t\tif (searchValueLength > 2)\n\t\t\treturn 'everything';\n\n\t\tlet lang = AppContext.user.lang;\n\t\t// if searchValue is at least one character and user's language is Chinese, Japanese, Korean or Thai then scope is everything\n\t\t// why?...see description for 'q' parameter at https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/resources_search_suggest_records.htm\n\t\t// see language codes at https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_translations.htm\n\t\tif (searchValueLength > 0 && (lang === 'zh_CN' || lang === 'zh_TW' || lang === 'ja' || lang === 'ko' || lang === 'th'))\n\t\t\treturn 'everything';\n\n\t\treturn 'mru';\n\t}\n\n\tomitField(value, type) {\n\t\treturn value == null && (this.isNumericType(type) || this.isLookupType(type));\n\t}\n\n\tgetBindValue(value, type) {\n\t\tif(value == null)\n\t\t\treturn \"''\";\n\n\t\tif(value === true || value === false)\n\t\t\treturn value;\n\n\t\tif(this.isNumericType(type))\n\t\t\treturn value;\n\n\t\treturn `'${value}'`;\n\t}\n\n\tisNumericType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\tcase 'int':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisLookupType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'id':\n\t\t\tcase 'reference':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisDateType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetSelectClause(selectAllFields) {\n\t\tlet fields = selectAllFields && this.fields && this.fields.fieldNames ? LookupQueryBuilder._buildFields(this.fields) : [this.searchField];\n\t\treturn `SELECT Id, ${fields.join(',')}`;\n\t}\n\n\tgetWhereClause(searchCriteria, searchValue, searchAdditionalFields) {\n\t\tlet whereConditions = [`${this.searchField} LIKE '${searchCriteria}'`];\n\n\t\t// if we are not searching against additional fields or we do not have the field types,\n\t\t// then we are done and just return the search field condition\n\t\tif(!searchAdditionalFields || !this.fields || !this.fields.additionalSearchFields || !this.fieldTypeByName)\n\t\t\treturn whereConditions[0];\n\n\t\tlet dateSearchValue = undefined, numberSearchValue = undefined;\n\t\tlet additionalSearchFields = LookupQueryBuilder._buildFields(this.fields, 'additionalSearchFields');\n\t\tfor(let field of additionalSearchFields) {\n\t\t\tlet type = this.fieldTypeByName[field];\n\t\t\tif(type != null && type.type != null)\n\t\t\t\ttype = type.type;\n\n\t\t\t// nobody is going to search via a reference ID, so skip lookup fields\n\t\t\tif (this.isLookupType(type))\n\t\t\t\tcontinue;\n\n\t\t\t// if a date type then do a greater then or equal to the date\n\t\t\tif(this.isDateType(type)) {\n\t\t\t\tif (searchValue == null || searchValue === \"\")\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif(dateSearchValue === undefined)\n\t\t\t\t\tdateSearchValue = this.dateParser.parse(searchValue);\n\n\t\t\t\tif(dateSearchValue == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet dateStr = dateSearchValue.toISOString().split('T')[0];\n\t\t\t\tif(type === 'datetime')\n\t\t\t\t\tdateStr += 'T00:00:00.000+0000';\n\n\t\t\t\twhereConditions.push(`${field} >= ${dateStr}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.isNumericType(type)) {\n\t\t\t\tif (searchValue == null || searchValue === \"\")\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif(numberSearchValue === undefined)\n\t\t\t\t\tnumberSearchValue = this.numberParser.parse(searchValue, true);\n\n\t\t\t\tif(isNaN(numberSearchValue))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet number = numberSearchValue;\n\t\t\t\tif(type === 'int')\n\t\t\t\t\tnumber = parseInt(number);\n\n\t\t\t\twhereConditions.push(`${field} >= ${number}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// for non number, non date, & non lookup types, simply do a LIKE against the search criteria\n\t\t\twhereConditions.push(`${field} LIKE '${searchCriteria}'`);\n\t\t}\n\n\t\t// join the where conditions with a logical OR to create the where clause\n\t\treturn whereConditions.join(' OR ');\n\t}\n\n\tstatic _buildFields(fields, fieldKey = 'fieldNames') {\n\t\tlet fieldNames = [].concat(fields[fieldKey]);\n\n\t\tlet relationships = [];\n\t\tfor(let lookupField of fields.fieldsOfTypeLookup) {\n\t\t\tif (fieldNames.indexOf(lookupField.name) !== -1)\n\t\t\t\trelationships.push(RelationshipFieldManager.getRelationshipField(lookupField.name, lookupField.table));\n\t\t}\n\t\tif(relationships.length > 0)\n\t\t\tfieldNames = fieldNames.concat(relationships);\n\n\t\treturn fieldNames;\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\n\n\nlet config = {\n\tinline: false,\n\tfont_formats: 'Arial=Arial,sans-serif;Courier=Courier,monospace;Dosis=Dosis,sans-serif;Droid Sans=Droid Sans,sans-serif;Droid Serif=Droid Serif,serif;Helvetica=Helvetica,sans-serif;Merriweather=Merriweather,sans-serif;Montserrat=Montserrat,sans-serif;Noto Sans JP=Noto Sans JP,sans-serif;Noto Sans KR=Noto Sans KR,sans-serif;Noto Sans SC=Noto Sans SC,sans-serif;Noto Sans TC=Noto Sans TC,sans-serif;Open Sans=Open Sans,sans-serif;Play=Play,sans-serif;PT Sans=PT Sans,sans-serif;PT Serif=PT Serif,serif;Roboto=Roboto,sans-serif;Roboto Light=Roboto:300,sans-serif;Times=Times,serif;Titillium Web=Titillium Web,sans-serif;Ubuntu=Ubuntu,sans-serif;',\n\tforced_root_block: '',\n\tmenubar: false,\n\ttoolbar1: 'cut copy paste | undo redo | styleselect formatselect fontselect fontsizeselect | link image table',\n\ttoolbar2: 'bold italic underline strikethrough subscript superscript removeformat | numlist bullist | outdent indent | blockquote | alignleft aligncenter alignright alignjustify | code',\n\tplugins: 'link image code table'\n};\n\nconst FONTS = \"//fonts.googleapis.com/css?family=Dosis|Droid+Sans|Droid+Serif|Merriweather|Montserrat|Open+Sans|Play|PT+Sans|PT+Serif|Roboto:300,400|Titillium+Web|Ubuntu\";\n\ntinymce.baseURL = '/common/staticresources/tinymce'; // default\ntinymce.suffix = '.min';\n\nexport class RichTextEditorDialog {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-rte-dialog';\n\t\tthis.properties = {\n   \t\t\tvalue: {\n   \t\t\t\ttype: String,\n\t\t\t\tobserver:  '_valueChanged',\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tlet sheets = document.querySelectorAll( 'head > link[rel=stylesheet]' ),\n\t\t\tlen = sheets ? sheets.length : 0;\n\n\t\t// add web fonts if not already in document\n\t\tfor( let i=0; i < len; i++ ) {\n\t\t\tif( sheets[i].getAttribute('href') == FONTS )\n\t\t\t\treturn;\n\t\t}\n\n\t\tlet link = document.createElement( 'link' );\n\t\tlink.setAttribute( 'rel', 'stylesheet' );\n\t\tlink.setAttribute( 'href', FONTS );\n\t\tdocument.head.appendChild( link );\n\t}\n\n\t_initialize() {\n\t\tconfig.inline = true;\n\t\tconfig.target = Polymer.dom(this.root).querySelector('#rte');\n\t\t// In order to prevent multiple tinymce instances from being initialized, we set this flag before we begin\n\t\t// initializing.\n\t\tthis.tinymceInitCalled = true;\n\t\ttinymce.init( config ).then( function( editors ) {\n\t\t\tthis.editor = editors[0];\n\t\t\ttry {\n\t\t\t\tthis.editor.setContent( this.value );\n\t\t\t} catch(e) {}\n\n\t\t\tthis.$.rte.focus();\n\n\t\t\tthis.editor.on('blur', function(e) {\n\t\t\t\tif (this.internal)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Use internal flag to prevent upcoming events, blur() and focus(), from being called multiple times\n\t\t\t\tthis.internal = true;\n\t\t\t\tthis.$.rte.blur();\n\t\t\t\tif (this.$.dialog.show)\n\t\t\t\t\tthis.$.rte.focus();\n\t\t\t\tthis.internal = false;\n\t\t\t}.bind(this));\n\n\t\t}.bind(this)).catch( function(err) {\n\t\t\tconsole.error( err );\n\t\t});\n\t}\n\n\tonSave() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tlet content = this.editor.getContent({format: 'raw'}); // use {format: 'raw'} to prevent missing line break\n\t\tthis.value = content !== description ? content : null;\n\t\tthis.rte.value = this.value;\n\t\tthis.rte.fire('rte-value-changed', {value: this.value});\n\t\tthis.rte.fire('rte-saved');\n\t\tthis.close();\n\t}\n\n\tonCancel() {\n\t\tthis.rte.fire('rte-esc', { keyCode: 27 } );\n\t\tthis.close();\n\t}\n\n\topen() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tthis.$.dialog.open();\n\t\tif (this.value === description || this.value == undefined)\n\t\t\tthis.value = null;\n\t\tthis.$.rte.focus();\n\t\tPolymer.dom(this.root).querySelector('.title').innerHTML = AppContext.properties.i18n.value().l(`Edit ${this.rte.label}`); // Needed for Safari and FF to update title correctly\n\t\t// In order to avoid initializing multiple tinymces when we don't want to, we check the value of this flag.\n\t\tif (!this.tinymceInitCalled) {\n\t\t\tthis._initialize();\n\t\t}\n\n\t\tthis.addEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\tclose() {\n\t\tlet description = AppContext.properties.i18n.value().l(\"Click to edit description\");\n\t\tthis.rte.fire('rte-blur');\n\t\tthis.$.dialog.close();\n\t\tif (this.value === description)\n\t\t\tthis.value = null;\n\t\t// Must call remove every time, because there can only been one instance of an editor on a page at a given time\n\t\ttinymce.remove();\n\t\tthis.tinymceInitCalled = false;\n\t\tthis.removeEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\tstatic setBaseUrl( u ) {\n\t\tif( u )\n\t\t\ttinymce.baseURL = u;\n\t}\n\n\t_valueChanged() {\n\t\tPolymer.dom(this.$.rte).innerHTML = this.value;\n\t}\n\n}\n\nPolymer ( RichTextEditorDialog );\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\n\nexport function richTextEditorFactory(value, editable, renderReadOnly, metadata, environment = PageContainer) {\n\tif (editable && !environment.isMobile()) {\n\t\treturn newRichTextEditor(value, renderReadOnly, metadata);\n\t}\n\n\t// In cases of mobile, not editable, etc.\n\treturn simpleFieldFactory(value);\n}\n\nfunction newRichTextEditor(value, renderReadOnly, metadata) {\n\t// prevent IE from display literal \"null\" when value is not set\n\tif (value === null) {\n\t\tvalue = '';\n\t}\n\tlet ff = new FormField('sb-rte');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\tff.addAttribute('label', 1, 'label', metadata.label);\n\n\tff.readOnlyKeyEvent = 'rte-esc';\n\tff.readOnlyBlurEvent = 'rte-blur';\n\tff.changeEvent = 'rte-value-changed';\n\n\treturn ff;\n}\n","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {Select} from 'common/forms/sb-select/Select.js';\n\nexport function selectFactory(value, editable, disabled, type, metadata, i18n, useNoneLabel, options) {\n\tlet multiSelect = type === 'multipicklist';\n\tif(editable)\n\t\treturn newSelectList(value, disabled, metadata, i18n, useNoneLabel, options, multiSelect);\n\n\treturn simpleFieldFactory(getLabel(value, options, multiSelect));\n}\n\nfunction newSelectList(value, disabled, metadata, i18n, useNoneLabel, options, multiSelect) {\n\tlet ff = new FormField('sb-select');\n\tif(metadata.defaultValue && !value && !metadata.controllerName && !metadata.restrictedPicklist) {\n\t\tvalue = metadata.defaultValue;\n\t\tff.defaultValue = value;\n\t}\n\tff.addAttribute('id', 0, 'picklist');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('md', 1, 'md', metadata);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('options', 1, 'options', options);\n\tff.addAttribute('is-required', 1, 'isRequired', !!(metadata.required));\n\tff.addAttribute('multi-select', 1, 'multiSelect', multiSelect);\n\tif(useNoneLabel)\n\t\tff.addAttribute('none-label', 1, 'noneLabel', `--${i18n.l(\"None\")}--`);\n\tif(metadata.precision != null)\n\t\tff.addAttribute('size', 1, 'size', metadata.precision);\n\n\tff.formattedValue = { value, label: getLabel(value, options, multiSelect) };\n\treturn ff;\n}\n\nfunction getLabel(value, options, multiSelect) {\n\tif(!options)\n\t\treturn value;\n\n\tlet values = Select.getValues(value, multiSelect);\n\tif(values.length === 0)\n\t\treturn value;\n\n\tlet label = null;\n\tfor(let option of options) {\n\t\tif(values.indexOf(option.value) !== -1) {\n\t\t\tif(multiSelect && label != null)\n\t\t\t\tlabel += (';' + option.label);\n\t\t\telse\n\t\t\t\tlabel = option.label;\n\t\t}\n\t}\n\treturn label || value;\n}\n","import {simpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport function textareaFactory(value, editable, disabled, renderReadOnly) {\n\tif(editable)\n\t\treturn newTextarea(value, disabled, renderReadOnly);\n\n\treturn simpleFieldFactory(value);\n}\n\nfunction newTextarea(value, disabled, renderReadOnly) {\n\t// prevent IE from display literal \"null\" when value is not set\n\tif (value === null) {\n\t\tvalue = '';\n\t}\n\tlet ff = new FormField('sb-textarea');\n\tff.addAttribute('value', 2, 'value', value);\n\tff.addAttribute('disabled', 1, 'disabled', disabled);\n\tff.addAttribute('render-read-only', 1, 'renderReadOnly', renderReadOnly);\n\n\tff.readOnlyKeyEvent = 'sb-textarea-key';\n\treturn ff;\n}\n","import {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js'\n\nexport class ContractLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-contract-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(app.org)'\n\t\t\t},\n\t\t\tcontracts: Array,\n\t\t\tlineEditorModel: Object,\n\t\t\tselectedContract: Object,\n\t\t\taction: String, //Value set only for Amend and Renew use case.  Null for Add-on use case,\n\t\t\taccountId: String,\n\t\t\tselectedAssetIds: String,\n\t\t\tvalidationMessages: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tready() {\n\t\tthis.$.header.selectable = false;\n\t\tthis.prefetchObjects();\n\t\tthis.handleMetaDataResponse(); //metadata response\n\t\tthis.setPropertyFromUrl();\n\t\tthis.setSkipActionClass();\n\t\tthis.handleLineEditorModelResponse();\n\t\tthis.handleContractModelLoadResponse();\n\t\tthis.handleContractSelected();\n\t\tthis.handleContractModelSaveResponse();\n\n\t\t// handles Amend and Renew asset from Account use case\n\t\tif(this.action) {\n\t\t\tthis.handleContractModelLoadRequest({'uid' : this.accountId, 'action' : this.action});\n\t\t}\n\t}\n\n\tgetPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tprefetchObjects() {\n\t\tthis.contractLookupObjects = ['Contract'];\n\t}\n\n\t//build the metadata required for the rows to render\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet recordKeys = [],\n\t\t\t\tfieldLabels = [],\n\t\t\t\tfieldLabelMap = {},\n\t\t\t\ttypeMap = {},\n\t\t\t\tlabelTypeMap = {},\n\t\t\t\titemTypeMap = {},\n\t\t\t\tfields = e.detail.value.fields;\n\t\t\tfields.forEach(function(field) {\n\t\t\t\tlet key = field.name;\n\t\t\t\trecordKeys.push(key);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t\tfieldLabelMap[key] = field.label;\n\t\t\t\ttypeMap[key] = {type: field.type};\n\t\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\t\titemTypeMap[key] = field.type;\n\t\t\t}.bind(this));\n\t\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\t\tthis.typeMap = typeMap;\n\t\t\tthis.recordKeys = recordKeys;\n\t\t\tthis.fieldLabels = fieldLabels;\n\t\t\tthis.fieldLabelMap = fieldLabelMap;\n\t\t}.bind(this));\n\t}\n\n\tsetPropertyFromUrl() {\n\t\tthis.action = this.ctx.params.action;\n\t\tthis.accountId = this.ctx.params.accId;\n\t\tthis.selectedAssetIds = this.ctx.params.selectedAssetIds;\n\t}\n\n\tsetSkipActionClass() {\n\t\tlet skipAction = Polymer.dom(this.$.skip).node;\n\t\tlet skipActionClass;\n\n\t\tif(!this.action) {\n\t\t\tskipActionClass = 'skipActionAddOn';\n\t\t} else if(this.action === 'Amend') {\n\t\t\tskipActionClass = 'skipActionAmend';\n\t\t}\n\n\t\tthis.toggleClass(skipActionClass, true, skipAction);\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\t// handles add-on use case\n\t\t\tthis.handleContractModelLoadRequest({'uid' : this.lineEditorModel.quote.record.Id});\n\t\t}.bind(this));\n\t}\n\n\thandleContractModelLoadRequest(context) {\n\t\tthis.$.contractModelLoadService.uid = null;\n\t\tthis.$.contractModelLoadService.context = context;\n\t}\n\n\thandleContractModelLoadResponse() {\n\t\tthis.$.contractModelLoadService.addEventListener('response-changed', function(e) {\n\t\t\tthis.contracts = e.detail.value;\n\n\t\t\tif(this.contracts.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setFieldSet();\n\t\t}.bind(this));\n\t}\n\n\tsetFieldSet() {\n\t\tlet fields = [];\n\n\t\tfor(let field of this.contracts[0].activeContractFieldSets) {\n\t\t\tfields.push(this.contractLookupObjects[0] + '.' + field);\n\t\t}\n\n\t\tthis.$.md.fields = fields;\n\t}\n\n\thandleContractSelected() {\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tif(!e.detail.selected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor(let i = 0; i < this.contracts.length; i++) {\n\t\t\t\tif(e.detail.Id === this.contracts[i].record.Id) {\n\t\t\t\t\tthis.selectedContract = this.contracts[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e); //deselect all available contracts\n\t\t}.bind(this));\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selected === false || e.detail.selected === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tlet root = Polymer.dom(e).rootTarget, //this is the current row\n\t\t\trows = Polymer.dom(root.parentElement).querySelectorAll('sb-table-row'); //this collects all the rows\n\n\t\tfor (let row of rows) {\n\t\t\tif (row !== root) {\n\t\t\t\trow.selected = false;\n\t\t\t}\n\t\t}\n\t}\n\n\thandleContractModelSaveResponse() {\n\t\tthis.$.contractModelSaveService.addEventListener('response-changed', function(e) {\n\t\t\tif(e.detail.value) {\n\t\t\t\tthis.quoteId = e.detail.value.quote.record.Id;\n\t\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\t\tthis.$.qo.addToCache(this.quoteId, this.lineEditorModel);\n\t\t\t}\n\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet quoteId = this.lineEditorModel ? this.lineEditorModel.quote.record.Id : this.quoteId;\n\t\tthis.nav('#', {'qId': quoteId}, ['quote', 'le'], false);\n\t}\n\n\tonSkip() {\n\t\tif(!this.action) {\n\t\t\tthis.navigateToLineEditor();\n\t\t} else {\n\t\t\tthis.$.contractModelSaveService.model = {'quote' : null, 'selectedContractId' : null, 'action' : this.action, 'accountId' : this.accountId, 'selectedAssetIds' : this.selectedAssetIds};\n\t\t}\n\t}\n\n\tonSelect() {\n\t\tthis.validationMessages = [];\n\n\t\tif (!this.selectedContract) {\n\t\t\tthis.validationMessages = [this.i18n.l('You must make a selection. Or use Skip if you do not want to co-terminate')];\n\t\t\treturn;\n\t\t}\n\n\t\tlet model;\n\n\t\tif(this.action) {\n\t\t\tmodel = {'quote' : null, 'selectedContractId' : this.selectedContract.record.Id, 'action' : this.action, 'accountId' : this.accountId, 'selectedAssetIds' : this.selectedAssetIds};\n\t\t} else {\n\t\t\tlet dataBuilder = new DataBuilder().addObject('quote', this.lineEditorModel.quote.record)\n\t\t\t\t.add('selectedContractId', this.selectedContract.record.Id)\n\t\t\t\t.build();\n\t\t\tmodel = dataBuilder;\n\t\t}\n\n\t\tthis.$.contractModelSaveService.model = model;\n\t}\n\n\tonCancel() {\n\t\tthis.showSpinner = true;\n\t\tthis.navigateToDetailPage();\n\t}\n\n\tnavigateToDetailPage() {\n\t\tlet objectId;\n\n\t\tif(this.action) {\n\t\t\tobjectId = this.accountId;\n\t\t} else {\n\t\t\tobjectId = this.lineEditorModel.quote.record.Id\n\t\t}\n\n\t\tif (this.isLightningExperience()){\n\t\t\t//W-014658: mobile does not have a way to exit the Visualforce page besides the back button\n\t\t\tif(PageContainer.getViewport().isMobile() === true)\n\t\t\t\tthis.navigateToURL('#/sObject/' + this.prefix + 'Quote__c/home');\n\t\t\telse\n\t\t\t\tsforce.one.navigateToSObject(objectId);\n\t\t\treturn;\n\t\t}\n\n\t\t//TODO: Is a check for partner portal needed?\n\t\tlet returnUrl = '/' + objectId;\n\n\t\tif (window.parent) {\n\t\t\t// For org\n\t\t\twindow.parent.location.href = returnUrl;\n\t\t} else {\n\t\t\t// For localhost\n\t\t\twindow.location.href = returnUrl;\n\t\t}\n\t}\n\n\tisLightningExperience() {\n\t\treturn (typeof sforce != 'undefined') && sforce && (!!sforce.one);\n\t}\n\n\tnavigateToURL(url) {\n\t\tsforce.one.navigateToURL(url);\n\t}\n}\n\nPolymer(ContractLookup);","import {Util} from 'common/Util.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {PageHeader} from 'common/core/sb-page-header/PageHeader.js';\nimport {ProductMessenger} from 'products/config/message/ProductMessenger.js';\n\n// We ship the api name for Product Code as 'Product Code' for Field picklist on Custom Action Condition\n// However, the api name for Product Code in Product is 'ProductCode'\n// TODO: Will need to use MetaDataUtils.js to grab the correct API Name instead of hard coding it as a map\nconst API_FIELD_NAME_MAP = {'Product Code' : 'ProductCode'};\n\nexport class CustomActions {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-actions';\n\t\tthis.properties = {\n\t\t\tcustomActions: Array,\n\t\t\tproducts: Array,\n\t\t\tisClassic: Boolean,\n\t\t\tproductIndex: Number,\n\t\t\tfirstItem: Object,\n\t\t\tremainingItems: Array,\n\t\t\tprefix: String,\n\t\t\tcustomActionsExist: Boolean,\n\t\t\tmoreThanOneCustomActionsExist: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmenuClosed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttonsCollapsed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t\t,\n\t\t\tmessenger: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_newMessenger(quote, products, productIndex, prefix)'\n\t\t\t},\n\t\t\tquote: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpopupResponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_updateQuoteFromPopupResponse'\n\t\t\t},\n\t\t\tlaunchExternalName: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: \"Launch External\"\n\t\t\t}\n\t\t};\n\t}\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tget observers() {\n\t\treturn ['init(customActions, products, prefix, productIndex, isClassic, menuClosed)']\n\t}\n\n\tinit() {\n\t\t// This check removes all custom actions when bundles have multiple products in classic view.\n\t\tif (this.isClassic && this.products.length > 1) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet showExternalAction = this.products[this.productIndex].record[this.prefix + 'ExternallyConfigurable__c'];\n\t\tlet urlKey = this.prefix + \"URL__c\";\n\t\tlet labelKey = this.prefix + \"Label__c\";\n\t\tlet page = this.prefix + \"Page__c\";\n\t\tlet targetKey = this.prefix + \"URLTarget__c\";\n\t\tlet brandButtonKey = this.prefix + \"BrandButton__c\";\n\t\tlet labelUrlMap = [];\n\t\tthis.customActions.forEach(customAction => {\n\t\t\tif (customAction[urlKey] !== undefined && customAction[page] === 'Product Configurator' && this.checkCustomActionsConditionsMet(customAction, showExternalAction)) {\n\t\t\t\tlet brandButtonClass = '';\n\n\t\t\t\tif(customAction[brandButtonKey] === true) {\n\t\t\t\t\tbrandButtonClass = 'primary';\n\t\t\t\t}\n\n\t\t\t\tlabelUrlMap.push({\n\t\t\t\t\tlabel: customAction[labelKey],\n\t\t\t\t\turl: customAction[urlKey],\n\t\t\t\t\ttarget: customAction[targetKey],\n\t\t\t\t\tbrandButtonClass: brandButtonClass\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (labelUrlMap.length == 0) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\t\tthis.firstItem = labelUrlMap[0];\n\t\tif (labelUrlMap.length > 1) {\n\t\t\tthis.remainingItems = labelUrlMap.slice(1);\n\t\t\tthis.moreThanOneCustomActionsExist = true;\n\t\t}\n\t\tthis.customActionsExist = true;\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tthis.classList.remove(\"hide\");\n\t}\n\n\t_itemSelected(e) {\n\t\tlet id = e.target.id;\n\t\tlet targetItem = (id === \"firstItem\") ? this.firstItem : this.remainingItems[id];\n\t\tif(targetItem.target === 'Popup')\n\t\t\tthis.handlePopup(targetItem.url);\n\t\telse\n\t\t\tthis.handleNav(targetItem.url);\n\t}\n\n\thandlePopup(url, autoLaunched = false, backOnCancelOrClose = false) {\n\t\tthis.$.popup.url = url;\n\t\tthis.$.popup.autoLaunched = autoLaunched;\n\t\tthis.$.popup.backOnCancelOrClose = backOnCancelOrClose;\n\t\tthis.$.popup.messenger = this.messenger;\n\t\tthis.$.popup.open();\n\t}\n\n\thandleNav(url) {\n\t\tif (this._isLightningExperience()) {\n\t\t\tsforce.one.navigateToURL(url);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce !== 'undefined') && sforce && (!!sforce.one);\n\t}\n\n\tcheckCustomActionsConditionsMet(customAction, showExternalAction) {\n\t\tlet conditionsKey = this.prefix + \"Custom_Action_Conditions__r\";\n\t\tlet fieldKey = this.prefix + \"Field__c\";\n\t\tlet operatorKey = this.prefix + \"Operator__c\";\n\t\tlet filterValueKey = this.prefix + \"FilterValue__c\";\n\t\tlet targetObjectKey = this.prefix + \"TargetObject__c\";\n\n\t\tif (customAction.Name === this.launchExternalName && !showExternalAction)\n\t\t\treturn false;\n\n\t\treturn (customAction[conditionsKey] === undefined) || customAction[conditionsKey].records.some(val => {\n\t\t\t\tif (val[fieldKey] === undefined || val[filterValueKey] === undefined || val[operatorKey] === undefined)\n\t\t\t\t\treturn false;\n\n\t\t\t\tlet targetObject = 'Product';\n\t\t\t\tif(val[targetObjectKey])\n\t\t\t\t\ttargetObject = val[targetObjectKey];\n\n\t\t\t\t// Get the correct api name if necessary\n\t\t\t\tlet fieldName = API_FIELD_NAME_MAP[val[fieldKey]] || val[fieldKey];\n\t\t\t\t//the target object can be Quote or Product\n\t\t\t\tlet record = targetObject === 'Quote' ? this.quote.record : this.products[this.productIndex].record;\n\t\t\t\treturn Util.arithmeticOperatorConversion(record[fieldName],\n\t\t\t\t\tval[filterValueKey], val[operatorKey])\n\t\t\t});\n\t}\n\n\t_changeMenu(e) {\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed, this.$$('#remainingItems'), 'open', this);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_viewportChanged() {\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t}\n\n\t_newMessenger() {\n\t\treturn new ProductMessenger(this.quote, this.products[this.productIndex], this.prefix, this.currencyIsoCode, Polymer.Base);\n\t}\n\n\t_updateQuoteFromPopupResponse() {\n\t\tthis.quote = this.popupResponse.quote;\n\t}\n}\n\nPolymer(CustomActions);\n","export class AttributeItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_notifyAttributeChanged'\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setAttributeMD(item, model, targetField)',\n\t\t\t'setTargetField(item, model)',\n\t\t\t'setRequired(value, model, attributeMD)',\n\t\t\t'setLabel(md)'\n\t\t];\n\t}\n\n\tsetRequired() {\n\t\t//because autoSelect disables the attribute, it doesn't make sense for it to be required\n\t\tif (this.attributeMD.required === false || this.attributeMD.autoSelect === true)\n\t\t\treturn;\n\t\tthis.toggleClass('mandatory-no-value', this.isValidValue() === false, this.$.attributeField);\n\t}\n\n\tisValidValue() {\n\t\treturn !!(this.value !== undefined && this.value !== null && this.value !== '');\n\t}\n\n\tsetAttributeMD() {\n\t\tif (!this.model.fields) {\n\t\t\treturn;\n\t\t}\n\t\tthis.attributeMD = this.model.attributeMD[this.item];\n\t\tthis.$.field.disabled = this.attributeMD.autoSelect; //autoSelect set to true disabled the attribute\n\t\tthis.hidden = this.attributeMD.hidden; //a configuration attribute can be hidden which means don't show on the UI\n\t\tlet md = JSON.parse(JSON.stringify(this.model.fields[this.targetField])); //don't reflect changes back to cache\n\t\tif(md.type === 'picklist') {\n\t\t\tmd.picklistValues = this.getPicklistValues(md.picklistValues);\n\t\t\tmd.required = this.attributeMD.required;\n\t\t}\n\n\t\tthis.md = md;\n\t}\n\n\tsetTargetField() {\n\t\tthis.$.field.record = this;\n\t\tthis.targetField = this.model.attributeMD[this.item].targetFieldName;\n\t}\n\n\tsetLabel() {\n\t\tthis.label = this.md.label;\n\t}\n\n\tgetPicklistValues(defaultValues) {\n\t\tif(this.attributeMD === undefined)\n\t\t\treturn defaultValues;\n\n\t\tif(!this.attributeMD.shownValues && !this.attributeMD.hiddenValues)\n\t\t\treturn defaultValues;\n\n\t\tlet shownValues = this.attributeMD.shownValues || [];\n\t\tif(!this.attributeMD.shownValues) {\n\t\t\tfor (let item of defaultValues)\n\t\t\t\tshownValues.push(item.value);\n\t\t}\n\n\t\tlet hiddenValues = this.attributeMD.hiddenValues || [];\n\t\treturn defaultValues.filter(function(item) {\n\t\t\treturn shownValues.indexOf(item.value) !== -1 && hiddenValues.indexOf(item.value) === -1;\n\t\t});\n\t}\n\n\t_notifyAttributeChanged(e) {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tthis.fire('sb-config-attribute-changed', {\n\t\t\tId: this.item,\n\t\t\tbundleId: this.model.attributeMD[this.item].bundleId,\n\t\t\tchanged: true,\n\t\t\tpath: true //this should always be set to true because any change to a value even if falsey should be considered a change\n\t\t});\n\t}\n\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tlet ids = this.model.attributeFieldMD[name];\n\t\tif(ids && ids.length > 0)\n\t\t\treturn this.data[ids[0]];\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(attributeItem) {\n\t\treturn this.data === attributeItem.data;\n\t}\n}\n\nPolymer(AttributeItem);\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class AttributeTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tposition: String,\n\t\t\tmodel: Object,\n\t\t\tconfigAttributes: Object,\n\t\t\taddedClass: String,\n\t\t\tmd: Object,\n\t\t\tshowTable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'generateColumns(featureId, model, configAttributes, md)',\n\t\t\t'getMD(configAttributes, model)',\n\t\t\t'bindDataToModel(configAttributes.*)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.optionFieldMetadata.addEventListener('md-changed', function (e) {\n\t\t\tthis.setMD(e);\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t\tthis.addEventListener('lookup-value-changed', this._setReferencedData.bind(this));\n\t}\n\n\tgetMD() {\n\t\tthis.spinner = true;\n\t\tlet attributeFields = {},\n\t\t\tattributeModelData = this.model.configurationAttributeModelMap;\n\t\tfor (let i in attributeModelData)\n\t\t\tattributeFields[attributeModelData[i].targetFieldName] = null;\n\n\t\tthis.$.optionFieldMetadata.fields = Object.keys(attributeFields);\n\t}\n\n\tsetMD(e) {\n\t\tthis.md = {\n\t\t\tfields: e.detail.value.fieldsByObject[this.model.prefix + 'ProductOption__c'],\n\t\t\tattributeMD: this.model.configurationAttributeModelMap,\n\t\t\tattributeFieldMD: this.model.configurationAttributeTargetFieldMap\n\t\t};\n\t}\n\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tlet featureAttributes = this.model.configAttributesByFeatureId[this.featureId] || [];\n\t\tlet numAttributes = featureAttributes.length;\n\t\tlet featureAttributesByFieldName = {};\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tlet targetAttribute = featureAttributes[i].myId;\n\t\t\tthis.md.attributeMD[targetAttribute].processed = true;\n\t\t\tlet targetFieldName = featureAttributes[i].targetFieldName;\n\n\t\t\tlet featureAttributeIds = featureAttributesByFieldName[targetFieldName] || [];\n\t\t\tfeatureAttributeIds.push(targetAttribute);\n\t\t\tfeatureAttributesByFieldName[targetFieldName] = featureAttributeIds;\n\n\t\t\tif (featureAttributes[i].position == this.position || !this.position) {\n\t\t\t\tif (featureAttributes[i].columnOrder == 1)\n\t\t\t\t\tcolumn1Group.push(targetAttribute);\n\t\t\t\telse if (featureAttributes[i].columnOrder == 2)\n\t\t\t\t\tcolumn2Group.push(targetAttribute);\n\t\t\t\telse\n\t\t\t\t\tcolumn3Group.push(targetAttribute);\n\t\t\t}\n\t\t}\n\t\tthis.normalizeData(featureAttributesByFieldName);\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\t/**\n\t * Its possible that other configuration attributes for this product\n\t * have been changed before these attributes have been stamped in since in mobile feature details are\n\t * stamped in only when the feature is expanded and not when the configurator page is rendered.\n\t * Also tabs don't stamp the content in until the tab has been clicked\n\t * Thus, we need to see if there exists any processed configuration attributes with the same target field\n\t * and update this feature's equivalent configuration attribute with that value to simulate the two-way\n\t * binding of those attributes that did not take place because the attributes were not yet stamped in.\n\t */\n\tnormalizeData(featureAttributesByFieldName) {\n\t\t// loop through all the configuration attributes in this feature by the target field of the attribute\n\t\tfor(let targetFieldName in featureAttributesByFieldName) {\n\t\t\tlet featureAttributes = featureAttributesByFieldName[targetFieldName];\n\t\t\tlet bundleAttributes = this.md.attributeFieldMD[targetFieldName];\n\n\t\t\t// return early if there are not more bundle attributes for a given target field\n\t\t\t// then there are feature attributes for the same target field\n\t\t\tif(bundleAttributes.length <= featureAttributes.length)\n\t\t\t\treturn;\n\n\t\t\t// loop through bundle attributes to find any that are not in this feature\n\t\t\t// and any that have already been processed\n\t\t\tfor (let bundleAttribute of bundleAttributes) {\n\n\t\t\t\t// if this bundle attribute is in this feature, then continue\n\t\t\t\tif (featureAttributes.indexOf(bundleAttribute) !== -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if this bundle attribute has not yet been processed (i.e. its feature has not yet been expanded)\n\t\t\t\t// then simply continue as the user could have yet changed its value\n\t\t\t\tif(!this.md.attributeMD[bundleAttribute].processed)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// we have found a bundle attribute for the same target field that is not in this feature\n\t\t\t\t// and has been processed, so lets sync its value with this features attribute value\n\t\t\t\tfor(let featureAttribute of featureAttributes)\n\t\t\t\t\tthis.configAttributes[featureAttribute] = this.configAttributes[bundleAttribute];\n\n\t\t\t\t// since the syncing is complete, we can move on to the next target field\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif (column1Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.firstColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.firstColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif (column2Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.secondColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.secondColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif (column3Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.thirdColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n\n\t//The purpose of this code is to bypass groups propagateFromParentToChild handler\n\t//We have a unique case for updating the elements for a given group\n\tcaptureCallBack(e) {\n\t\tlet elements = this.elements,\n\t\t\tattributeId = e.path.split('.')[1];\n\t\tif (attributeId === undefined)\n\t\t\treturn;\n\n\t\tlet targetField = this.model.attributeMD[attributeId].targetFieldName;\n\t\tfor (let i = 0, l = elements.length; i < l; i++) {\n\t\t\tlet elementId = elements[i].item.split('.')[0];\n\t\t\tif (elementId === attributeId)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.model.attributeMD[elements[i].item].targetFieldName === targetField)\n\t\t\t\telements[i].value = e.value;\n\t\t}\n\t}\n\n\tbindDataToModel(e) {\n\t\tif (e.path === undefined || e.path === 'configAttributes')\n\t\t\treturn;\n\n\t\t//update the product view model with the data change\n\t\tlet targetField = this._getTargetFieldNameFromModel(e.path.split('.')[1]);\n\t\tthis.model.product.configuration.configurationData[targetField] = e.value;\n\t}\n\n\t// Reference Field metadata needs to be supplied on the configuration model to render correctly after a reconfigure\n\t_setReferencedData(e) {\n\t\tif (!e || !e.detail || !e.detail.obj || !e.detail.item)\n\t\t\treturn;\n\n\t\tconst targetField = this._getTargetFieldNameFromModel(e.detail.item);\n\t\tconst referencedField = this.md.fields[targetField].relationshipName;\n\t\tif (referencedField === null) return;\n\t\tconst attributeData = e.detail.value === null ? null : {\n\t\t\t'attributes': e.detail.obj.attributes,\n\t\t\t'Id': e.detail.obj.Id,\n\t\t\t'Name': e.detail.obj.Name\n\t\t};\n\n\t\tthis.model.product.configuration.configurationData[referencedField] = attributeData;\n\t}\n\n\t_getTargetFieldNameFromModel(attributeID) {\n\t\treturn this.model.configurationAttributeModelMap[attributeID].targetFieldName;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\nPolymer(AttributeTable);\n","export class ProductBundlesFilterItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tlabel: String\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setFieldData(model)'];\n\t}\n\n\tsetFieldData() {\n\t\tlet md;\n\t\tfor (let i = 0, numFields = this.model.length; i < numFields; i++) {\n\t\t\tif (this.model[i].name === this.item) {\n\t\t\t\tthis.label = this.model[i].label;\n\t\t\t\t// allow pick list types, but convert all other to string types\n\t\t\t\tmd = this.model[i].type === 'picklist' || this.model[i].type === 'multipicklist' ? this.model[i] : { type: 'string' };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = md;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n}\n\nPolymer(ProductBundlesFilterItem);\n","import {FieldSetHandler} from '../../../../common/layout/fields/FieldSetHandler.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class ProductFeature {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = \"sb-product-feature\";\n\n\t\tthis.listeners = {\n\t\t\t'selection-changed': 'handleSelectionCounter'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tmaxOptions: Object,\n\t\t\tfeature: Object,\n\t\t\tfieldSetKey: String,\n\t\t\tfieldSetHandler: Object,\n\t\t\ttabNames: {\n\t\t\t\ttype: Array,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: [\"options\", \"attributes\"]\n\t\t\t},\n\t\t\ttabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobile(viewport)\"\n\t\t\t},\n\t\t\thasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setHasConfigAttributes(model, featureId)\"\n\t\t\t},\n\t\t\thasTopConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasTopConfigAttributes(model, featureId)'\n\t\t\t},\n\t\t\thasBottomConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasBottomConfigAttributes(model, featureId)'\n\t\t\t},\n\t\t\tmobileHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: \"_setHasOptions(model, featureId)\"\n\t\t\t},\n\t\t\tmobileHasOptions: Boolean,\n\t\t\thasOptionsAndConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions)'\n\t\t\t},\n\t\t\tmobileHasOptionsAndConfigAttributes: Boolean,\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasInstructions(feature)'\n\t\t\t},\n\t\t\tmobileHasInstructions: Boolean,\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectedOptions: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\thasSelectedOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_hasSelectedOptions(selectedOptions)'\n\t\t\t},\n\t\t\tfeatureIndex: Number,\n\t\t\tconfigAttributes:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasUpgradedOptions(feature)'\n\t\t\t},\n\t\t\tmobileRendering: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobileExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'render(featureId, model)',\n\t\t\t'buildTabs(viewport, model, featureId)',\n\t\t\t'featureChanged(feature)',\n\t\t\t'initFieldSet(model, fieldSetKey, fieldSetHandler)'\n\t\t];\n\t}\n\n\t_setHasUpgradedOptions() {\n\t\treturn this.model.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_hasSelectedOptions(selectedOptions) {\n\t\treturn !selectedOptions;\n\t}\n\n\trender() {\n\t\tif (!this.model.featureIdsWithOptionsOrConfigAttr[this.featureId])\n\t\t\treturn;\n\t\tthis.setFeatureAndOptionSelectionMethod();\n\t\tthis.setOptionsDetails();\n\t\tthis.setFieldSetHandler();\n\t\tthis.renderFeatureInDesktopOrMobileView();\n\t\tthis.initSelectedOptions();\n\t\tthis.handleDeleteOptions();\n\t\tthis.handleOptionChangedByRule();\n\t}\n\n\tbuildTabs() {\n\t\tif (!this.isMobile)\n\t\t\treturn;\n\n\t\tlet i18n = AppContext.properties.i18n.value();\n\t\tlet optionsTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: i18n.l(\"Options\"),\n\t\t\tpageComponent: \"sb-product-option-table\",\n\t\t\tattributes: [ { name: 'id', value: 'ot' } ],\n\t\t\tbind: [ \"model\", \"featureId\", \"fieldSet\", \"fieldSetName\", \"routeSource\", \"isClickSelection\",\n\t\t\t\t\"disabledStateMap\", \"configSearch\", \"hasUpgradeOptions\"]\n\t\t};\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'configAttributesTop' }, { name: 'added-class', value: 'header-attributes' } ],\n\t\t\tbind: [ \"featureId\", \"model\", \"configAttributes\"]\n\t\t};\n\t\tthis.tabs = [optionsTab, attributesTab];\n\t}\n\n\tsetFieldSetHandler() {\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.model.product.optionFieldSets, 'OptionConfiguration',\n\t\t\t'OptionConfigurationTablet', 'OptionConfigurationPhone');\n\t}\n\n\tsetFeatureAndOptionSelectionMethod() {\n\t\tthis.feature = this.model.getFeature(this.featureId);\n\t}\n\n\tsetOptionsDetails() {\n\t\tthis.isClickSelection = this.feature.optionSelectionMethod === 'Click';\n\t\tthis.routeSource = 'Configurator';\n\t}\n\n\tfeatureChanged() {\n\t\tlet configurationFieldSet = this.feature.record[this.model.prefix + 'ConfigurationFieldSet__c'];\n\t\tthis.fieldSetKey = configurationFieldSet === undefined ? null : configurationFieldSet;\n\t}\n\n\tsetFieldSetFromViewport() {\n\t\tlet fs = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tthis.fieldSet = fs.fields;\n\t\tthis.fieldSetName = fs.name;\n\t}\n\n\tinitFieldSet() {\n\t\tif(this.fieldSetKey) {\n\t\t\tthis.fieldSet = this.model.product.optionFieldSets[this.fieldSetKey];\n\t\t\tthis.fieldSetName = this.fieldSetKey;\n\t\t} else {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_setHasConfigAttributes(model, featureId) {\n\t\tlet configAttributes = this.model.configAttributesByFeatureId[featureId];\n\n\t\tif(!configAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < configAttributes.length; i++) {\n\t\t\tif(!configAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasTopConfigAttributes(model, featureId) {\n\t\treturn this._hasTopOrBottomConfigAttributes('Top', featureId);\n\t}\n\n\t_setHasBottomConfigAttributes(model, featureId) {\n\t\treturn this._hasTopOrBottomConfigAttributes('Bottom', featureId);\n\t}\n\n\t_hasTopOrBottomConfigAttributes(position, featureId) {\n\t\tlet configAttributes = this.model.configAttributesByFeatureId[featureId];\n\n\t\tif (!configAttributes)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId[featureId]) {\n\t\t\tif (attribute.position === position && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasOptions() {\n\t\treturn !!this.model.optionsByFeatureId[this.featureId] || this.model.featureIdsWIthSelectionMethodDynamic[this.featureId];\n\t}\n\n\t_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions) {\n\t\treturn hasConfigAttributes && hasOptions;\n\t}\n\n\t_setHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\n\t\tif(!this.fieldSetKey) {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\trenderFeatureInDesktopOrMobileView() {\n\t\tthis.toggleClass(\"group\", !this.isMobile, this.$.feature);\n\t}\n\n\tapplyFilters() {\n\t\tlet featureOptions = this.model.getOptionsByFeatureId(this.featureId);\n\t\tlet configSearch = new ConfiguratorSearch(this.searchFilters, featureOptions, {});\n\t\tthis.filtered = !configSearch.hasOptions || !configSearch.containsFeature(this.feature);\n\t}\n\n\tmobileExpand(e) {\n\t\tif(this.mobileExpanded) {\n\t\t\tthis.expand(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.mobileRendering)\n\t\t\treturn; // already tapped on it and its still rendering so nothing more to do here\n\n\t\t// setting this to true displays the loading spinner\n\t\tthis.mobileRendering = true;\n\n\t\t// removing the 'first' class removes the chevron\n\t\tthis.toggleClass('first', false, this.$$('header'));\n\n\t\t// Wait for the spinner to render before proceeding\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t// set all the boolean properties that drives the mobile dom-if rendering\n\t\t\tthis.mobileHasInstructions = this.hasInstructions;\n\t\t\tthis.mobileHasOptionsAndConfigAttributes = this.hasOptionsAndConfigAttributes;\n\t\t\tthis.mobileHasConfigAttributes = this.hasConfigAttributes;\n\t\t\tthis.mobileHasOptions = this.hasOptions;\n\t\t\tPolymer.dom(this.$.feature).observeNodes(function () {\n\t\t\t\t// nodes have been stamped in, so lets finish the expanding process\n\t\t\t\tthis.mobileExpanded = true;\n\t\t\t\tthis.mobileRendering = false;\n\t\t\t\t// adding the 'first' class back re-adds the chevron\n\t\t\t\tthis.toggleClass('first', true, this.$$('header'));\n\t\t\t\tthis.expand(e);\n\t\t\t}.bind(this));\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tthis.expanded = !this.expanded;\n\t\tthis.fire('feature-expanded', {expanded: this.expanded, path: Polymer.dom(e).path});\n\t}\n\n\tinitSelectedOptions() {\n\t\tlet prefix = AppContext.org.prefix !== '' ? AppContext.org.prefix + '__' : '';\n\t\tvar options = this.model.getOptionsByFeatureId(this.featureId);\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].selected)\n\t\t\t\tthis.selectedOptions++;\n\n\t\t\tif(options[i].record[prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\tconsole.warn('Option is missing entry in selected pricebook => ' + options[i].record[prefix + 'ProductCode__c'] + ': ' + options[i].record[prefix + 'ProductName__c']);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSelectionCounter(e) {\n\t\tif(!e.detail.changed)\n\t\t\treturn;\n\n\t\tif (e.detail.selectionType === 'radio') {\n\t\t\t// When selected, a radio can have either one option or no options\n\t\t\tthis.selectedOptions = e.detail.selected ? 1 : 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.selectedOptions && !e.detail.selected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectedOptions += (e.detail.selected ? 1 : -1);\n\t}\n\n\thandleDeleteOptions(e) {\n\t\tthis.addEventListener('delete-tapped', function(e) {\n\t\t\tif (this.selectedOptions > 0)\n\t\t\t\tthis.selectedOptions--;\n\t\t});\n\t}\n\n\thandleOptionChangedByRule(e) {\n\t\tthis.addEventListener('option-changed-by-rule', function(e) {\n\t\t\te.detail.added ? this.selectedOptions++ : this.selectedOptions--;\n\t\t});\n\t}\n}\n\nPolymer(ProductFeature);","export class ProductFeatureCategoryList {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-category-list';\n\t\tthis.properties = {\n\t\t\tcategoryNamesOrFeatures: Array,\n\t\t\thasCategories: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setHasCategories(model)',\n\t\t\t'setCategoryNamesOrFeatures(model, hasCategories)'\n\t\t];\n\t}\n\n\tsetHasCategories(model) {\n\t\tthis.hasCategories = model.checkAtLeastOneFeatureHasCategory();\n\t}\n\n\tsetCategoryNamesOrFeatures(model, hasCategories) {\n\t\tif (hasCategories) {\n\t\t\tthis.categoryNamesOrFeatures = Object.keys(model.getTabFeaturesMap());\n\t\t} else {\n\t\t\tthis.categoryNamesOrFeatures = model.featuresWithOptionsOrConfigAttr;\n\t\t}\n\t}\n\n\tgetFeaturesByCategory(categoryName) {\n\t\tvar map = this.model.getTabFeaturesMap();\n\n\t\treturn map[categoryName];\n\t}\n}\n\nPolymer(ProductFeatureCategoryList);","import {ConfiguratorSearch} from '../../search/ConfiguratorSearch.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\n\nexport class ProductBundlesLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-layout';\n\t\tthis.properties = {\n\t\t\tproductIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tconfiguredProducts: Array,\n\t\t\tsetToSections: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tisClassic: Boolean,\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'formatBundlesLayout'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tqId: String,\n\t\t\tsearchFilters: Array, //array of fields for md\n\t\t\tsearchValuesByFilter: Object, //keymap of filter fields vs inputs\n\t\t\tsearchFieldMD: Object,\n\t\t\tsearchFilterTypeMap: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setMD(searchFilters)',\n\t\t\t'initSearchFilter(searchFieldMD, prefix)',\n\t\t\t'_updateProductFromPopupResponse(popupResponse, configuredProducts)',\n\t\t\t'_resize(configuredProducts.*)',\n\t\t\t'selectBundle(isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex)'\n\t\t];\n\t}\n\n\t_resize() {\n\t\tthis.resize();\n\t}\n\n\tinitSearchFilter() {\n\t\tthis.$.group.group = this.searchFilters;\n\t\tthis.$.group.model = this.searchFieldMD;\n\t\tthis.$.group.data = this.searchValuesByFilter;\n\t\tlet searchFilterTypeMap = {};\n\t\tfor (let md of this.searchFieldMD)\n\t\t\tsearchFilterTypeMap[md.name] = md.type;\n\t\tthis.searchFilterTypeMap = searchFilterTypeMap;\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t\tthis.handlePanelSlide();\n\t\tthis.handlePanelEvents();\n\t\tthis.handleMD();\n\t}\n\n\thandlePanelEvents() {\n\t\tthis.addEventListener('side-toggle-clicked', function () {\n\t\t\tthis.toggle();\n\t\t}.bind(this));\n\t\tthis.addEventListener('iron-select', function () {\n\t\t\tif (this.$.drawer.selected == 'drawer')\n\t\t\t\tthis.drawerState = 'open';\n\t\t\telse\n\t\t\t\tthis.drawerState = 'closed';\n\t\t}.bind(this));\n\t\tthis.addEventListener('x-clicked', function () {\n\t\t\tthis.$.search.closeDrawer();\n\t\t}.bind(this));\n\t\tthis.addEventListener('enter-keypress', function() {\n\t\t\tif (this.searchFilters)\n\t\t\t\tthis.applyFilters();\n\t\t}.bind(this));\n\t}\n\n\thandleMD() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.searchFieldMD = e.detail.value.fields;\n\t\t}.bind(this));\n\t}\n\n\tnavTo(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\tlet numBundles = this.configuredProducts.length;\n\t\tlet index = this.productIndex;\n\t\tfor (let i = 0; i < numBundles; i++) {\n\t\t\tif (this.getProductId(i) === target)\n\t\t\t\tindex = i;\n\t\t}\n\t\t// enable the selection of the tapped item\n\t\tthis.setSelected(target);\n\n\t\tif (!this.isMobile && this.isClassic)\n\t\t\tthis.$$('#Bundle' + target).scrollIntoView();\n\t\telse\n\t\t\tthis.fire('bundle-panel-clicked', index);\n\t}\n\n\ttoggle() {\n\t\tthis.toggleTransition(true);\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tclassicOrSelectedIndex(item, configuredProductIndex) {\n\t\treturn ((this.isClassic && !this.isMobile) ||\n\t\t(this.configuredProducts[this.productIndex] === item) ||\n\t\t(!this.productIndex && configuredProductIndex === 0) ||\n\t\t((this.productIndex >= this.configuredProducts.length) && configuredProductIndex === 0));\n\t}\n\n\thandleResize() {\n\t\tlet sfSidebar = document.querySelector('#sidebarCell');\n\t\tif (sfSidebar) {\n\t\t\tsfSidebar.addEventListener('click', this.resize.bind(this));\n\t\t}\n\t\twindow.addEventListener('resize', this.resize.bind(this));\n\t}\n\n\tresize() {\n\t\tthis.toggleTransition(false);\n\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\thandlePanelSlide() {\n\t\tif (!this.isMobile) {\n\t\t\t//check for which drawers are open\n\t\t\tthis.addEventListener('iron-select', function () {\n\t\t\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\t\t\tthis._setBundleContainerWidth(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._setBundleContainerWidth(true);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tif (this.isMobile) {\n\t\t\tthis.addEventListener('iron-deselect', function (e) {\n\t\t\t\tif (e.detail.item.id === 'drawer') {\n\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tselectBundle() {\n\t\t//add scrim to search panel\n\t\tthis.$.search.$$('#scrim').style.width = '100%';\n\n\t\tif (this.isMobile) {\n\t\t\tthis.navWidth = 0;\n\t\t\t//add scrim to bundle list in mobile\n\t\t\tthis.$.drawer.$$('#scrim').style.width = '100%';\n\t\t}\n\t\tif (this.configuredProducts.length === 1)\n\t\t\tthis.navWidth = 0;\n\n\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\n\t\tif (!this.isClassic || this.isMobile) {\n\t\t\tlet targetId = this.getProductId(this.productIndex);\n\n\t\t\tthis.fire('bundle-name-changed', {name: this.configuredProducts[this.productIndex].record.Name});\n\t\t\tPolymer.dom(this.$.panel).observeNodes(function () {\n\t\t\t\tthis.setSelected(targetId);\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.resize();\n\t}\n\n\tbuildPanelIfMultipleBundesAndNotMobile() {\n\t\tif (this.configuredProducts.length  === 1 || this.isMobile)\n\t\t\treturn;\n\n\t\tthis.panelWidth = 256;\n\t\tthis.navWidth = 24;\n\t\tthis.$.panel.rightSideButton = true;\n\t\tthis.toggleTransition(false);\n\t\tif (this.isOpen === \"1\") {\n\t\t\tthis.$.drawer.selected = 'drawer';\n\t\t\tthis.drawerState = 'open';\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis.$.drawer.selected = 'main';\n\t\t\tthis.drawerState = 'closed';\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\t_setBundleContainerWidth(isDrawerOpen) {\n\t\tif (this.configuredProducts && this.configuredProducts.length < 2) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('open', !isDrawerOpen, this.$.bundleContainer);\n\t\tthis.toggleClass('close', isDrawerOpen, this.$.bundleContainer);\n\t}\n\n\ttoggleTransition(enable) {\n\t\t// enables/disables the transition for the drawer\n\t\tthis.$.drawer._transition = enable;\n\t\t// enables/disables the transition for the content\n\t\tthis.toggleClass('transition', enable, this.$.bundleContainer);\n\t}\n\n\tdefaultState() {\n\t\tif (this.isOpen === \"1\")\n\t\t\treturn 'drawer';\n\t\treturn 'main';\n\t}\n\n\ttoggleSearch() {\n\t\tthis.$.search.togglePanel();\n\t}\n\n\trefocus() {\n\t\tthis.$.search.querySelector('#searchPanel').querySelector('sb-group').$$('sb-product-bundles-filter-item').$$('sb-field').$$('div#f').firstChild.focus();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clear.focus();\n\t}\n\n\tsetMD() {\n\t\tthis.$.md.object = 'ProductOption__c';\n\t\tthis.$.md.fields = this.searchFilters;\n\t}\n\n\tapplyFilters() {\n\t\tthis.$.clear.focus();\n\t\tthis.$.search.closeDrawer();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tclearFields() {\n\t\tthis.fire('iron-signal', {name: 'sb-clear-product-filter'});\n\t\tthis.blur();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix, this.searchFilterTypeMap);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tgetProductId(productIndex, underscorePrefix) {\n\t\tlet product = this.configuredProducts[productIndex];\n\t\t// product key is the unique identifier of a product if a cloned product\n\t\tlet id = product.productKey || product.record.Id;\n\t\tlet prefix = underscorePrefix ? '_' : '';\n\t\treturn prefix + id;\n\t}\n\n\tsetSelected(targetId) {\n\t\tthis.removeAllSelected();\n\t\tthis.toggleClass('selected-tab', true, this.$$('#_' + targetId));\n\t}\n\n\tremoveAllSelected() {\n\t\tlet navItems = Polymer.dom(this.root).querySelectorAll('div.nav-item');\n\t\tfor (let navItem of navItems)\n\t\t\tthis.toggleClass('selected-tab', false, navItem);\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_updateProductFromPopupResponse() {\n\t\tlet products = this.popupResponse.products;\n\t\tif(!products || products.length === 0)\n\t\t\treturn;\n\n\t\tlet numConfiguredProducts = this.configuredProducts.length;\n\t\tfor(let product of products)\n\t\t\tthis.push('configuredProducts', product);\n\n\t\tif(numConfiguredProducts === 1)\n\t\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\t}\n\n\tformatBundlesLayout() {\n\t\tthis.toggleClass('multiple-bundles', this.hasMultipleBundles, this.$.bundleContainer);\n\t}\n}\n\nPolymer(ProductBundlesLayout);","import {Page} from '../../../../common/core/Page.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\n\nexport class ProductFeatureLayout extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tqId: String, // quoteId needed for building PVM\n\t\t\tproduct: Object,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tconfigAttributes: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfeatures: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: '_setFeatures(model)'\n\t\t\t},\n\t\t\tvp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(vp)'\n\t\t\t},\n\t\t\thasTopConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasTopConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\thasBottomConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasBottomConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\thasFeaturelessConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasFeaturelessConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\tisMobileAndHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes)'\n\t\t\t},\n\t\t\tisSectionLayout: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisPaginationRequired: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabsForFeatureLayout: Object,\n\t\t\ttabsForTabsAndWizardLayout: Object,\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConstraintsHandler: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: 'setOptionConstraintsHandler(model)'\n\t\t\t},\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tlistenersAttached: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setConfigAttributes(model)', // Must be ran before render, thus it must be ordered in the array before render (W-3837959)\n\t\t\t'render(model, isSectionLayout)',\n\t\t\t'buildModel(product, qId, currencyIsoCode)',\n\t\t\t'handleProductRulesResponse(model, disabledStateMap, product.configuration.*)',\n\t\t\t'_setOptionData(model, product.configuration.optionDataByOptionIdAndIndex)',\n\t\t\t'_updateProductFromPopupResponse(popupResponse, model)',\n\t\t\t'_createConstraintsHoverMessages(model, optionConstraintsHandler)'\n\t\t];\n\t}\n\n\tbuildModel() {\n\t\tthis.model = new ProductViewModel(this.qId, this.product, this.app.org.prefix, this.currencyIsoCode);\n\t}\n\n\t_setConfigAttributes() {\n\t\tthis.configAttributes = this.model.configurationAttributeValueMap;\n\t}\n\n\t_setHasFeaturelessConfigAttributes() {\n\t\tlet featurelessConfigAttributes = this.model.configAttributesByFeatureId['featureless'];\n\n\t\tif(!featurelessConfigAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < featurelessConfigAttributes.length; i++) {\n\t\t\tif(!featurelessConfigAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setFeatures(model) {\n\t\treturn model.featuresWithOptionsOrConfigAttr;\n\t}\n\n\t_setIsMobile(vp) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (vp) {\n\t\t\treturn vp.isMobile();\n\t\t}\n\t}\n\n\t_setHasTopConfigAttributes(configAttributes) {\n\t\tif (!this.model || !this.model.configAttributesByFeatureId.featureless)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId.featureless) {\n\t\t\tif (attribute.position === 'Top' && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasBottomConfigAttributes(configAttributes) {\n\t\tif (!this.model || !this.model.configAttributesByFeatureId.featureless)\n\t\t\treturn false;\n\n\t\tfor (let attribute of this.model.configAttributesByFeatureId.featureless) {\n\t\t\tif (attribute.position === 'Bottom' && !attribute.hidden)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes) {\n\t\treturn isMobile && hasFeaturelessConfigAttributes;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.vp = e.detail.viewport;\n\t}\n\n\trender() {\n\t\tlet optionLayout = this.model.getOptionLayout();\n\t\tif (this.isMobile) {\n\t\t\toptionLayout = 'Sections';\n\n\t\t\tif (this.hasFeaturelessConfigAttributes) {\n\t\t\t\tthis.buildFeatureLayoutTabs();\n\t\t\t\tthis.handleOptionSelectionChanged();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isSectionLayout) {\n\t\t\toptionLayout = 'Sections';\n\t\t}\n\n\t\tif ( !this.isMobile && (optionLayout === 'Tabs' || this.model.checkAtLeastOneFeatureHasCategory()) ) {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = false;\n\t\t} else if (optionLayout === 'Wizard') {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = true;\n\t\t} else if (optionLayout === 'Sections' || optionLayout === 'None') {\n\t\t\tthis.isSectionLayout = true;\n\t\t}\n\t\tthis.handleOptionSelectionChanged();\n\t\tthis.listenersAttached = true;\n\t}\n\n\tbuildFeatureLayoutTabs() {\n\t\tlet featuresTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: this.i18n.l(\"Features\"),\n\t\t\tpageComponent: \"sb-product-feature-category-list\",\n\t\t\tbind: [ \"model\", \"configAttributes\", \"disabledStateMap\", \"configSearch\"]\n\t\t};\n\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: this.i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'globalConfigAttributes' }, { name: 'added-class', value: 'header-attributes' }, { name: 'feature-id', value: 'featureless' } ],\n\t\t\tbind: [\"model\", \"configAttributes\"]\n\t\t};\n\n\t\tthis.tabsForFeatureLayout = [featuresTab, attributesTab];\n\t}\n\n\tbuildTabsAndWizardLayoutTabs() {\n\t\tlet tabFeaturesMap = this.model.getTabFeaturesMap(),\n\t\t\tfeatureKeys = Object.keys(tabFeaturesMap),\n\t\t\ttabs = [];\n\t\tfor (let i = 0, l = featureKeys.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i;\n\t\t\ttabs.push({name: tId, label: featureKeys[i]});\n\t\t}\n\t\tthis.isSectionLayout = false;\n\t\tthis.tabsForTabsAndWizardLayout = tabs;\n\t}\n\n\tsetOptionConstraintsHandler() {\n\t\treturn new OptionConstraintsHandler(this.model.product, this.model.prefix);\n\t}\n\n\thandleOptionSelectionChanged() {\n\t\tif (this.listenersAttached)\n\t\t\treturn;\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tif (e && e.detail) {\n\t\t\t\tif (e.detail.selected === false && this.model.getOption(e.detail.Id).added) {\n\t\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\t\toption.added = false;\n\t\t\t\t\toption.removed = true;\n\t\t\t\t}\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, e.detail.selected);\n\n\t\t\t\t// if this option is constrained by any option not yet rendered, then handle those here as well\n\t\t\t\tlet constraining = this.optionConstraintsHandler.getUnrenderedConstraining(e.detail.Id);\n\t\t\t\tconstraining.forEach(constraint => {\n\t\t\t\t\tlet selected = constraint.selected && !this.disabledStateMap[constraint.record.Id]; // if disabled then treat as unselected\n\t\t\t\t\tthis.handleOptionConstraints(constraint.record.Id, selected);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tif (e && e.detail && !this.hasSameOptionAdded(e.detail.Id)) {\n\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\toption.added = false;\n\t\t\t\toption.removed = true;\n\t\t\t\tif(option._transient_) option._transient_.rendered = false;\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, false);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thasSameOptionAdded(optionId) {\n\t\tlet fId = this.model.getOption(optionId).record[this.model.prefix + 'Feature__c'],\n\t\t\tfeature = this.model.getFeature(fId),\n\t\t\toptions = feature ? feature._transient_.optionConfigurations : [];\n\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].record.Id === optionId)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thandleOptionConstraints(optionId, selected) {\n\t\tlet disabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected);\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t\tif(!change.rendered) // if the constrained option is not yet rendered\n\t\t\t\t\t// then we need to handle the options this yet to be rendered constrained option is constraining\n\t\t\t\t\tthis.handleOptionConstraints(change.optionId, change.selected && !change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\thandleProductRulesResponse() {\n\t\tif (!this.domHost || !this.product.configuration.productRulesActions)\n\t\t\treturn;\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.enableOptions))\n\t\t\tif (!this.model.optionSystemOrRequired(id)) // do NOT override system or required properties\n\t\t\t\tthis.product.configuration.productRulesActions.enableOptions[id] = !this.optionConstraintsHandler.optionShouldBeDisabled(id);\n\t\t\telse\n\t\t\t\tdelete this.product.configuration.productRulesActions.enableOptions[id];\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.disableOptions))\n\t\t\tif (!this.model.optionSystemOrRequired(id)) // do NOT override system or required properties\n\t\t\t\tthis.product.configuration.productRulesActions.disableOptions[id] = this.optionConstraintsHandler.optionShouldBeDisabled(id);\n\t\t\telse\n\t\t\t\tdelete this.product.configuration.productRulesActions.enableOptions[id];\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.hideOptions))\n\t\t\tthis.handleShownAndHiddenOptions(this.model.featureIdByOptionId[id], true);\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.showOptions))\n\t\t\tthis.handleShownAndHiddenOptions(this.model.featureIdByOptionId[id], false);\n\n\t\tthis.set('model.productRulesActions', this.product.configuration.productRulesActions);\n\t\tthis._handleOptionSelectionsInUnrenderedTabs(this.model);\n\n\t\tdelete this.product.configuration.productRulesActions;\n\t}\n\n\t/**\n\t * Applies product rule selections in lazy loaded tabs\n\t * @private\n\t */\n\t_handleOptionSelectionsInUnrenderedTabs(pvm) {\n\t\tconst layout = pvm.getOptionLayout();\n\t\tif (layout === 'Tabs' || layout === 'Wizard') {\n\t\t\tthis._setOptionSelections(pvm, this.product.configuration.productRulesActions.selectOptions, true);\n\t\t\tthis._setOptionSelections(pvm, this.product.configuration.productRulesActions.deselectOptions, false);\n\t\t}\n\t}\n\n\t/**\n\t * Sets selected property of the referenced options to the passed in Boolean value\n\t * @param pvm ProductViewModel\n\t * @param optionsById Map of option Ids to 'true'\n\t * @param value Boolean to indicate selected status of the option\n\t * @private\n\t */\n\t_setOptionSelections(pvm, optionsById, value) {\n\t\tif (!optionsById) {return;}\n\n\t\tObject.keys(optionsById).forEach(optionId => {\n\t\t\tlet option = pvm.getOption(optionId);\n\t\t\tif (option && option.selected !== value) {\n\t\t\t\toption.selected = value;\n\t\t\t}\n\t\t});\n\t}\n\n\thandleShownAndHiddenOptions(featureId, hideOption) {\n\t\tlet checkVisibleOptions = hideOption ? this.featureContainsOneVisibleOptions : this.featureContainsNoVisibleOptions;\n\t\tif (checkVisibleOptions.call(this, featureId)) {\n\t\t\tlet index = this.features.findIndex(feature => { return feature.record.Id === featureId; });\n\t\t\tthis.set(['features', index, 'hidden'], hideOption);\n\t\t}\n\t}\n\n\t_setOptionData() {\n\t\tif (!this.domHost)\n\t\t\treturn;\n\t\tthis.set('model.optionDataByOptionIdAndIndex', this.product.configuration.optionDataByOptionIdAndIndex);\n\t\tdelete this.product.configuration.optionDataByOptionIdAndIndex;\n\t}\n\n\tfeatureContainsOneVisibleOptions(featureId) {\n\t\tlet visibleOptions = 0,\n\t\t\toptions = this.model.optionsByFeatureId[featureId],\n\t\t\tl = options.length,\n\t\t\ti = 0;\n\n\t\twhile (visibleOptions <= 1 && i < l) {\n\t\t\tif (!options[i].hidden)\n\t\t\t\tvisibleOptions++;\n\t\t\ti++\n\t\t}\n\n\t\treturn visibleOptions === 1;\n\t}\n\n\tfeatureContainsNoVisibleOptions(featureId) {\n\t\tlet noVisibleOptions = true,\n\t\t\toptions = this.model.optionsByFeatureId[featureId],\n\t\t\tl = options.length,\n\t\t\ti = 0;\n\n\t\twhile (noVisibleOptions && i < l) {\n\t\t\tif (!options[i].hidden)\n\t\t\t\tnoVisibleOptions = false;\n\t\t\ti++\n\t\t}\n\n\t\treturn noVisibleOptions;\n\t}\n\n\t_updateProductFromPopupResponse() {\n\t\tif (this.popupResponse.dynamicOptions && this.popupResponse.dynamicOptions.length > 0)\n\t\t\treturn; // if response contains dynamic options, we delegate to product configurator to handle the response\n\t\tthis._bindResponseChangesToUI();\n\t}\n\n\t_bindResponseChangesToUI() {\n\t\tthis.model.init(this.popupResponse.product);\n\t\tthis._setConfigAttributes();\n\t\tthis.set('model.optionNotifications', this.popupResponse.optionNotifications);\n\t}\n\n\thandleDynamicOptionsAdded(results) {\n\t\t// called by productConfig after response of dynamic option loader is received\n\t\tfor (let key in results) {\n\t\t\tlet dynamicOption = this._getDynamicOption(key, results[key].record[this.model.prefix + 'Feature__c']);\n\t\t\tvar option = this._extendDataToOption(results[key], dynamicOption);\n\t\t\tlet feature = this.model.getFeature(dynamicOption.featureId);\n\t\t\tthis.popupResponse.product.options.push(option);\n\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\tfeature._transient_.changedExternally = true;\n\t\t}\n\t\t//the last option will apply its record values to any configuration attributes for the original bundle\n\t\tthis.syncConfigurationAttributesToProduct(option);\n\t\tthis._bindResponseChangesToUI();\n\t}\n\n\t_getDynamicOption(productId, featureId) {\n\t\treturn this.popupResponse.dynamicOptions.find( dynamicOption => {\n\t\t\treturn dynamicOption.productId.substring(0,15) === productId.substring(0,15) &&\n\t\t\t\tdynamicOption.featureId.substring(0,15) === featureId.substring(0,15);\n\t\t});\n\t}\n\n\t_extendDataToOption(option, sourceOption) {\n\t\tif (sourceOption.configurationData && typeof(sourceOption.configurationData) === 'object') {\n\t\t\tfor (let property in sourceOption.configurationData)\n\t\t\t\toption.record[property] = sourceOption.configurationData[property];\n\t\t}\n\t\toption.record[this.model.prefix + 'Quantity__c'] = sourceOption.Quantity;\n\t\toption.index = sourceOption.index;\n\t\toption.isDynamicOption = true;\n\t\toption.selected = true;\n\t\toption.added = true;\n\t\tif (option.record[this.model.prefix + 'UnitPrice__c'] === undefined)\n\t\t\toption.record[this.model.prefix + 'UnitPrice__c'] = 0;\n\t\treturn option;\n\t}\n\n\tsyncConfigurationAttributesToProduct(product) {\n\t\t// 1: build a key map for any configuration attribute that has auto select set to true\n\t\t// 2: loop through those attributes and set the value to the value of the product record field value\n\t\tif(this.autoSelectAttributes === undefined) {\n\t\t\tthis.autoSelectAttributes = {};\n\t\t\tfor (let attribute of this.popupResponse.product.configurationAttributes)\n\t\t\t\tif (attribute.autoSelect === true && this.autoSelectAttributes[attribute.targetFieldName] === undefined)\n\t\t\t\t\tthis.autoSelectAttributes[attribute.targetFieldName] = true; //just storing keys\n\t\t}\n\n\t\tfor(let attribute in this.autoSelectAttributes)\n\t\t\tthis.popupResponse.product.configuration.configurationData[attribute] = product.record[attribute];\n\t}\n\n\t_createConstraintsHoverMessages() {\n\t\tif (this.model.optionConstraintsByConstrained)\n\t\t\treturn;\n\n\t\tthis.model.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n}\n\nPolymer(ProductFeatureLayout);\n","import {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class ProductFeatureList{\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-list';\n\t\tthis.properties = {\n\t\t\tfeatures: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tmodel: Object,\n\t\t\tlabel: String,\n\t\t\tspinner: { //a loading spinner for when we are stamping in the content\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshow: { //used to show/hide the component.  needs to default to false for FF to get the perf benefits\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabs: { //determines if this component was initialized from a tab\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * For tabs we don't need to load the content until the tab is clicked\n\t * This gets setup here\n\t */\n\tinitLazyTabRendering() {\n\t\tthis.show = this.isMobile() === true || this.tabs === false;\n\t\tif(this.show === false)\n\t\t\tthis.addEventListener('sb-tab-selected', this.handleTabSelected.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t//'init(features)',\n\t\t\t'initFeatures(label, model)',\n\t\t\t'filterFeatures(configSearch, features, model)',\n\t\t\t'filterFeaturesFromRules(model.productRulesActions)',\n\t\t\t'handleFeatureExpandEvent(features)',\n\t\t\t'setFeatureOptionsAsRendered(show, features, model)',\n\t\t\t'initLazyTabRendering(tabs, viewport)'\n\t\t];\n\t}\n\n\tinitFeatures() {\n\t\tthis.features = this.features || this.model.getTabFeaturesMap()[this.label];\n\t}\n\n\tfilterFeaturesFromRules(rules) {\n\t\tif(this.configSearch && this.features && rules && Object.keys(rules).length > 0)\n\t\t\tthis.filterFeatures(this.configSearch, this.features, this.model, rules);\n\t}\n\n\tfilterFeatures(configSearch, features, model, rules) {\n\t\tif(this.domHost) {\n\t\t\tthis._filterFeatures(configSearch, features, model, rules);\n\t\t\treturn;\n\t\t}\n\n\t\t// if already queued up for next render, then nothing more to do here\n\t\tif(this._filterQueuedForNextRender)\n\t\t\treturn;\n\n\t\t// when applying filter on page load in FF and Safari, domHost is not yet available so defer a rendering cycle\n\t\tPolymer.RenderStatus.afterNextRender(this, this._filterFeatures.bind(this, configSearch, features, model, rules));\n\t\tthis._filterQueuedForNextRender = true;\n\t}\n\n\t_filterFeatures(configSearch, features, model, rules) {\n\t\tlet allFeaturesHidden = true;\n\t\tfor (let i = 0, numFeatures = this.features.length; i < numFeatures; i++)\n\t\t\tallFeaturesHidden = this._filterFeatureByIndex(configSearch, features, model, rules, i) && allFeaturesHidden;\n\n\t\tthis._parentHandleContentFiltered(!allFeaturesHidden);\n\t\tthis._filterQueuedForNextRender = false;\n\t}\n\n\t_parentHandleContentFiltered(visibleContent) {\n\t\tif(this.label == null)\n\t\t\treturn; // we need a label to move on so we are done if no label (which means not rendered in tabs)\n\n\t\t// call function on host component directly instead of broadcasting an event, as event approach did not work in FF or Safari\n\t\tif(this.domHost && typeof this.domHost.contentFilteredHandler === 'function')\n\t\t\tthis.domHost.contentFilteredHandler(this.label, visibleContent);\n\t}\n\n\t_filterFeatureByIndex(configSearch, features, model, rules, featureIndex) {\n\t\t// consider the rules' showOptions when determining if a feature has visible options below\n\t\tlet showOptions = rules ? rules.showOptions : null;\n\t\tlet featureOptions = model.optionsByFeatureId[features[featureIndex].record.Id] || [];\n\n\t\t// if feature list is not rendered and logic invoked by applying product rules then\n\t\t// make sure the options have the correct hiddenByRule values\n\t\tif(!this.show && rules)\n\t\t\tthis._updateHiddenByRuleOptionPropertyForUnRenderedFeatures(featureOptions, rules);\n\n\t\tfeatureOptions = configSearch.setOptionVisibility(featureOptions);\n\t\tlet isHidden = this._hideFeature(configSearch, features[featureIndex], model, featureOptions, showOptions);\n\t\tthis.set('features.' + featureIndex + '.hidden', isHidden);\n\t\treturn isHidden;\n\t}\n\n\t_hideFeature(configSearch, feature, model, featureOptions, showOptions) {\n\t\tlet hasRequiredConfigAttributes = configSearch.hasRequiredConfigAttributes(feature, model);\n\t\tif (hasRequiredConfigAttributes) // never hide a feature if it has required config attributes\n\t\t\treturn false;\n\n\t\tlet hasFeature = configSearch.containsFeature(feature);\n\t\tif (!hasFeature) // if your filter does not contain your feature, always hide the feature\n\t\t\treturn true;\n\n\t\tlet filterHasVisibleInlineOptions = configSearch.hasVisibleOptions(featureOptions, showOptions);\n\t\tif (filterHasVisibleInlineOptions) // if feature matches, then never hide feature if it has visible options\n\t\t\treturn false;\n\n\t\tlet allOptionsHiddenByRule = configSearch.allOptionsHiddenByRule(featureOptions);\n\t\tlet hasAnyConfigAttr = configSearch.hasConfigAttributes(feature, model);\n\t\tif (allOptionsHiddenByRule && hasAnyConfigAttr) // even if no visible options, never hide feature if all hidden by rule and any config attribute\n\t\t\treturn false;\n\n\t\tlet selectionMethod = feature.optionSelectionMethod;\n\t\tif (selectionMethod === 'Click') // we have no visible options, so at this point always hide a \"Click\" feature\n\t\t\treturn true;\n\n\t\tlet maxOptionsMet = model.maxOptionsMet(feature);\n\t\tif (maxOptionsMet) // we have no visible options, so at this point always hide an \"Add\" or \"Dynamic\" feature if you can't add any more options\n\t\t\treturn true;\n\n\t\tif (selectionMethod === 'Dynamic')\n\t\t\treturn false; // even with no visible options, never hide a \"Dynamic\" feature as you can add more options\n\n\t\tlet hasNoSelectableOptions = !configSearch.hasVisibleOptions(feature._transient_.optionConfigurations, showOptions);\n\t\treturn hasNoSelectableOptions; // even with no visible options, only hide an \"Add\" feature if you have no visible options to select\n\t}\n\n\n\t_updateHiddenByRuleOptionPropertyForUnRenderedFeatures(options, rules) {\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif(options[i].hiddenByRule && rules.showOptions && rules.showOptions[options[i].record.Id])\n\t\t\t\toptions[i].hiddenByRule = false; // if hiddenByRule then only set to false if explicitly selected now\n\t\t\telse if(!options[i].hiddenByRule && rules.hideOptions && rules.hideOptions[options[i].record.Id])\n\t\t\t\toptions[i].hiddenByRule = true; // if not hiddenByRule then set to true if matches a hidden rule option\n\t\t}\n\t}\n\n\thandleFeatureExpandEvent() {\n\t\t//if (!this.model.optionsByFeatureId[this.features[0].record.Id])\n\t\t//\treturn;\n\t\tthis.addEventListener('feature-expanded', function(e) {\n\t\t\tlet nodes = e.detail.path;\n\n\t\t\tnodes.forEach(function(node) {\n\n\t\t\t\tif (node.id === 'feature-header') {\n\t\t\t\t\twhile (node.nextElementSibling) {\n\t\t\t\t\t\tnode.classList.toggle('expanded', e.detail.expanded);\n\t\t\t\t\t\tnode = node.nextElementSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Listens for sb-tab-selected which is fired when the tab for the feature list is clicked\n\t * We then render this component/enable the content inside the dom-if by setting show to true (W-3597046)\n\t */\n\thandleTabSelected() {\n\t\tif (this.show === true)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.async(this.renderComponent.bind(this), 0); //async ensures the spinner is up\n\t}\n\n\t/**\n\t * Toggles the dom-if on\n\t */\n\trenderComponent() {\n\t\tif(this.renderingComponent)\n\t\t\treturn;\n\n\t\tthis.renderingComponent = true;\n\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\tthis.show = true;\n\t\t\tthis.spinner = false;\n\t\t\tthis.renderingComponent = false;\n\t\t}.bind(this));\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\t/**\n\t * @returns {Boolean} is the device mobile?\n\t */\n\tisMobile() {\n\t\treturn !!(this.viewport && this.viewport.isMobile());\n\t}\n\n\tsetFeatureOptionsAsRendered() {\n\t\tif(this.show === false)\n\t\t\treturn;\n\t\tthis.features.forEach(feature => {\n\t\t\tthis.model.getOptionsByFeatureId(feature.record.Id).forEach(option => {\n\t\t\t\tif(feature.optionSelectionMethod == 'Add')\n\t\t\t\t\toption = this.model.product.options.find(o => o.record.Id === option.record.Id);\n\t\t\t\toption._transient_ = option._transient_ || {};\n\t\t\t\toption._transient_.rendered = true;\n\t\t\t});\n\t\t});\n\t}\n}\n\nPolymer(ProductFeatureList);","import {AppContext} from 'common/core/AppContext.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class OptionCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\titemLabel: String,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: Object,\n\t\t\tdata: Object,\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () { return AppContext.org.prefix ? AppContext.org.prefix + '__' : ''; }\n\t\t\t},\n\t\t\tselected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return PageContainer.getViewport(); }\n\t\t\t},\n\t\t\toptionDrawer: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return this.classList.contains('drawerCell') }\n\t\t\t},\n\t\t\trenderReadOnly: { // Will not render in read only mode if OptionCell is placed inside an option drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getRenderReadOnly(optionDrawer)'\n\t\t\t},\n\t\t\tisDisabled: { // Fields will always be editable if placed inside an option drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getDisabled(optionDrawer, selected)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(itemLabel, model, data, prefix)',\n\t\t\t'setItemLabel(item)',\n\t\t\t'_displayChanged(value, display, item, data, field)'\n\t\t];\n\t}\n\n\tbuildCell() {\n\t\tthis.field = this.getField();\n\t\tif (this.itemLabel === this.prefix + 'Quantity__c')\n\t\t\tthis.initQuantityCell();\n\t\telse if (this.itemLabel === this.prefix + 'UnitPrice__c')\n\t\t\tthis.initUnitPriceCell();\n\t\telse\n\t\t\tthis.initCell();\n\t}\n\n\tgetQuantityEditable() {\n\t\treturn this.getFieldRecordValue('QuantityEditable__c') || this.data.recordHasQuantity === false;\n\t}\n\n\tgetPriceEditable() {\n\t\treturn this.getFieldRecordValue('PriceEditable__c') === 'Yes' && this.getFieldRecordValue('Bundled__c') === false;\n\t}\n\n\tgetField() {\n\t\treturn this.model.fieldDetails[this.item];\n\t}\n\n\tinitQuantityCell() {\n\t\t//if this is an MDQ option that has already been selected on a previous configuration, we don't create a field, but instead show a warning icon\n\t\tif(this.data.hasDimension === true && this.data.isSegmented === true && this.data.configured === true)\n\t\t\treturn this.mdqWarningIcon = true;\n\t\tthis.editable = this.getQuantityEditable();\n\t\tif (this.getFieldRecordValue('ProductQuantityScale__c') != undefined) {\n\t\t\t// If the option for this quantity cell has a specified Product Quantity Scale, then we need to copy the field\n\t\t\t// metadata and modify the copy's scale instead. Otherwise, each quantity cell is overriding the metadata\n\t\t\t// for all the others, and every quantity cell will use the same quantity scale as the last option.\n\t\t\tthis.field = JSON.parse(JSON.stringify(this.field));\n\t\t\tthis.field.scale = this.getFieldRecordValue('ProductQuantityScale__c');\n\t\t} else if (AppContext.org.quantityScale !== undefined) {\n\t\t\tthis.field.scale = AppContext.org.quantityScale;\n\t\t}\n\t\tthis.$.field.preventNumericAlignment = true;\n\t\tthis.attachQuantityChangeCallback();\n\t\tthis.initCell();\n\t}\n\n\tinitUnitPriceCell() {\n\t\tthis.editable = this.getPriceEditable();\n\t\tthis.initCell();\n\t}\n\n\tinitCell() {\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\tthis.editable = false;\n\n\t\tif (this.editable === undefined && this.optionDrawer)\n\t\t\tthis.editable = true;\n\n\t\tif (this.editable === undefined)\n\t\t\tthis.editable = this.field.updateable && this.quoteLineHasField(this.itemLabel);\n\n\t\tif (this.value === undefined)\n\t\t\tthis.value = '';\n\n\t\tthis.setDisplayIfRelationshipItem();\n\t\tthis.attachValueChangedCallback();\n\t\tthis.handleOriginalValues();\n\t\tthis.$.field.record = this;\n\t\tthis.$.field.md = this.field;\n\t}\n\n\tattachQuantityChangeCallback() {\n\t\tthis.addEventListener('value-changed', function (e) {\n\t\t\tthis.fire('sb-quantity-changed', {\n\t\t\t\tId: this.data.record.Id,\n\t\t\t\tbundleId: this.getBundleId(),\n\t\t\t\tchanged: true,\n\t\t\t\tinvalidQuantity: this.data.invalidQuantity,\n\t\t\t\tvalidQuantity: this.data.validQuantity,\n\t\t\t\tpath: e.path\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tattachValueChangedCallback() {\n\t\tthis.addEventListener('value-changed', this.syncValueChangeWithOptionConfiguration.bind(this));\n\t}\n\n\tgetBundleId() {\n\t\t// the option's parentProductKey is the unique identifier of its product if it's a cloned product\n\t\treturn this.data.parentProductKey || this.getFieldRecordValue('ConfiguredSKU__c');\n\t}\n\n\tgetFieldRecordValue(field) {\n\t\treturn this.data.record[this.prefix + field];\n\t}\n\n\tquoteLineHasField(field) {\n\t\treturn !!(this.model.quoteLineFields[field]);\n\t}\n\n\tsetItemLabel() {\n\t\tif (this.item.startsWith('record.'))\n\t\t\tthis.itemLabel = this.item.split('.')[1];\n\t\telse\n\t\t\tthis.itemLabel = this.item;\n\t}\n\n\tsyncValueChangeWithOptionConfiguration() {\n\t\t// sync the value change into the option's configuration.optionData if it exists\n\t\t// this is to handle toggling between products in a reconfigure scenario with a cloned product\n\t\tif(!this.data.configuration || this.data.configuration.length == 0)\n\t\t\treturn;\n\n\t\t// Do not support option configuration sync if the same option is selected more than once,\n\t\t// which is possible for options in an option selection method 'Add' feature (or dynamic feature).\n\t\t// Do not support because we cannot determine which of the duplicate selected options is being changed here.\n\t\t// For now it is OK we don't support as this is only needed for reconfigure with cloned products via a custom popup action,\n\t\t// which currently does not support option selection method 'Add' features (or dynamic features)\n\t\tif(this.data.configuration.length > 1)\n\t\t\treturn;\n\n\t\tlet optionData = this.data.configuration[0].optionData;\n\t\tif(!optionData)\n\t\t\treturn;\n\n\t\tlet parts = this.item.split('.');\n\t\tlet key = parts[parts.length -1];\n\t\tif(optionData[key] === undefined)\n\t\t\treturn;\n\n\t\toptionData[key] = this.value;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data._transient_.original && this.data.record) {\n\t\t\tthis.data._transient_.original = {};\n\t\t\tthis.data._transient_.original.record = JSON.parse(JSON.stringify(this.data.record));\n\t\t}\n\n\t\tif(this.data._transient_.original) {\n\t\t\tif(!this.data._transient_.original.record.hasOwnProperty(this.item.split('.')[1]))\n\t\t\t\tthis.set('data._transient_.original.' + this.item, this.value);\n\t\t\tthis.$.field.originalValue = this.get('data._transient_.original.' + this.item);\n\t\t}\n\t}\n\n\tsetDisplayIfRelationshipItem() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, function(field) {\n\t\t\treturn this.get('data.' + field);\n\t\t}.bind(this));\n\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, function(field, value) {\n\t\t\tif(!value) return this.get('data.' + field);\n\t\t\telse this.set('data.' + field, value);\n\t\t}.bind(this));\n\t\trfm.addRelationshipName(this.value, this.display, this.field.referenceTo[0]);\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\t getValue(name) { \n\t\treturn this.data.record[name];\n \t} \n\n\tsetValue(path, value) { \n\t\tthis.set('data.' + path, value); \n\t}\n\n\t  equals(optionCell) { \n\t\treturn this.data === optionCell.data; \n\t}\n\n\tgetRenderReadOnly() {\n\t\treturn !this.optionDrawer;\n\t}\n\n\tgetDisabled() {\n\t\treturn this.optionDrawer ? true : this.selected;\n\t}\n}\n\nPolymer(OptionCell);\n","export class OptionDrawer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-drawer';\n\t\tthis.properties = {\n\t\t\toption: Object,\n\t\t\tmd: Object,\n\t\t\tfieldNames: Array,\n\t\t\trichTextFields: Array\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [ 'setFieldNamesAndRichTextFields(option, md)' ];\n\t}\n\n\tsetFieldNamesAndRichTextFields() {\n\t\tlet fieldNames = [];\n\t\tlet richTextFields = [];\n\t\tfor (let field in this.option._transient_.attributeItems) {\n\t\t\tfieldNames.push('record.' + field);\n\n\t\t\tif (this.md.fieldDetails['record.' + field] && this.md.fieldDetails['record.' + field].extraTypeInfo === 'richtextarea')\n\t\t\t\trichTextFields.push('record.' + field);\n\t\t}\n\t\tthis.fieldNames = fieldNames;\n\t\tthis.richTextFields = richTextFields;\n\t}\n\n}\nPolymer(OptionDrawer);","import {AppContext} from '../../../../common/core/AppContext.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\n\nexport class ProductOptionTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\t\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-option-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tisClickSelection: Boolean,\n\t\t\tindex: String,\n\t\t\trouteSource: String,\n\t\t\toptions: Array,\n\t\t\tshowAddOptionsButton: Boolean,\n\t\t\tmd: Object,\n\t\t\tfieldSet: Array,\n\t\t\tfeatureless: Boolean,\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(model)'\n\t\t\t},\n\t\t\tprimaryMobileCol: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: \"_getPrimaryMobileColumns(prefix, fieldSet, fieldSetName)\"\n\t\t\t},\n\t\t\tparentIdDataPath: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setParentIdDataPath(model, prefix)'\n\t\t\t},\n\t\t\tdisabledStateMap: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tupgradeOptionButtonText: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Show Available Upgrades'\n\t\t\t},\n\t\t\thasUpgradeOptions: Boolean,\n\t\t\theaderActions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tattributeItemFields: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tproductHasAttributeSet: Boolean,\n\t\t\tdisplayStyle: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: '_getDisplayStyle(productHasAttributeSet)'\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() { //TODO: Refactor these observers so that they can take advantage of looping through options once!\n\t\treturn [\n\t\t\t'setMetadataRequest(model, fieldSet, prefix, options)',\n\t\t\t'initOptions(model, featureId, isClickSelection, fieldSet)',\n\t\t\t'disabledStateMapChanged(disabledStateMap.*)',\n\t\t\t'setOptionsDisabledData(disabledStateMap, options)',\n\t\t\t'setUpgradeOptionClass(options)',\n\t\t\t'filterOptions(configSearch, options)',\n\t\t\t'setProductRulesActions(options, model.productRulesActions.*)',\n\t\t\t'_firePriceRules(options, model.optionDataByOptionIdAndIndex.*)',\n\t\t\t'notify(model.optionNotifications, options)',\n\t\t\t'showOrHideAddOptionsButton(model, featureId, isClickSelection)',\n\t\t\t'setHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton)',\n\t\t\t'_setHeaderActions(options)',\n\t\t\t'_showUpgradeOptionIfSelectionMethodAdd(options, isClickSelection)',\n\t\t\t'setOptionIndex(options)',\n\t\t\t'isFeatureOptionless(options)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.header.selectable = false;\n\t\tthis.handleSelectionChanged();\n\t\tthis.handleMetadataChanged();\n\t\tthis.handleDeleteOption();\n\t\tthis.handleConfigureOption();\n\t\tif(!this.viewport || !this.viewport.isMobile())\n\t\t\tthis.editFirstWhenSelected = 'sb-field';\n\t}\n\n\thandleSelectionChanged() {\n\t\tthis.addEventListener('selection-changed', this._selectionChanged.bind(this));\n\t\tthis.addEventListener('sb-quantity-changed', this._handleOptionUpgrades.bind(this));\n\t}\n\n\t_selectionChanged(e) {\n\t\tthis.model.setOptionSelected(e.detail.Id, e.detail.selected);\n\t\tthis.ifRadioSelectedClearOtherRadioSelections(e);\n\n\t\tlet optionIndex = e.detail.index != undefined ? e.detail.index : this.getOptionIndex(e.detail.Id);\n\n\t\tif(optionIndex < 0)\n\t\t\treturn;\n\n\t\tif(e.detail.selected === true && this.routeSource === 'Configurator') {\n\t\t\tthis._displayAvailableRowActions(optionIndex, false);\n\t\t\tthis.set(['options', optionIndex, 'selected'], e.detail.selected);\n\t\t} else {\n\t\t\tthis._displayAvailableRowActions(optionIndex, true);\n\t\t}\n\n\t\t//Undo Price Rules when Product Option is de-selected\n\t\tif(!e.detail.selected && e.detail.changed) {\n\t\t\tlet changedOption = this.model.originalDataByOptionIds[e.detail.Id];\n\n\t\t\tif(changedOption.priceRule) {\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Discount__c'], changedOption.discountRate);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'DiscountAmount__c'], changedOption.discountAmount);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'UnitPrice__c'], changedOption.unitPrice);\n\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Quantity__c'], changedOption.quantity);\n\t\t\t}\n\t\t}\n\n\t\t// Only on user change, not on load.  e.detail.path gets defined on user selection\n\t\tif(this.routeSource === 'Configurator' && e.detail.path && this.options.length > optionIndex && (!!this.options[optionIndex].upgradedAssetId || !!this.options[optionIndex].sourceProductIds))\n\t\t\tthis._handleOptionUpgrades(e, optionIndex);\n\t}\n\n\t_displayAvailableRowActions(index, actionsHidden) {\n\t\tif(this.options.length <= index)\n\t\t\treturn;\n\n\t\tfor(let i = 0; i < this.options[index]._transient_.rowActions.length; i++) {\n\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], actionsHidden);\n\n\t\t\tif(this.routeSource === 'OptionLookup')\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'hidden'], actionsHidden);\n\n\t\t\tif(this.options[index]._transient_.rowActions[i].title === 'Configure' && this.options[index].configurable !== true)\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], true);\n\t\t}\n\t}\n\n\thandleMetadataChanged() {\n\t\tthis.$.fieldMetaData.addEventListener('md-changed', function (e) {\n\t\t\tlet md = this.initFieldMetadata(e.detail.value.fieldsByObject);\n\t\t\tthis.rowClassMap = md.fieldSetMd.rowClassMap; // have to assign this to own property before md because of FireFox\n\t\t\tthis.md = md.fieldSetMd; // Option Rows\n\t\t\tthis.attributeItemMd = md.attributeItemMd; // Option Drawer\n\t\t\tthis.spinner = false;\n\t\t}.bind(this));\n\t}\n\n\t_handleOptionUpgrades(e, optionIndex) {\n\t\tif(this.model.product.quoteType !== 'Amendment') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet option = this.options[optionIndex || this.getOptionIndex(e.detail.Id)];\n\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, this.options, option);\n\t\tlet assetUpgradeQauntityCalculator = new AssetUpgradeQuantityCalculator(optionUpgradeHandler);\n\n\t\tassetUpgradeQauntityCalculator.setQuantitiesByRatio();\n\n\t\tif(!optionUpgradeHandler.getSourceOption() && !optionUpgradeHandler.getUpgradeOption()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceOptionIndex = this.getOptionIndex(optionUpgradeHandler.getSourceOption().record.Id);\n\t\tlet upgradeOptionIndex = this.getOptionIndex(optionUpgradeHandler.getUpgradeOption().record.Id);\n\n\t\t// Debounce used to avoid race condition in field.js (this.set was being invoked while onChange event is still running)\n\t\tthis.debounce('Wait for function to finish', () => {\n\t\t\tlet sourceOption = optionUpgradeHandler.getSourceOption();\n\t\t\tlet upgradeOption = optionUpgradeHandler.getUpgradeOption();\n\n\t\t\tif(sourceOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex, sourceOption, true);\n\t\t\t} else if(upgradeOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(upgradeOptionIndex, sourceOptionIndex, upgradeOption, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex);\n\t\t\t}\n\n\t\t\tsourceOption.invalidQuantity = null;\n\t\t\tupgradeOption.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t_notifyQuantityChange(index1, index2, option, invalidQuantity) {\n\t\tif(invalidQuantity) {\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.invalidQuantity;\n\t\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(['options', index2, 'record', this.prefix + 'Quantity__c']);\n\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t}\n\n\t_getPrimaryMobileColumns() {\n\t\tlet primaryMobileCols = [\"record.\" + this.prefix + \"ProductName__c\"];\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSetName.endsWith('Phone'))\n\t\t\tprimaryMobileCols = [\"record.\" + this.fieldSet[0]];\n\n\t\treturn primaryMobileCols;\n\t}\n\n\tsetMetadataRequest() {\n\t\tthis.spinner = true;\n\t\tlet mdFieldSet = new Set(),\n\t\t\tmdFields = [];\n\t\tfor (let fieldName of this.fieldSet) // Add fields from fieldSet\n\t\t\tmdFieldSet.add(fieldName)\n\t\tmdFieldSet = this.setAttributeItemMetaData(mdFieldSet);\n\t\tfor (let names of mdFieldSet.values()) { // Request fields from both Product Option and Quote Line objects\n\t\t\tmdFields.push('ProductOption__c.' + names);\n\t\t\tmdFields.push('QuoteLine__c.' + names);\n\t\t}\n\n\t\t//checking if the array values are a match and returning\n\t\t//tabs will cause this code to be run twice when a flush is done, reproducible on the mobile configurator\n\t\tif(JSON.stringify(this.$.fieldMetaData.fields) === JSON.stringify(mdFields))\n\t\t\treturn;\n\t\tthis.$.fieldMetaData.fields = mdFields;\n\t}\n\n\tsetAttributeItemMetaData(mdFieldSet) {\n\t\tlet attributeItemFields = new Set();\n\t\tfor (let option of this.options) {// Add additional fields from Attribute Items\n\t\t\tif (!this.hasAttributeItems(option))\n\t\t\t\tcontinue;\n\n\t\t\tfor (let field in option._transient_.attributeItems) {\n\t\t\t\tmdFieldSet.add(field);\n\t\t\t\tattributeItemFields.add(field);\n\t\t\t}\n\t\t}\n\t\tfor (let field of attributeItemFields.values())\n\t\t\tthis.attributeItemFields.push(field);\n\n\t\treturn mdFieldSet;\n\t}\n\n\tinitFieldMetadata(md) {\n\t\t//Handle the response from field metadata\n\t\tlet fieldSetMd = { fieldLabelMap: {}, recordKeys: [], fieldLabels: [], fieldDetails: {}, labelTypeMap: {}, itemTypeMap: {}, fields: this.fieldSet },\n\t\t\tattributeItemMd = { fieldLabelMap: {}, recordKeys: [], fieldLabels: [], fieldDetails: {}, labelTypeMap: {}, itemTypeMap: {}, fields: this.attributeItemFields };\n\t\tfor (let i in md[this.prefix + 'ProductOption__c']) {\n\t\t\tlet mdItem = md[this.prefix + 'ProductOption__c'][i];\n\t\t\tif (mdItem.type.toLowerCase() === 'currency')\n\t\t\t\tmdItem.CurrencyIsoCode = this.model.currencyIsoCode;\n\t\t\tthis.addMetaDataProperties(fieldSetMd, mdItem);\n\t\t\tif (this.attributeItemFields.length > 0)\n\t\t\t\tthis.addMetaDataProperties(attributeItemMd, mdItem);\n\t\t}\n\n\t\tthis.addAdditionalMetaDataProperties(fieldSetMd, md);\n\t\tthis.addAdditionalMetaDataProperties(attributeItemMd, md);\n\t\treturn { fieldSetMd: fieldSetMd, attributeItemMd: attributeItemMd };\n\t}\n\n\taddMetaDataProperties(obj, mdItem) {\n\t\tlet name = mdItem.name;\n\t\tif (obj.fields.indexOf(name) == -1)\n\t\t\treturn;\n\n\t\tobj.fieldLabels.push(mdItem.label);\n\t\tobj.recordKeys.push('record.' + name);\n\t\tobj.fieldLabelMap[name] = mdItem.label;\n\t\tobj.fieldDetails['record.' + name] = mdItem;\n\n\t\tlet type = mdItem.type;\n\t\tif (!this._isMobile()) {\n\t\t\t// if the quantity field then lets treat as string for the purposes of table formatting\n\t\t\tlet isQuantity = name === (this.prefix + 'Quantity__c');\n\t\t\tif (isQuantity) type = 'string';\n\n\t\t\t// returns undefined if cell is not an image\n\t\t\tlet imageWidth = new ImageCellSizer(mdItem).getImageWidth(20);\n\t\t\t// append the image width to the type if defined as TableClassBuilder knows what to do with a type of format type:width\n\t\t\tif (imageWidth) type += ':' + imageWidth;\n\t\t}\n\n\t\tobj.labelTypeMap[mdItem.label.replace(/\\W/g, '')] = type;\n\t\tobj.itemTypeMap['record.' + name] = type;\n\t}\n\n\taddAdditionalMetaDataProperties(obj, md) {\n\t\tobj.quoteLineFields = md[this.prefix + 'QuoteLine__c'];\n\t\tobj.headerClassMap = new TableClassBuilder(Object.keys(obj.labelTypeMap), 'Th', obj.labelTypeMap).build();\n\t\tobj.rowClassMap = new TableClassBuilder(obj.recordKeys, 'Td', obj.itemTypeMap, ['initial']).build();\n\t\tdelete obj.fields;\n\t}\n\n\tinitOptions() {\n\t\tthis.productHasAttributeSet = !this._isMobile() && this.model.product._transient_ && this.model.product._transient_.hasAttributeItems;\n\n\t\tthis.options = this.model.getOptionsByFeatureId(this.featureId);\n\t}\n\n\tnotify(paths) { // only gets used for external configuration changes\n\t\tif (this.isClickSelection) {\n\t\t\tfor(let i = 0, l = this.options.length; i < l; i++ ) {\n\t\t\t\tfor(let path of paths)\n\t\t\t\t\tthis.notifyPath(`options.${i}.${path}`);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.model.getFeature(this.featureId)._transient_.changedExternally)\n\t\t\t\tthis._optionsExternallyChanged();\n\t\t\t// added rows notification pattern is different to allow for duplicate options\n\t\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\t\tif (rows.length) {\n\t\t\t\trows.forEach(tableRow => {\n\t\t\t\t\ttableRow.notify(paths);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_optionsExternallyChanged() {\n\t\t/* Step 1: Render the template to stamp rows in via dom-repeat */\n\t\tPolymer.dom(this.$.tbody).querySelector('template[is=\"dom-repeat\"]').render();\n\t\t/* Step 2: Bind in rowData and fire change handlers for respective option changes */\n\t\tthis._renderChangedRows();\n\t\t/* Step 3: Render the option-table header and set margin appropriately */\n\t\tthis.isFeatureOptionless();\n\t\tthis._setHeaderActions();\n\n\t}\n\n\t_renderChangedRows() {\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tfor(let i = this.options.length - 1; i >= 0; i--) {\n\t\t\tthis.options[i].selected ? this._addSelectedOption(this.options[i], rows[i], i) : this.deleteOption(this.options[i].record.Id, i);\n\t\t}\n\t}\n\n\t_addSelectedOption(option, row, optionIndex) { // only used for externally configured product\n\t\tif (row.rowData) //if row has already been added, don't try to re-add it\n\t\t\treturn;\n\n\t\t// reset row actions\n\t\toption._transient_.rowActions = this.model.getOption(option.record.Id)._transient_.rowActions;\n\t\t// set row data\n\t\trow.rowData = option;\n\t\t// render row as selected\n\t\trow.$.row.selected = true;\n\t\t// set row actions correctly\n\t\tthis._displayAvailableRowActions(optionIndex, false);\n\t}\n\n\tgetOptionIndex(optionId) {\n\t\tlet index = -1,\n\t\t\ti = 0,\n\t\t\tlength = this.options.length;\n\t\twhile(index < 0 && i < length) {\n\t\t\tif (this.options[i].record.Id === optionId)\n\t\t\t\tindex = i;\n\t\t\ti++\n\t\t}\n\t\treturn index;\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selectionType !== 'radio' || !e.detail.selected)\n\t\t\treturn;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (!rows || rows.length == 0)\n\t\t\treturn;\n\n\t\tlet root = Polymer.dom(e).rootTarget;\n\t\tfor (let row of rows) {\n\t\t\tif (row.selectionType == 'radio' && row !== root) {\n\t\t\t\trow.$.row.fire('group-selected', {selected: false});\n\t\t\t\trow.selected = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetParentIdDataPath() {\n\t\treturn 'record.' + this.prefix + 'ConfiguredSKU__c';\n\t}\n\n\tnavigationChanged() {\n\t\tif (this.model.getFeature(this.featureId)._transient_.changedExternally)\n\t\t\treturn;\n\t\tthis.reset();\n\t}\n\n\tsetOptionsDisabledData() {\n\t\tif(!this.options.length || !this.disabledStateMap || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tthis.options.forEach(function (option, idx) {\n\t\t\tif (this.optionShouldChange(option))\n\t\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}.bind(this));\n\t}\n\n\tdisabledStateMapChanged(newVal) {\n\t\tif(!this.options || !this.options.length || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tlet optionId = newVal.path.split('.')[1],\n\t\t\toption = this.model.optionsById[optionId],\n\t\t\tidx = this.options.findIndex(opt => { return opt.record.Id === optionId} );\n\n\t\tif (idx >= 0 && this.optionShouldChange(option)) {\n\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}\n\t}\n\n\toptionShouldChange(option) {\n\t\treturn option.disabledData && this.disabledStateMap[option.record.Id] !== option.disabledData.constrained;\n\t}\n\n\tchangeOptionDisabled(option, idx) {\n\t\tlet constrained = !!this.disabledStateMap[option.record.Id],\n\t\t\tdisabled = option.disabledData.disabled;\n\t\tthis.set(`options.${idx}.disabledData`, {'disabled': disabled, 'constrained': constrained});\n\t\tif (!this.isClickSelection && this.disabledStateMap[option.record.Id] == true)\n\t\t\tthis.deleteOption(option.record.Id, idx, true);\n\t}\n\n\treset() {\n\t\tPolymer._collections.delete(this.options);\n\t}\n\n\trouteToLookup() {\n\t\tlet queryParams = {\n\t\t\tqId: this.model.qId,\n\t\t\tpId: this.model.product.record.Id,\n\t\t\tfId: this.featureId\n\t\t};\n\t\tif (this.model.getFeature(this.featureId).optionSelectionMethod === 'Dynamic')\n\t\t\tqueryParams.path = ['product', 'dl'];\n\t\tthis.fire('add-option-clicked', queryParams);\n\t}\n\n\tisFeatureOptionless() {\n\t\tif (!this.options)\n\t\t\treturn;\n\t\tthis.featureless = this.options.length === 0 ? 'featureless' : null;\n\t}\n\n\tisOptionSelected(option) {\n\t\tif (this.routeSource === 'OptionLookup')\n\t\t\treturn false;\n\t\treturn !!option.selected;\n\t}\n\n\thandleDeleteOption() {\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tthis.deleteOption(e.detail.Id, e.detail.index);\n\t\t}.bind(this));\n\t}\n\n\tdeleteOption(id, index, deleteMultiple) {\n\t\tlet copy = this.sameOptionAdded(id, index, true);\n\t\tif (!copy)\n\t\t\tthis.model.optionsById[id].selected = false;\n\n\t\tthis.fire('sb-option-deleted', this.options[index]);\n\t\tthis.splice('options', index, 1);\n\t\tthis.showOrHideAddOptionsButton();\n\t\tif(deleteMultiple && copy) this.deleteOption(copy.id, copy.index, true);\n\t}\n\n\tsameOptionAdded(optionId, index) {\n\t\tlet sameOption = null;\n\t\tfor (let [idx, option] of this.options.entries()) {\n\t\t\tif (idx === index)\n\t\t\t\tcontinue;\n\t\t\tif (option.record.Id === optionId) {\n\t\t\t\tsameOption = {'id': optionId, 'index': idx};\n\t\t\t\tif (option.index > index)\n\t\t\t\t\toption.index--;\n\t\t\t}\n\t\t}\n\t\treturn sameOption;\n\t}\n\n\thandleConfigureOption() {\n\t\tthis.addEventListener('configure-tapped', function (e) {\n\t\t\tlet index = this.isClickSelection ? null : e.detail.index;\n\t\t\t//When in an 'Add' feature, feature._transient_.optionConfigurations may contain distinct clones. For this reason, access optionConfigurations directly rather that this.options\n\t\t\tlet option = this.isClickSelection ? this.model.optionsById[e.detail.Id] : this.model.getFeature(this.featureId)._transient_.optionConfigurations[e.detail.index];\n\t\t\tlet tabIndex;\n\t\t\tif (this.model.product.record[this.prefix + 'OptionLayout__c'] === 'Tabs' || this.model.product.featureCategories.length > 0)\n\t\t\t\ttabIndex = this.getTabIndex();\n\t\t\tthis.fire('configure-option-tapped', {\n\t\t\t\taddedIndex: option.index || 0,\n\t\t\t\tindex: index,\n\t\t\t\toptionId: option.record.Id,\n\t\t\t\toptionalSKU: option.record[this.prefix + 'OptionalSKU__c'],\n\t\t\t\tproductId: this.model.product.record.Id,\n\t\t\t\ttabIndex: tabIndex,\n\t\t\t\toptionData: option.record,\n\t\t\t\tisDynamicOption: option.isDynamicOption\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tgetTabIndex() {\n\t\tlet categoryName;\n\t\tfor (let [idx, feature] of this.model.product.features.entries()) {\n\t\t\tif (feature.record.Id !== this.featureId)\n\t\t\t\tcontinue;\n\t\t\tif (this.model.product.featureCategories.length > 0) {\n\t\t\t\tcategoryName = feature.record[this.prefix + 'Category__c'];\n\t\t\t\tif (categoryName == null)\n\t\t\t\t\treturn this.model.product.featureCategories.length;\n\t\t\t\tbreak;\n\t\t\t} else\n\t\t\t\treturn idx;\n\t\t}\n\n\t\tfor (let [index, category] of this.model.product.featureCategories.entries()) {\n\t\t\tif (this.model.product.featureCategoryLabels[category] === categoryName)\n\t\t\t\treturn index;\n\t\t}\n\t}\n\n\tfilterOptions() {\n\t\tlet _options = this.configSearch.setOptionVisibility(this.options);\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!this.options[i].hiddenByRule)\n\t\t\t\tthis.set('options.' + i + '.hidden', _options[i].hidden);\n\t\t}\n\t}\n\n\tsetOptionIndex() { // TODO: This can easily be combined with filterOptions, just need a big refactor. Setting property values will not hinder performance\n\t\tlet optionCount = {};\n\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!optionCount[this.options[i].record.Id])\n\t\t\t\toptionCount[this.options[i].record.Id] = 0;\n\t\t\tthis.set('options.' + i + '.index', optionCount[this.options[i].record.Id]);\n\n\t\t\tlet nodeId = '_' + this.options[i].record.Id + '_' + this.options[i].index;\n\t\t\tlet configured = this.model.product.configuration.configuredOptions && this.model.product.configuration.configuredOptions[nodeId];\n\t\t\tthis.set('options.' + i + '.configured', configured);\n\t\t\toptionCount[this.options[i].record.Id]++;\n\t\t}\n\t}\n\n\tsetProductRulesActions() {\n\t\tif (Object.keys(this.model.productRulesActions).length == 0 || !this.model.optionsByFeatureId[this.featureId])\n\t\t\treturn;\n\n\t\tif (this.isClickSelection == false)\n\t\t\tthis.setUnaddedOptionsRulesActions();\n\t\tif (this.options[0] !== undefined)\n\t\t\tthis.setDisplayedOptionsRulesActions();\n\t}\n\n\tsetUnaddedOptionsRulesActions() {\n\t\tlet addedOptions = this.model.optionsByFeatureId[this.featureId];\n\t\tfor (let h = 0; h < addedOptions.length; h++) {\n\t\t\tlet option = addedOptions[h];\n\t\t\tif (this.model.productRulesActions.selectOptions[option.record.Id] && !this.sameOptionAdded(option.record.Id, h)) {\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t\tthis.push('options', option);\n\t\t\t\tthis.showOrHideAddOptionsButton();\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[option.record.Id]) {\n\t\t\t\toption.hidden = false;\n\t\t\t\toption.hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.hideOptions[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': true};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': true};\n\t\t\t}\n\t\t}\n\t}\n\n\tsetDisplayedOptionsRulesActions() {\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif (this.isClickSelection && this.model.productRulesActions.selectOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.selected`, true);\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.deselectOptions[this.options[i].record.Id]) {\n\t\t\t\tif (this.isClickSelection) {\n\t\t\t\t\tthis.set(`options.${i}.selected`, false);\n\t\t\t\t\tthis.fireOptionChangedByRule(false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteOption(this.options[i].record.Id, i);\n\t\t\t\t\tif (this.options[i] === undefined) return;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.hideOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, true);\n\t\t\t\tthis.options[i].hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t\tthis.options[i].hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': true});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': true});\n\t\t\t}\n\t\t}\n\t}\n\n\tfireOptionChangedByRule(added) {\n\t\tif (this.viewport && !this.viewport.isMobile())\n\t\t\treturn;\n\n\t\tthis.fire('option-changed-by-rule', {\n\t\t\tadded: added\n\t\t});\n\t}\n\n\t_firePriceRules() {\n\t\tlet optionDataByOptionIdAndIndex = this.model.optionDataByOptionIdAndIndex;\n\t\tlet options = this.options;\n\n\t\tif (options != null) {\n\t\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\t\tlet optionId = options[i].optionId || options[i].record.Id;\n\t\t\t\tlet index = options[i].index;\n\n\t\t\t\tif(optionDataByOptionIdAndIndex[optionId] && optionDataByOptionIdAndIndex[optionId][index] != null) {\n\t\t\t\t\tlet priceActions = this._getPriceActions(options[i], optionId, index);\n\n\t\t\t\t\tfor(let priceAction in priceActions) {\n\t\t\t\t\t\tif(priceActions.hasOwnProperty(priceAction)) {\n\t\t\t\t\t\t\tthis.set(['options', i, 'record', priceAction], priceActions[priceAction]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_getPriceActions(option, optionId, index) {\n\t\tlet priceActions = {};\n\t\tlet optionData = this.model.optionDataByOptionIdAndIndex[optionId][index].optionData;\n\t\tlet listPrice = this.model.optionDataByOptionIdAndIndex[optionId][index].listPrice || this.model.originalDataByOptionIds[optionId].unitPrice;\n\n\t\tfor(let priceAction in optionData) {\n\t\t\tif(optionData.hasOwnProperty(priceAction) && priceAction != 'attributes') {\n\t\t\t\tif(option.record[priceAction] != optionData[priceAction]) {\n\t\t\t\t\tpriceActions[priceAction] = optionData[priceAction];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._calculateUnitPrice(priceActions, optionData, listPrice);\n\n\t\treturn priceActions;\n\t}\n\n\t_calculateUnitPrice(priceActions, optionData, listPrice) {\n\t\tlet prefix = this.getPrefix();\n\t\tlet discountRate = optionData[prefix + 'Discount__c'];\n\t\tlet discountAmount = optionData[prefix + 'DiscountAmount__c'];\n\n\n\t\tif(discountRate) {\n\t\t\tlistPrice = listPrice * ((100 - discountRate) / 100);\n\t\t} else if(discountAmount) {\n\t\t\tlistPrice = listPrice - discountAmount;\n\t\t}\n\n\t\tpriceActions[prefix + 'UnitPrice__c'] = listPrice\n\t}\n\n\tsetUpgradeOptionClass() {\n\t\tPolymer.dom(this.$.tbody).observeNodes(function () {\n\t\t\tlet upgradeOptions = Polymer.dom(this.$.tbody).node.querySelectorAll('#row[hidden]');\n\n\t\t\tfor(let i = 0; i < upgradeOptions.length; i++) {\n\t\t\t\tif (upgradeOptions[i].rowData.isUpgrade)\n\t\t\t\t\tthis.toggleClass('upgradeOption', true, upgradeOptions[i]);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\ttoggleUpgradeOptions() {\n\t\tlet options = this.options;\n\t\tthis.showUpgradeOptions = !this.showUpgradeOptions;\n\n\t\tif(this.showUpgradeOptions) {\n\t\t\tthis.upgradeOptionButtonText = 'Hide Available Upgrades';\n\t\t} else {\n\t\t\tthis.upgradeOptionButtonText = 'Show Available Upgrades';\n\t\t}\n\n\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\tif (options[i].isUpgrade === true) {\n\t\t\t\tif(this.showUpgradeOptions) {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tshowOrHideAddOptionsButton() {\n\t\tthis.showAddOptionsButton = !this.isClickSelection && !this.model.maxOptionsMet(this.model.getFeature(this.featureId));\n\t}\n\n\tgetPrefix() {\n\t\treturn this.model.prefix;\n\t}\n\n\tsetHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton) {\n\t\tthis.hasUpgradeOptions = hasUpgradeOptions && !showAddOptionsButton;\n\t}\n\n\t_setHeaderActions() {\n\t\tif(this.routeSource === 'OptionLookup' || this.options.length === 0 || !this.options[0]._transient_.rowActions) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.headerActions = JSON.parse(JSON.stringify(this.options[0]._transient_.rowActions));\n\n\t\t\tfor(let i = this.headerActions.length -1; i >= 0; i--) {\n\t\t\t\tthis.headerActions[i].invisible = true;\n\t\t\t}\n\n\t\t\tif(!this.isClickSelection) {\n\t\t\t\tthis.headerActions[0].hidden = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getDisplayStyle() {\n\t\t// We should make this in the Global Space, but Scott was too risk averse to making this global right at release freeze. This was a Safari specific bug\n\t\treturn this.productHasAttributeSet ? 'table-row' : 'table-row-group';\n\t}\n\n\t// Method needed since upgrade options are hidden on load by default\n\t_showUpgradeOptionIfSelectionMethodAdd() {\n\t\tif(this.isClickSelection) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif(this.options[i].isUpgrade) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\thasAttributeItems(option) {\n\t\treturn (!this._isMobile() && this.model.getFeature(this.featureId).optionSelectionMethod !== 'Add' && option &&\n\t\t\toption._transient_ && option._transient_.attributeItems && Object.keys(option._transient_.attributeItems).length > 0) || false;\n\t}\n}\n\nPolymer(ProductOptionTable);\n","import {Page} from 'common/core/Page.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class DynamicLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dynamic-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tquote: Object,\n\t\t\tmodel: Object,\n\t\t\tfeature: Object,\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\thiddenByGroup: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tdefaultFilters: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\t// errors for services\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t// errors for sb-toast\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasInstructions(feature)'\n\t\t\t},\n\t\t\tvalidationMessages: Array\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelChanged(searchModel)'\n\t\t];\n\t}\n\n\tsearchModelChanged() {\n\t\tthis.deSelectAll();\n\t}\n\n\tready() {\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t\tthis.handleOptionConfiguratorResponse();\n\t}\n\n\tcancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tadd() {\n\t\tif (Object.keys(this.selectedProducts).length === 0) {\n\t\t\tthis.cancel();\n\t\t\treturn;\n\t\t}\n\n\t\tlet featureOptionIds = [];\n\t\tfor (let key in this.selectedProducts) {\n\t\t\tfeatureOptionIds.push(this.ctx.params.fId + ':' + key);\n\t\t}\n\t\tconst exceededNumber = this.validateMaximumOptionsNotExceeded(featureOptionIds.length);\n\t\tthis.validationMessages = [];\n\t\tif (exceededNumber > 0) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.\", [exceededNumber, this.feature.record[this.prefix + 'MaxOptionCount__c']])];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$.productLoader.featureOptionIds = featureOptionIds;\n\t\tthis.$.productLoader.ignoreCache = true;\n\t}\n\n\tconvertProductsToOptions (results) {\n\t\tfor (let key in results) {\n\t\t\tvar option = results[key];\n\t\t\toption.record[this.prefix + 'UnitPrice__c'] = this.selectedProducts[key].record.UnitPrice;\n\t\t\toption.isDynamicOption = true;\n\t\t\tthis.push('product.options', option);\n\t\t\tthis.push('feature._transient_.optionConfigurations', option);\n\t\t}\n\t\t//the last option will apply it's record values to any configuration attributes for the original bundle\n\t\tthis.syncConfigurationAttributesToProduct(option);\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tsyncConfigurationAttributesToProduct(product) {\n\t\t// 1: build a key map for any configuration attribute that has auto select set to true\n\t\t// 2: loop through those attributes and set the value to the value of the product record field value\n\t\tif(this.autoSelectAttributes === undefined) {\n\t\t\tthis.autoSelectAttributes = {};\n\t\t\tfor (let attribute of this.product.configurationAttributes)\n\t\t\t\tif (attribute.autoSelect === true && this.autoSelectAttributes[attribute.targetFieldName] === undefined)\n\t\t\t\t\tthis.autoSelectAttributes[attribute.targetFieldName] = true; //just storing keys\n\t\t}\n\n\t\tfor(let attribute in this.autoSelectAttributes)\n\t\t\tthis.product.configuration.configurationData[attribute] = product.record[attribute];\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.model.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'dl'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.$.productLoader.productIds = this.productIds;\n\t\t\tthis.$.productLoader.quote = this.$.optionConfigure.quote = this.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\n\t\tthis.$.productLoader.addEventListener('product-load-model-changed', function (e) {\n\t\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\t\treturn this.convertProductsToOptions(e.detail.value);\n\t\t\tlet product = this.ctx.params.productIdx ? e.detail.value.configuredProducts[this.ctx.params.productIdx] : e.detail.value.configuredProducts[0];\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.$.optionConfigure.product = product;\n\n\t\t\tthis.setCurrentProductModel(product);\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\t\t\tlet layoutFieldSet = this.product.productFieldSets[this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c']];\n\t\t\tif (layoutFieldSet)\n\t\t\t\tsearchModel.resultFieldNames = layoutFieldSet;\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.';\n\t\t\tthis.searchModel = searchModel;\n\t\t\tthis.buildDelegator();\n\t\t}.bind(this));\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) { //possibly just listen to service change\n\t\t\tthis.setCurrentProductModel(e.detail.value.configuredProducts[0]);\n\t\t}.bind(this));\n\t}\n\n\tsetCurrentProductModel(product) {\n\t\tthis.product = product;\n\t\tthis.model = new ProductViewModel(this.quote.record.Id, product, this.app.org.prefix, this.isoCode, this.ctx.params.fId);\n\t\tthis.feature = this.model.getFeature(this.ctx.params.fId);\n\t\tif (this.feature === undefined) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Attempted to access a feature not associated with this bundle.\")];\n\t\t\treturn;\n\t\t}\n\t\tlet filters = [];\n\t\tlet filtersLoaded = false;\n\t\tif (this.feature.searchFilters) {\n\t\t\tif (this.defaultFilters[this.feature.record.Id] != null)\n\t\t\t\tfiltersLoaded = true;\n\t\t\telse\n\t\t\t\tthis.defaultFilters[this.feature.record.Id] = [];\n\t\t\tfor (let searchFilter of this.feature.searchFilters) {\n\t\t\t\tif (searchFilter.valueObject != null)\n\t\t\t\t\tsearchFilter.stringValue = this.getStringValue(searchFilter);\n\t\t\t\tfilters.push(JSON.stringify(searchFilter));\n\t\t\t\tif (!filtersLoaded)\n\t\t\t\t\tthis.defaultFilters[this.feature.record.Id].push(searchFilter);\n\t\t\t}\n\t\t}\n\t\tthis.$.smLoadService.filters = filters;\n\t\tthis.$.smLoadService.fieldSet = this.feature.record[this.prefix + 'DynamicProductFilterFieldSet__c'];\n\t\tthis.$.smLoadService.quote = this.quote;\n\t}\n\n\tbuildDelegator() {\n\t\tlet searcher = new Searcher(this.searchModel);\n\t\tsearcher.dynamicSearchFilters = this.defaultFilters[this.feature.record.Id] ? this.defaultFilters[this.feature.record.Id] : [];\n\t\tsearcher.dynamicFieldSet = this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c'];\n\t\tthis.searcher = searcher;\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.panelHeader = 'Product Filter';\n\t\tthis.$.drawer.togglePanel();\n\t\tthis.refocus();\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus() {\n\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clearfilter.focus();\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blurred so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let selectedProductId of orderedSelectedProductIds)\n\t\t\torderedSelectedProducts.push(this.selectedProducts[selectedProductId]);\n\t\treturn orderedSelectedProducts;\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.selected === 'main') {\n\t\t\tthis.fire('iron-signal', {name: 'sb-panel-closed'});\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tgetStringValue(filter) {\n\t\tif (filter.valueObject === 'Product')\n\t\t\treturn this.product.record[filter.valueField];\n\t\telse if (filter.valueObject === 'Quote')\n\t\t\treturn this.quote.record[filter.valueField];\n\t\telse if (filter.valueObject === 'Configuration Attributes')\n\t\t\treturn this.product.configuration.configurationData[filter.valueField];\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n\n\tsetHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n\n\tvalidateMaximumOptionsNotExceeded(optionsSelected) {\n\t\treturn this.feature._transient_.optionConfigurations.length + optionsSelected - this.feature.record[this.prefix + 'MaxOptionCount__c'];\n\t}\n}\n\nPolymer(DynamicLookup);\n","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class OptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\ttopLevelBundle: Object, // ConfiguredProduct\n\t\t\tcurrentProductModel: Object, //ProductViewModel\n\t\t\tfeature: Object,\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\toptionConstraintsHandler: Object, //OptionConstraintsHandler\n\t\t\theaderSubtitle: String,\n\t\t\tselectedOptions: Object,\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasUpgradeOptions(feature)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tvalidationMessages: Array,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis._handleLineEditorModelResponse();\n\t\tthis._handleProductLoadResponse();\n\t\tthis.handleOptionConfiguratorResponse();\n\t\tthis.addEventListener('selection-changed', this._handleOptionSelection);\n\t}\n\n\tadd() {\n\t\tthis.validationMessages = [];\n\t\tconst exceededNumber = this._validateMaximumOptionsNotExceeded();\n\t\tif (exceededNumber > 0) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.\", [exceededNumber, this.feature.record[this.prefix + 'MaxOptionCount__c']])];\n\t\t\treturn;\n\t\t}\n\t\tthis._addSelected();\n\t\tthis._routeToConfig();\n\t}\n\n\tcancel() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tthis.currentProductModel.optionsById[key].added = false;\n\t\t\tthis.currentProductModel.optionsById[key].selected = false;\n\t\t}\n\t\tthis._routeToConfig();\n\t}\n\n\t_handleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.$.productLoad.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t\tthis.currencyIsoCode = e.detail.value.quote.record.CurrencyIsoCode || null;\n\t\t}.bind(this));\n\t}\n\n\t_handleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tlet products = e.detail && e.detail.value ? e.detail.value.configuredProducts : null,\n\t\t\t\tidx = this.ctx.params && this.ctx.params.productIdx ? this.ctx.params.productIdx : 0,\n\t\t\t\tproduct = products ? products[idx] : e.detail.value;\n\t\t\tif (!product.rulesProcessed) {\n\t\t\t\tlet processor = new RuleProcessor(product.configuration, product);\n\t\t\t\tprocessor.initProductRulesActions(this.optionId === '' ? 'load' : 'reconfigure');\n\t\t\t}\n\t\t\tthis.topLevelBundle = product;\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.$.optionConfigure.product = product;\n\t\t\t// pass in fId and ONLY render map for fID;\n\t\t\tthis.setCurrentProductModel(product);\n\t\t}.bind(this));\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) { //possibly just listen to service change\n\t\t\tthis.setCurrentProductModel(e.detail.value.configuredProducts[0]);\n\t\t}.bind(this));\n\t}\n\n\tsetCurrentProductModel(product) {\n\t\t// pass in fId and ONLY render map for fID;\n\t\tthis.currentProductModel = new ProductViewModel(this.$.productLoad.quote.record.Id, product, this.app.org.prefix, this.currencyIsoCode, this.ctx.params.fId);\n\t\tthis.feature = this.currentProductModel.getFeature(this.ctx.params.fId);\n\t\tif (this.feature === undefined) {\n\t\t\tthis.validationMessages = [this.i18n.l(\"Attempted to access a feature not associated with this bundle.\")];\n\t\t\treturn;\n\t\t}\n\t\tthis.selectedOptions = {};\n\t\tthis.optionConstraintsHandler = new OptionConstraintsHandler(this.currentProductModel.product, this.currentProductModel.prefix);\n\t\tthis.$.optionTable.fieldSetName = \"OptionLookup\";\n\t\tthis.$.optionTable.fieldSet = this.currentProductModel.product.optionFieldSets[this.$.optionTable.fieldSetName];\n\t\tthis.$.optionTable.displayDelete = false;\n\t\tthis._createConstraintsHoverMessages();\n\t\tthis._fireSelectionStatesForOtherFeatures();\n\t}\n\n\t_handleOptionSelection(e) {\n\t\tif (e && e.detail) {\n\t\t\tthis._toggleOptionSelection(e.detail.Id, e.detail.selected);\n\t\t\tthis._handleOptionConstraints(e.detail.Id, e.detail.selected);\n\t\t}\n\t}\n\n\t_fireSelectionStatesForOtherFeatures() {\n\t\tfor (let featureId of Object.keys(this.currentProductModel.featureIdsWithSelectionMethodClick)) {\n\t\t\tfor (let option of this.currentProductModel.optionsByFeatureId[featureId])\n\t\t\t\tthis._handleOptionConstraints(option.record.Id, option.selected);\n\t\t}\n\t}\n\n\t_toggleOptionSelection(optionId, selected) {\n\t\tif (!selected && this.selectedOptions[optionId]) {\n\t\t\tdelete this.selectedOptions[optionId];\n\t\t} else if (selected && !this.selectedOptions[optionId]) {\n\t\t\tthis.selectedOptions[optionId] = this.currentProductModel.getOption(optionId);\n\t\t}\n\t}\n\n\t_handleOptionConstraints(optionId, selected) {\n\t\tlet addedOption = this.feature._transient_.optionConfigurations.find(function(option) { return option.record.Id === optionId }),\n\t\t\tpreviouslySelected = addedOption && addedOption.selected,\n\t\t\tdisabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected || previouslySelected);\n\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\t_addSelected() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tlet productOption = this.currentProductModel.optionsById[key];\n\t\t\tlet clonedOption = JSON.parse(JSON.stringify(this.currentProductModel.optionsById[key]));\n\t\t\tthis.currentProductModel.initOptionActions(clonedOption, true);\n\t\t\t// TODO: I am not able to get these properties to stick when I enter PVM again.\n\t\t\tclonedOption.addedManually = true; //differentiates copies of required options from originally added options\n\t\t\tclonedOption.index = this.feature._transient_.optionConfigurations.filter( option => { return option.record.Id === key; }).length;\n\t\t\tclonedOption.configured = false;\n\t\t\tthis.currentProductModel.setOptionDisabledData(clonedOption);\n\t\t\tthis.push('feature._transient_.optionConfigurations', clonedOption);\n\t\t\tthis.currentProductModel.optionsById[key].added = true;\n\t\t\tthis.currentProductModel.optionsById[key].selected = true;\n\t\t}\n\t}\n\n\t_validateMaximumOptionsNotExceeded() {\n\t\treturn (this.feature._transient_.optionConfigurations.length + Object.keys(this.selectedOptions).length) - this.feature.record[this.prefix + 'MaxOptionCount__c'];\n\t}\n\n\t_routeToConfig() {\n\t\tthis.selectedOptions = {};\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.currentProductModel ? this.currentProductModel.qId : this.ctx.params.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'ol'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif(params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.optionLookupObjects = [this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tsetHasUpgradeOptions() {\n\t\treturn this.currentProductModel.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_createConstraintsHoverMessages() {\n\t\tthis.currentProductModel.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n}\n\nPolymer(OptionLookup);","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductReconfigurer} from 'products/resources/reconfigure/ProductReconfigurer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {NestedOptionsModel} from '../../../resources/model/nestedOptions/NestedOptionsModel.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\nimport {Navigator} from 'common/core/Navigator.js';\n\nexport class ProductConfig extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-config';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlineEditorModel: Object,\n\t\t\tproductSelectionModel: Object,\n\t\t\ttopLevelBundle: Object,\n\t\t\tcurrentTarget: Object,\n\t\t\tproductIndex: Number,\n\t\t\theaderSubtitle: String, // from LineEditorModel, should be Quote Number\n\t\t\thasMultipleBundles: Boolean,\n\t\t\tisClassic: Boolean,\n\t\t\tsearchValuesByFilter: Object,\n\t\t\tsearchFilters: Array,\n\t\t\tvalidationMessages: Array,\n\t\t\theaderTitle: String,\n\t\t\tisMobileAndHasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles)\"\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getGroupKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(app.org)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpreventPreLoadObjects: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\n\n\tready() {\n\t\tthis.handleLineEditorModelResponse();\n\t\tthis.handleProductLoadResponse();\n\t\tthis.handleOptionSaveResponse();\n\t\tthis.handleProductRulesInvokerResponse();\n\t\tthis.handleCustomActionsCollapsed();\n\t\tthis.handleOnAddOptionClick();\n\t\tthis.handleBundlePanelClick();\n\t\tthis.handleChangeEvents();\n\t\tthis.handleBundleNameChange();\n\t\tthis.handleExternalConfiguration();\n\t\tthis.handleConfigureOptionEvent();\n\t\tthis.handleOptionConfiguratorResponse();\n\t}\n\n\tattached() {\n\t\tif(!this.preventPreLoadObjects)\n\t\t\tthis.preLoadObjects();\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.$.optionSave.stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\t\tthis.$.optionSave.stripLinesMessage = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tthis.$.productLoad.quote = this.$.optionSave.quote = this.$.productRulesInvoke.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\t}\n\n\thandleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tif (e.detail.value && e.detail.value.configuredProducts === undefined) {\n\t\t\t\t// if we aren't loading a productLoadModel, we are handling the response of dynamic option loader as a result of an external configuration\n\t\t\t\tthis._handleExternalDynamicOptionsResponse(e.detail.value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet model = this.handleProductConfigurationInitializer(e.detail.value);\n\t\t\t// If a user enters the Configurator by reconfiguring a quote line, and that line has not been saved in a quote, we have to return the\n\t\t\t// user to the QLE. We do not cache the unsaved quote line, so it would error out.\n\t\t\tif(model.returnToQuote) {\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', {qId: this.lineEditorModel.quote.record.Id }, ['quote', 'le'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [model.returnToQuote];\n\t\t\t}\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.setOptionConfigurationDetails(model);\n\t\t\tif (this.loadedModelIsReconfigure(model)) {\n\t\t\t\tnew ProductReconfigurer(model.configuredProducts[0], this.lineEditorModel.quote.record[this.prefix + 'Type__c']).reconfigure();\n\t\t\t\tthis.addAttributeSetFromServerProductVO(model.configuredProducts[0]);\n\t\t\t}\n\t\t\tfor (let prod of model.configuredProducts) {\n\t\t\t\tif (!prod.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(prod.configuration, prod);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\t\t\t\tif (model.attributeSet != null && Object.keys(model.attributeSet.attributeItemIdsByOptionId).length > 0) {\n\t\t\t\t\tprod._transient_ = prod._transient_ || {};\n\t\t\t\t\tprod._transient_.attributeSet = model.attributeSet;\n\t\t\t\t}\n\t\t\t\tif (prod.configuration != null && prod.nestedOptionModel == null) {\n\t\t\t\t\tprod.nestedOptionModel = new NestedOptionsModel(prod.configuration);\n\t\t\t\t}\n\t\t\t\tprod.configuration.configuredOptions = prod.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t}\n\t\t\tthis.productSelectionModel = undefined;\n\t\t\tthis.productSelectionModel = model;\n\t\t\tthis.hasMultipleBundles = (this.productSelectionModel.configuredProducts.length > 1);\n\t\t\tthis.isClassic = (this.hasMultipleBundles && this.lineEditorModel.settings.multipleBundlesView === 'Classic');\n\t\t\tthis.currentTarget = this.productSelectionModel;\n\t\t\t//initialize option configurations for all products\n\t\t\tfor (let i = 0; i < this.productSelectionModel.configuredProducts.length; i++)\n\t\t\t\tthis.productIndex = i;\n\t\t\tthis.productIndex = this.getProductIndex();\n\t\t\t//remove invalid fields from the search filter field set\n\t\t\tthis.searchFilters = this.productSelectionModel.configuredProducts[0].optionFieldSets.SearchFilters; //TODO: Andrew should this only refer to configuredProducts[0]?\n\t\t\tlet filterMap = {};\n\t\t\tif (this.searchFilters && !this.productSelectionModel.searchValuesByFilter) {\n\t\t\t\tfor (let i = 0, numFilters = this.searchFilters.length; i < numFilters; i++) {\n\t\t\t\t\tfilterMap[this.searchFilters[i]] = null;\n\t\t\t\t}\n\t\t\t\t//filter keymap added to PSM to persist across bundles\n\t\t\t\tthis.productSelectionModel.searchValuesByFilter = filterMap;\n\t\t\t}\n\t\t\tthis.$.bundles.searchValuesByFilter = this.productSelectionModel.searchValuesByFilter;\n\t\t\tthis.$.bundles.searchFilters = this.searchFilters;\n\t\t\t//must do this after all data is set\n\t\t\tthis.checkForExternalConfiguration();\n\t\t}.bind(this));\n\t}\n\n\thandleOptionSaveResponse() {\n\t\tthis.$.optionSave.addEventListener('psm-response-changed', function (e) {\n\t\t\tthis.validationMessages = null;\n\t\t\tlet response = e.detail.value;\n\t\t\tlet ruleProcessor = new RuleProcessor(response, this.topLevelBundle);\n\t\t\truleProcessor.initValidationMessages();\n\t\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\t\t\tif (this.validationMessages.length > 0) {\n\t\t\t\tthis.spinner = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//check for product alert rules\n\t\t\tif (response.guidedMessages && response.guidedMessages.length > 0) {\n\t\t\t\tthis.$.productAlerts.cancelCB = null;\n\t\t\t\tthis.$.productAlerts.displayContinueButton = true;\n\t\t\t\tthis.$.productAlerts.continueCB = this.afterSaveNavigate.bind(this, response, ruleProcessor);\n\t\t\t\tthis.spinner = false;\n\t\t\t\tthis.$.productAlerts.alerts = response.guidedMessages;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// no validation or alert rules encountered, so lets complete our after save navigation\n\t\t\tthis.afterSaveNavigate(response, ruleProcessor);\n\t\t}.bind(this));\n\t}\n\n\tafterSaveNavigate(response, ruleProcessor) {\n\t\tlet optionId = 'none',\n\t\t\ttabIndex;\n\t\tif (this.optionId !== '') {\n\t\t\tlet latestData = this.topLevelBundle.nestedOptionModel.getLastFromPath();\n\t\t\ttabIndex = latestData.tabIndex;\n\t\t\toptionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU() || 'none';\n\t\t\truleProcessor.initDescendantTree();\n\t\t}\n\t\tlet redirectUrl = this.ctx.params ? this.ctx.params.redirectUrl : null,\n\t\t\tpathParams = this.createPathParams(redirectUrl),\n\t\t\tqueryParams;\n\n\t\tif(this.optionId !== '')\n\t\t\tqueryParams = this.createQueryParams({ oId: optionId, ignoreCache: false, jspr: true }, tabIndex);\n\t\telse {\n\t\t\tqueryParams = {qId: response.quote.record.Id};\n\t\t\tif(this.ctx.params.groupKey != null)\n\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\tif(this.ctx.params.aId && pathParams[0] !== 'quote')\n\t\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\t}\n\n\t\tif (response.quote)\n\t\t\tthis.lineEditorModel.quote = response.quote;\n\t\tthis.nav('#', queryParams, pathParams, false);\n\t}\n\n\thandleProductRulesInvokerResponse() {\n\t\tthis.$.productRulesInvoke.addEventListener('config-response-changed', function (e) {\n\t\t\tlet response = e.detail.value;\n\t\t\tlet productIndex = this.currentTarget.configuredProducts.findIndex( product => {\n\t\t\t\t// in case of cloned object use the productKey instead of id (unless no key then use the id)\n\t\t\t\tlet productKey = product.productKey || product.record.Id;\n\t\t\t\treturn productKey === response.configuredProductKey;\n\t\t\t});\n\t\t\tlet currentProduct = this.currentTarget.configuredProducts[productIndex];\n\t\t\tlet ruleProcessor = new RuleProcessor(response, currentProduct);\n\t\t\truleProcessor.init(this.topLevelBundle !== undefined ? this.topLevelBundle.nestedOptionModel : currentProduct.nestedOptionModel);\n\t\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\t\t\t//W-3652536: response from the server does not have the updated configuration attribute values\n\t\t\t//always using the configuration.configurationData values from the client\n\t\t\tif(currentProduct.configuration !== undefined && currentProduct.configuration.configurationData !== undefined)\n\t\t\t\tresponse.configurationData = currentProduct.configuration.configurationData;\n\t\t\tthis.$.bundles.set(`configuredProducts.${productIndex}.configuration.productRulesActions`, ruleProcessor.getProductRulesActions()); //apply product rules\n\t\t\tthis.$.bundles.set(`configuredProducts.${productIndex}.configuration.optionDataByOptionIdAndIndex`, ruleProcessor.getOptionDataByOptionIdAndIndex()); //apply price rules\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\t\tthis.spinner = false;\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\thandleCustomActionsCollapsed() {\n\t\tthis.changeAllActions(this.$.customActions.buttonsCollapsed);\n\t\tthis.$.customActions.addEventListener('buttons-collapsed-changed', function (e) {\n\t\t\tlet val = e.detail.value;\n\t\t\tthis.changeAllActions(val);\n\t\t}.bind(this));\n\t}\n\n\thandleOnAddOptionClick() {\n\t\tlet tabIndex;\n\t\t// Must have the most up to date tabIndex so the proper feature gets updated.\n\t\tthis.addEventListener('selected-page-changed', function (e) {\n\t\t\ttabIndex = e.detail;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('add-option-clicked', function (e) {\n\t\t\tlet query = this.optionId === '' ? e.detail : Object.assign({}, e.detail, { oId: this.optionId });\n\t\t\tlet index;\n\t\t\tif (query.path && this.optionId === '')\n\t\t\t\tindex = this.getProductIndex(e.detail.pId);\n\t\t\tlet queryParams = this.createQueryParams(query, tabIndex),\n\t\t\t\tpath = query.path != null ? query.path : ['product', 'ol'];\n\t\t\tif (index)\n\t\t\t\tqueryParams.productIdx = index;\n\t\t\tthis.nav('#', queryParams, path, false);\n\t\t}.bind(this));\n\t}\n\n\thandleBundlePanelClick() {\n\t\tthis.addEventListener('bundle-panel-clicked', this.navToBundle);\n\t}\n\n\tnavToBundle(e) {\n\t\tlet queryParams = (this.createQueryParams(this.ctx.params));\n\t\tqueryParams.productIdx = e.detail;\n\t\tqueryParams.open = 1;\n\t\tif (queryParams.tab)\n\t\t\tdelete queryParams.tab;\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\thandleChangeEvents() {\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Selection');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-quantity-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Quantity Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-config-attribute-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Attribute Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-option-deleted', function(e) {\n\t\t\tlet prod = this.topLevelBundle || this.productSelectionModel.configuredProducts[this.productIndex];\n\t\t\tif (prod.nestedOptionModel)\n\t\t\t\tprod.nestedOptionModel.remove(e.detail);\n\t\t}.bind(this));\n\t}\n\n\thandleBundleNameChange() {\n\t\tif (!this.isMobileViewport()) {\n\t\t\tthis.headerTitle = this.i18n.l('Configure Products');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addEventListener('bundle-name-changed', function(e) {\n\t\t\tthis.headerTitle = e.detail.name;\n\t\t}.bind(this));\n\t}\n\n\thandleExternalConfiguration() {\n\t\tthis.addEventListener('sb-close-popup', function(e) {\n\t\t\tif (e.detail.dynamicOptions && e.detail.dynamicOptions.length > 0 && e.detail.featureOptionIds) {\n\t\t\t\tthis._handleExternalDynamicOptions(e.detail);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!e.detail.redirect)\n\t\t\t\treturn null;\n\n\t\t\tif (this.productSelectionModel.configuredProducts.length === 1) { // If only configuring one bundle...\n\t\t\t\tif (!e.detail.redirect.auto && !e.detail.redirect.back) // ...and auto-launch and back-on-close setting are false...\n\t\t\t\t\treturn null; // drop the popup and show the configurator.\n\t\t\t\telse if (e.detail.redirect.save) // ...and we are saving either an auto-launch or back-on-close page\n\t\t\t\t\tthis.save(); // save the bundle to the QLE\n\t\t\t\telse // ...and we are either not saving the configuration\n\t\t\t\t\tthis.cancel(e.detail.redirect.back); // route back to QLE or previous page based on 'back' parameter\n\t\t\t} else { // If configuring multiple bundles...\n\t\t\t\tif (e.detail.redirect.back && e.detail.redirect.save) { // ...and we are saving a back-on-close configuration...\n\t\t\t\t\tif (this.productIndex === this.productSelectionModel.configuredProducts.length - 1)  // ...and this bundle is the last bundle...\n\t\t\t\t\t\tthis.save(); // ...save the bundles to the QLE\n\t\t\t\t\telse // ...and this bundle is not the last bundle...\n\t\t\t\t\t\tthis.navToBundle({detail: this.productIndex + 1}); // ...iterate to the next bundle\n\t\t\t\t} else if (e.detail.redirect.back) { // ...and we are not saving a back-on-close configuration...\n\t\t\t\t\tthis.cancel(true); // ...navigate to the previous page\n\t\t\t\t} else { // ...and we do not have a back-on-close configuration...\n\t\t\t\t\treturn null; // drop the popup and show the configurator\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleProductConfigurationInitializer(model) {\n\t\tif (this.isReconfigure(model))\n\t\t\treturn model;\n\t\t// Applies changes made to the data model from Quote Process record's Product Configuration Initializer\n\t\tfor (let c_product of model.configuredProducts) {\n\t\t\tlet configuration = c_product.configuration; //PCI changes are reflect in this object\n\t\t\tfor (let o_config of configuration.optionConfigurations) {\n\t\t\t\tlet optionId = o_config.optionData.Id; //option ID of an option that has been affected by PCI\n\t\t\t\tfor (let option of c_product.options) {\n\t\t\t\t\tif (option.record.Id === optionId)\n\t\t\t\t\t\tfor (let data in o_config.optionData)\n\t\t\t\t\t\t\tif (option.record[data] && option.record[data] != o_config.optionData[data])\n\t\t\t\t\t\t\t\toption.record[data] = o_config.optionData[data];\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn model;\n\t}\n\n\tsave() {\n\t\tif (this.configurationAttributesValid() === false) {\n\t\t\tthis.validationMessages = [this.i18n.l('Please review required configuration attributes') + this.getConfigurationAttributeMissingFeaturesMessage()];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validationMessages = null;\n\t\tif (this.optionId !== '') {\n\t\t\tlet configuredProduct = this.prepareProductForServer(this.currentTarget.configuredProducts[0]);\n\t\t\tif (this.validationMessages)\n\t\t\t\treturn;\n\t\t\tthis.spinner = true;\n\t\t\tthis.$.optionSave.configuration = undefined; //makes certain the observer fires\n\t\t\treturn this.$.optionSave.configuration = configuredProduct.configuration;\n\t\t}\n\t\t// Two use cases here.\n\t\t// 1. \tIf reconfigure then selectedProducts map is nil and all products to save are configured products.\n\t\t// 2. \tIf initial configuration then the selectedProducts map is not empty, contains both configured products\n\t\t//\t\t& selected standard products, and its object values contain an index whose order needs to be maintained upon save.\n\t\tlet addedProducts = this.isReconfigure(this.productSelectionModel) ? this.getConfiguredProductsToSave() : this.getSelectedProductsToSave();\n\t\t// Do not return early when you call the addProducts function and find a validation message\n\t\t// it will mess up the product and give you an error when you configure an option\n\t\tif (this.validationMessages)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.$.optionSave.products = undefined; //makes certain the observer fires\n\t\tthis.$.optionSave.products = addedProducts;\n\t}\n\n\tcancel(back = false) {\n\t\tthis.spinner = true;\n\t\tif (this.optionId === '') {\n\t\t\tlet queryParams = {qId: this.lineEditorModel.quote.record.Id};\n\t\t\tif (this.ctx.params.groupKey != null)\n\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\tif (back === true)\n\t\t\t\treturn Navigator.navToPreviousRoute(this, queryParams, ['product', 'lookup']);\n\t\t\telse\n\t\t\t\treturn this.nav('#', queryParams, ['quote', 'le'], false);\n\t\t}\n\n\t\tthis.topLevelBundle.nestedOptionModel.cancel();\n\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfiguredProductsToSave() {\n\t\tlet productsToSave = [];\n\t\tthis.productSelectionModel.configuredProducts.forEach( product => {\n\t\t\tproductsToSave.push(this.prepareProductForServer(product))\n\t\t});\n\t\treturn productsToSave;\n\t}\n\n\tgetSelectedProductsToSave() {\n\t\tlet configuredProducts = this.productSelectionModel.configuredProducts;\n\t\tlet configuredProductsById = {};\n\n\t\t// create map of configured products by product Id taking into account that we could have more then one\n\t\t// reconfigured product per product Id if the product was cloned by a popup custom action\n\t\tfor(let configuredProduct of configuredProducts) {\n\t\t\tlet productToSave = this.prepareProductForServer(configuredProduct);\n\t\t\tlet productId = configuredProduct.record.Id;\n\t\t\tlet configuredProducts = configuredProductsById[productId];\n\t\t\tif (!configuredProducts)\n\t\t\t\tconfiguredProducts = [];\n\t\t\tconfiguredProducts.push(productToSave);\n\t\t\tconfiguredProductsById[productId] = configuredProducts;\n\t\t}\n\n\t\t// to preserve order, build an ordered selected product id array from the object using the values' index\n\t\tlet selectedProducts = this.productSelectionModel.selectedProducts;\n\t\tlet orderedSelectedProductIds = Object.keys(selectedProducts).sort(function(id1, id2) {\n\t\t\treturn selectedProducts[id1].index - selectedProducts[id2].index;\n\t\t});\n\n\t\t//loop through the ordered selectedProductIds array to build the ordered productToSave array\n\t\tlet productsToSave = [];\n\t\tfor(let selectedProductId of orderedSelectedProductIds) {\n\t\t\tlet selectedProduct = selectedProducts[selectedProductId];\n\t\t\tlet configuredProducts = configuredProductsById[selectedProductId];\n\t\t\tif(configuredProducts)\n\t\t\t\tproductsToSave = productsToSave.concat(configuredProducts);\n\t\t\telse if(!selectedProduct.invalid)\n\t\t\t\tproductsToSave.push(selectedProduct);\n\t\t}\n\t\treturn productsToSave;\n\t}\n\n\tcheckForExternalConfiguration() {\n\t\tlet product = this.productSelectionModel.configuredProducts[this.productIndex],\n\t\t\texternalKey = this.prefix + 'ExternallyConfigurable__c',\n\t\t\texternalURL = this.lineEditorModel.settings.externalConfiguratorUrl,\n\t\t\tbackOrCancelOrClose = this.lineEditorModel.settings.thirdPartyConfigurator;\n\n\t\tif (product.record[externalKey] && (!product.visitedExternal || backOrCancelOrClose) && !this.isClassic && externalURL !== null) {\n\t\t\tproduct.visitedExternal = true;\n\t\t\tthis.$.customActions.handlePopup(externalURL, true, backOrCancelOrClose);\n\t\t}\n\t}\n\n\t_handleExternalDynamicOptions(detail) {\n\t\tthis.$.productLoad.featureOptionIds = detail.featureOptionIds;\n\t\tthis.$.productLoad.ignoreCache = undefined;\n\t\tthis.$.productLoad.ignoreCache = true; // fires the listener on productLoad to load dynamicOptions\n\t\tif (!detail.redirect || !detail.redirect.auto)\n\t\t\treturn;\n\n\t\t// set properties that allow response handler to know to auto-redirect\n\t\tif (detail.redirect.save) this.redirectAfterOptionsAdded = 'save';\n\t\telse this.redirectAfterOptionsAdded = 'cancel';\n\t}\n\n\t_handleExternalDynamicOptionsResponse(response) {\n\t\tlet featureLayout = this.$.bundles.$$('#features');\n\t\t// delegate to featureLayout for handling response of external configurator\n\t\tfeatureLayout.handleDynamicOptionsAdded(response);\n\t\tif (this.redirectAfterOptionsAdded === undefined)\n\t\t\treturn;\n\n\t\tif (this.redirectAfterOptionsAdded === 'save') this.save();\n\t\telse this.cancel();\n\t}\n\n\thandleChangeEvent(e, eventContext) {\n\t\tif (e && e.detail && e.detail.bundleId && e.detail.changed && e.detail.path) {\n\t\t\tlet product = this.getProductById(e.detail.bundleId);\n\t\t\tthis.handleApplyImmediatelyProductRules(product, e.detail, eventContext);\n\t\t}\n\n\t\tif(eventContext === 'On Quantity Change') {\n\t\t\tthis.validationMessages = null;\n\t\t\tif(e.detail.invalidQuantity > 0) {\n\t\t\t\tlet errorMessage = this.i18n.l('Exceeded maximum quantity available. Value has been reduced to {0}', [e.detail.validQuantity]);\n\t\t\t\tthis.validationMessages = [{\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\tmsg: errorMessage\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\thandleApplyImmediatelyProductRules(product, detail, eventContext) {\n\t\tif (!product || !this.isAppliedImmediately(product, detail, eventContext))\n\t\t\treturn;\n\n\t\tthis.spinner = true;\n\t\tthis.debounce('ApplyImmediatelyProductRules', function () {\n\t\t\tthis.$.productRulesInvoke.product = undefined;\n\t\t\tthis._updateProductConfigurationHiddenOptions(product);\n\t\t\tproduct = this.prepareProductForServer(product, true);\n\t\t\tthis.$.productRulesInvoke.upgradeAssetId = product.upgradedAssetId || null;\n\t\t\tthis.$.productRulesInvoke.product = product;\n\t\t}, 250);\n\t}\n\n\t_updateProductConfigurationHiddenOptions(product) {\n\t\tlet hiddenOptionIds = product.configuration.hiddenOptionIds || [];\n\t\tfor(let option of product.options) {\n\t\t\tlet optionIsHidden = option.hiddenByRule;\n\t\t\tlet optionWasHiddenIndex = hiddenOptionIds.indexOf(option.record.Id);\n\t\t\tlet optionWasHidden = optionWasHiddenIndex !== -1;\n\n\t\t\tif(optionIsHidden && !optionWasHidden)\n\t\t\t\thiddenOptionIds.push(option.record.Id);\n\n\t\t\tif(!optionIsHidden && optionWasHidden)\n\t\t\t\thiddenOptionIds.splice(optionWasHiddenIndex, 1);\n\t\t}\n\t\tproduct.configuration.hiddenOptionIds = hiddenOptionIds;\n\t}\n\n\tisAppliedImmediately(product, detail, eventContext) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c',\n\t\t\tcontext = this.prefix + 'AppliedImmediatelyContext__c',\n\t\t\titem, applyImmediatelyContext;\n\n\t\tif (eventContext === 'On Attribute Change') {\n\t\t\titem = product.configurationAttributes.find( attribute => { return attribute.myId === detail.Id; });\n\t\t\treturn item.appliedImmediately;\n\t\t} else {\n\t\t\titem = product.options.find( option => { return option.record.Id === detail.Id; });\n\t\t\tapplyImmediatelyContext = item.record[context];\n\t\t\tif (applyImmediatelyContext === 'Always' || applyImmediatelyContext === eventContext || (applyImmediatelyContext === undefined && eventContext === 'On Selection'))\n\t\t\t\treturn item.record[appliedImmediately];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleConfigureOptionEvent() {\n\t\tthis.addEventListener('configure-option-tapped', function(e) {\n\t\t\tlet product = this.prepareProductForNestedConfigure(e.detail);\n\t\t\tlet queryParams = (this.createQueryParams({ oId: product.nestedOptionModel.getLastFromPath().optionalSKU, ignoreCache: false }));\n\t\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t\t}.bind(this));\n\t}\n\n\tprepareProductForNestedConfigure(nested) {\n\t\tlet product;\n\t\tif (this.optionId === '') {\n\t\t\tlet index = this.productSelectionModel.currentIndex = this.getProductIndex(nested.productId);\n\t\t\tproduct = this.productSelectionModel.configuredProducts[index];\n\t\t} else {\n\t\t\tproduct = this.topLevelBundle;\n\t\t}\n\t\tproduct.nestedOptionModel = product.nestedOptionModel || new NestedOptionsModel();\n\t\tproduct.nestedOptionModel.addToPath(nested.optionId, nested.optionalSKU, nested.addedIndex, nested.tabIndex);\n\t\tproduct.nestedOptionModel.stagedOption = {\n\t\t\toptionData: nested.optionData,\n\t\t\tisDynamicOption: nested.isDynamicOption\n\t\t};\n\t\treturn product\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) {\n\t\t\tthis.currentTarget = e.detail.value;\n\t\t\tlet nestedProduct = this.currentTarget.configuredProducts[0];\n\n\t\t\tif (this.ctx.params.oId && nestedProduct.options.length == 0 && nestedProduct.configurationAttributes.length == 0 && !this.hasDynamicFeature(nestedProduct)) {\n\t\t\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\t\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\t\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', queryParams, ['product', 'pc'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [this.i18n.l('This product has no options and configurations. To add this product, add options/configurations or change Configuration Type to not be Required.')];\n\t\t\t} else {\n\t\t\t\tif (this.topLevelBundle.nestedOptionModel) {\n\t\t\t\t\tif (this.topLevelBundle.nestedOptionModel.descendLevel) {\n\t\t\t\t\t\tlet configuration = this.topLevelBundle.nestedOptionModel.configure(nestedProduct.configuration);\n\t\t\t\t\t\tnew ProductReconfigurer(nestedProduct, this.lineEditorModel.quote.record[this.prefix + 'Type__c']).reconfigure(configuration);\n\t\t\t\t\t\tif (this.ctx.params.tab)\n\t\t\t\t\t\t\tthis.ctx.params.tab = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnestedProduct.configuration = this.topLevelBundle.nestedOptionModel.getCurrentLevel();\n\t\t\t\t\t\tnestedProduct.configuration.configuredOptions = this.topLevelBundle.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!nestedProduct.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(nestedProduct.configuration, nestedProduct);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\n\t\t\t\tthis.addAttributeSetFromServerProductVO(nestedProduct); // Add attributeSet reference to nestedProduct._transient_\n\n\t\t\t\tlet filters = this.topLevelBundle.optionFieldSets.SearchFilters;\n\t\t\t\tlet searchValuesByFilter = {};\n\t\t\t\tfor (let filter of filters) {\n\t\t\t\t\tsearchValuesByFilter[filter] = null;\n\t\t\t\t}\n\t\t\t\tthis.productIndex = 0;\n\t\t\t\tthis.$.bundles.searchValuesByFilter = searchValuesByFilter;\n\t\t\t\tthis.$.bundles.searchFilters = filters;\n\t\t\t\tthis.$.bundles.set(`configuredProducts`, this.currentTarget.configuredProducts);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetProductById(id) {\n\t\treturn this.currentTarget.configuredProducts.find( product => {\n\t\t\t// product key is the unique identifier of a product if a cloned product\n\t\t\tlet productId = product.productKey || product.record.Id;\n\t\t\treturn productId === id;\n\t\t});\n\t}\n\n\tgetProductIndex(id) {\n\t\tif (id) {\n\t\t\tfor (var i=0;i<this.productSelectionModel.configuredProducts.length;i++) {\n\t\t\t\tif (this.productSelectionModel.configuredProducts[i].record.Id === id)\n\t\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.ctx.params || !this.ctx.params.productIdx)\n\t\t\treturn 0;\n\n\t\tlet productIdx = +this.ctx.params.productIdx;\n\t\tif (Number.isNaN(productIdx) || productIdx < 0 || productIdx >= this.currentTarget.configuredProducts.length)\n\t\t\treturn 0;\n\n\t\treturn productIdx;\n\t}\n\n\thasDynamicFeature(product) {\n\t\tfor (let feature of product.features)\n\t\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] === 'Dynamic')\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\taddAttributeSetFromServerProductVO(product) {\n\t\tif (product.attributeSet && Object.keys(product.attributeSet.attributeItemIdsByOptionId).length === 0)\n\t\t\treturn;\n\t\tproduct._transient_ = product._transient_ || {};\n\t\tproduct._transient_.attributeSet = product.attributeSet;\n\t}\n\n\tchangeAllActions(buttonsCollapsed) {\n\t\tif (buttonsCollapsed)\n\t\t\tthis.$$('#allActions').classList.add(\"actionsCollapsed\");\n\t\telse\n\t\t\tthis.$$('#allActions').classList.remove(\"actionsCollapsed\");\n\t}\n\n\tprepareProductForServer(configuredProduct, applyImmediately) {\n\t\tlet minimalProduct = { record:{}},\n\t\t\tnestedOptionModel = this.topLevelBundle ? this.topLevelBundle.nestedOptionModel : configuredProduct.nestedOptionModel;\n\t\tminimalProduct.upgradedAssetId = configuredProduct.upgradedAssetId; //the asset being upgraded when configuring from asset upgrade\n\t\tlet selectedProducts = this.getSelectedOptions(configuredProduct, applyImmediately, nestedOptionModel);\n\t\tminimalProduct.configuration = nestedOptionModel.save(selectedProducts, applyImmediately);\n\t\tminimalProduct.configuration.configurationData = configuredProduct.configuration.configurationData;\n\t\tminimalProduct.configuration.configuredProductId = minimalProduct.record.Id = configuredProduct.record.Id;\n\t\treturn minimalProduct;\n\t}\n\n\tgetSelectedOptions(configuredProduct, skipValidations, nestedOptionModel) {\n\t\tvar selectedOptionList = [];\n\t\tfor (let feature of configuredProduct.features) {\n\t\t\tfor (let [index, option] of feature._transient_.optionConfigurations.entries()) {\n\t\t\t\tif (option.selected) {\n\t\t\t\t\tlet product = this.optionId ? this.topLevelBundle : configuredProduct;\n\t\t\t\t\tif (!skipValidations && option.configurationRequired && option.configured !== true)\n\t\t\t\t\t\tthis.validationMessages = [this.i18n.l('Some or all options require further configuration. Look for configuration icon next to options that must be configured.')];\n\t\t\t\t\tif (option.isUpgrade) {\n\t\t\t\t\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, configuredProduct.options, option);\n\t\t\t\t\t\toptionUpgradeHandler.setUpgradedAssetId();\n\t\t\t\t\t}\n\t\t\t\t\tlet clonedOption = JSON.parse(JSON.stringify(option));\n\t\t\t\t\tthis.buildOptionForLineEditor(clonedOption, selectedOptionList);\n\t\t\t\t}\n\t\t\t\telse if (nestedOptionModel) {\n\t\t\t\t\tnestedOptionModel.remove(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selectedOptionList;\n\t}\n\n\tbuildOptionForLineEditor(clonedOption, array) {\n\t\t// Ascending/Descending Product Rules requires building the nested configurations whenever you save at each level\n\t\tclonedOption.optionConfigurations = clonedOption.optionConfigurations || [];\n\t\tclonedOption.optionId = clonedOption.record.Id;\n\t\tclonedOption.optionData = clonedOption.record;\n\t\tif(clonedOption.configurationData === undefined)\n\t\t\tclonedOption.configurationData = {};\n\t\tclonedOption.isDynamicOption = clonedOption.isDynamicOption || clonedOption.isUpgrade;\n\t\tdelete clonedOption.record;\n\t\tarray.push(clonedOption);\n\t}\n\n\tcreateQueryParams(queryParams, tabIndex) {\n\t\tlet params = this.ctx.params;\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\telse\n\t\t\tqueryParams.pId = this.getAllProductIds();\n\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\n\t\tif (queryParams.oId) {\n\t\t\tqueryParams.qId = params.qId;\n\t\t\tif (queryParams.oId === 'none')\n\t\t\t\tdelete queryParams.oId;\n\t\t}\n\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\telse if (params.pId != null && typeof params.pId !== 'string' && params.pId.length > 1)\n\t\t\tqueryParams.productIdx = 0;\n\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\n\t\tif (queryParams.ignoreCache == null && params.ignoreCache)\n\t\t\tqueryParams.ignoreCache = false;\n\n\t\tif (tabIndex || tabIndex == 0)\n\t\t\tqueryParams.tab = tabIndex;\n\t\telse if (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\tgetAllProductIds() {\n\t\tlet ids = [];\n\t\tfor(let product of this.currentTarget.configuredProducts)\n\t\t\tids.push(product.record.Id);\n\t\treturn ids.join();\n\t}\n\n\tcreatePathParams(redirectUrl) {\n\t\tif (this.optionId !== '')\n\t\t\treturn ['product', 'pc'];\n\t\treturn redirectUrl === 'ProductLookup' ? ['product', 'lookup'] : ['quote', 'le'];\n\t}\n\n\ttoggle() {\n\t\tif (this.viewport.isMobile() && this.hasMultipleBundles)\n\t\t\tthis.$.bundles.toggle();\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles) {\n\t\treturn viewport.isMobile() && hasMultipleBundles;\n\t}\n\n\tgetRequiredConfigurationAttributes() {\n\t\tif (this.requiredConfigAttributes)\n\t\t\treturn this.requiredConfigAttributes;\n\n\t\tlet configuredProducts = this.currentTarget.configuredProducts,\n\t\t\trequiredConfigAttributes = {};\n\n\t\t// loop through each product being configured and store by the product index\n\t\t// an array of unique target fields that map to the product's required configuration attributes\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigAttributes = configuredProducts[i].configurationAttributes;\n\t\t\tlet requiredProductConfigAttributes = {};\n\t\t\t// loop through all configuration attributes for this product to store unique target fields for any required configuration attributes\n\t\t\tfor (let j = 0, ll = productConfigAttributes.length; j < ll; j++) {\n\t\t\t\tlet productConfigAttribute = productConfigAttributes[j];\n\t\t\t\t// ensure configuration attribute is required, and the required attribute's target field has not already been set\n\t\t\t\tif (productConfigAttribute.required === true && Object.keys(requiredProductConfigAttributes).indexOf(productConfigAttribute.targetFieldName) === -1)\n\t\t\t\t\trequiredProductConfigAttributes[productConfigAttribute.targetFieldName] = productConfigAttribute;\n\t\t\t}\n\t\t\trequiredConfigAttributes[i] = requiredProductConfigAttributes;\n\t\t}\n\t\tthis.requiredConfigAttributes = requiredConfigAttributes;\n\t\treturn this.requiredConfigAttributes;\n\t}\n\n\tconfigurationAttributesValid() {\n\t\t// required configurations is a map by product index\n\t\t// whose value is an array of unique target fields that map to that product's required configuration attributes\n\t\tlet requiredConfigurations = this.getRequiredConfigurationAttributes();\n\t\tlet missingAttributes = {};\n\t\t// loop through each product being configured and check if its configuration data\n\t\t// has a non nil value for all of its required configuration attributes' target fields\n\t\tlet configuredProducts = this.currentTarget.configuredProducts;\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigData = configuredProducts[i].configuration.configurationData;\n\t\t\tlet productRequiredConfigAttributes = requiredConfigurations[i];\n\t\t\t// loop through all the target fields that map to this product's required configuration attributes to check if the value has been set\n\t\t\tfor (let attr in productRequiredConfigAttributes) {\n\t\t\t\t// if the required configuration attribute does not have a non nil value on the product's configuration data, then we are not valid\n\t\t\t\tif(!this.requiredConfigurationAttributeValid(productConfigData[attr]))\n\t\t\t\t\tmissingAttributes[attr] = true;\n\t\t\t}\n\t\t}\n\t\tthis.requiredAttributeMissingValue = missingAttributes;\n\t\treturn Object.keys(missingAttributes).length === 0; // no keys means no missing required attributes\n\t}\n\n\t/**\n\t * @returns {string} return a string of comma separated feature names\n\t */\n\tgetConfigurationAttributeMissingFeaturesMessage() {\n\t\tlet featuresWithRequiredMissingAttributes = {};\n\t\tif (this.requiredAttributeMissingValue === undefined)\n\t\t\tthis.getRequiredConfigurationAttributes();\n\n\t\tfor(let attrs in this.requiredConfigAttributes) {\n\t\t\tfor (let attr in this.requiredConfigAttributes[attrs]) {\n\t\t\t\tif(this.requiredAttributeMissingValue[attr] !== true)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet featureName = this.getFeatureNameFromId(this.requiredConfigAttributes[attrs][attr].featureId);\n\t\t\t\tif(featureName === undefined)\n\t\t\t\t\tcontinue;\n\t\t\t\tfeaturesWithRequiredMissingAttributes[featureName] = undefined; //storing as an object so we don't have duplicate feature names\n\t\t\t}\n\t\t}\n\t\tlet featureNames = Object.keys(featuresWithRequiredMissingAttributes);\n\t\tif(featureNames.length === 0)\n\t\t\treturn ''; //no feature config attributes\n\n\t\treturn ' in the following features: ' + featureNames; //TODO: localize?\n\t}\n\n\t/**\n\t * Returns the name of a feature given it's ID\n\t * @param id a feature id\n\t * @returns {string} return a string of the feature name\n\t */\n\tgetFeatureNameFromId(id) {\n\t\tif(id === undefined)\n\t\t\treturn;\n\n\t\tfor(let prod of this.currentTarget.configuredProducts)\n\t\t\tfor(let feat of prod.features)\n\t\t\t\tif(feat.record.Id === id)\n\t\t\t\t\treturn feat.record.Name;\n\t}\n\n\trequiredConfigurationAttributeValid(value) {\n\t\treturn !this.isNil(value);\n\t}\n\n\tsearch() {\n\t\tthis.$.bundles.toggleSearch();\n\t}\n\n\tsetOptionConfigurationDetails(model) {\n\t\tthis.topLevelBundle = model.currentIndex ? model.configuredProducts[model.currentIndex] : model.configuredProducts[0];\n\t\tif (this.topLevelBundle.nestedOptionModel == null) { // if you accessed this page directly without going through the topLevelBundle, sends you to topLevel if you bypassed\n\t\t\tdelete this.ctx.params.oId;\n\t\t\treturn this.nav('#', this.ctx.params, ['product', 'pc'], false);\n\t\t}\n\n\t\tlet config = this.topLevelBundle.nestedOptionModel.getCurrentLevel();\n\t\tif (this.topLevelBundle.nestedOptionModel && config && config.configured) { // do not set configuration for server if it hasn't been saved in the front end\n\t\t\tthis.$.optionConfigure.featureOptionalSKUs = this.buildDynamicConfigurations(config);\n\t\t\tthis.$.optionConfigure.configuration = config;\n\t\t}\n\t\tif (this.topLevelBundle.nestedOptionModel)\n\t\t\tthis.$.optionConfigure.ignoreCache = this.ctx.params.origin === 'ol' ? false : this.topLevelBundle.nestedOptionModel.descendLevel;\n\t\telse\n\t\t\tthis.$.optionConfigure.ignoreCache = true;\n\t\tthis.$.optionConfigure.product = undefined; //makes certain the observer fires\n\t\tthis.$.optionConfigure.product = this.topLevelBundle;\n\t}\n\n\tbuildDynamicConfigurations(config) {\n\t\t// Build up a featureId:productId list to use in case any of these options are dynamically created\n\t\tlet featureOptionalSKUs = [];\n\n\t\tfor (let optionConfig of config.optionConfigurations) {\n\t\t\tif (!optionConfig.isDynamicOption)\n\t\t\t\tcontinue;\n\n\t\t\tlet optionData = optionConfig.optionData;\n\t\t\tif (optionData.Id && optionData[this.prefix + 'Feature__c'] && optionData[this.prefix + 'OptionalSKU__c'])\n\t\t\t\tfeatureOptionalSKUs.push(optionData[this.prefix + 'Feature__c'] + ':' + optionData[this.prefix + 'OptionalSKU__c'] + ':' + optionData.Id);\n\t\t}\n\t\treturn featureOptionalSKUs;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.configuratorObjects = [this.prefix + 'DiscountSchedule__c', this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.groupKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tgetPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tisNil(value) {\n\t\treturn value == null || value === '';\n\t}\n\n\tloadedModelIsReconfigure(model) {\n\t\treturn !model.quote && model.configuredProducts.length == 1;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n\n\tisReconfigure(model) {\n\t\treturn !(model.selectedProducts);\n\t}\n}\nPolymer(ProductConfig);\n","import {ConfigTree} from 'products/resources/tree/ConfigTree.js';\n\nexport class NestedOptionsModel {\n\tconstructor(configuration, isReconfigure) {\n\t\tthis.init(configuration, isReconfigure);\n\t}\n\n\tinit(configuration, isReconfigure) {\n\t\tthis.path = [];\n\t\tthis.descendLevel = false; // Boolean: Identifies if the user is moving into or out of a nested configuration\n\t\tthis.configTree = new ConfigTree(configuration); //manages nested configuration\n\t\tthis._setConfiguredOptionsObject(isReconfigure); // Map of Path to configured nodeIds\n\t}\n\n\tconfigure(obj) {\n\t\tlet data = this.getLastFromPath(),\n\t\t\tparent = this._getPreviousLevel();\n\t\tobj.index = obj.index || data.index;\n\t\tobj.optionId = obj.optionId || data.optionId;\n\t\tif(this.stagedOption !== undefined) {\n\t\t\tobj.optionData = this.stagedOption.optionData || obj.optionData;\n\t\t\t//It is important to track isDynamicOption here or it can become lost in navigation during initial configuration\n\t\t\tobj.isDynamicOption = this.stagedOption.isDynamicOption || obj.isDynamicOption || false;\n\t\t\tdelete this.stagedOption;\n\t\t}\n\t\tobj = this._updateThenGetSubtree(obj, parent, false);\n\t\tobj.staged = true;\n\t\tobj.configuredOptions = this.getConfiguredOptionsFromPath();\n\t\tthis.descendLevel = false;\n\t\treturn obj;\n\t}\n\n\tsave(optionsToAdd = [], applyImmediately) {\n\t\tlet currentLevel = this.getCurrentLevel();\n\t\tfor (let i = 0, l = optionsToAdd.length; i < l; i++) {\n\t\t\tthis._updateThenGetSubtree(optionsToAdd[i], currentLevel, true, i);\n\t\t}\n\t\tif (!applyImmediately)\n\t\t\tthis._setConfigured(currentLevel);\n\t\treturn currentLevel;\n\t}\n\n\tremove(option) {\n\t\tlet parent = this.getCurrentLevel();\n\t\tif (!parent.getChildren || parent.getChildren().length < 1)\n\t\t\treturn;\n\t\toption.optionId = option.record ? option.record.Id : option.optionId;\n\t\toption.index = option.index || 0;\n\t\tthis._removeSubtree(option, this.getCurrentLevel());\n\t}\n\n\tcancel() {\n\t\tlet currentLevel = this.getCurrentLevel(),\n\t\t\tchildren = currentLevel.getChildren(),\n\t\t\ti = 0;\n\t\twhile (i < children.length) {\n\t\t\tif (children[i].staged)\n\t\t\t\tthis._removeConfiguration(currentLevel, i, children[i].nodeId);\n\t\t\telse\n\t\t\t\ti++;\n\t\t}\n\t}\n\n\thandleDescendantRules(configPath, configsToAdd, hiddenOptionIds, disabledOptionIds) {\n\t\tlet level = this.configTree.getFromPath(this.path.concat(configPath)), existingConfigs;\n\t\tif (!level)\n\t\t\treturn;\n\n\t\tlet indices = {};\n\t\texistingConfigs = level.getChildren();\n\t\t// add all specified nested configurations\n\t\tconfigsToAdd.forEach( config => {\n\t\t\tindices[config.optionId] = indices[config.optionId] === undefined ? 0 : (indices[config.optionId] + 1);\n\t\t\tconfig.index = indices[config.optionId];\n\t\t\tlet existingConfig = existingConfigs.find( existing => {\n\t\t\t\treturn this._buildId(config) === existing.nodeId;\n\t\t\t});\n\t\t\tif (existingConfig === undefined) {\n\t\t\t\tthis.configTree.buildSubtree(config);\n\t\t\t\texistingConfigs.push(config);\n\t\t\t}\n\t\t});\n\t\t// remove all unspecified nested configurations\n\t\texistingConfigs.forEach( config => {\n\t\t\tlet configToAdd = configsToAdd.find( configToAdd => {\n\t\t\t\treturn config.nodeId === this._buildId(configToAdd);\n\t\t\t});\n\t\t\tif (configToAdd === undefined)\n\t\t\t\tthis._removeSubtree(config, level);\n\t\t});\n\t\tlevel = this._propagateRuleData(level, disabledOptionIds, hiddenOptionIds);\n\t}\n\n\tgetCurrentLevel() {\n\t\treturn this.configTree.getFromPath(this.path);\n\t}\n\n\taddToPath(id, sku, index, tabIndex) {\n\t\tthis.path.push({optionId: id, optionalSKU: sku, index: index, tabIndex: tabIndex });\n\t\tthis.descendLevel = true;\n\t}\n\n\tpopFromPathAndGetNextSKU() {\n\t\tthis.path.pop();\n\t\tthis.descendLevel = false;\n\t\tlet optionInfo = this.getLastFromPath();\n\t\treturn optionInfo ? optionInfo.optionalSKU : optionInfo;\n\t}\n\n\tgetLastFromPath() {\n\t\treturn this.path[this.path.length-1];\n\t}\n\n\tgetConfiguredOptionsFromPath() {\n\t\treturn this.configuredOptions[this._buildPathString(true)] || {};\n\t}\n\n\t_getPreviousLevel() {\n\t\treturn this.configTree.getFromPath(this.path.slice(0, this.path.length-1));\n\t}\n\n\t_setConfiguredOptionsObject(isReconfigure) {\n\t\tthis.configuredOptions = {};\n\t\tif (!isReconfigure)\n\t\t\treturn;\n\t\tthis._addConfigsToConfigurationObject(this.configTree.root, []); // on reconfigure, flag every configuration in tree as configured\n\t\tthis.configTree.root.configuredOptions = this.getConfiguredOptionsFromPath();\n\t}\n\n\t_addConfigsToConfigurationObject(configuration, path) {\n\t\tconfiguration.getChildren().forEach( nestedConfig => {\n\t\t\tlet obj = {'optionId': nestedConfig.optionId, 'index': nestedConfig.index};\n\t\t\tthis._addConfigsToConfigurationObject(nestedConfig, path.concat([obj]));\n\t\t});\n\t\tthis._setConfigured(configuration, path);\n\t}\n\n\t_setConfigured(configuration, path) {\n\t\tlet key = this._buildPathString(false, path);\n\t\tconfiguration.configured = true;\n\t\tconfiguration.configurationEntered = true;\n\t\tif (key) {\n\t\t\tthis.configuredOptions[key] = this.configuredOptions[key] || {};\n\t\t\tthis.configuredOptions[key][configuration.nodeId] = true;\n\t\t}\n\t}\n\n\n\t_updateThenGetSubtree(obj, parent, onSave, index) {\n\t\tlet existingObj = this._findOnLevel(obj, parent);\n\t\tif (!existingObj) {\n\t\t\tthis._appendSubtree(obj, parent, index);\n\t\t\treturn obj;\n\t\t} else {\n\t\t\tthis._updateSubtree(existingObj, obj, onSave);\n\t\t\treturn existingObj;\n\t\t}\n\t}\n\n\t/**\n\t * Sets properties on client configuration object from updated configuration\n\t * @param existingObj {Object} - Client-side configuration object already present in configuration tree\n\t * @param obj {Object} - Configuration object returned from server on a configuration event or updated from client by user or product rules\n\t * @param onSave {Boolean} - True when saving, false when not saving\n\t * @private\n\t */\n\t_updateSubtree(existingObj, obj, onSave) {\n\t\tif (onSave) {\n\t\t\tdelete existingObj.staged;\n\t\t\texistingObj.optionData = obj.optionData;\n\t\t\texistingObj.externalConfigurationData = obj.externalConfigurationData;\n\t\t}\n\t\tthis._propagateRuleData(existingObj, obj.disabledOptionIds, obj.hiddenOptionIds);\n\t\tthis._propagateAttributes(existingObj.configurationData, obj.configurationData);\n\t\tthis._mergeNestedConfigurations(obj, existingObj);\n\t}\n\n\t/**\n\t * Recursively sets properties on nested configurations present in the configuration tree\n\t * @param obj {Object} - Client-side configuration object already present in configuration tree\n\t * @param existingObj {Object} - Configuration object returned from server on a configuration event or updated from client by user or product rules\n\t * @private\n\t */\n\t_mergeNestedConfigurations(obj, existingObj) {\n\t\tif (obj.optionConfigurations.length > 0) {\n\t\t\tlet indices = {};\n\t\t\tobj.optionConfigurations.forEach( nestedConfig => {\n\t\t\t\tindices[nestedConfig.optionId] = indices[nestedConfig.optionId] === undefined ? 0: indices[nestedConfig.optionId] + 1;\n\t\t\t\tnestedConfig.index = indices[nestedConfig.optionId];\n\t\t\t\tnestedConfig.selected = true;\n\t\t\t\tthis._updateThenGetSubtree(nestedConfig, existingObj, false);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Product Configuration might already have disabled or hidden optionIds if it has been pre-selected and loaded\n\t * with the initial Product Model. Don't override those values, otherwise use the current product configuration.\n\t * @param productConfiguration {Object} - Client-side configuration object already present in configuration tree\n\t * @param disabledOptionIds {Array|Id} - Array of product Ids to disable\n\t * @param hiddenOptionIds {Array|Id} - Array of product Ids to hide\n\t * @private\n\t */\n\t_propagateRuleData(productConfiguration, disabledOptionIds, hiddenOptionIds) {\n\t\tproductConfiguration.disabledOptionIds = productConfiguration.disabledOptionIds || disabledOptionIds;\n\t\tproductConfiguration.hiddenOptionIds = productConfiguration.hiddenOptionIds || hiddenOptionIds;\n\t}\n\n\t/**\n\t * Sets default configuration attribute values from server configuration if they were not previously defined on the client configuration\n\t * @param productConfigurationData {Object} - Attributes of client-side configuration object already present in configuration tree\n\t * @param configurationData {Object} - Map of configuration attribute field APIs to attribute values\n\t * @private\n\t */\n\t_propagateAttributes(productConfigurationData, configurationData) {\n\t\tObject.keys(configurationData).forEach( attribute => {\n\t\t\tproductConfigurationData[attribute] = productConfigurationData[attribute] || configurationData[attribute];\n\t\t});\n\t}\n\n\t/**\n\t * Builds hierarchical tree with product configurations below the current configuration.\n\t * Adds current configuration to the parent's list of children.\n\t * @param obj\n\t * @param parent\n\t * @param index\n\t * @private\n\t */\n\t_appendSubtree(obj, parent, index) {\n\t\tthis._addIndexProperty(obj, parent);\n\t\tthis.configTree.buildSubtree(obj);\n\t\tif (index != undefined) {\n\t\t\tparent.getChildren().splice(index, 0, obj);\n\t\t} else {\n\t\t\tparent.getChildren().push(obj);\n\t\t}\n\t}\n\n\t_removeSubtree(child, parent) {\n\t\tlet childIndex = this._getChildIndexAndAdjustIndices(child.optionId, child.index, parent.getChildren());\n\t\tif (childIndex >= 0) {\n\t\t\tthis._removeConfiguration(parent, childIndex, this._buildId(child));\n\t\t}\n\t}\n\n\t_removeConfiguration(parent, index, childId) {\n\t\tlet key = this._buildPathString(true);\n\t\tparent.getChildren().splice(index, 1);\n\t\tif (key && this.configuredOptions[key] && this.configuredOptions[key][childId] && !this._findOnLevel(childId, parent)) {\n\t\t\tdelete this.configuredOptions[key][childId];\n\t\t}\n\t}\n\n\t_findOnLevel(idProperties, parent) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\treturn parent.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n\n\t_addIndexProperty(obj, parent) {\n\t\tlet i = obj.index || 0;\n\t\twhile (this._findOnLevel({'optionId': obj.optionId, 'index': i}, parent)) {\n\t\t\ti++;\n\t\t}\n\t\tobj.index = i;\n\t}\n\n\t_getChildIndexAndAdjustIndices(optionId, index, children) {\n\t\tlet i = 0,\n\t\t\tchildIndex = -1,\n\t\t\tid = this._buildId({'optionId': optionId, 'index': index});\n\t\tfor (let child of children) {\n\t\t\tif (child.nodeId === id)\n\t\t\t\tchildIndex = i;\n\t\t\telse if (child.optionId === optionId && child.index > index)\n\t\t\t\tthis._alterIndexPropertyAndNodeId(child);\n\t\t\ti++;\n\t\t}\n\t\treturn childIndex;\n\t}\n\n\t_alterIndexPropertyAndNodeId(obj) {\n\t\tlet prevId = obj.nodeId;\n\t\tobj.index--;\n\t\tobj.nodeId = this._buildId(obj);\n\n\t\tlet key = this._buildPathString(true);\n\t\tif (key && this.configuredOptions[key]) {\n\t\t\tthis.configuredOptions[key][obj.nodeId] = true;\n\t\t\tdelete this.configuredOptions[key][prevId];\n\t\t}\n\t}\n\n\t_buildId(obj) {\n\t\treturn '_' + obj.optionId + '_' + obj.index;\n\t}\n\n\t_buildPathString(includeLast, path = this.path) {\n\t\tlet string = this.configTree.root.nodeId,\n\t\t\tn = includeLast ? 0 : 1;\n\t\tfor (let i = 0; i < path.length - n; i++) {\n\t\t\tstring += ('-' + this._buildId(path[i]));\n\t\t}\n\t\treturn string;\n\t}\n}\n","import {Util} from '../../../../common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Suggester {\n\tconstructor(prefix, searchModel, quoteProcess) {\n\t\tthis.prefix = prefix;\n\t\tthis.searchModel = searchModel;\n\t\tthis.searchFilterData = {};\n\t\tthis.filterContext = quoteProcess;\n\t}\n\n\tbuildFields(fields) {\n\t\tlet gsfields = [];\n\t\tfor (let field of fields) {\n\t\t\tgsfields.push(field.replace('Product2','ProcessInput__c'));\n\t\t}\n\t\treturn gsfields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.prefix + 'ProcessInput__c';\n\t}\n\n\tgetGroupKey(filter) {\n\t\treturn filter.record.Id;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tfor (let id of group) {\n\t\t\tfor (let process of this.searchModel.quoteProcess.inputs) {\n\t\t\t\tif (process.record.Id === id) {\n\t\t\t\t\tif (!this.searchModel.processInputValues[id]) {\n\t\t\t\t\t\t//do nothing here; just skip code in following else if\n\t\t\t\t\t}\n\t\t\t\t\telse if (searchFilterModel && this.isLookupType(searchFilterModel[id].model.type) && this.searchModel.processInputValues[id][this.prefix + 'Value__c'])\n\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(this.searchModel.processInputValues[id][this.prefix + 'Value__c'], searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\tlet value = null;\n\t\t\t\t\tif (this.searchModel.processInputValues[id])\n\t\t\t\t\t\tvalue = this.searchModel.processInputValues[id][this.prefix + 'Value__c'] || null;\n\t\t\t\t\telse\n\t\t\t\t\t\tvalue = process.record[process.record[this.prefix + 'InputField__c']] || null;\n\t\t\t\t\tsearchFilterData[id] = {value: value, hidden: false, field: process.targetFieldName};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif (!searchFilter.value)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\t\tthis.evaluateProcessInputConditions();\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetFilterContext() {\n\t\tlet quoteProcess = JSON.parse(JSON.stringify(this.filterContext));\n\t\tfor (let input of quoteProcess.inputs) {\n\t\t\tif (this.searchFilterData[input.record.Id].hidden) {\n\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\tinput.hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.searchFilterData[input.record.Id]) {\n\t\t\t\tif (this.searchFilterData[input.record.Id].value === '')\n\t\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\telse\n\t\t\t\t\tinput.record[input.targetFieldName] = this.searchFilterData[input.record.Id].value;\n\t\t\t}\n\t\t}\n\n\t\tlet length = quoteProcess.inputs.length;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tif (quoteProcess.inputs[i].hidden)\n\t\t\t{\n\t\t\t\tquoteProcess.inputs.splice(i, 1);\n\t\t\t\tlength--;\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn quoteProcess;\n\t}\n\n\tgetAdditionalProperties() {\n\t\treturn null;\n\t}\n\n\tevaluateProcessInputConditions() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.searchFilterData));\n\t\tfor (let input of this.filterContext.inputs) {\n\t\t\tlet numPass = 0;\n\t\t\tif(input.conditions.length === 0) {\n\t\t\t\tsearchFilterData[input.record.Id].hidden = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (let condition of input.conditions) {\n\t\t\t\tlet masterProcessInput = condition[this.prefix + 'MasterProcessInput__c'];\n\t\t\t\tlet masterProcessInputValue = searchFilterData[masterProcessInput].value;\n\t\t\t\tif (Util.arithmeticOperatorConversion(masterProcessInputValue, condition[this.prefix + 'Value__c'], condition[this.prefix + 'Operator__c']))\n\t\t\t\t\tnumPass++;\n\t\t\t}\n\t\t\tif (input.record[this.prefix + 'ConditionsMet__c'] === 'All')\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass === input.conditions.length);\n\t\t\telse\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass > 0);\n\t\t}\n\t\tthis.searchFilterData = searchFilterData;\n\t\treturn searchFilterData;\n\t}\n\n\trunOnLoad() {\n\t\tlet Ids = [];\n\t\tfor (let input of this.searchModel.quoteProcess.inputs) {\n\t\t\tIds.push(input.record.Id);\n\t\t}\n\t\tthis.setDefaultFilterValues(Ids);\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n}","import {Page} from 'common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {Suggester} from 'products/selection/filter/sb-suggester/Suggester.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {RuleExecutor} from 'common/rules/RuleExecutor.js';\nconst PANELS = [ '#gslayout', '#pflayout' ];\n\nexport class ProductLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\thiddenByGroup: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// errors for services\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t// error for sb-toast\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t},\n\t\t\tsearchContext: String, //the value in the searchBar\n\t\t\tsearchedValue: String, //the value last searched\n\t\t\tfilterContext: Object, //the filter panel filters\n\t\t\tsearcher: Object\n\t\t}, Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'handleAutoSelect(searchModel)',\n\t\t\t'modal(quote, modalActive)',\n\t\t\t'handleValueChanged(searchFilterData.*)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tmodal() {\n\t\tif (!this.modalActive && this.hasQuoteProcess) {\n\t\t\tthis.$.selectionSaver.save({uid: this.quote.record.Id, model: {modalActive: true}});\n\t\t\tthis.toggleClass('modaloverflow', true, this);\n\t\t\tthis.$.modal.show = true;\n\t\t\tthis.refocus();\n\t\t} else {\n\t\t\tif (!this.hasQuoteProcess) {\n\t\t\t\tthis.setPanelDisplay('#pflayout');\n\t\t\t}\n\n\t\t\tif (this.lineEditorModel.settings.openSearchFilterByDefault === true)\n\t\t\t\tthis.toggleFilter();\n\n\t\t\tthis.panelSuggester = this.suggester;\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis.handleClearSelected();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.modal.addEventListener('sb-gs-modal-close', this.closeDialog.bind(this));\n\t\tthis.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.$.modal.addEventListener('filter-item-value-changed', this.handleLabelChanged.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t\tthis.addEventListener('clear-filters', this.clearFilterFields);\n\t\tthis.addEventListener('sb-type-clear', this.resetSearchBar);\n\t\tthis.attachSearchBarEventListeners();\n\t\t//this.initMobileSearchBar();\n\t}\n\n\thandleTransientCache() {\n\t\t//TODO: run the filter on initial searchModel retrieval, don't need 2 server requests for a searchModel on page load\n\t\t//this applies a previously cached filter when returning to the page\n\t\tthis.$.selectionReader.read({uid: this.quote.record.Id}).then(function (response) {\n\t\t\tthis.lastSubmit = response ? response.lastSubmit : null;\n\t\t\tthis.modalActive = response ? response.modalActive : false;\n\t\t\tif (this.lastSubmit === 'gs') {\n\t\t\t\tthis.suggester.runOnLoad();\n\t\t\t\tthis.runSuggester();\n\t\t\t}\n\t\t\telse if (this.lastSubmit === 'pf') {\n\t\t\t\tthis.searcher.runOnLoad(response.filterValues);\n\t\t\t\tthis.runSearcher();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.inputField = this.prefix + 'InputField__c'; //handle record property for guided selling inputs\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\t\tlet groupKey = parseInt(this.ctx.params.groupKey),\n\t\t\t\tquoteProcessId = this.getQuoteProcessId(this.quote, groupKey);\n\t\t\tthis.hasQuoteProcess = (quoteProcessId !== null);\n\t\t\t//this loads either the guided selling or product filter panel when the page loads\n\t\t\tif (this.hasQuoteProcess === true)\n\t\t\t\tthis.setPanelDisplay('#gslayout');\n\t\t\telse\n\t\t\t\tthis.setPanelDisplay('#pflayout');\n\t\t\tif (this.ctx.params.aId)\n\t\t\t\tthis.$.smLoadService.actionId = this.ctx.params.aId;\n\t\t\tthis.$.smLoadService.processId = quoteProcessId;\n\t\t\tthis.$.smLoadService.quote = this.$.smSelectService.quote = this.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\n\t\t\t//disable filter panel button if no visible filters\n\t\t\tthis.setFilterButtonState(searchModel);\n\t\t\tif (!this.onLoadSearchModel)\n\t\t\t\tthis.onLoadSearchModel = Object.assign({}, searchModel); //save a version of the searchModel.  useful if we need to revert back to it\n\t\t\tthis.$.lookupLayout.groupByField = searchModel.productResultsGroupFieldName; //Setting for allowing the product results to be grouped by a column\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.'; //todo add good comment here\n\t\t\tthis.quoteProcess = searchModel.quoteProcess; //detach quoteProcess from the searchModel so it isn't overwritten by null when service returns\n\t\t\tthis.searchModel = searchModel;\n\t\t\tthis.buildDelegator();\n\t\t\tthis.handleTransientCache();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Sets a Quote Process ID by the following priority, based on the quoteVO:\n\t * Group -> Quote -> null (if neither has a Quote Process)\n\t * @param quote quoteVO that is passed in\n\t * @param groupKey key of a group, if the event originates from a group\n\t * @returns {*|null}\n\t */\n\tgetQuoteProcessId(quote, groupKey) {\n\t\tlet groupProcessId;\n\t\tfor (let group of quote.lineItemGroups) {\n\t\t\tif(group.key === groupKey) {\n\t\t\t\tgroupProcessId = group.record[this.prefix + 'QuoteProcess__c'];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn groupProcessId || quote.record[this.prefix + 'QuoteProcessId__c'] || null;\n\t}\n\n\t//initMobileSearchBar() {\n\t//\tif(this.isMobileViewport() === false)\n\t//\t\treturn;\n\t//\n\t//\tthis.$.headersearch.showResetButton = true;\n\t//\tthis.$.headersearch.hideCancelIcon = true;\n\t//\t//if mobile, add an event listener to the focus of the search bar\n\t//\t//then open a dialog\n\t//\tthis.$.headersearch.addEventListener('sb-type-focus', function(){\n\t//\t\tthis.fire('iron-signal', {name: 'sb-open-search-bar-dialog', data: {\n\t//\t\t\tvalue: this.searchContext,\n\t//\t\t\tquote: this.quote\n\t//\t\t}});\n\t//\t}.bind(this))\n\t//}\n\n\tattachSearchBarEventListeners() {\n\t\tthis.addEventListener('sb-search-invoked', this.searchBarResultsChanged.bind(this));\n\t\tthis.addEventListener('sb-search-item-selected', this.searchBarItemSelected.bind(this));\n\t\tthis.addEventListener('sb-search-reset-clicked', this.searchBarResetClicked.bind(this));\n\t\tthis.addEventListener('sb-search-nil-search-invoked', this.searchBarNilSearchInvoked.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tthis._updateQuote(e.detail.value.quote);\n\t\t\tif (e.detail.value.configuredProducts.length == 0) {\n\t\t\t\tthis.handleNonConfigurableProducts(e);\n\t\t\t}\n\t\t\tif (e.detail.value.configuredProducts.length > 0) {\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleNonConfigurableProducts(e) {\n\t\tif (this.redirectUrl === 'LineEditor') {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t\telse if (this.redirectUrl === 'ProductLookup') {\n\t\t\tthis.$.smSelectService.quote = e.detail.value.quote;\n\t\t\tthis.$.lookupLayout.deSelectAll();\n\t\t\tthis.navigateToSelf();\n\t\t\tthis.spinner = false;\n\t\t}\n\t}\n\n\thandleConfigurableProducts(e) {\n\t\tlet queryParams = {};\n\t\te.detail.value.selectedProducts = this.selectedProducts;\n\t\tlet configProductIds = this.getConfigProductIds(e);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tif(this.ctx.params.aId !== undefined)\n\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\tqueryParams.pId = configProductIds;\n\t\tqueryParams.redirectUrl = this.redirectUrl;\n\t\tqueryParams.open = 0;\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\t_updateQuote(responseQuote) {\n\t\tif (responseQuote.partialVO) {\n\t\t\t// If the response quote was a partial VO, then it means we need to compare the new VO with the old one,\n\t\t\t// and combine the data from both.\n\t\t\tvar originalLines = this.lineEditorModel.quote.lineItems;\n\t\t\t// Append the new line items onto the existing ones.\n\t\t\tresponseQuote.lineItems = originalLines.concat(responseQuote.lineItems);\n\t\t\t// Delete all of the temporary attributes we added to the partial VO, and stop marking it as a partial VO.\n\t\t\tdelete responseQuote.existingProductIds;\n\t\t\tdelete responseQuote.segmentTemplatesByDimensionTypeByGroupKey;\n\t\t\tdelete responseQuote.emptyGroupKeys;\n\t\t\tresponseQuote.partialVO = false;\n\t\t}\n\t\tthis.lineEditorModel.quote = responseQuote;\n\t}\n\n\thandleLabelChanged(e) {\n\t\tif(this.searchFilterData) // only defined in a guided selling use case\n\t\t\tthis.searchFilterData[e.detail.item].label = e.detail.value;\n\t}\n\n\tbuildDelegator() {\n\t\tif (this.hasQuoteProcess) {\n\t\t\tthis.suggester = new Suggester(this.prefix, this.searchModel, this.quoteProcess);\n\t\t}\n\t\tif (!this.searcher)\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t}\n\n\thandleValueChanged() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tthis.internal = true;\n\t\tthis.updateSearchFilterData();\n\t\tthis.internal = false;\n\t}\n\n\tupdateSearchFilterData() {\n\t\tthis.suggester.searchFilterData = this.searchFilterData;\n\t\tlet searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t\tthis.searchFilterData = searchFilterData;\n\t}\n\n\tsetPanelDisplay(visiblePanel) {\n\t\tPANELS.forEach((panel) => {\n\t\t\tconst isVisible = visiblePanel === panel;\n\t\t\tthis.toggleClass('hidden-panel', !isVisible, this.$$(panel));\n\t\t\tthis.toggleClass('visible-panel', isVisible, this.$$(panel));\n\t\t});\n\t}\n\n\ttoggleFilter() {\n\t\tthis.togglePanel('pflayout');\n\t}\n\n\ttoggleGuidedSelling() {\n\t\tthis.togglePanel('gslayout');\n\n\n\t}\n\n\ttogglePanel(panel) {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tif (this.$$('.visible-panel').id === panel || this.$.drawer.selected === 'main')\n\t\t\tthis.$.drawer.togglePanel();\n\t\tthis.setPanelDisplay('#' + panel);\n\t\tthis.refocus();\n\t}\n\n\tcloseDrawer() {\n\t\t// W-4820156: In Safari only, searching while the cursor is focused on any filter except the first one\n\t\t// will cause the lookup layout iron list to be moved to the side, cutting off columns including the selection\n\t\t// checkbox, making it impossible to proceed. Todo: implement a more robust fix\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\trefocus() {\n\t\tif (!this.$$('.visible-panel'))\n\t\t\treturn;\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.modalGroup.focusFirstField();\n\t\telse if (this.$$('.visible-panel').id === 'gslayout')\n\t\t\tthis.$.gs.focusFirstField();\n\t\telse if (this.$$('.visible-panel').id === 'pflayout')\n\t\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tif (!this.$$('.visible-panel'))\n\t\t\treturn;\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.suggest.focus();\n\t\telse if (this.$$('.visible-panel').id === 'gslayout')\n\t\t\tthis.$.cleargs.focus();\n\t\telse if (this.$$('.visible-panel').id === 'pflayout')\n\t\t\tthis.$.clearfilter.focus();\n\t}\n\n\tcloseDialog() {\n\t\tthis.toggleClass('modaloverflow', false, this);\n\t\t//build guided selling panel\n\t\t//todo: make this html property instead of object property\n\t\tthis.suggester.skipDefaults = true;\n\t\tthis.panelSuggester = this.suggester;\n\t\tif (!this.panelGroupItems)\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\tthis.$.modal.show = false;\n\t}\n\n\tsuggestClicked() {\n\t\tthis.suggest = true;\n\t\tthis.runSuggester();\n\t}\n\n\trunSuggester() {\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'gs';\n\t\tthis.closeDialog();\n\t\tthis.$.gs.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\trunSearcher() {\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.actionId = this.ctx.params.aId;\n\t\tthis.searchContext = this.searchedValue;\n\t\tthis.filterContext = this.$.pf.filterDelegator.getFilterContext(); //store the filter values in a property\n\t\tthis.$.pf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\tsaveCache() {\n\t\tthis.$.selectionSaver.save({\n\t\t\tuid: this.quote.record.Id, model: {\n\t\t\t\tmodalActive: true,\n\t\t\t\tlastSubmit: this.$$('.visible-panel').id.substring(0, 2),\n\t\t\t\tfilterValues: this.searcher.searchFilterData\n\t\t\t}\n\t\t});\n\t}\n\n\tsetFilterButtonState(searchModel) {\n\t\tif (searchModel.searchFilters.length === 0) {\n\t\t\tthis.removeFilter();\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let filter of searchModel.searchFilters) {\n\t\t\tif (!filter.hidden)\n\t\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.removeFilter();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('#fb').disabled = true;\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tonSelect() {\n\t\tthis.redirectUrl = 'LineEditor';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis._addAggregateDataIfThresholdExceeded();\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t}\n\n\tonSelectMore() {\n\t\tthis.redirectUrl = 'ProductLookup';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis._addAggregateDataIfThresholdExceeded();\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToSelf();\n\t\t}\n\t}\n\n\t_addAggregateDataIfThresholdExceeded() {\n\t\tlet stripLinesThreshold = this.lineEditorModel.settings.largeQuoteThreshold;\n\t\tif (stripLinesThreshold != null && this.quote.lineItems.length > stripLinesThreshold) {\n\t\t\tthis.$.smSelectService.stripQuoteLines = true;\n\t\t\tlet lineOmissionMsg = this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;\n\t\t\tlineOmissionMsg = lineOmissionMsg\n\t\t\t\t.replace('{0}', this.lineEditorModel.quote.record.Id)\n\t\t\t\t.replace('{1}', stripLinesThreshold);\n\t\t\tconsole.log(lineOmissionMsg);\n\t\t\tlet qla = new QuoteLineAggregator(this.quote);\n\t\t\t// We need existing product IDs to handle upgrades\n\t\t\tthis.quote.existingProductIds = qla.getExistingProductIdsFromLines();\n\t\t\tlet groupKey = this.ctx.params.groupKey;\n\t\t\tlet mdqTemplatesByDimensionType = qla.getSegmentTemplatesByDimensionTypeForGroupKey(groupKey);\n\t\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey = {};\n\t\t\t// For adding MDQ lines, we will attempt to use existing lines as a template if there are any such lines.\n\t\t\t// This is important because it lets us know exactly how many segments we need to add, and what we need to label\n\t\t\t// them. It also lets us know how many custom segments we're supposed to add, since we're supposed to add\n\t\t\t// segments equal to the current number of custom segments.\n\t\t\t// Since you can only add products to one group at a time, we map it according to the target group key, or -1\n\t\t\t// if there is no target group.\n\t\t\tthis.quote.segmentTemplatesByDimensionTypeByGroupKey[(groupKey || -1) + ''] = mdqTemplatesByDimensionType;\n\t\t\tthis.quote.emptyGroupKeys = qla.getKeysOfEmptyGroups();\n\t\t}\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let orderedSelectedProductId of orderedSelectedProductIds) {\n\t\t\tlet selectedProduct = this.selectedProducts[orderedSelectedProductId];\n\n\t\t\t// do no save invalid products\n\t\t\tif(selectedProduct.invalid)\n\t\t\t\tcontinue;\n\n\t\t\t// UnitPrice is added to avoid looping through all the pricebook entries, but we do not need the information in the server.\n\t\t\tdelete selectedProduct.record.UnitPrice;\n\t\t\torderedSelectedProducts.push(selectedProduct);\n\t\t}\n\t\treturn orderedSelectedProducts;\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {'qId': this.quote.record.Id};\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet queryParams = {'qId': this.quote.record.Id };\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToSelf() {\n\t\tlet actionIdQueryString = this.ctx.params.aId ? ('&aId=' + this.ctx.params.aId) : '';\n\t\tthis.fire('iron-signal', {\n\t\t\tname: 'sb-navigation-changed', data: {\n\t\t\t\turl: '#', location: '#/product/lookup?qId=' + this.quote.record.Id + actionIdQueryString\n\t\t\t}\n\t\t});\n\t\tthis.$.plSelectMore.blur();\n\t}\n\n\tnavToFavorites() {\n\t\tlet params = {qId: this.quote.record.Id};\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tparams.groupKey = this.ctx.params.groupKey;\n\t\tif (this.ctx.params.aId !== undefined)\n\t\t\tparams.aId = this.ctx.params.aId;\n\t\tthis.nav('#', params, ['favorite', 'lookup'], false);\n\t}\n\n\thandleAutoSelect() {\n\t\tif (this.suggest && this.quoteProcess && this.quoteProcess.record[this.prefix + 'ProductAutoSelected__c'] && this.searchModel.results.length === 1)\n\t\t{\n\t\t\tlet result = this.searchModel.results[0];\n\t\t\tthis.selectedProducts[result.record.Product2Id] = {\n\t\t\t\trecord: {Id: result.record.Product2Id, attributes: result.record.attributes, UnitPrice: result.record.UnitPrice},\n\t\t\t\tinvalid: false\n\t\t\t};\n\t\t\tthis.suggest = false;\n\t\t\tthis.onSelect();\n\t\t}\n\t}\n\n\thandleClearSelected() {\n\t\tthis.addEventListener('suggestion-loaded', function () {\n\t\t\tthis.$.lookupLayout.deSelectAll();\n\t\t}.bind(this));\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.selected === 'main') {\n\t\t\tthis.fire('iron-signal', {name: 'sb-panel-closed'});\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearGSFields() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.suggester.searchFilterData));\n\t\tfor (let value in searchFilterData) {\n\t\t\tsearchFilterData[value].value = null;\n\t\t}\n\t\tthis.suggester.searchFilterData = searchFilterData;\n\t\tthis.searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t\tthis.$.gs.enterCallback = this.runSuggester.bind(this);\n\t\tthis.$.modalGroup.enterCallback = this.runSuggester.bind(this);\n\t}\n\n\t/**\n\t * this runs when a searchBar performs a search\n\t * this takes that searchModel with those results and applies them to the product lookup list\n\t * the value in the searchBar is also passed so that in mobile it can sync the value from the modal\n\t * @param e\n\t */\n\tsearchBarResultsChanged(e) {\n\t\tlet searchModel = e.detail.searchModel,\n\t\t\tsearchValue = e.detail.searchValue;\n\n\t\tthis.searchContext = searchValue;\n\t\tthis.searchedValue = searchValue;\n\t\tthis.$$('#headersearch').toggleResetButton(true);\n\t\tif(searchModel === undefined)\n\t\t\treturn;\n\n\t\tthis.searchModel = searchModel;\n\t}\n\n\t/**\n\t * this runs when an item is selected from the search drop down\n\t * it takes the result selected and updates the searchModel showing that 1 result\n\t * the value in the searchBar is also passed so that in mobile it can sync the value from the modal\n\t * @param e\n\t */\n\tsearchBarItemSelected(e) {\n\t\tlet item = e.detail.item,\n\t\t\tsearchModel = Object.assign({}, this.searchModel),\n\t\t\tsearchValue = e.detail.searchValue;\n\n\t\tthis.searchContext = searchValue;\n\t\tthis.searchedValue = searchValue; //this is to support keeping the search value there on filter\n\n\t\tif(item === undefined)\n\t\t\treturn;\n\n\t\tthis.$$('#headersearch').toggleResetButton(true);\n\n\t\tsearchModel.results = [item];\n\t\tsearchModel.totalCount = 1;\n\t\tthis.searchModel = searchModel;\n\t}\n\n\tsearchBarResetClicked() {\n\t\tthis.searchContext = ''; //clear the searchBar value\n\t\tthis.searchedValue = '';\n\t\tthis.$$('#headersearch').toggleResetButton(false); //disable the reset button\n\t\tthis.searchModel = Object.assign({}, this.onLoadSearchModel); //set the searchModel back to the model we first got when the page loaded\n\t}\n\n\tsearchBarNilSearchInvoked() {\n\t\tif (this.searcher.hasSearchFilterValues())\n\t\t\tthis.runSearcher();\n\t\telse\n\t\t\tthis.searchBarResetClicked();\n\t}\n\n\tresetSearchBar() {\n\t\tthis.searchContext = ''; //clear the searchBar value\n\t\tthis.searchedValue = '';\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.lookupObjects = ['Product2', 'PricebookEntry', this.prefix + 'ProcessInput__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n}\n\nPolymer(ProductLookup);\n","/**\n * A table cell meant for displaying summary data.\n */\nexport class LESummaryCell {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-cell';\n\t\tthis.properties = {\n\t\t\t// The model where all the data *should* belong.\n\t\t\tmodel: Object,\n\n\t\t\t// The field name of the summary for this field.\n\t\t\titem: String,\n\n\t\t\t// The summaries for the table.\n\t\t\tsummaries: Object,\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_updateCurrency(model, item)',\n\t\t\t'_setWidthStyle(model.colWidth, item)'];\n\t}\n\n\t_getMD(editorModel, item) {\n\t\treturn editorModel.md.fieldsMap[editorModel.data.quoteLineObjectName][item];\n\t}\n\n\t_updateCurrency(model, item) {\n\t\tthis._getMD(model.editorModel, item).CurrencyIsoCode = model.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t}\n\n\t_getValue(summaries, item) {\n\t\treturn summaries[item.toLowerCase()];\n\t}\n\n\t_setWidthStyle(colWidth, item) {\n\t\tthis.style.minWidth = `${colWidth.Standard[item]}px`;\n\t\tthis.style.maxWidth = this.style.minWidth;\n\t}\n}\n\nPolymer( LESummaryCell );\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class GroupTabs {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group-tabs';\n\n\t\tthis.properties = {\n\t\t\tisGroupFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupFieldPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPage(pageType)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildPage(groupModel)'];\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModel) {return;}\n\t\tthis.pageType = this.attributes.label.value;\n\t\tthis.ui3Enabled = AppContext.org.isUI3Enabled || false;\n\t\tthis.pageComponent = this.ui3Enabled ? 'sf-segmented-table' : 'sb-segmented-lines';\n\t\tthis.groupObjectName = this.groupModel.groupObjectName;\n\t\tif (this.groupModel.groupMDQTabs) {\n\t\t\tthis.tabs = this.groupModel.groupMDQTabs;\n\t\t}\n\t\tthis.hideTabs = this.tabs ? this.tabs.length == 1 && this.tabs[0].key != 'Custom' : false;\n\n\t\tthis.containerClass = this.groupModel.editorModel.largeQuoteExperienceEnabled ? 'largeQuote' : '';\n\n\t}\n\n\t_setIsGroupFieldPage(pageType) {\n\t\treturn pageType === \"details\";\n\t}\n\n\t_setIsStandardLinesPage(pageType) {\n\t\treturn pageType === \"standard\";\n\t}\n\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === \"segmented\";\n\t}\n}\n\nPolymer(GroupTabs);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class QuoteTabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-quote-tabs';\n\n\t\tthis.properties = {\n\t\t\tisQuoteFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsQuoteFieldPage(pageType)'\n\t\t\t},\n\t\t\tisGroupsPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupsPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPageUI2: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPageUI2(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPageUI3: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPageUI3(pageType)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tgroupModels: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tui3Enabled: Boolean,\n\t\t\tsegmentedCompName: String\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildPage(groupModels)', '_groupModelsChanged(groupModels.*)'];\n\t}\n\n\t_groupModelsChanged(e) {\n\t\tif (this.groupModels.length == 1 && e.path != 'groupModels' && !this.groupModels[0].quoteModel.grouped) {\n\t\t\t// Remove first two parts of path which are usually groupsModels and then the index\n\t\t\t// Convert groupModels.#0 to groupModel for ungrouped quote\n\t\t\tlet parts = e.path.split('.');\n\t\t\tlet path = parts.splice(2, parts.length).join('.');\n\t\t\tthis.set('groupModel.' + path, e.value);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t\tthis.ui3Enabled = AppContext.org.isUI3Enabled || false;\n\t\tthis.segmentedCompName = this.ui3Enabled ? 'sf-segmented-table' : 'sb-segmented-lines'\n\t}\n\n\tattached() {\n\t\tthis.resize();\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModels)\n\t\t\treturn;\n\n\t\tthis.pageType = this.attributes.label.value;\n\t\tif (this.pageType != 'details' && this.pageType != 'groups') {\n\t\t\tthis.groupModel = this.groupModels[0];\n\t\t\tthis.quoteModel = this.groupModel.quoteModel;\n\t\t}\n\t\tif (this.pageType == 'segmented' && this.groupModel.quoteMDQTabs) {\n\t\t\tthis.segmentedTabs = this.groupModel.quoteMDQTabs;\n\t\t}\n\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t// If it meets the above criteria, do not render the tab\n\t\tthis.hideTabs = this.segmentedTabs ? this.segmentedTabs.length == 1 && this.segmentedTabs[0].key != 'Custom' : false;\n\t\tthis.resize();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\thandleResize() {\n\t\twindow.addEventListener('resize', function(e) {\n\t\t\tthis.resize();\n\t\t}.bind(this));\n\t}\n\n\tresize() {\n\t\tif (this.domHost) {\n\t\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t\t// If it meets the above criteria, do not render the tab\n\t\t\tlet tabHeight = this.domHost.tabs.length == 1 && this.domHost.tabs[0].key != 'Custom'  ? 0 : 43;\n\t\t\tthis.layoutHeight = this.domHost.getBoundingClientRect().height - tabHeight + 'px';\n\t\t\tPolymer.dom(this).parentNode.style.height = this.layoutHeight;\n\t\t}\n\t}\n\n\t_setIsQuoteFieldPage(pageType) {\n\t\treturn pageType === \"details\";\n\t}\n\n\t_setIsGroupsPage(pageType) {\n\t\treturn pageType === \"groups\";\n\t}\n\n\t_setIsStandardLinesPageUI2(pageType) {\n\t\treturn pageType === \"standard\" && !AppContext.org.isUI3Enabled;\n\t}\n\n\t_setIsStandardLinesPageUI3(pageType) {\n\t\treturn pageType === \"standard\" && AppContext.org.isUI3Enabled;\n\t}\n\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === \"segmented\";\n\t}\n}\n\nPolymer(QuoteTabs);","import {Page} from '../../../../common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\nimport {ConnectionClient} from '../../../../common/data/client/ConnectionClient.js';\n\nexport class SubscriptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-subscription-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: String,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = this.$.smLoadService.quote = this.$.smSelectService.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t\tthis.maxSelectAll = (this.lineEditorModel.settings.usesClientAmendRenew) ? 500 : 100;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tlet existingLines = this.lineEditorModel.quote.lineItems;\n\t\t\tthis.lineEditorModel.quote = e.detail.value;\n\t\t\t// If using the JSQC, the Quote was sent without Lines, so we need to add them back here by joining them with the new Lines that were added\n\t\t\tif (this.lineEditorModel.settings.usesClientCalculator) {\n\t\t\t\tthis.lineEditorModel.quote.lineItems = existingLines.concat(this.lineEditorModel.quote.lineItems);\n\t\t\t}\n\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\trefocus() {\n\t\tthis.$.sf.focusFirstField();\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tcloseDrawer() {\n\t\tthis.refocus();\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tthis.spinner = true;\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tif (this.lineEditorModel.settings.usesClientAmendRenew) {\n\t\t\t\treturn new Promise((res, rej) => {\n\t\t\t\t\t// First, check that all of the window has everything we need.\n\t\t\t\t\tif (SB && SB.JSARSettings && SB.JSARServices && SB.JSARLineGenManager) {\n\t\t\t\t\t\t// Initialize our Settings object\n\t\t\t\t\t\tlet settings = new SB.JSARSettings(this.app.orgPrefix, this.lineEditorModel.amendRenewSettings);\n\t\t\t\t\t\t// Get a JSForce connection\n\t\t\t\t\t\tlet client = new ConnectionClient(this.app.orgPrefix);\n\t\t\t\t\t\tclient.getConnection()\n\t\t\t\t\t\t\t.then((conn) => {\n\t\t\t\t\t\t\t\t// Use the connection to create a Services object and a LineGenerationManager.\n\t\t\t\t\t\t\t\tlet services = new SB.JSARServices(conn, settings);\n\t\t\t\t\t\t\t\tlet lineGenManager = new SB.JSARLineGenManager(conn, settings, services);\n\n\t\t\t\t\t\t\t\t// Get the Quote and determine its Type.\n\t\t\t\t\t\t\t\tlet quote = this.lineEditorModel.quote;\n\t\t\t\t\t\t\t\tlet isRenewal = quote.record[this.prefix + 'Type__c'] === 'Renewal';\n\n\t\t\t\t\t\t\t\t// Get the Subscription IDs that we need to process.\n\t\t\t\t\t\t\t\tlet subIds = Object.keys(this.selectedProducts);\n\n\t\t\t\t\t\t\t\t// Invoke the line generation manager.\n\t\t\t\t\t\t\t\tlet invocationPromise = isRenewal\n\t\t\t\t\t\t\t\t\t? lineGenManager.renewSubscriptionsToQuote(subIds, quote)\n\t\t\t\t\t\t\t\t\t: lineGenManager.amendSubscriptionsToQuote(subIds, quote);\n\t\t\t\t\t\t\t\tinvocationPromise\n\t\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\t\tres(result);\n\t\t\t\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\t\t\t\trej(err.message || err);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\t\trej(err.message || err);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\trej('ERROR: Could not find Client-Side Amend/Renew');\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t\t\t.then((quote) => {\n\t\t\t\t\t\tquote.calculationRequired = true;\n\t\t\t\t\t\tthis.lineEditorModel.quote = quote;\n\t\t\t\t\t\tthis.navigateToLineEditor();\n\t\t\t\t\t}, (error) => {\n\t\t\t\t\t\tthis.errors = [error];\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$.smSelectService.selectedProducts = this.selectedProducts;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tthis.navigateToLineEditor();\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = {'qId': this.lineEditorModel.quote.record.Id};\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet queryParams = {'qId': this.lineEditorModel.quote.record.Id };\n\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\tqueryParams.jspr = true;\n\t\tif(this.ctx.params.groupKey != null)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tthis.nav('#', queryParams, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.sf.runService();\n\t\tthis.closeDrawer();\n\t}\n\n\t////we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.subscriptionLookupObjects = [this.prefix + 'Subscription__c', 'Contract'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.sf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n\n}\n\nPolymer(SubscriptionLookup);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class OptionConfigurator {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-configure';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\toptionId: String,\n\t\t\tfeatureOptionalSKUs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tconfiguration: Object,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConfiguratorResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['load(quote, product, optionId, ignoreCache)'];\n\t}\n\n\tready() {\n\t\tlet service = this.$.service;\n\t\tservice.addEventListener('response-changed', function(e) {\n\t\t\tthis.optionConfiguratorResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tservice.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tthis.$.service.uid = this.optionId;\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\t\t// Since the service provider doesn't require quote lines, we can remove the lines from the model that gets sent\n\t\t// to the server.\n\t\tlet lineItems = this.quote.lineItems;\n\t\tthis.quote.lineItems = [];\n\t\tlet dataModel = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.add('optionId', this.optionId)\n\t\t\t.add('featureOptionalSKUs', this.featureOptionalSKUs)\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.addObject('parentProduct', this.serverProduct)\n\t\t\t.addObject('stagedOption', this.stagedOption);\n\t\t// Now that we've created a context that will be sent to the server, we mustn't forget to add the lines back to\n\t\t// the quote.\n\t\tthis.quote.lineItems = lineItems;\n\t\tthis.$.service.context = dataModel.build();\n\t}\n\n\t/**\n\t * Returns a simplified ProductVO to overcome the input too long error\n\t * @returns {Object}\n\t */\n\tget serverProduct() {\n\t\tlet serverProduct = {};\n\t\tserverProduct.configurationAttributes = this.product.configurationAttributes;\n\t\tserverProduct.inheritedConfigurationAttributes = this.product.inheritedConfigurationAttributes;\n\t\tif(this.product.configuration === undefined)\n\t\t\treturn serverProduct;\n\n\t\tserverProduct.configuration = {\n\t\t\tconfigurationData: this.product.configuration.configurationData,\n\t\t\tinheritedConfigurationData: this.product.configuration.inheritedConfigurationData\n\t\t};\n\n\t\treturn serverProduct;\n\t}\n\n\tget stagedOption() {\n\t\tif (this.product.nestedOptionModel == null || this.product.nestedOptionModel.stagedOption == null || this.product.nestedOptionModel.stagedOption.isDynamicOption)\n\t\t\treturn null;\n\t\treturn this.product.nestedOptionModel.stagedOption.optionData;\n\t}\n}\nPolymer(OptionConfigurator);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\nimport {QuoteMinimizer} from 'common/data/minimize/QuoteMinimizer.js';\nimport {QuoteAggregator} from 'common/aggregate/quote-aggregator/QuoteAggregator.js';\n\nexport class OptionSaver {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-save';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproducts: Array,\n\t\t\tconfiguration : Object,\n\t\t\tupgradeAssetId: String, //TODO: support UpgradeAssetId\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpsmResponse: { // is either a ProductSelectionModel or a ConfigurationVO depending on which method is called\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tstripLinesThreshold: Number,\n\t\t\tstripLinesMessage: String,\n\t\t\tcache: String //provides the ability to cache to response\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['topLevelSave(quote, products)', 'nestedConfigurationSave(quote, configuration)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tlet serverQuote = e.detail.value.quote;\n\t\t\t// The existence of serverQuote isn't guaranteed. If we're saving a nested bundle, we received a ProductConfigurationVO,\n\t\t\t// not a ProductSelectionModel. Only the latter will have a quote property.\n\t\t\tif (serverQuote && serverQuote.partialVO) {\n\t\t\t\tlet qa = new QuoteAggregator(this.quote, serverQuote, this.requiredKeys);\n\t\t\t\te.detail.value.quote = qa.reconcileServerQuoteWithUIQuote();\n\t\t\t}\n\t\t\tthis.psmResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\ttopLevelSave() {\n\t\tif (this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\n\t\tlet builder = new DataBuilder();\n\t\tbuilder.addObject('products', this.products);\n\t\tif (this.groupKey != null && this.groupKey >= 0) {\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\t\t}\n\n\t\tif (this.stripLinesThreshold == null || this.quote.lineItems.length < this.stripLinesThreshold) {\n\t\t\t// If no large quote threshold has been declared, or the quote's size is below that threshold, we can just\n\t\t\t// add the quote to the builder and be done.\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.$.service.model = builder.build();\n\t\t} else {\n\t\t\t// If the quote size exceeds the admin-declared large quote threshold, then we need to remove all non-essential\n\t\t\t// lines from the quote, and capture necessary data about the omitted lines.\n\t\t\tlet minimizer = new QuoteMinimizer(this.quote, this.products, this.groupkey, this.stripLinesThreshold, this.stripLinesMessage);\n\t\t\tthis.quote = minimizer.reduceQuote();\n\t\t\tthis.requiredKeys = minimizer.getRequiredKeys();\n\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.$.service.model = builder.build();\n\t\t\t// Now that we've sent the quote, we should remove all of the temporary attributes we added to it.\n\t\t\tthis.quote = minimizer.revertQuote();\n\t\t}\n\t}\n\n\tnestedConfigurationSave() {\n\t\tif(this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\t\t// The only line-level information required for saving nested configurations is the prior bundled quantity, which is\n\t\t// used to validate asset quantities. In order to avoid the massive scalability cost of sending all lines to the server,\n\t\t// we store the lines in a variable, remove them from the quote,a nd replace them with a map from line keys\n\t\t// to the prior bundled quantity.\n\t\tthis.quote.priorBundledQuantityByLineKey = new QuoteLineAggregator(this.quote).mapPriorBundledQuantityByLineKey();\n\t\tlet lines = this.quote.lineItems;\n\t\tthis.quote.lineItems = null;\n\t\tlet dataModel = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.add('upgradeAssetId', null);\n\t\t// After creating the model, we can reassign the lines and remove the map.\n\t\tthis.quote.lineItems = lines;\n\t\tdelete this.quote.priorBundledQuantityByLineKey;\n\t\t// Now we assign the model to the service to trigger the call.\n\t\tthis.$.service.model = dataModel.build();\n\t}\n}\nPolymer(OptionSaver);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class ProductLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-product-load';\n\t\tthis.properties = {\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfeatureOptionIds: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquote: Object,\n\t\t\tproduct: { //primarily used for test, may look to remove this in the future\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tproductLoadModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['load(quote, productIds, lineKey, ignoreCache)']\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.featureOptionIds = null;\n\t\t\tthis.productLoadModel = e.detail && e.detail.value ? e.detail.value : null;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tif (this.lineKey != null && this.lineKey >= 0 && this.lineKey > this.quote.nextKey)\n\t\t\treturn this.productLoadModel = { returnToQuote: 'The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it.' };\n\n\t\tvar products = [];\n\t\tvar pIds = this.productIds.split(',');\n\t\tpIds.forEach(function (pId) {\n\t\t\tproducts.push({record: {Id: pId}});\n\t\t});\n\t\tthis.$.service.context = undefined;\n\t\tthis.$.service.uid = this.featureOptionIds ? 'dynamic' : this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\n\t\tlet builder = new DataBuilder();\n\t\tif (this.featureOptionIds != null) {\n\t\t\tbuilder.add('featureOptionIds', this.featureOptionIds)\n\t\t\t\t.add('fieldSet', this.fieldSet);\n\t\t\t// If the feature option ID list isn't null, it's because we're loading dynamic options for a bundle.\n\t\t\t// In that case, we don't need any lines, and can just send the quote record.\n\t\t\tbuilder.addObject('quoteRecord', this.quote.record);\n\t\t} else if (this.lineKey != null && this.lineKey >= 0) {\n\t\t\tbuilder.add('lineKey', this.lineKey);\n\t\t\t// If the line key isn't null, it's because we're reconfiguring an existing bundle. So we should filter out\n\t\t\t// lines that aren't essential to that process.\n\t\t\tlet relevantLines = this._getLinesRelevantToParentKey(this.lineKey);\n\t\t\tlet allLines = this.quote.lineItems;\n\t\t\tthis.quote.lineItems = relevantLines;\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.quote.lineItems = allLines;\n\t\t} else {\n\t\t\tbuilder.addObject('products', products);\n\t\t\t// If there's no line key or feature option Ids, it means we're configuring a bundle that hasn't been actually\n\t\t\t// added to the quote yet. In that case, there's nothing that requires the lines, unless we decide we want to\n\t\t\t// support complete bundle upgrades outside of the 'Upgrade Assets' button. So we can just remove the lines from\n\t\t\t// the VO and send that.\n\t\t\tlet lineItems = this.quote.lineItems;\n\t\t\tthis.quote.lineItems = [];\n\t\t\tbuilder.addQuote('quote', this.quote);\n\t\t\tthis.quote.lineItems = lineItems;\n\t\t}\n\t\tif (this.groupKey != null && this.groupKey >= 0) {\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\t\t}\n\t\tthis.$.service.context = builder.build();\n\t}\n\n\t/**\n\t * Returns all lines related to the provided key, including the line itself, all of its descendants, source lines for\n\t * the aforementioned, and any of their descendents.\n\t * @param {Integer} key A top level key\n\t * @returns {Array} An array of all relevant quote lines\n\t * @private\n\t */\n\t_getLinesRelevantToParentKey(key) {\n\t\tlet prefix = this.quote.record.attributes.type == 'Quote__c' ? '' : this.quote.record.attributes.type.slice(0, -8);\n\t\tlet relevantLineKeys = new Set();\n\t\tlet addKeysRelevantTo = (lineKey) => {\n\t\t\t// Add the provided key to the set.\n\t\t\trelevantLineKeys.add(lineKey);\n\t\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\t\t// For each line whose parent item key is the provided key, add that line's key to the set.\n\t\t\t\tif (line.parentItemKey === lineKey) {\n\t\t\t\t\trelevantLineKeys.add(line.key);\n\t\t\t\t\t// If the child line has components, we make a recursive call to get those components.\n\t\t\t\t\tif (line.record[prefix + 'Bundle__c']) {\n\t\t\t\t\t\taddKeysRelevantTo(line.key);\n\t\t\t\t\t}\n\t\t\t\t\t// If the child line has a source line key, we make a recursive call to get all keys relevant to the source.\n\t\t\t\t\tif (line.sourceLineKey != null) {\n\t\t\t\t\t\taddKeysRelevantTo(line.sourceLineKey);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\taddKeysRelevantTo(key);\n\n\t\t// Now we have a set of all line keys that are in any way relevant to the top-level parent key. So get all lines\n\t\t// whose key is in that set.\n\t\tlet relevantLines = [];\n\t\tthis.quote.lineItems.forEach((line) => {\n\t\t\tif (relevantLineKeys.has(line.key)) {\n\t\t\t\trelevantLines.push(line);\n\t\t\t}\n\t\t});\n\t\treturn relevantLines;\n\t}\n}\nPolymer(ProductLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {QuoteLineAggregator} from 'common/aggregate/quote-line-aggregator/QuoteLineAggregator.js';\n\nexport class ProductRulesInvoker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-rules-invoke';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\tupgradeAssetId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tconfigResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['update(quote, product)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\n\t\t\tthis.configResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tupdate() {\n\t\t// in case this product is a cloned product, set the configuration key to product's key (or if not set simply set to the configuredProductId)\n\t\tthis.product.configuration.configuredProductKey = this.product.productKey || this.product.configuration.configuredProductId;\n\t\t// The only line-level information required for product configuration rules is the prior bundled quantity, which is used\n\t\t// to validate asset quantities. In order to avoid the massive scalability cost of sending all quote lines to the server,\n\t\t// we store the lines in a variable, remove them from the quote, and replace them with a map from line keys\n\t\t// to the prior bundled quantity.\n\t\tthis.quote.priorBundledQuantityByLineKey = new QuoteLineAggregator(this.quote).mapPriorBundledQuantityByLineKey();\n\t\tlet lines = this.quote.lineItems;\n\t\tthis.quote.lineItems = null;\n\t\tthis.$.service.model = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote, true)\n\t\t\t.addObject('configuration', this.product.configuration)\n\t\t\t.add('upgradeAssetId', this.upgradeAssetId)\n\t\t\t.build();\n\t\t// After making the service call, reassign the lines back to the quote.\n\t\tthis.quote.lineItems = lines;\n\t\tdelete this.quote.priorBundledQuantityByLineKey;\n\t}\n}\nPolymer(ProductRulesInvoker);"]}